import{_ as oo}from"./index.js";var as=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Px(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Dx(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var s=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(s,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),s}var Kh={exports:{}},Xi={},Qh={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var io=Symbol.for("react.element"),Ix=Symbol.for("react.portal"),Ox=Symbol.for("react.fragment"),Ax=Symbol.for("react.strict_mode"),$x=Symbol.for("react.profiler"),Lx=Symbol.for("react.provider"),Rx=Symbol.for("react.context"),zx=Symbol.for("react.forward_ref"),Fx=Symbol.for("react.suspense"),Ux=Symbol.for("react.memo"),Bx=Symbol.for("react.lazy"),Ju=Symbol.iterator;function Hx(e){return e===null||typeof e!="object"?null:(e=Ju&&e[Ju]||e["@@iterator"],typeof e=="function"?e:null)}var Yh={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Jh=Object.assign,Xh={};function Vr(e,t,s){this.props=e,this.context=t,this.refs=Xh,this.updater=s||Yh}Vr.prototype.isReactComponent={};Vr.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Vr.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Zh(){}Zh.prototype=Vr.prototype;function Id(e,t,s){this.props=e,this.context=t,this.refs=Xh,this.updater=s||Yh}var Od=Id.prototype=new Zh;Od.constructor=Id;Jh(Od,Vr.prototype);Od.isPureReactComponent=!0;var Xu=Array.isArray,ef=Object.prototype.hasOwnProperty,Ad={current:null},tf={key:!0,ref:!0,__self:!0,__source:!0};function sf(e,t,s){var n,a={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)ef.call(t,n)&&!tf.hasOwnProperty(n)&&(a[n]=t[n]);var l=arguments.length-2;if(l===1)a.children=s;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps,l)a[n]===void 0&&(a[n]=l[n]);return{$$typeof:io,type:e,key:o,ref:i,props:a,_owner:Ad.current}}function Wx(e,t){return{$$typeof:io,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $d(e){return typeof e=="object"&&e!==null&&e.$$typeof===io}function Vx(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Zu=/\/+/g;function Tl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Vx(""+e.key):t.toString(36)}function ei(e,t,s,n,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case io:case Ix:i=!0}}if(i)return i=e,a=a(i),e=n===""?"."+Tl(i,0):n,Xu(a)?(s="",e!=null&&(s=e.replace(Zu,"$&/")+"/"),ei(a,t,s,"",function(d){return d})):a!=null&&($d(a)&&(a=Wx(a,s+(!a.key||i&&i.key===a.key?"":(""+a.key).replace(Zu,"$&/")+"/")+e)),t.push(a)),1;if(i=0,n=n===""?".":n+":",Xu(e))for(var l=0;l<e.length;l++){o=e[l];var c=n+Tl(o,l);i+=ei(o,t,s,c,a)}else if(c=Hx(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=n+Tl(o,l++),i+=ei(o,t,s,c,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function So(e,t,s){if(e==null)return e;var n=[],a=0;return ei(e,n,"","",function(o){return t.call(s,o,a++)}),n}function qx(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ot={current:null},ti={transition:null},Gx={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:ti,ReactCurrentOwner:Ad};function nf(){throw Error("act(...) is not supported in production builds of React.")}$e.Children={map:So,forEach:function(e,t,s){So(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return So(e,function(){t++}),t},toArray:function(e){return So(e,function(t){return t})||[]},only:function(e){if(!$d(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};$e.Component=Vr;$e.Fragment=Ox;$e.Profiler=$x;$e.PureComponent=Id;$e.StrictMode=Ax;$e.Suspense=Fx;$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gx;$e.act=nf;$e.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Jh({},e.props),a=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Ad.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)ef.call(t,c)&&!tf.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=s;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:io,type:e.type,key:a,ref:o,props:n,_owner:i}};$e.createContext=function(e){return e={$$typeof:Rx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Lx,_context:e},e.Consumer=e};$e.createElement=sf;$e.createFactory=function(e){var t=sf.bind(null,e);return t.type=e,t};$e.createRef=function(){return{current:null}};$e.forwardRef=function(e){return{$$typeof:zx,render:e}};$e.isValidElement=$d;$e.lazy=function(e){return{$$typeof:Bx,_payload:{_status:-1,_result:e},_init:qx}};$e.memo=function(e,t){return{$$typeof:Ux,type:e,compare:t===void 0?null:t}};$e.startTransition=function(e){var t=ti.transition;ti.transition={};try{e()}finally{ti.transition=t}};$e.unstable_act=nf;$e.useCallback=function(e,t){return Ot.current.useCallback(e,t)};$e.useContext=function(e){return Ot.current.useContext(e)};$e.useDebugValue=function(){};$e.useDeferredValue=function(e){return Ot.current.useDeferredValue(e)};$e.useEffect=function(e,t){return Ot.current.useEffect(e,t)};$e.useId=function(){return Ot.current.useId()};$e.useImperativeHandle=function(e,t,s){return Ot.current.useImperativeHandle(e,t,s)};$e.useInsertionEffect=function(e,t){return Ot.current.useInsertionEffect(e,t)};$e.useLayoutEffect=function(e,t){return Ot.current.useLayoutEffect(e,t)};$e.useMemo=function(e,t){return Ot.current.useMemo(e,t)};$e.useReducer=function(e,t,s){return Ot.current.useReducer(e,t,s)};$e.useRef=function(e){return Ot.current.useRef(e)};$e.useState=function(e){return Ot.current.useState(e)};$e.useSyncExternalStore=function(e,t,s){return Ot.current.useSyncExternalStore(e,t,s)};$e.useTransition=function(){return Ot.current.useTransition()};$e.version="18.3.1";Qh.exports=$e;var h=Qh.exports;const em=Px(h);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kx=h,Qx=Symbol.for("react.element"),Yx=Symbol.for("react.fragment"),Jx=Object.prototype.hasOwnProperty,Xx=Kx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Zx={key:!0,ref:!0,__self:!0,__source:!0};function rf(e,t,s){var n,a={},o=null,i=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)Jx.call(t,n)&&!Zx.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:Qx,type:e,key:o,ref:i,props:a,_owner:Xx.current}}Xi.Fragment=Yx;Xi.jsx=rf;Xi.jsxs=rf;Kh.exports=Xi;var r=Kh.exports,af={exports:{}},Yt={},of={exports:{}},lf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(se,oe){var Q=se.length;se.push(oe);e:for(;0<Q;){var J=Q-1>>>1,D=se[J];if(0<a(D,oe))se[J]=oe,se[Q]=D,Q=J;else break e}}function s(se){return se.length===0?null:se[0]}function n(se){if(se.length===0)return null;var oe=se[0],Q=se.pop();if(Q!==oe){se[0]=Q;e:for(var J=0,D=se.length,le=D>>>1;J<le;){var U=2*(J+1)-1,Y=se[U],ue=U+1,ve=se[ue];if(0>a(Y,Q))ue<D&&0>a(ve,Y)?(se[J]=ve,se[ue]=Q,J=ue):(se[J]=Y,se[U]=Q,J=U);else if(ue<D&&0>a(ve,Q))se[J]=ve,se[ue]=Q,J=ue;else break e}}return oe}function a(se,oe){var Q=se.sortIndex-oe.sortIndex;return Q!==0?Q:se.id-oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,m=null,f=3,p=!1,S=!1,E=!1,T=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(se){for(var oe=s(d);oe!==null;){if(oe.callback===null)n(d);else if(oe.startTime<=se)n(d),oe.sortIndex=oe.expirationTime,t(c,oe);else break;oe=s(d)}}function _(se){if(E=!1,x(se),!S)if(s(c)!==null)S=!0,_e(F);else{var oe=s(d);oe!==null&&Ee(_,oe.startTime-se)}}function F(se,oe){S=!1,E&&(E=!1,y(R),R=-1),p=!0;var Q=f;try{for(x(oe),m=s(c);m!==null&&(!(m.expirationTime>oe)||se&&!I());){var J=m.callback;if(typeof J=="function"){m.callback=null,f=m.priorityLevel;var D=J(m.expirationTime<=oe);oe=e.unstable_now(),typeof D=="function"?m.callback=D:m===s(c)&&n(c),x(oe)}else n(c);m=s(c)}if(m!==null)var le=!0;else{var U=s(d);U!==null&&Ee(_,U.startTime-oe),le=!1}return le}finally{m=null,f=Q,p=!1}}var A=!1,H=null,R=-1,ge=5,ce=-1;function I(){return!(e.unstable_now()-ce<ge)}function ee(){if(H!==null){var se=e.unstable_now();ce=se;var oe=!0;try{oe=H(!0,se)}finally{oe?te():(A=!1,H=null)}}else A=!1}var te;if(typeof g=="function")te=function(){g(ee)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Se=be.port2;be.port1.onmessage=ee,te=function(){Se.postMessage(null)}}else te=function(){T(ee,0)};function _e(se){H=se,A||(A=!0,te())}function Ee(se,oe){R=T(function(){se(e.unstable_now())},oe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(se){se.callback=null},e.unstable_continueExecution=function(){S||p||(S=!0,_e(F))},e.unstable_forceFrameRate=function(se){0>se||125<se?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<se?Math.floor(1e3/se):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return s(c)},e.unstable_next=function(se){switch(f){case 1:case 2:case 3:var oe=3;break;default:oe=f}var Q=f;f=oe;try{return se()}finally{f=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(se,oe){switch(se){case 1:case 2:case 3:case 4:case 5:break;default:se=3}var Q=f;f=se;try{return oe()}finally{f=Q}},e.unstable_scheduleCallback=function(se,oe,Q){var J=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?J+Q:J):Q=J,se){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=Q+D,se={id:u++,callback:oe,priorityLevel:se,startTime:Q,expirationTime:D,sortIndex:-1},Q>J?(se.sortIndex=Q,t(d,se),s(c)===null&&se===s(d)&&(E?(y(R),R=-1):E=!0,Ee(_,Q-J))):(se.sortIndex=D,t(c,se),S||p||(S=!0,_e(F))),se},e.unstable_shouldYield=I,e.unstable_wrapCallback=function(se){var oe=f;return function(){var Q=f;f=oe;try{return se.apply(this,arguments)}finally{f=Q}}}})(lf);of.exports=lf;var e0=of.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t0=h,Qt=e0;function de(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cf=new Set,Oa={};function Qn(e,t){Pr(e,t),Pr(e+"Capture",t)}function Pr(e,t){for(Oa[e]=t,e=0;e<t.length;e++)cf.add(t[e])}var Ws=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),xc=Object.prototype.hasOwnProperty,s0=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tm={},sm={};function n0(e){return xc.call(sm,e)?!0:xc.call(tm,e)?!1:s0.test(e)?sm[e]=!0:(tm[e]=!0,!1)}function r0(e,t,s,n){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function a0(e,t,s,n){if(t===null||typeof t>"u"||r0(e,t,s,n))return!0;if(n)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function At(e,t,s,n,a,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var St={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){St[e]=new At(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];St[t]=new At(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){St[e]=new At(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){St[e]=new At(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){St[e]=new At(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){St[e]=new At(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){St[e]=new At(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){St[e]=new At(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){St[e]=new At(e,5,!1,e.toLowerCase(),null,!1,!1)});var Ld=/[\-:]([a-z])/g;function Rd(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Ld,Rd);St[t]=new At(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Ld,Rd);St[t]=new At(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Ld,Rd);St[t]=new At(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){St[e]=new At(e,1,!1,e.toLowerCase(),null,!1,!1)});St.xlinkHref=new At("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){St[e]=new At(e,1,!1,e.toLowerCase(),null,!0,!0)});function zd(e,t,s,n){var a=St.hasOwnProperty(t)?St[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(a0(t,s,a,n)&&(s=null),n||a===null?n0(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,n=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,n?e.setAttributeNS(n,t,s):e.setAttribute(t,s))))}var Qs=t0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_o=Symbol.for("react.element"),ur=Symbol.for("react.portal"),mr=Symbol.for("react.fragment"),Fd=Symbol.for("react.strict_mode"),yc=Symbol.for("react.profiler"),df=Symbol.for("react.provider"),uf=Symbol.for("react.context"),Ud=Symbol.for("react.forward_ref"),vc=Symbol.for("react.suspense"),bc=Symbol.for("react.suspense_list"),Bd=Symbol.for("react.memo"),tn=Symbol.for("react.lazy"),mf=Symbol.for("react.offscreen"),nm=Symbol.iterator;function Yr(e){return e===null||typeof e!="object"?null:(e=nm&&e[nm]||e["@@iterator"],typeof e=="function"?e:null)}var at=Object.assign,Ml;function la(e){if(Ml===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);Ml=t&&t[1]||""}return`
`+Ml+e}var Pl=!1;function Dl(e,t){if(!e||Pl)return"";Pl=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),o=n.stack.split(`
`),i=a.length-1,l=o.length-1;1<=i&&0<=l&&a[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(a[i]!==o[l]){if(i!==1||l!==1)do if(i--,l--,0>l||a[i]!==o[l]){var c=`
`+a[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=l);break}}}finally{Pl=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?la(e):""}function o0(e){switch(e.tag){case 5:return la(e.type);case 16:return la("Lazy");case 13:return la("Suspense");case 19:return la("SuspenseList");case 0:case 2:case 15:return e=Dl(e.type,!1),e;case 11:return e=Dl(e.type.render,!1),e;case 1:return e=Dl(e.type,!0),e;default:return""}}function jc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case mr:return"Fragment";case ur:return"Portal";case yc:return"Profiler";case Fd:return"StrictMode";case vc:return"Suspense";case bc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uf:return(e.displayName||"Context")+".Consumer";case df:return(e._context.displayName||"Context")+".Provider";case Ud:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Bd:return t=e.displayName||null,t!==null?t:jc(e.type)||"Memo";case tn:t=e._payload,e=e._init;try{return jc(e(t))}catch{}}return null}function i0(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return jc(t);case 8:return t===Fd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function vn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function hf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function l0(e){var t=hf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Co(e){e._valueTracker||(e._valueTracker=l0(e))}function ff(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),n="";return e&&(n=hf(e)?e.checked?"true":"false":e.value),e=n,e!==s?(t.setValue(e),!0):!1}function yi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function wc(e,t){var s=t.checked;return at({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function rm(e,t){var s=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;s=vn(t.value!=null?t.value:s),e._wrapperState={initialChecked:n,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pf(e,t){t=t.checked,t!=null&&zd(e,"checked",t,!1)}function Nc(e,t){pf(e,t);var s=vn(t.value),n=t.type;if(s!=null)n==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?kc(e,t.type,s):t.hasOwnProperty("defaultValue")&&kc(e,t.type,vn(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function am(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function kc(e,t,s){(t!=="number"||yi(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var ca=Array.isArray;function Nr(e,t,s,n){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&n&&(e[s].defaultSelected=!0)}else{for(s=""+vn(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Sc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(de(91));return at({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function om(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(de(92));if(ca(s)){if(1<s.length)throw Error(de(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:vn(s)}}function gf(e,t){var s=vn(t.value),n=vn(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),n!=null&&(e.defaultValue=""+n)}function im(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function xf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _c(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Eo,yf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Eo=Eo||document.createElement("div"),Eo.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Eo.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Aa(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var fa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},c0=["Webkit","ms","Moz","O"];Object.keys(fa).forEach(function(e){c0.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fa[t]=fa[e]})});function vf(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||fa.hasOwnProperty(e)&&fa[e]?(""+t).trim():t+"px"}function bf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var n=s.indexOf("--")===0,a=vf(s,t[s],n);s==="float"&&(s="cssFloat"),n?e.setProperty(s,a):e[s]=a}}var d0=at({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cc(e,t){if(t){if(d0[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(de(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(de(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(de(61))}if(t.style!=null&&typeof t.style!="object")throw Error(de(62))}}function Ec(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tc=null;function Hd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Mc=null,kr=null,Sr=null;function lm(e){if(e=uo(e)){if(typeof Mc!="function")throw Error(de(280));var t=e.stateNode;t&&(t=nl(t),Mc(e.stateNode,e.type,t))}}function jf(e){kr?Sr?Sr.push(e):Sr=[e]:kr=e}function wf(){if(kr){var e=kr,t=Sr;if(Sr=kr=null,lm(e),t)for(e=0;e<t.length;e++)lm(t[e])}}function Nf(e,t){return e(t)}function kf(){}var Il=!1;function Sf(e,t,s){if(Il)return e(t,s);Il=!0;try{return Nf(e,t,s)}finally{Il=!1,(kr!==null||Sr!==null)&&(kf(),wf())}}function $a(e,t){var s=e.stateNode;if(s===null)return null;var n=nl(s);if(n===null)return null;s=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(de(231,t,typeof s));return s}var Pc=!1;if(Ws)try{var Jr={};Object.defineProperty(Jr,"passive",{get:function(){Pc=!0}}),window.addEventListener("test",Jr,Jr),window.removeEventListener("test",Jr,Jr)}catch{Pc=!1}function u0(e,t,s,n,a,o,i,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(s,d)}catch(u){this.onError(u)}}var pa=!1,vi=null,bi=!1,Dc=null,m0={onError:function(e){pa=!0,vi=e}};function h0(e,t,s,n,a,o,i,l,c){pa=!1,vi=null,u0.apply(m0,arguments)}function f0(e,t,s,n,a,o,i,l,c){if(h0.apply(this,arguments),pa){if(pa){var d=vi;pa=!1,vi=null}else throw Error(de(198));bi||(bi=!0,Dc=d)}}function Yn(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function _f(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function cm(e){if(Yn(e)!==e)throw Error(de(188))}function p0(e){var t=e.alternate;if(!t){if(t=Yn(e),t===null)throw Error(de(188));return t!==e?null:e}for(var s=e,n=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(n=a.return,n!==null){s=n;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return cm(a),e;if(o===n)return cm(a),t;o=o.sibling}throw Error(de(188))}if(s.return!==n.return)s=a,n=o;else{for(var i=!1,l=a.child;l;){if(l===s){i=!0,s=a,n=o;break}if(l===n){i=!0,n=a,s=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===s){i=!0,s=o,n=a;break}if(l===n){i=!0,n=o,s=a;break}l=l.sibling}if(!i)throw Error(de(189))}}if(s.alternate!==n)throw Error(de(190))}if(s.tag!==3)throw Error(de(188));return s.stateNode.current===s?e:t}function Cf(e){return e=p0(e),e!==null?Ef(e):null}function Ef(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ef(e);if(t!==null)return t;e=e.sibling}return null}var Tf=Qt.unstable_scheduleCallback,dm=Qt.unstable_cancelCallback,g0=Qt.unstable_shouldYield,x0=Qt.unstable_requestPaint,ct=Qt.unstable_now,y0=Qt.unstable_getCurrentPriorityLevel,Wd=Qt.unstable_ImmediatePriority,Mf=Qt.unstable_UserBlockingPriority,ji=Qt.unstable_NormalPriority,v0=Qt.unstable_LowPriority,Pf=Qt.unstable_IdlePriority,Zi=null,Cs=null;function b0(e){if(Cs&&typeof Cs.onCommitFiberRoot=="function")try{Cs.onCommitFiberRoot(Zi,e,void 0,(e.current.flags&128)===128)}catch{}}var ys=Math.clz32?Math.clz32:N0,j0=Math.log,w0=Math.LN2;function N0(e){return e>>>=0,e===0?32:31-(j0(e)/w0|0)|0}var To=64,Mo=4194304;function da(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function wi(e,t){var s=e.pendingLanes;if(s===0)return 0;var n=0,a=e.suspendedLanes,o=e.pingedLanes,i=s&268435455;if(i!==0){var l=i&~a;l!==0?n=da(l):(o&=i,o!==0&&(n=da(o)))}else i=s&~a,i!==0?n=da(i):o!==0&&(n=da(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(n&4&&(n|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)s=31-ys(t),a=1<<s,n|=e[s],t&=~a;return n}function k0(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function S0(e,t){for(var s=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-ys(o),l=1<<i,c=a[i];c===-1?(!(l&s)||l&n)&&(a[i]=k0(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function Ic(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Df(){var e=To;return To<<=1,!(To&4194240)&&(To=64),e}function Ol(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function lo(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ys(t),e[t]=s}function _0(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-ys(s),o=1<<a;t[a]=0,n[a]=-1,e[a]=-1,s&=~o}}function Vd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var n=31-ys(s),a=1<<n;a&t|e[n]&t&&(e[n]|=t),s&=~a}}var We=0;function If(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Of,qd,Af,$f,Lf,Oc=!1,Po=[],dn=null,un=null,mn=null,La=new Map,Ra=new Map,nn=[],C0="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function um(e,t){switch(e){case"focusin":case"focusout":dn=null;break;case"dragenter":case"dragleave":un=null;break;case"mouseover":case"mouseout":mn=null;break;case"pointerover":case"pointerout":La.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ra.delete(t.pointerId)}}function Xr(e,t,s,n,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:n,nativeEvent:o,targetContainers:[a]},t!==null&&(t=uo(t),t!==null&&qd(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function E0(e,t,s,n,a){switch(t){case"focusin":return dn=Xr(dn,e,t,s,n,a),!0;case"dragenter":return un=Xr(un,e,t,s,n,a),!0;case"mouseover":return mn=Xr(mn,e,t,s,n,a),!0;case"pointerover":var o=a.pointerId;return La.set(o,Xr(La.get(o)||null,e,t,s,n,a)),!0;case"gotpointercapture":return o=a.pointerId,Ra.set(o,Xr(Ra.get(o)||null,e,t,s,n,a)),!0}return!1}function Rf(e){var t=An(e.target);if(t!==null){var s=Yn(t);if(s!==null){if(t=s.tag,t===13){if(t=_f(s),t!==null){e.blockedOn=t,Lf(e.priority,function(){Af(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function si(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Ac(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var n=new s.constructor(s.type,s);Tc=n,s.target.dispatchEvent(n),Tc=null}else return t=uo(s),t!==null&&qd(t),e.blockedOn=s,!1;t.shift()}return!0}function mm(e,t,s){si(e)&&s.delete(t)}function T0(){Oc=!1,dn!==null&&si(dn)&&(dn=null),un!==null&&si(un)&&(un=null),mn!==null&&si(mn)&&(mn=null),La.forEach(mm),Ra.forEach(mm)}function Zr(e,t){e.blockedOn===t&&(e.blockedOn=null,Oc||(Oc=!0,Qt.unstable_scheduleCallback(Qt.unstable_NormalPriority,T0)))}function za(e){function t(a){return Zr(a,e)}if(0<Po.length){Zr(Po[0],e);for(var s=1;s<Po.length;s++){var n=Po[s];n.blockedOn===e&&(n.blockedOn=null)}}for(dn!==null&&Zr(dn,e),un!==null&&Zr(un,e),mn!==null&&Zr(mn,e),La.forEach(t),Ra.forEach(t),s=0;s<nn.length;s++)n=nn[s],n.blockedOn===e&&(n.blockedOn=null);for(;0<nn.length&&(s=nn[0],s.blockedOn===null);)Rf(s),s.blockedOn===null&&nn.shift()}var _r=Qs.ReactCurrentBatchConfig,Ni=!0;function M0(e,t,s,n){var a=We,o=_r.transition;_r.transition=null;try{We=1,Gd(e,t,s,n)}finally{We=a,_r.transition=o}}function P0(e,t,s,n){var a=We,o=_r.transition;_r.transition=null;try{We=4,Gd(e,t,s,n)}finally{We=a,_r.transition=o}}function Gd(e,t,s,n){if(Ni){var a=Ac(e,t,s,n);if(a===null)Wl(e,t,n,ki,s),um(e,n);else if(E0(a,e,t,s,n))n.stopPropagation();else if(um(e,n),t&4&&-1<C0.indexOf(e)){for(;a!==null;){var o=uo(a);if(o!==null&&Of(o),o=Ac(e,t,s,n),o===null&&Wl(e,t,n,ki,s),o===a)break;a=o}a!==null&&n.stopPropagation()}else Wl(e,t,n,null,s)}}var ki=null;function Ac(e,t,s,n){if(ki=null,e=Hd(n),e=An(e),e!==null)if(t=Yn(e),t===null)e=null;else if(s=t.tag,s===13){if(e=_f(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ki=e,null}function zf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(y0()){case Wd:return 1;case Mf:return 4;case ji:case v0:return 16;case Pf:return 536870912;default:return 16}default:return 16}}var ln=null,Kd=null,ni=null;function Ff(){if(ni)return ni;var e,t=Kd,s=t.length,n,a="value"in ln?ln.value:ln.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var i=s-e;for(n=1;n<=i&&t[s-n]===a[o-n];n++);return ni=a.slice(e,1<n?1-n:void 0)}function ri(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Do(){return!0}function hm(){return!1}function Jt(e){function t(s,n,a,o,i){this._reactName=s,this._targetInst=a,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(s=e[l],this[l]=s?s(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Do:hm,this.isPropagationStopped=hm,this}return at(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),t}var qr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qd=Jt(qr),co=at({},qr,{view:0,detail:0}),D0=Jt(co),Al,$l,ea,el=at({},co,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ea&&(ea&&e.type==="mousemove"?(Al=e.screenX-ea.screenX,$l=e.screenY-ea.screenY):$l=Al=0,ea=e),Al)},movementY:function(e){return"movementY"in e?e.movementY:$l}}),fm=Jt(el),I0=at({},el,{dataTransfer:0}),O0=Jt(I0),A0=at({},co,{relatedTarget:0}),Ll=Jt(A0),$0=at({},qr,{animationName:0,elapsedTime:0,pseudoElement:0}),L0=Jt($0),R0=at({},qr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),z0=Jt(R0),F0=at({},qr,{data:0}),pm=Jt(F0),U0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},B0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},H0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function W0(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=H0[e])?!!t[e]:!1}function Yd(){return W0}var V0=at({},co,{key:function(e){if(e.key){var t=U0[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ri(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?B0[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yd,charCode:function(e){return e.type==="keypress"?ri(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ri(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),q0=Jt(V0),G0=at({},el,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gm=Jt(G0),K0=at({},co,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yd}),Q0=Jt(K0),Y0=at({},qr,{propertyName:0,elapsedTime:0,pseudoElement:0}),J0=Jt(Y0),X0=at({},el,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Z0=Jt(X0),ey=[9,13,27,32],Jd=Ws&&"CompositionEvent"in window,ga=null;Ws&&"documentMode"in document&&(ga=document.documentMode);var ty=Ws&&"TextEvent"in window&&!ga,Uf=Ws&&(!Jd||ga&&8<ga&&11>=ga),xm=" ",ym=!1;function Bf(e,t){switch(e){case"keyup":return ey.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var hr=!1;function sy(e,t){switch(e){case"compositionend":return Hf(t);case"keypress":return t.which!==32?null:(ym=!0,xm);case"textInput":return e=t.data,e===xm&&ym?null:e;default:return null}}function ny(e,t){if(hr)return e==="compositionend"||!Jd&&Bf(e,t)?(e=Ff(),ni=Kd=ln=null,hr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Uf&&t.locale!=="ko"?null:t.data;default:return null}}var ry={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vm(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ry[e.type]:t==="textarea"}function Wf(e,t,s,n){jf(n),t=Si(t,"onChange"),0<t.length&&(s=new Qd("onChange","change",null,s,n),e.push({event:s,listeners:t}))}var xa=null,Fa=null;function ay(e){tp(e,0)}function tl(e){var t=gr(e);if(ff(t))return e}function oy(e,t){if(e==="change")return t}var Vf=!1;if(Ws){var Rl;if(Ws){var zl="oninput"in document;if(!zl){var bm=document.createElement("div");bm.setAttribute("oninput","return;"),zl=typeof bm.oninput=="function"}Rl=zl}else Rl=!1;Vf=Rl&&(!document.documentMode||9<document.documentMode)}function jm(){xa&&(xa.detachEvent("onpropertychange",qf),Fa=xa=null)}function qf(e){if(e.propertyName==="value"&&tl(Fa)){var t=[];Wf(t,Fa,e,Hd(e)),Sf(ay,t)}}function iy(e,t,s){e==="focusin"?(jm(),xa=t,Fa=s,xa.attachEvent("onpropertychange",qf)):e==="focusout"&&jm()}function ly(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return tl(Fa)}function cy(e,t){if(e==="click")return tl(t)}function dy(e,t){if(e==="input"||e==="change")return tl(t)}function uy(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var js=typeof Object.is=="function"?Object.is:uy;function Ua(e,t){if(js(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var a=s[n];if(!xc.call(t,a)||!js(e[a],t[a]))return!1}return!0}function wm(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Nm(e,t){var s=wm(e);e=0;for(var n;s;){if(s.nodeType===3){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=wm(s)}}function Gf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Gf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Kf(){for(var e=window,t=yi();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=yi(e.document)}return t}function Xd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function my(e){var t=Kf(),s=e.focusedElem,n=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Gf(s.ownerDocument.documentElement,s)){if(n!==null&&Xd(s)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(n.start,a);n=n.end===void 0?o:Math.min(n.end,a),!e.extend&&o>n&&(a=n,n=o,o=a),a=Nm(s,o);var i=Nm(s,n);a&&i&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hy=Ws&&"documentMode"in document&&11>=document.documentMode,fr=null,$c=null,ya=null,Lc=!1;function km(e,t,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Lc||fr==null||fr!==yi(n)||(n=fr,"selectionStart"in n&&Xd(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ya&&Ua(ya,n)||(ya=n,n=Si($c,"onSelect"),0<n.length&&(t=new Qd("onSelect","select",null,t,s),e.push({event:t,listeners:n}),t.target=fr)))}function Io(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var pr={animationend:Io("Animation","AnimationEnd"),animationiteration:Io("Animation","AnimationIteration"),animationstart:Io("Animation","AnimationStart"),transitionend:Io("Transition","TransitionEnd")},Fl={},Qf={};Ws&&(Qf=document.createElement("div").style,"AnimationEvent"in window||(delete pr.animationend.animation,delete pr.animationiteration.animation,delete pr.animationstart.animation),"TransitionEvent"in window||delete pr.transitionend.transition);function sl(e){if(Fl[e])return Fl[e];if(!pr[e])return e;var t=pr[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Qf)return Fl[e]=t[s];return e}var Yf=sl("animationend"),Jf=sl("animationiteration"),Xf=sl("animationstart"),Zf=sl("transitionend"),ep=new Map,Sm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wn(e,t){ep.set(e,t),Qn(t,[e])}for(var Ul=0;Ul<Sm.length;Ul++){var Bl=Sm[Ul],fy=Bl.toLowerCase(),py=Bl[0].toUpperCase()+Bl.slice(1);wn(fy,"on"+py)}wn(Yf,"onAnimationEnd");wn(Jf,"onAnimationIteration");wn(Xf,"onAnimationStart");wn("dblclick","onDoubleClick");wn("focusin","onFocus");wn("focusout","onBlur");wn(Zf,"onTransitionEnd");Pr("onMouseEnter",["mouseout","mouseover"]);Pr("onMouseLeave",["mouseout","mouseover"]);Pr("onPointerEnter",["pointerout","pointerover"]);Pr("onPointerLeave",["pointerout","pointerover"]);Qn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ua="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),gy=new Set("cancel close invalid load scroll toggle".split(" ").concat(ua));function _m(e,t,s){var n=e.type||"unknown-event";e.currentTarget=s,f0(n,t,void 0,e),e.currentTarget=null}function tp(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var n=e[s],a=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var l=n[i],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&a.isPropagationStopped())break e;_m(a,l,d),o=c}else for(i=0;i<n.length;i++){if(l=n[i],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&a.isPropagationStopped())break e;_m(a,l,d),o=c}}}if(bi)throw e=Dc,bi=!1,Dc=null,e}function Xe(e,t){var s=t[Bc];s===void 0&&(s=t[Bc]=new Set);var n=e+"__bubble";s.has(n)||(sp(t,e,2,!1),s.add(n))}function Hl(e,t,s){var n=0;t&&(n|=4),sp(s,e,n,t)}var Oo="_reactListening"+Math.random().toString(36).slice(2);function Ba(e){if(!e[Oo]){e[Oo]=!0,cf.forEach(function(s){s!=="selectionchange"&&(gy.has(s)||Hl(s,!1,e),Hl(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Oo]||(t[Oo]=!0,Hl("selectionchange",!1,t))}}function sp(e,t,s,n){switch(zf(t)){case 1:var a=M0;break;case 4:a=P0;break;default:a=Gd}s=a.bind(null,t,s,e),a=void 0,!Pc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function Wl(e,t,s,n,a){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var l=n.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(i===4)for(i=n.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;i=i.return}for(;l!==null;){if(i=An(l),i===null)return;if(c=i.tag,c===5||c===6){n=o=i;continue e}l=l.parentNode}}n=n.return}Sf(function(){var d=o,u=Hd(s),m=[];e:{var f=ep.get(e);if(f!==void 0){var p=Qd,S=e;switch(e){case"keypress":if(ri(s)===0)break e;case"keydown":case"keyup":p=q0;break;case"focusin":S="focus",p=Ll;break;case"focusout":S="blur",p=Ll;break;case"beforeblur":case"afterblur":p=Ll;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=fm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=O0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Q0;break;case Yf:case Jf:case Xf:p=L0;break;case Zf:p=J0;break;case"scroll":p=D0;break;case"wheel":p=Z0;break;case"copy":case"cut":case"paste":p=z0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=gm}var E=(t&4)!==0,T=!E&&e==="scroll",y=E?f!==null?f+"Capture":null:f;E=[];for(var g=d,x;g!==null;){x=g;var _=x.stateNode;if(x.tag===5&&_!==null&&(x=_,y!==null&&(_=$a(g,y),_!=null&&E.push(Ha(g,_,x)))),T)break;g=g.return}0<E.length&&(f=new p(f,S,null,s,u),m.push({event:f,listeners:E}))}}if(!(t&7)){e:{if(f=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",f&&s!==Tc&&(S=s.relatedTarget||s.fromElement)&&(An(S)||S[Vs]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(S=s.relatedTarget||s.toElement,p=d,S=S?An(S):null,S!==null&&(T=Yn(S),S!==T||S.tag!==5&&S.tag!==6)&&(S=null)):(p=null,S=d),p!==S)){if(E=fm,_="onMouseLeave",y="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(E=gm,_="onPointerLeave",y="onPointerEnter",g="pointer"),T=p==null?f:gr(p),x=S==null?f:gr(S),f=new E(_,g+"leave",p,s,u),f.target=T,f.relatedTarget=x,_=null,An(u)===d&&(E=new E(y,g+"enter",S,s,u),E.target=x,E.relatedTarget=T,_=E),T=_,p&&S)t:{for(E=p,y=S,g=0,x=E;x;x=Zn(x))g++;for(x=0,_=y;_;_=Zn(_))x++;for(;0<g-x;)E=Zn(E),g--;for(;0<x-g;)y=Zn(y),x--;for(;g--;){if(E===y||y!==null&&E===y.alternate)break t;E=Zn(E),y=Zn(y)}E=null}else E=null;p!==null&&Cm(m,f,p,E,!1),S!==null&&T!==null&&Cm(m,T,S,E,!0)}}e:{if(f=d?gr(d):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var F=oy;else if(vm(f))if(Vf)F=dy;else{F=ly;var A=iy}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(F=cy);if(F&&(F=F(e,d))){Wf(m,F,s,u);break e}A&&A(e,f,d),e==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&kc(f,"number",f.value)}switch(A=d?gr(d):window,e){case"focusin":(vm(A)||A.contentEditable==="true")&&(fr=A,$c=d,ya=null);break;case"focusout":ya=$c=fr=null;break;case"mousedown":Lc=!0;break;case"contextmenu":case"mouseup":case"dragend":Lc=!1,km(m,s,u);break;case"selectionchange":if(hy)break;case"keydown":case"keyup":km(m,s,u)}var H;if(Jd)e:{switch(e){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else hr?Bf(e,s)&&(R="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(R="onCompositionStart");R&&(Uf&&s.locale!=="ko"&&(hr||R!=="onCompositionStart"?R==="onCompositionEnd"&&hr&&(H=Ff()):(ln=u,Kd="value"in ln?ln.value:ln.textContent,hr=!0)),A=Si(d,R),0<A.length&&(R=new pm(R,e,null,s,u),m.push({event:R,listeners:A}),H?R.data=H:(H=Hf(s),H!==null&&(R.data=H)))),(H=ty?sy(e,s):ny(e,s))&&(d=Si(d,"onBeforeInput"),0<d.length&&(u=new pm("onBeforeInput","beforeinput",null,s,u),m.push({event:u,listeners:d}),u.data=H))}tp(m,t)})}function Ha(e,t,s){return{instance:e,listener:t,currentTarget:s}}function Si(e,t){for(var s=t+"Capture",n=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=$a(e,s),o!=null&&n.unshift(Ha(e,o,a)),o=$a(e,t),o!=null&&n.push(Ha(e,o,a))),e=e.return}return n}function Zn(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Cm(e,t,s,n,a){for(var o=t._reactName,i=[];s!==null&&s!==n;){var l=s,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,a?(c=$a(s,o),c!=null&&i.unshift(Ha(s,c,l))):a||(c=$a(s,o),c!=null&&i.push(Ha(s,c,l)))),s=s.return}i.length!==0&&e.push({event:t,listeners:i})}var xy=/\r\n?/g,yy=/\u0000|\uFFFD/g;function Em(e){return(typeof e=="string"?e:""+e).replace(xy,`
`).replace(yy,"")}function Ao(e,t,s){if(t=Em(t),Em(e)!==t&&s)throw Error(de(425))}function _i(){}var Rc=null,zc=null;function Fc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Uc=typeof setTimeout=="function"?setTimeout:void 0,vy=typeof clearTimeout=="function"?clearTimeout:void 0,Tm=typeof Promise=="function"?Promise:void 0,by=typeof queueMicrotask=="function"?queueMicrotask:typeof Tm<"u"?function(e){return Tm.resolve(null).then(e).catch(jy)}:Uc;function jy(e){setTimeout(function(){throw e})}function Vl(e,t){var s=t,n=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(n===0){e.removeChild(a),za(t);return}n--}else s!=="$"&&s!=="$?"&&s!=="$!"||n++;s=a}while(s);za(t)}function hn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Mm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var Gr=Math.random().toString(36).slice(2),Ss="__reactFiber$"+Gr,Wa="__reactProps$"+Gr,Vs="__reactContainer$"+Gr,Bc="__reactEvents$"+Gr,wy="__reactListeners$"+Gr,Ny="__reactHandles$"+Gr;function An(e){var t=e[Ss];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Vs]||s[Ss]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=Mm(e);e!==null;){if(s=e[Ss])return s;e=Mm(e)}return t}e=s,s=e.parentNode}return null}function uo(e){return e=e[Ss]||e[Vs],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function gr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(de(33))}function nl(e){return e[Wa]||null}var Hc=[],xr=-1;function Nn(e){return{current:e}}function Ze(e){0>xr||(e.current=Hc[xr],Hc[xr]=null,xr--)}function Je(e,t){xr++,Hc[xr]=e.current,e.current=t}var bn={},Mt=Nn(bn),Bt=Nn(!1),Un=bn;function Dr(e,t){var s=e.type.contextTypes;if(!s)return bn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ht(e){return e=e.childContextTypes,e!=null}function Ci(){Ze(Bt),Ze(Mt)}function Pm(e,t,s){if(Mt.current!==bn)throw Error(de(168));Je(Mt,t),Je(Bt,s)}function np(e,t,s){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return s;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(de(108,i0(e)||"Unknown",a));return at({},s,n)}function Ei(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||bn,Un=Mt.current,Je(Mt,e),Je(Bt,Bt.current),!0}function Dm(e,t,s){var n=e.stateNode;if(!n)throw Error(de(169));s?(e=np(e,t,Un),n.__reactInternalMemoizedMergedChildContext=e,Ze(Bt),Ze(Mt),Je(Mt,e)):Ze(Bt),Je(Bt,s)}var Ls=null,rl=!1,ql=!1;function rp(e){Ls===null?Ls=[e]:Ls.push(e)}function ky(e){rl=!0,rp(e)}function kn(){if(!ql&&Ls!==null){ql=!0;var e=0,t=We;try{var s=Ls;for(We=1;e<s.length;e++){var n=s[e];do n=n(!0);while(n!==null)}Ls=null,rl=!1}catch(a){throw Ls!==null&&(Ls=Ls.slice(e+1)),Tf(Wd,kn),a}finally{We=t,ql=!1}}return null}var yr=[],vr=0,Ti=null,Mi=0,es=[],ts=0,Bn=null,Rs=1,zs="";function Pn(e,t){yr[vr++]=Mi,yr[vr++]=Ti,Ti=e,Mi=t}function ap(e,t,s){es[ts++]=Rs,es[ts++]=zs,es[ts++]=Bn,Bn=e;var n=Rs;e=zs;var a=32-ys(n)-1;n&=~(1<<a),s+=1;var o=32-ys(t)+a;if(30<o){var i=a-a%5;o=(n&(1<<i)-1).toString(32),n>>=i,a-=i,Rs=1<<32-ys(t)+a|s<<a|n,zs=o+e}else Rs=1<<o|s<<a|n,zs=e}function Zd(e){e.return!==null&&(Pn(e,1),ap(e,1,0))}function eu(e){for(;e===Ti;)Ti=yr[--vr],yr[vr]=null,Mi=yr[--vr],yr[vr]=null;for(;e===Bn;)Bn=es[--ts],es[ts]=null,zs=es[--ts],es[ts]=null,Rs=es[--ts],es[ts]=null}var Kt=null,Gt=null,tt=!1,hs=null;function op(e,t){var s=ss(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Im(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Kt=e,Gt=hn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Kt=e,Gt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=Bn!==null?{id:Rs,overflow:zs}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=ss(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,Kt=e,Gt=null,!0):!1;default:return!1}}function Wc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Vc(e){if(tt){var t=Gt;if(t){var s=t;if(!Im(e,t)){if(Wc(e))throw Error(de(418));t=hn(s.nextSibling);var n=Kt;t&&Im(e,t)?op(n,s):(e.flags=e.flags&-4097|2,tt=!1,Kt=e)}}else{if(Wc(e))throw Error(de(418));e.flags=e.flags&-4097|2,tt=!1,Kt=e}}}function Om(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Kt=e}function $o(e){if(e!==Kt)return!1;if(!tt)return Om(e),tt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Fc(e.type,e.memoizedProps)),t&&(t=Gt)){if(Wc(e))throw ip(),Error(de(418));for(;t;)op(e,t),t=hn(t.nextSibling)}if(Om(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(de(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){Gt=hn(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}Gt=null}}else Gt=Kt?hn(e.stateNode.nextSibling):null;return!0}function ip(){for(var e=Gt;e;)e=hn(e.nextSibling)}function Ir(){Gt=Kt=null,tt=!1}function tu(e){hs===null?hs=[e]:hs.push(e)}var Sy=Qs.ReactCurrentBatchConfig;function ta(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(de(309));var n=s.stateNode}if(!n)throw Error(de(147,e));var a=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var l=a.refs;i===null?delete l[o]:l[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(de(284));if(!s._owner)throw Error(de(290,e))}return e}function Lo(e,t){throw e=Object.prototype.toString.call(t),Error(de(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Am(e){var t=e._init;return t(e._payload)}function lp(e){function t(y,g){if(e){var x=y.deletions;x===null?(y.deletions=[g],y.flags|=16):x.push(g)}}function s(y,g){if(!e)return null;for(;g!==null;)t(y,g),g=g.sibling;return null}function n(y,g){for(y=new Map;g!==null;)g.key!==null?y.set(g.key,g):y.set(g.index,g),g=g.sibling;return y}function a(y,g){return y=xn(y,g),y.index=0,y.sibling=null,y}function o(y,g,x){return y.index=x,e?(x=y.alternate,x!==null?(x=x.index,x<g?(y.flags|=2,g):x):(y.flags|=2,g)):(y.flags|=1048576,g)}function i(y){return e&&y.alternate===null&&(y.flags|=2),y}function l(y,g,x,_){return g===null||g.tag!==6?(g=Zl(x,y.mode,_),g.return=y,g):(g=a(g,x),g.return=y,g)}function c(y,g,x,_){var F=x.type;return F===mr?u(y,g,x.props.children,_,x.key):g!==null&&(g.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===tn&&Am(F)===g.type)?(_=a(g,x.props),_.ref=ta(y,g,x),_.return=y,_):(_=ui(x.type,x.key,x.props,null,y.mode,_),_.ref=ta(y,g,x),_.return=y,_)}function d(y,g,x,_){return g===null||g.tag!==4||g.stateNode.containerInfo!==x.containerInfo||g.stateNode.implementation!==x.implementation?(g=ec(x,y.mode,_),g.return=y,g):(g=a(g,x.children||[]),g.return=y,g)}function u(y,g,x,_,F){return g===null||g.tag!==7?(g=zn(x,y.mode,_,F),g.return=y,g):(g=a(g,x),g.return=y,g)}function m(y,g,x){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Zl(""+g,y.mode,x),g.return=y,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case _o:return x=ui(g.type,g.key,g.props,null,y.mode,x),x.ref=ta(y,null,g),x.return=y,x;case ur:return g=ec(g,y.mode,x),g.return=y,g;case tn:var _=g._init;return m(y,_(g._payload),x)}if(ca(g)||Yr(g))return g=zn(g,y.mode,x,null),g.return=y,g;Lo(y,g)}return null}function f(y,g,x,_){var F=g!==null?g.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return F!==null?null:l(y,g,""+x,_);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case _o:return x.key===F?c(y,g,x,_):null;case ur:return x.key===F?d(y,g,x,_):null;case tn:return F=x._init,f(y,g,F(x._payload),_)}if(ca(x)||Yr(x))return F!==null?null:u(y,g,x,_,null);Lo(y,x)}return null}function p(y,g,x,_,F){if(typeof _=="string"&&_!==""||typeof _=="number")return y=y.get(x)||null,l(g,y,""+_,F);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case _o:return y=y.get(_.key===null?x:_.key)||null,c(g,y,_,F);case ur:return y=y.get(_.key===null?x:_.key)||null,d(g,y,_,F);case tn:var A=_._init;return p(y,g,x,A(_._payload),F)}if(ca(_)||Yr(_))return y=y.get(x)||null,u(g,y,_,F,null);Lo(g,_)}return null}function S(y,g,x,_){for(var F=null,A=null,H=g,R=g=0,ge=null;H!==null&&R<x.length;R++){H.index>R?(ge=H,H=null):ge=H.sibling;var ce=f(y,H,x[R],_);if(ce===null){H===null&&(H=ge);break}e&&H&&ce.alternate===null&&t(y,H),g=o(ce,g,R),A===null?F=ce:A.sibling=ce,A=ce,H=ge}if(R===x.length)return s(y,H),tt&&Pn(y,R),F;if(H===null){for(;R<x.length;R++)H=m(y,x[R],_),H!==null&&(g=o(H,g,R),A===null?F=H:A.sibling=H,A=H);return tt&&Pn(y,R),F}for(H=n(y,H);R<x.length;R++)ge=p(H,y,R,x[R],_),ge!==null&&(e&&ge.alternate!==null&&H.delete(ge.key===null?R:ge.key),g=o(ge,g,R),A===null?F=ge:A.sibling=ge,A=ge);return e&&H.forEach(function(I){return t(y,I)}),tt&&Pn(y,R),F}function E(y,g,x,_){var F=Yr(x);if(typeof F!="function")throw Error(de(150));if(x=F.call(x),x==null)throw Error(de(151));for(var A=F=null,H=g,R=g=0,ge=null,ce=x.next();H!==null&&!ce.done;R++,ce=x.next()){H.index>R?(ge=H,H=null):ge=H.sibling;var I=f(y,H,ce.value,_);if(I===null){H===null&&(H=ge);break}e&&H&&I.alternate===null&&t(y,H),g=o(I,g,R),A===null?F=I:A.sibling=I,A=I,H=ge}if(ce.done)return s(y,H),tt&&Pn(y,R),F;if(H===null){for(;!ce.done;R++,ce=x.next())ce=m(y,ce.value,_),ce!==null&&(g=o(ce,g,R),A===null?F=ce:A.sibling=ce,A=ce);return tt&&Pn(y,R),F}for(H=n(y,H);!ce.done;R++,ce=x.next())ce=p(H,y,R,ce.value,_),ce!==null&&(e&&ce.alternate!==null&&H.delete(ce.key===null?R:ce.key),g=o(ce,g,R),A===null?F=ce:A.sibling=ce,A=ce);return e&&H.forEach(function(ee){return t(y,ee)}),tt&&Pn(y,R),F}function T(y,g,x,_){if(typeof x=="object"&&x!==null&&x.type===mr&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case _o:e:{for(var F=x.key,A=g;A!==null;){if(A.key===F){if(F=x.type,F===mr){if(A.tag===7){s(y,A.sibling),g=a(A,x.props.children),g.return=y,y=g;break e}}else if(A.elementType===F||typeof F=="object"&&F!==null&&F.$$typeof===tn&&Am(F)===A.type){s(y,A.sibling),g=a(A,x.props),g.ref=ta(y,A,x),g.return=y,y=g;break e}s(y,A);break}else t(y,A);A=A.sibling}x.type===mr?(g=zn(x.props.children,y.mode,_,x.key),g.return=y,y=g):(_=ui(x.type,x.key,x.props,null,y.mode,_),_.ref=ta(y,g,x),_.return=y,y=_)}return i(y);case ur:e:{for(A=x.key;g!==null;){if(g.key===A)if(g.tag===4&&g.stateNode.containerInfo===x.containerInfo&&g.stateNode.implementation===x.implementation){s(y,g.sibling),g=a(g,x.children||[]),g.return=y,y=g;break e}else{s(y,g);break}else t(y,g);g=g.sibling}g=ec(x,y.mode,_),g.return=y,y=g}return i(y);case tn:return A=x._init,T(y,g,A(x._payload),_)}if(ca(x))return S(y,g,x,_);if(Yr(x))return E(y,g,x,_);Lo(y,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,g!==null&&g.tag===6?(s(y,g.sibling),g=a(g,x),g.return=y,y=g):(s(y,g),g=Zl(x,y.mode,_),g.return=y,y=g),i(y)):s(y,g)}return T}var Or=lp(!0),cp=lp(!1),Pi=Nn(null),Di=null,br=null,su=null;function nu(){su=br=Di=null}function ru(e){var t=Pi.current;Ze(Pi),e._currentValue=t}function qc(e,t,s){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===s)break;e=e.return}}function Cr(e,t){Di=e,su=br=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ut=!0),e.firstContext=null)}function os(e){var t=e._currentValue;if(su!==e)if(e={context:e,memoizedValue:t,next:null},br===null){if(Di===null)throw Error(de(308));br=e,Di.dependencies={lanes:0,firstContext:e}}else br=br.next=e;return t}var $n=null;function au(e){$n===null?$n=[e]:$n.push(e)}function dp(e,t,s,n){var a=t.interleaved;return a===null?(s.next=s,au(t)):(s.next=a.next,a.next=s),t.interleaved=s,qs(e,n)}function qs(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var sn=!1;function ou(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function up(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Us(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function fn(e,t,s){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Fe&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,qs(e,s)}return a=n.interleaved,a===null?(t.next=t,au(n)):(t.next=a.next,a.next=t),n.interleaved=t,qs(e,s)}function ai(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,s|=n,t.lanes=s,Vd(e,s)}}function $m(e,t){var s=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var i={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=i:o=o.next=i,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Ii(e,t,s,n){var a=e.updateQueue;sn=!1;var o=a.firstBaseUpdate,i=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,i===null?o=d:i.next=d,i=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==i&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(o!==null){var m=a.baseState;i=0,u=d=c=null,l=o;do{var f=l.lane,p=l.eventTime;if((n&f)===f){u!==null&&(u=u.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var S=e,E=l;switch(f=t,p=s,E.tag){case 1:if(S=E.payload,typeof S=="function"){m=S.call(p,m,f);break e}m=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=E.payload,f=typeof S=="function"?S.call(p,m,f):S,f==null)break e;m=at({},m,f);break e;case 2:sn=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,f=a.effects,f===null?a.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=p,c=m):u=u.next=p,i|=f;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;f=l,l=f.next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}while(!0);if(u===null&&(c=m),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do i|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);Wn|=i,e.lanes=i,e.memoizedState=m}}function Lm(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=s,typeof a!="function")throw Error(de(191,a));a.call(n)}}}var mo={},Es=Nn(mo),Va=Nn(mo),qa=Nn(mo);function Ln(e){if(e===mo)throw Error(de(174));return e}function iu(e,t){switch(Je(qa,t),Je(Va,e),Je(Es,mo),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_c(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_c(t,e)}Ze(Es),Je(Es,t)}function Ar(){Ze(Es),Ze(Va),Ze(qa)}function mp(e){Ln(qa.current);var t=Ln(Es.current),s=_c(t,e.type);t!==s&&(Je(Va,e),Je(Es,s))}function lu(e){Va.current===e&&(Ze(Es),Ze(Va))}var st=Nn(0);function Oi(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Gl=[];function cu(){for(var e=0;e<Gl.length;e++)Gl[e]._workInProgressVersionPrimary=null;Gl.length=0}var oi=Qs.ReactCurrentDispatcher,Kl=Qs.ReactCurrentBatchConfig,Hn=0,rt=null,ft=null,vt=null,Ai=!1,va=!1,Ga=0,_y=0;function Ct(){throw Error(de(321))}function du(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!js(e[s],t[s]))return!1;return!0}function uu(e,t,s,n,a,o){if(Hn=o,rt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,oi.current=e===null||e.memoizedState===null?My:Py,e=s(n,a),va){o=0;do{if(va=!1,Ga=0,25<=o)throw Error(de(301));o+=1,vt=ft=null,t.updateQueue=null,oi.current=Dy,e=s(n,a)}while(va)}if(oi.current=$i,t=ft!==null&&ft.next!==null,Hn=0,vt=ft=rt=null,Ai=!1,t)throw Error(de(300));return e}function mu(){var e=Ga!==0;return Ga=0,e}function Ns(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?rt.memoizedState=vt=e:vt=vt.next=e,vt}function is(){if(ft===null){var e=rt.alternate;e=e!==null?e.memoizedState:null}else e=ft.next;var t=vt===null?rt.memoizedState:vt.next;if(t!==null)vt=t,ft=e;else{if(e===null)throw Error(de(310));ft=e,e={memoizedState:ft.memoizedState,baseState:ft.baseState,baseQueue:ft.baseQueue,queue:ft.queue,next:null},vt===null?rt.memoizedState=vt=e:vt=vt.next=e}return vt}function Ka(e,t){return typeof t=="function"?t(e):t}function Ql(e){var t=is(),s=t.queue;if(s===null)throw Error(de(311));s.lastRenderedReducer=e;var n=ft,a=n.baseQueue,o=s.pending;if(o!==null){if(a!==null){var i=a.next;a.next=o.next,o.next=i}n.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((Hn&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var m={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=m,i=n):c=c.next=m,rt.lanes|=u,Wn|=u}d=d.next}while(d!==null&&d!==o);c===null?i=n:c.next=l,js(n,t.memoizedState)||(Ut=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,s.lastRenderedState=n}if(e=s.interleaved,e!==null){a=e;do o=a.lane,rt.lanes|=o,Wn|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Yl(e){var t=is(),s=t.queue;if(s===null)throw Error(de(311));s.lastRenderedReducer=e;var n=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var i=a=a.next;do o=e(o,i.action),i=i.next;while(i!==a);js(o,t.memoizedState)||(Ut=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,n]}function hp(){}function fp(e,t){var s=rt,n=is(),a=t(),o=!js(n.memoizedState,a);if(o&&(n.memoizedState=a,Ut=!0),n=n.queue,hu(xp.bind(null,s,n,e),[e]),n.getSnapshot!==t||o||vt!==null&&vt.memoizedState.tag&1){if(s.flags|=2048,Qa(9,gp.bind(null,s,n,a,t),void 0,null),bt===null)throw Error(de(349));Hn&30||pp(s,t,a)}return a}function pp(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function gp(e,t,s,n){t.value=s,t.getSnapshot=n,yp(t)&&vp(e)}function xp(e,t,s){return s(function(){yp(t)&&vp(e)})}function yp(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!js(e,s)}catch{return!0}}function vp(e){var t=qs(e,1);t!==null&&vs(t,e,1,-1)}function Rm(e){var t=Ns();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ka,lastRenderedState:e},t.queue=e,e=e.dispatch=Ty.bind(null,rt,e),[t.memoizedState,e]}function Qa(e,t,s,n){return e={tag:e,create:t,destroy:s,deps:n,next:null},t=rt.updateQueue,t===null?(t={lastEffect:null,stores:null},rt.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(n=s.next,s.next=e,e.next=n,t.lastEffect=e)),e}function bp(){return is().memoizedState}function ii(e,t,s,n){var a=Ns();rt.flags|=e,a.memoizedState=Qa(1|t,s,void 0,n===void 0?null:n)}function al(e,t,s,n){var a=is();n=n===void 0?null:n;var o=void 0;if(ft!==null){var i=ft.memoizedState;if(o=i.destroy,n!==null&&du(n,i.deps)){a.memoizedState=Qa(t,s,o,n);return}}rt.flags|=e,a.memoizedState=Qa(1|t,s,o,n)}function zm(e,t){return ii(8390656,8,e,t)}function hu(e,t){return al(2048,8,e,t)}function jp(e,t){return al(4,2,e,t)}function wp(e,t){return al(4,4,e,t)}function Np(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function kp(e,t,s){return s=s!=null?s.concat([e]):null,al(4,4,Np.bind(null,t,e),s)}function fu(){}function Sp(e,t){var s=is();t=t===void 0?null:t;var n=s.memoizedState;return n!==null&&t!==null&&du(t,n[1])?n[0]:(s.memoizedState=[e,t],e)}function _p(e,t){var s=is();t=t===void 0?null:t;var n=s.memoizedState;return n!==null&&t!==null&&du(t,n[1])?n[0]:(e=e(),s.memoizedState=[e,t],e)}function Cp(e,t,s){return Hn&21?(js(s,t)||(s=Df(),rt.lanes|=s,Wn|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ut=!0),e.memoizedState=s)}function Cy(e,t){var s=We;We=s!==0&&4>s?s:4,e(!0);var n=Kl.transition;Kl.transition={};try{e(!1),t()}finally{We=s,Kl.transition=n}}function Ep(){return is().memoizedState}function Ey(e,t,s){var n=gn(e);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},Tp(e))Mp(t,s);else if(s=dp(e,t,s,n),s!==null){var a=It();vs(s,e,n,a),Pp(s,t,n)}}function Ty(e,t,s){var n=gn(e),a={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(Tp(e))Mp(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,l=o(i,s);if(a.hasEagerState=!0,a.eagerState=l,js(l,i)){var c=t.interleaved;c===null?(a.next=a,au(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}s=dp(e,t,a,n),s!==null&&(a=It(),vs(s,e,n,a),Pp(s,t,n))}}function Tp(e){var t=e.alternate;return e===rt||t!==null&&t===rt}function Mp(e,t){va=Ai=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function Pp(e,t,s){if(s&4194240){var n=t.lanes;n&=e.pendingLanes,s|=n,t.lanes=s,Vd(e,s)}}var $i={readContext:os,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useInsertionEffect:Ct,useLayoutEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useMutableSource:Ct,useSyncExternalStore:Ct,useId:Ct,unstable_isNewReconciler:!1},My={readContext:os,useCallback:function(e,t){return Ns().memoizedState=[e,t===void 0?null:t],e},useContext:os,useEffect:zm,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,ii(4194308,4,Np.bind(null,t,e),s)},useLayoutEffect:function(e,t){return ii(4194308,4,e,t)},useInsertionEffect:function(e,t){return ii(4,2,e,t)},useMemo:function(e,t){var s=Ns();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var n=Ns();return t=s!==void 0?s(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Ey.bind(null,rt,e),[n.memoizedState,e]},useRef:function(e){var t=Ns();return e={current:e},t.memoizedState=e},useState:Rm,useDebugValue:fu,useDeferredValue:function(e){return Ns().memoizedState=e},useTransition:function(){var e=Rm(!1),t=e[0];return e=Cy.bind(null,e[1]),Ns().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var n=rt,a=Ns();if(tt){if(s===void 0)throw Error(de(407));s=s()}else{if(s=t(),bt===null)throw Error(de(349));Hn&30||pp(n,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,zm(xp.bind(null,n,o,e),[e]),n.flags|=2048,Qa(9,gp.bind(null,n,o,s,t),void 0,null),s},useId:function(){var e=Ns(),t=bt.identifierPrefix;if(tt){var s=zs,n=Rs;s=(n&~(1<<32-ys(n)-1)).toString(32)+s,t=":"+t+"R"+s,s=Ga++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=_y++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Py={readContext:os,useCallback:Sp,useContext:os,useEffect:hu,useImperativeHandle:kp,useInsertionEffect:jp,useLayoutEffect:wp,useMemo:_p,useReducer:Ql,useRef:bp,useState:function(){return Ql(Ka)},useDebugValue:fu,useDeferredValue:function(e){var t=is();return Cp(t,ft.memoizedState,e)},useTransition:function(){var e=Ql(Ka)[0],t=is().memoizedState;return[e,t]},useMutableSource:hp,useSyncExternalStore:fp,useId:Ep,unstable_isNewReconciler:!1},Dy={readContext:os,useCallback:Sp,useContext:os,useEffect:hu,useImperativeHandle:kp,useInsertionEffect:jp,useLayoutEffect:wp,useMemo:_p,useReducer:Yl,useRef:bp,useState:function(){return Yl(Ka)},useDebugValue:fu,useDeferredValue:function(e){var t=is();return ft===null?t.memoizedState=e:Cp(t,ft.memoizedState,e)},useTransition:function(){var e=Yl(Ka)[0],t=is().memoizedState;return[e,t]},useMutableSource:hp,useSyncExternalStore:fp,useId:Ep,unstable_isNewReconciler:!1};function ds(e,t){if(e&&e.defaultProps){t=at({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function Gc(e,t,s,n){t=e.memoizedState,s=s(n,t),s=s==null?t:at({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var ol={isMounted:function(e){return(e=e._reactInternals)?Yn(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var n=It(),a=gn(e),o=Us(n,a);o.payload=t,s!=null&&(o.callback=s),t=fn(e,o,a),t!==null&&(vs(t,e,a,n),ai(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var n=It(),a=gn(e),o=Us(n,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=fn(e,o,a),t!==null&&(vs(t,e,a,n),ai(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=It(),n=gn(e),a=Us(s,n);a.tag=2,t!=null&&(a.callback=t),t=fn(e,a,n),t!==null&&(vs(t,e,n,s),ai(t,e,n))}};function Fm(e,t,s,n,a,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!Ua(s,n)||!Ua(a,o):!0}function Dp(e,t,s){var n=!1,a=bn,o=t.contextType;return typeof o=="object"&&o!==null?o=os(o):(a=Ht(t)?Un:Mt.current,n=t.contextTypes,o=(n=n!=null)?Dr(e,a):bn),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ol,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Um(e,t,s,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,n),t.state!==e&&ol.enqueueReplaceState(t,t.state,null)}function Kc(e,t,s,n){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},ou(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=os(o):(o=Ht(t)?Un:Mt.current,a.context=Dr(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Gc(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&ol.enqueueReplaceState(a,a.state,null),Ii(e,s,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function $r(e,t){try{var s="",n=t;do s+=o0(n),n=n.return;while(n);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function Jl(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function Qc(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var Iy=typeof WeakMap=="function"?WeakMap:Map;function Ip(e,t,s){s=Us(-1,s),s.tag=3,s.payload={element:null};var n=t.value;return s.callback=function(){Ri||(Ri=!0,ad=n),Qc(e,t)},s}function Op(e,t,s){s=Us(-1,s),s.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;s.payload=function(){return n(a)},s.callback=function(){Qc(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){Qc(e,t),typeof n!="function"&&(pn===null?pn=new Set([this]):pn.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),s}function Bm(e,t,s){var n=e.pingCache;if(n===null){n=e.pingCache=new Iy;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(s)||(a.add(s),e=Gy.bind(null,e,t,s),t.then(e,e))}function Hm(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Wm(e,t,s,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=Us(-1,1),t.tag=2,fn(s,t,1))),s.lanes|=1),e)}var Oy=Qs.ReactCurrentOwner,Ut=!1;function Dt(e,t,s,n){t.child=e===null?cp(t,null,s,n):Or(t,e.child,s,n)}function Vm(e,t,s,n,a){s=s.render;var o=t.ref;return Cr(t,a),n=uu(e,t,s,n,o,a),s=mu(),e!==null&&!Ut?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Gs(e,t,a)):(tt&&s&&Zd(t),t.flags|=1,Dt(e,t,n,a),t.child)}function qm(e,t,s,n,a){if(e===null){var o=s.type;return typeof o=="function"&&!wu(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,Ap(e,t,o,n,a)):(e=ui(s.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var i=o.memoizedProps;if(s=s.compare,s=s!==null?s:Ua,s(i,n)&&e.ref===t.ref)return Gs(e,t,a)}return t.flags|=1,e=xn(o,n),e.ref=t.ref,e.return=t,t.child=e}function Ap(e,t,s,n,a){if(e!==null){var o=e.memoizedProps;if(Ua(o,n)&&e.ref===t.ref)if(Ut=!1,t.pendingProps=n=o,(e.lanes&a)!==0)e.flags&131072&&(Ut=!0);else return t.lanes=e.lanes,Gs(e,t,a)}return Yc(e,t,s,n,a)}function $p(e,t,s){var n=t.pendingProps,a=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Je(wr,qt),qt|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Je(wr,qt),qt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:s,Je(wr,qt),qt|=n}else o!==null?(n=o.baseLanes|s,t.memoizedState=null):n=s,Je(wr,qt),qt|=n;return Dt(e,t,a,s),t.child}function Lp(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Yc(e,t,s,n,a){var o=Ht(s)?Un:Mt.current;return o=Dr(t,o),Cr(t,a),s=uu(e,t,s,n,o,a),n=mu(),e!==null&&!Ut?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Gs(e,t,a)):(tt&&n&&Zd(t),t.flags|=1,Dt(e,t,s,a),t.child)}function Gm(e,t,s,n,a){if(Ht(s)){var o=!0;Ei(t)}else o=!1;if(Cr(t,a),t.stateNode===null)li(e,t),Dp(t,s,n),Kc(t,s,n,a),n=!0;else if(e===null){var i=t.stateNode,l=t.memoizedProps;i.props=l;var c=i.context,d=s.contextType;typeof d=="object"&&d!==null?d=os(d):(d=Ht(s)?Un:Mt.current,d=Dr(t,d));var u=s.getDerivedStateFromProps,m=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";m||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==n||c!==d)&&Um(t,i,n,d),sn=!1;var f=t.memoizedState;i.state=f,Ii(t,n,i,a),c=t.memoizedState,l!==n||f!==c||Bt.current||sn?(typeof u=="function"&&(Gc(t,s,u,n),c=t.memoizedState),(l=sn||Fm(t,s,l,n,f,c,d))?(m||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),i.props=n,i.state=c,i.context=d,n=l):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,up(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:ds(t.type,l),i.props=d,m=t.pendingProps,f=i.context,c=s.contextType,typeof c=="object"&&c!==null?c=os(c):(c=Ht(s)?Un:Mt.current,c=Dr(t,c));var p=s.getDerivedStateFromProps;(u=typeof p=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==m||f!==c)&&Um(t,i,n,c),sn=!1,f=t.memoizedState,i.state=f,Ii(t,n,i,a);var S=t.memoizedState;l!==m||f!==S||Bt.current||sn?(typeof p=="function"&&(Gc(t,s,p,n),S=t.memoizedState),(d=sn||Fm(t,s,d,n,f,S,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,S,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,S,c)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=S),i.props=n,i.state=S,i.context=c,n=d):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),n=!1)}return Jc(e,t,s,n,o,a)}function Jc(e,t,s,n,a,o){Lp(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return a&&Dm(t,s,!1),Gs(e,t,o);n=t.stateNode,Oy.current=t;var l=i&&typeof s.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=Or(t,e.child,null,o),t.child=Or(t,null,l,o)):Dt(e,t,l,o),t.memoizedState=n.state,a&&Dm(t,s,!0),t.child}function Rp(e){var t=e.stateNode;t.pendingContext?Pm(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Pm(e,t.context,!1),iu(e,t.containerInfo)}function Km(e,t,s,n,a){return Ir(),tu(a),t.flags|=256,Dt(e,t,s,n),t.child}var Xc={dehydrated:null,treeContext:null,retryLane:0};function Zc(e){return{baseLanes:e,cachePool:null,transitions:null}}function zp(e,t,s){var n=t.pendingProps,a=st.current,o=!1,i=(t.flags&128)!==0,l;if((l=i)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Je(st,a&1),e===null)return Vc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=cl(i,n,0,null),e=zn(e,n,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Zc(s),t.memoizedState=Xc,e):pu(t,i));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return Ay(e,t,i,n,l,a,s);if(o){o=n.fallback,i=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:n.children};return!(i&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=xn(a,c),n.subtreeFlags=a.subtreeFlags&14680064),l!==null?o=xn(l,o):(o=zn(o,i,s,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?Zc(s):{baseLanes:i.baseLanes|s,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~s,t.memoizedState=Xc,n}return o=e.child,e=o.sibling,n=xn(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=s),n.return=t,n.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n}function pu(e,t){return t=cl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ro(e,t,s,n){return n!==null&&tu(n),Or(t,e.child,null,s),e=pu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ay(e,t,s,n,a,o,i){if(s)return t.flags&256?(t.flags&=-257,n=Jl(Error(de(422))),Ro(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,a=t.mode,n=cl({mode:"visible",children:n.children},a,0,null),o=zn(o,a,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&Or(t,e.child,null,i),t.child.memoizedState=Zc(i),t.memoizedState=Xc,o);if(!(t.mode&1))return Ro(e,t,i,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var l=n.dgst;return n=l,o=Error(de(419)),n=Jl(o,n,void 0),Ro(e,t,i,n)}if(l=(i&e.childLanes)!==0,Ut||l){if(n=bt,n!==null){switch(i&-i){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|i)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,qs(e,a),vs(n,e,a,-1))}return ju(),n=Jl(Error(de(421))),Ro(e,t,i,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Ky.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,Gt=hn(a.nextSibling),Kt=t,tt=!0,hs=null,e!==null&&(es[ts++]=Rs,es[ts++]=zs,es[ts++]=Bn,Rs=e.id,zs=e.overflow,Bn=t),t=pu(t,n.children),t.flags|=4096,t)}function Qm(e,t,s){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),qc(e.return,t,s)}function Xl(e,t,s,n,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=s,o.tailMode=a)}function Fp(e,t,s){var n=t.pendingProps,a=n.revealOrder,o=n.tail;if(Dt(e,t,n.children,s),n=st.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Qm(e,s,t);else if(e.tag===19)Qm(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Je(st,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&Oi(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),Xl(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Oi(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}Xl(t,!0,s,null,o);break;case"together":Xl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function li(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gs(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Wn|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(de(153));if(t.child!==null){for(e=t.child,s=xn(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=xn(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function $y(e,t,s){switch(t.tag){case 3:Rp(t),Ir();break;case 5:mp(t);break;case 1:Ht(t.type)&&Ei(t);break;case 4:iu(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Je(Pi,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Je(st,st.current&1),t.flags|=128,null):s&t.child.childLanes?zp(e,t,s):(Je(st,st.current&1),e=Gs(e,t,s),e!==null?e.sibling:null);Je(st,st.current&1);break;case 19:if(n=(s&t.childLanes)!==0,e.flags&128){if(n)return Fp(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Je(st,st.current),n)break;return null;case 22:case 23:return t.lanes=0,$p(e,t,s)}return Gs(e,t,s)}var Up,ed,Bp,Hp;Up=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};ed=function(){};Bp=function(e,t,s,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,Ln(Es.current);var o=null;switch(s){case"input":a=wc(e,a),n=wc(e,n),o=[];break;case"select":a=at({},a,{value:void 0}),n=at({},n,{value:void 0}),o=[];break;case"textarea":a=Sc(e,a),n=Sc(e,n),o=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=_i)}Cc(s,n);var i;s=null;for(d in a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(i in l)l.hasOwnProperty(i)&&(s||(s={}),s[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Oa.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=a!=null?a[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(s||(s={}),s[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(s||(s={}),s[i]=c[i])}else s||(o||(o=[]),o.push(d,s)),s=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Oa.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Xe("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}s&&(o=o||[]).push("style",s);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};Hp=function(e,t,s,n){s!==n&&(t.flags|=4)};function sa(e,t){if(!tt)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Et(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,n=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=s,t}function Ly(e,t,s){var n=t.pendingProps;switch(eu(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(t),null;case 1:return Ht(t.type)&&Ci(),Et(t),null;case 3:return n=t.stateNode,Ar(),Ze(Bt),Ze(Mt),cu(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&($o(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,hs!==null&&(ld(hs),hs=null))),ed(e,t),Et(t),null;case 5:lu(t);var a=Ln(qa.current);if(s=t.type,e!==null&&t.stateNode!=null)Bp(e,t,s,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(de(166));return Et(t),null}if(e=Ln(Es.current),$o(t)){n=t.stateNode,s=t.type;var o=t.memoizedProps;switch(n[Ss]=t,n[Wa]=o,e=(t.mode&1)!==0,s){case"dialog":Xe("cancel",n),Xe("close",n);break;case"iframe":case"object":case"embed":Xe("load",n);break;case"video":case"audio":for(a=0;a<ua.length;a++)Xe(ua[a],n);break;case"source":Xe("error",n);break;case"img":case"image":case"link":Xe("error",n),Xe("load",n);break;case"details":Xe("toggle",n);break;case"input":rm(n,o),Xe("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Xe("invalid",n);break;case"textarea":om(n,o),Xe("invalid",n)}Cc(s,o),a=null;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="children"?typeof l=="string"?n.textContent!==l&&(o.suppressHydrationWarning!==!0&&Ao(n.textContent,l,e),a=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Ao(n.textContent,l,e),a=["children",""+l]):Oa.hasOwnProperty(i)&&l!=null&&i==="onScroll"&&Xe("scroll",n)}switch(s){case"input":Co(n),am(n,o,!0);break;case"textarea":Co(n),im(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=_i)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(s,{is:n.is}):(e=i.createElement(s),s==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,s),e[Ss]=t,e[Wa]=n,Up(e,t,!1,!1),t.stateNode=e;e:{switch(i=Ec(s,n),s){case"dialog":Xe("cancel",e),Xe("close",e),a=n;break;case"iframe":case"object":case"embed":Xe("load",e),a=n;break;case"video":case"audio":for(a=0;a<ua.length;a++)Xe(ua[a],e);a=n;break;case"source":Xe("error",e),a=n;break;case"img":case"image":case"link":Xe("error",e),Xe("load",e),a=n;break;case"details":Xe("toggle",e),a=n;break;case"input":rm(e,n),a=wc(e,n),Xe("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=at({},n,{value:void 0}),Xe("invalid",e);break;case"textarea":om(e,n),a=Sc(e,n),Xe("invalid",e);break;default:a=n}Cc(s,a),l=a;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?bf(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&yf(e,c)):o==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&Aa(e,c):typeof c=="number"&&Aa(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Oa.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Xe("scroll",e):c!=null&&zd(e,o,c,i))}switch(s){case"input":Co(e),am(e,n,!1);break;case"textarea":Co(e),im(e);break;case"option":n.value!=null&&e.setAttribute("value",""+vn(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?Nr(e,!!n.multiple,o,!1):n.defaultValue!=null&&Nr(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=_i)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Et(t),null;case 6:if(e&&t.stateNode!=null)Hp(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(de(166));if(s=Ln(qa.current),Ln(Es.current),$o(t)){if(n=t.stateNode,s=t.memoizedProps,n[Ss]=t,(o=n.nodeValue!==s)&&(e=Kt,e!==null))switch(e.tag){case 3:Ao(n.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ao(n.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(s.nodeType===9?s:s.ownerDocument).createTextNode(n),n[Ss]=t,t.stateNode=n}return Et(t),null;case 13:if(Ze(st),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(tt&&Gt!==null&&t.mode&1&&!(t.flags&128))ip(),Ir(),t.flags|=98560,o=!1;else if(o=$o(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(de(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(de(317));o[Ss]=t}else Ir(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Et(t),o=!1}else hs!==null&&(ld(hs),hs=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||st.current&1?gt===0&&(gt=3):ju())),t.updateQueue!==null&&(t.flags|=4),Et(t),null);case 4:return Ar(),ed(e,t),e===null&&Ba(t.stateNode.containerInfo),Et(t),null;case 10:return ru(t.type._context),Et(t),null;case 17:return Ht(t.type)&&Ci(),Et(t),null;case 19:if(Ze(st),o=t.memoizedState,o===null)return Et(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)sa(o,!1);else{if(gt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=Oi(e),i!==null){for(t.flags|=128,sa(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=s,s=t.child;s!==null;)o=s,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Je(st,st.current&1|2),t.child}e=e.sibling}o.tail!==null&&ct()>Lr&&(t.flags|=128,n=!0,sa(o,!1),t.lanes=4194304)}else{if(!n)if(e=Oi(i),e!==null){if(t.flags|=128,n=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),sa(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!tt)return Et(t),null}else 2*ct()-o.renderingStartTime>Lr&&s!==1073741824&&(t.flags|=128,n=!0,sa(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(s=o.last,s!==null?s.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=ct(),t.sibling=null,s=st.current,Je(st,n?s&1|2:s&1),t):(Et(t),null);case 22:case 23:return bu(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?qt&1073741824&&(Et(t),t.subtreeFlags&6&&(t.flags|=8192)):Et(t),null;case 24:return null;case 25:return null}throw Error(de(156,t.tag))}function Ry(e,t){switch(eu(t),t.tag){case 1:return Ht(t.type)&&Ci(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ar(),Ze(Bt),Ze(Mt),cu(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return lu(t),null;case 13:if(Ze(st),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(de(340));Ir()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Ze(st),null;case 4:return Ar(),null;case 10:return ru(t.type._context),null;case 22:case 23:return bu(),null;case 24:return null;default:return null}}var zo=!1,Tt=!1,zy=typeof WeakSet=="function"?WeakSet:Set,je=null;function jr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(n){ot(e,t,n)}else s.current=null}function td(e,t,s){try{s()}catch(n){ot(e,t,n)}}var Ym=!1;function Fy(e,t){if(Rc=Ni,e=Kf(),Xd(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var a=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var i=0,l=-1,c=-1,d=0,u=0,m=e,f=null;t:for(;;){for(var p;m!==s||a!==0&&m.nodeType!==3||(l=i+a),m!==o||n!==0&&m.nodeType!==3||(c=i+n),m.nodeType===3&&(i+=m.nodeValue.length),(p=m.firstChild)!==null;)f=m,m=p;for(;;){if(m===e)break t;if(f===s&&++d===a&&(l=i),f===o&&++u===n&&(c=i),(p=m.nextSibling)!==null)break;m=f,f=m.parentNode}m=p}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(zc={focusedElem:e,selectionRange:s},Ni=!1,je=t;je!==null;)if(t=je,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,je=e;else for(;je!==null;){t=je;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,T=S.memoizedState,y=t.stateNode,g=y.getSnapshotBeforeUpdate(t.elementType===t.type?E:ds(t.type,E),T);y.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(de(163))}}catch(_){ot(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,je=e;break}je=t.return}return S=Ym,Ym=!1,S}function ba(e,t,s){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&td(t,s,o)}a=a.next}while(a!==n)}}function il(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var n=s.create;s.destroy=n()}s=s.next}while(s!==t)}}function sd(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Wp(e){var t=e.alternate;t!==null&&(e.alternate=null,Wp(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Ss],delete t[Wa],delete t[Bc],delete t[wy],delete t[Ny])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Vp(e){return e.tag===5||e.tag===3||e.tag===4}function Jm(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Vp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function nd(e,t,s){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=_i));else if(n!==4&&(e=e.child,e!==null))for(nd(e,t,s),e=e.sibling;e!==null;)nd(e,t,s),e=e.sibling}function rd(e,t,s){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(rd(e,t,s),e=e.sibling;e!==null;)rd(e,t,s),e=e.sibling}var wt=null,us=!1;function Js(e,t,s){for(s=s.child;s!==null;)qp(e,t,s),s=s.sibling}function qp(e,t,s){if(Cs&&typeof Cs.onCommitFiberUnmount=="function")try{Cs.onCommitFiberUnmount(Zi,s)}catch{}switch(s.tag){case 5:Tt||jr(s,t);case 6:var n=wt,a=us;wt=null,Js(e,t,s),wt=n,us=a,wt!==null&&(us?(e=wt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):wt.removeChild(s.stateNode));break;case 18:wt!==null&&(us?(e=wt,s=s.stateNode,e.nodeType===8?Vl(e.parentNode,s):e.nodeType===1&&Vl(e,s),za(e)):Vl(wt,s.stateNode));break;case 4:n=wt,a=us,wt=s.stateNode.containerInfo,us=!0,Js(e,t,s),wt=n,us=a;break;case 0:case 11:case 14:case 15:if(!Tt&&(n=s.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var o=a,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&td(s,t,i),a=a.next}while(a!==n)}Js(e,t,s);break;case 1:if(!Tt&&(jr(s,t),n=s.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(l){ot(s,t,l)}Js(e,t,s);break;case 21:Js(e,t,s);break;case 22:s.mode&1?(Tt=(n=Tt)||s.memoizedState!==null,Js(e,t,s),Tt=n):Js(e,t,s);break;default:Js(e,t,s)}}function Xm(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new zy),t.forEach(function(n){var a=Qy.bind(null,e,n);s.has(n)||(s.add(n),n.then(a,a))})}}function ls(e,t){var s=t.deletions;if(s!==null)for(var n=0;n<s.length;n++){var a=s[n];try{var o=e,i=t,l=i;e:for(;l!==null;){switch(l.tag){case 5:wt=l.stateNode,us=!1;break e;case 3:wt=l.stateNode.containerInfo,us=!0;break e;case 4:wt=l.stateNode.containerInfo,us=!0;break e}l=l.return}if(wt===null)throw Error(de(160));qp(o,i,a),wt=null,us=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){ot(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Gp(t,e),t=t.sibling}function Gp(e,t){var s=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ls(t,e),ws(e),n&4){try{ba(3,e,e.return),il(3,e)}catch(E){ot(e,e.return,E)}try{ba(5,e,e.return)}catch(E){ot(e,e.return,E)}}break;case 1:ls(t,e),ws(e),n&512&&s!==null&&jr(s,s.return);break;case 5:if(ls(t,e),ws(e),n&512&&s!==null&&jr(s,s.return),e.flags&32){var a=e.stateNode;try{Aa(a,"")}catch(E){ot(e,e.return,E)}}if(n&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,i=s!==null?s.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&pf(a,o),Ec(l,i);var d=Ec(l,o);for(i=0;i<c.length;i+=2){var u=c[i],m=c[i+1];u==="style"?bf(a,m):u==="dangerouslySetInnerHTML"?yf(a,m):u==="children"?Aa(a,m):zd(a,u,m,d)}switch(l){case"input":Nc(a,o);break;case"textarea":gf(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Nr(a,!!o.multiple,p,!1):f!==!!o.multiple&&(o.defaultValue!=null?Nr(a,!!o.multiple,o.defaultValue,!0):Nr(a,!!o.multiple,o.multiple?[]:"",!1))}a[Wa]=o}catch(E){ot(e,e.return,E)}}break;case 6:if(ls(t,e),ws(e),n&4){if(e.stateNode===null)throw Error(de(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(E){ot(e,e.return,E)}}break;case 3:if(ls(t,e),ws(e),n&4&&s!==null&&s.memoizedState.isDehydrated)try{za(t.containerInfo)}catch(E){ot(e,e.return,E)}break;case 4:ls(t,e),ws(e);break;case 13:ls(t,e),ws(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(yu=ct())),n&4&&Xm(e);break;case 22:if(u=s!==null&&s.memoizedState!==null,e.mode&1?(Tt=(d=Tt)||u,ls(t,e),Tt=d):ls(t,e),ws(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(je=e,u=e.child;u!==null;){for(m=je=u;je!==null;){switch(f=je,p=f.child,f.tag){case 0:case 11:case 14:case 15:ba(4,f,f.return);break;case 1:jr(f,f.return);var S=f.stateNode;if(typeof S.componentWillUnmount=="function"){n=f,s=f.return;try{t=n,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(E){ot(n,s,E)}}break;case 5:jr(f,f.return);break;case 22:if(f.memoizedState!==null){eh(m);continue}}p!==null?(p.return=f,je=p):eh(m)}u=u.sibling}e:for(u=null,m=e;;){if(m.tag===5){if(u===null){u=m;try{a=m.stateNode,d?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=m.stateNode,c=m.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=vf("display",i))}catch(E){ot(e,e.return,E)}}}else if(m.tag===6){if(u===null)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(E){ot(e,e.return,E)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;u===m&&(u=null),m=m.return}u===m&&(u=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:ls(t,e),ws(e),n&4&&Xm(e);break;case 21:break;default:ls(t,e),ws(e)}}function ws(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if(Vp(s)){var n=s;break e}s=s.return}throw Error(de(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Aa(a,""),n.flags&=-33);var o=Jm(e);rd(e,o,a);break;case 3:case 4:var i=n.stateNode.containerInfo,l=Jm(e);nd(e,l,i);break;default:throw Error(de(161))}}catch(c){ot(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Uy(e,t,s){je=e,Kp(e)}function Kp(e,t,s){for(var n=(e.mode&1)!==0;je!==null;){var a=je,o=a.child;if(a.tag===22&&n){var i=a.memoizedState!==null||zo;if(!i){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Tt;l=zo;var d=Tt;if(zo=i,(Tt=c)&&!d)for(je=a;je!==null;)i=je,c=i.child,i.tag===22&&i.memoizedState!==null?th(a):c!==null?(c.return=i,je=c):th(a);for(;o!==null;)je=o,Kp(o),o=o.sibling;je=a,zo=l,Tt=d}Zm(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,je=o):Zm(e)}}function Zm(e){for(;je!==null;){var t=je;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Tt||il(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Tt)if(s===null)n.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:ds(t.type,s.memoizedProps);n.componentDidUpdate(a,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Lm(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Lm(t,i,s)}break;case 5:var l=t.stateNode;if(s===null&&t.flags&4){s=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var m=u.dehydrated;m!==null&&za(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(de(163))}Tt||t.flags&512&&sd(t)}catch(f){ot(t,t.return,f)}}if(t===e){je=null;break}if(s=t.sibling,s!==null){s.return=t.return,je=s;break}je=t.return}}function eh(e){for(;je!==null;){var t=je;if(t===e){je=null;break}var s=t.sibling;if(s!==null){s.return=t.return,je=s;break}je=t.return}}function th(e){for(;je!==null;){var t=je;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{il(4,t)}catch(c){ot(t,s,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(c){ot(t,a,c)}}var o=t.return;try{sd(t)}catch(c){ot(t,o,c)}break;case 5:var i=t.return;try{sd(t)}catch(c){ot(t,i,c)}}}catch(c){ot(t,t.return,c)}if(t===e){je=null;break}var l=t.sibling;if(l!==null){l.return=t.return,je=l;break}je=t.return}}var By=Math.ceil,Li=Qs.ReactCurrentDispatcher,gu=Qs.ReactCurrentOwner,rs=Qs.ReactCurrentBatchConfig,Fe=0,bt=null,dt=null,kt=0,qt=0,wr=Nn(0),gt=0,Ya=null,Wn=0,ll=0,xu=0,ja=null,zt=null,yu=0,Lr=1/0,Is=null,Ri=!1,ad=null,pn=null,Fo=!1,cn=null,zi=0,wa=0,od=null,ci=-1,di=0;function It(){return Fe&6?ct():ci!==-1?ci:ci=ct()}function gn(e){return e.mode&1?Fe&2&&kt!==0?kt&-kt:Sy.transition!==null?(di===0&&(di=Df()),di):(e=We,e!==0||(e=window.event,e=e===void 0?16:zf(e.type)),e):1}function vs(e,t,s,n){if(50<wa)throw wa=0,od=null,Error(de(185));lo(e,s,n),(!(Fe&2)||e!==bt)&&(e===bt&&(!(Fe&2)&&(ll|=s),gt===4&&rn(e,kt)),Wt(e,n),s===1&&Fe===0&&!(t.mode&1)&&(Lr=ct()+500,rl&&kn()))}function Wt(e,t){var s=e.callbackNode;S0(e,t);var n=wi(e,e===bt?kt:0);if(n===0)s!==null&&dm(s),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(s!=null&&dm(s),t===1)e.tag===0?ky(sh.bind(null,e)):rp(sh.bind(null,e)),by(function(){!(Fe&6)&&kn()}),s=null;else{switch(If(n)){case 1:s=Wd;break;case 4:s=Mf;break;case 16:s=ji;break;case 536870912:s=Pf;break;default:s=ji}s=sg(s,Qp.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Qp(e,t){if(ci=-1,di=0,Fe&6)throw Error(de(327));var s=e.callbackNode;if(Er()&&e.callbackNode!==s)return null;var n=wi(e,e===bt?kt:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=Fi(e,n);else{t=n;var a=Fe;Fe|=2;var o=Jp();(bt!==e||kt!==t)&&(Is=null,Lr=ct()+500,Rn(e,t));do try{Vy();break}catch(l){Yp(e,l)}while(!0);nu(),Li.current=o,Fe=a,dt!==null?t=0:(bt=null,kt=0,t=gt)}if(t!==0){if(t===2&&(a=Ic(e),a!==0&&(n=a,t=id(e,a))),t===1)throw s=Ya,Rn(e,0),rn(e,n),Wt(e,ct()),s;if(t===6)rn(e,n);else{if(a=e.current.alternate,!(n&30)&&!Hy(a)&&(t=Fi(e,n),t===2&&(o=Ic(e),o!==0&&(n=o,t=id(e,o))),t===1))throw s=Ya,Rn(e,0),rn(e,n),Wt(e,ct()),s;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(de(345));case 2:Dn(e,zt,Is);break;case 3:if(rn(e,n),(n&130023424)===n&&(t=yu+500-ct(),10<t)){if(wi(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){It(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Uc(Dn.bind(null,e,zt,Is),t);break}Dn(e,zt,Is);break;case 4:if(rn(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var i=31-ys(n);o=1<<i,i=t[i],i>a&&(a=i),n&=~o}if(n=a,n=ct()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*By(n/1960))-n,10<n){e.timeoutHandle=Uc(Dn.bind(null,e,zt,Is),n);break}Dn(e,zt,Is);break;case 5:Dn(e,zt,Is);break;default:throw Error(de(329))}}}return Wt(e,ct()),e.callbackNode===s?Qp.bind(null,e):null}function id(e,t){var s=ja;return e.current.memoizedState.isDehydrated&&(Rn(e,t).flags|=256),e=Fi(e,t),e!==2&&(t=zt,zt=s,t!==null&&ld(t)),e}function ld(e){zt===null?zt=e:zt.push.apply(zt,e)}function Hy(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var n=0;n<s.length;n++){var a=s[n],o=a.getSnapshot;a=a.value;try{if(!js(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function rn(e,t){for(t&=~xu,t&=~ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-ys(t),n=1<<s;e[s]=-1,t&=~n}}function sh(e){if(Fe&6)throw Error(de(327));Er();var t=wi(e,0);if(!(t&1))return Wt(e,ct()),null;var s=Fi(e,t);if(e.tag!==0&&s===2){var n=Ic(e);n!==0&&(t=n,s=id(e,n))}if(s===1)throw s=Ya,Rn(e,0),rn(e,t),Wt(e,ct()),s;if(s===6)throw Error(de(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Dn(e,zt,Is),Wt(e,ct()),null}function vu(e,t){var s=Fe;Fe|=1;try{return e(t)}finally{Fe=s,Fe===0&&(Lr=ct()+500,rl&&kn())}}function Vn(e){cn!==null&&cn.tag===0&&!(Fe&6)&&Er();var t=Fe;Fe|=1;var s=rs.transition,n=We;try{if(rs.transition=null,We=1,e)return e()}finally{We=n,rs.transition=s,Fe=t,!(Fe&6)&&kn()}}function bu(){qt=wr.current,Ze(wr)}function Rn(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,vy(s)),dt!==null)for(s=dt.return;s!==null;){var n=s;switch(eu(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Ci();break;case 3:Ar(),Ze(Bt),Ze(Mt),cu();break;case 5:lu(n);break;case 4:Ar();break;case 13:Ze(st);break;case 19:Ze(st);break;case 10:ru(n.type._context);break;case 22:case 23:bu()}s=s.return}if(bt=e,dt=e=xn(e.current,null),kt=qt=t,gt=0,Ya=null,xu=ll=Wn=0,zt=ja=null,$n!==null){for(t=0;t<$n.length;t++)if(s=$n[t],n=s.interleaved,n!==null){s.interleaved=null;var a=n.next,o=s.pending;if(o!==null){var i=o.next;o.next=a,n.next=i}s.pending=n}$n=null}return e}function Yp(e,t){do{var s=dt;try{if(nu(),oi.current=$i,Ai){for(var n=rt.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Ai=!1}if(Hn=0,vt=ft=rt=null,va=!1,Ga=0,gu.current=null,s===null||s.return===null){gt=1,Ya=t,dt=null;break}e:{var o=e,i=s.return,l=s,c=t;if(t=kt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,m=u.tag;if(!(u.mode&1)&&(m===0||m===11||m===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=Hm(i);if(p!==null){p.flags&=-257,Wm(p,i,l,o,t),p.mode&1&&Bm(o,d,t),t=p,c=d;var S=t.updateQueue;if(S===null){var E=new Set;E.add(c),t.updateQueue=E}else S.add(c);break e}else{if(!(t&1)){Bm(o,d,t),ju();break e}c=Error(de(426))}}else if(tt&&l.mode&1){var T=Hm(i);if(T!==null){!(T.flags&65536)&&(T.flags|=256),Wm(T,i,l,o,t),tu($r(c,l));break e}}o=c=$r(c,l),gt!==4&&(gt=2),ja===null?ja=[o]:ja.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var y=Ip(o,c,t);$m(o,y);break e;case 1:l=c;var g=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof g.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(pn===null||!pn.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var _=Op(o,l,t);$m(o,_);break e}}o=o.return}while(o!==null)}Zp(s)}catch(F){t=F,dt===s&&s!==null&&(dt=s=s.return);continue}break}while(!0)}function Jp(){var e=Li.current;return Li.current=$i,e===null?$i:e}function ju(){(gt===0||gt===3||gt===2)&&(gt=4),bt===null||!(Wn&268435455)&&!(ll&268435455)||rn(bt,kt)}function Fi(e,t){var s=Fe;Fe|=2;var n=Jp();(bt!==e||kt!==t)&&(Is=null,Rn(e,t));do try{Wy();break}catch(a){Yp(e,a)}while(!0);if(nu(),Fe=s,Li.current=n,dt!==null)throw Error(de(261));return bt=null,kt=0,gt}function Wy(){for(;dt!==null;)Xp(dt)}function Vy(){for(;dt!==null&&!g0();)Xp(dt)}function Xp(e){var t=tg(e.alternate,e,qt);e.memoizedProps=e.pendingProps,t===null?Zp(e):dt=t,gu.current=null}function Zp(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=Ry(s,t),s!==null){s.flags&=32767,dt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{gt=6,dt=null;return}}else if(s=Ly(s,t,qt),s!==null){dt=s;return}if(t=t.sibling,t!==null){dt=t;return}dt=t=e}while(t!==null);gt===0&&(gt=5)}function Dn(e,t,s){var n=We,a=rs.transition;try{rs.transition=null,We=1,qy(e,t,s,n)}finally{rs.transition=a,We=n}return null}function qy(e,t,s,n){do Er();while(cn!==null);if(Fe&6)throw Error(de(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(de(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(_0(e,o),e===bt&&(dt=bt=null,kt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||Fo||(Fo=!0,sg(ji,function(){return Er(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=rs.transition,rs.transition=null;var i=We;We=1;var l=Fe;Fe|=4,gu.current=null,Fy(e,s),Gp(s,e),my(zc),Ni=!!Rc,zc=Rc=null,e.current=s,Uy(s),x0(),Fe=l,We=i,rs.transition=o}else e.current=s;if(Fo&&(Fo=!1,cn=e,zi=a),o=e.pendingLanes,o===0&&(pn=null),b0(s.stateNode),Wt(e,ct()),t!==null)for(n=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],n(a.value,{componentStack:a.stack,digest:a.digest});if(Ri)throw Ri=!1,e=ad,ad=null,e;return zi&1&&e.tag!==0&&Er(),o=e.pendingLanes,o&1?e===od?wa++:(wa=0,od=e):wa=0,kn(),null}function Er(){if(cn!==null){var e=If(zi),t=rs.transition,s=We;try{if(rs.transition=null,We=16>e?16:e,cn===null)var n=!1;else{if(e=cn,cn=null,zi=0,Fe&6)throw Error(de(331));var a=Fe;for(Fe|=4,je=e.current;je!==null;){var o=je,i=o.child;if(je.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(je=d;je!==null;){var u=je;switch(u.tag){case 0:case 11:case 15:ba(8,u,o)}var m=u.child;if(m!==null)m.return=u,je=m;else for(;je!==null;){u=je;var f=u.sibling,p=u.return;if(Wp(u),u===d){je=null;break}if(f!==null){f.return=p,je=f;break}je=p}}}var S=o.alternate;if(S!==null){var E=S.child;if(E!==null){S.child=null;do{var T=E.sibling;E.sibling=null,E=T}while(E!==null)}}je=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,je=i;else e:for(;je!==null;){if(o=je,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ba(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,je=y;break e}je=o.return}}var g=e.current;for(je=g;je!==null;){i=je;var x=i.child;if(i.subtreeFlags&2064&&x!==null)x.return=i,je=x;else e:for(i=g;je!==null;){if(l=je,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(F){ot(l,l.return,F)}if(l===i){je=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,je=_;break e}je=l.return}}if(Fe=a,kn(),Cs&&typeof Cs.onPostCommitFiberRoot=="function")try{Cs.onPostCommitFiberRoot(Zi,e)}catch{}n=!0}return n}finally{We=s,rs.transition=t}}return!1}function nh(e,t,s){t=$r(s,t),t=Ip(e,t,1),e=fn(e,t,1),t=It(),e!==null&&(lo(e,1,t),Wt(e,t))}function ot(e,t,s){if(e.tag===3)nh(e,e,s);else for(;t!==null;){if(t.tag===3){nh(t,e,s);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(pn===null||!pn.has(n))){e=$r(s,e),e=Op(t,e,1),t=fn(t,e,1),e=It(),t!==null&&(lo(t,1,e),Wt(t,e));break}}t=t.return}}function Gy(e,t,s){var n=e.pingCache;n!==null&&n.delete(t),t=It(),e.pingedLanes|=e.suspendedLanes&s,bt===e&&(kt&s)===s&&(gt===4||gt===3&&(kt&130023424)===kt&&500>ct()-yu?Rn(e,0):xu|=s),Wt(e,t)}function eg(e,t){t===0&&(e.mode&1?(t=Mo,Mo<<=1,!(Mo&130023424)&&(Mo=4194304)):t=1);var s=It();e=qs(e,t),e!==null&&(lo(e,t,s),Wt(e,s))}function Ky(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),eg(e,s)}function Qy(e,t){var s=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(de(314))}n!==null&&n.delete(t),eg(e,s)}var tg;tg=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||Bt.current)Ut=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return Ut=!1,$y(e,t,s);Ut=!!(e.flags&131072)}else Ut=!1,tt&&t.flags&1048576&&ap(t,Mi,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;li(e,t),e=t.pendingProps;var a=Dr(t,Mt.current);Cr(t,s),a=uu(null,t,n,e,a,s);var o=mu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ht(n)?(o=!0,Ei(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,ou(t),a.updater=ol,t.stateNode=a,a._reactInternals=t,Kc(t,n,e,s),t=Jc(null,t,n,!0,o,s)):(t.tag=0,tt&&o&&Zd(t),Dt(null,t,a,s),t=t.child),t;case 16:n=t.elementType;e:{switch(li(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=Jy(n),e=ds(n,e),a){case 0:t=Yc(null,t,n,e,s);break e;case 1:t=Gm(null,t,n,e,s);break e;case 11:t=Vm(null,t,n,e,s);break e;case 14:t=qm(null,t,n,ds(n.type,e),s);break e}throw Error(de(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ds(n,a),Yc(e,t,n,a,s);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ds(n,a),Gm(e,t,n,a,s);case 3:e:{if(Rp(t),e===null)throw Error(de(387));n=t.pendingProps,o=t.memoizedState,a=o.element,up(e,t),Ii(t,n,null,s);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=$r(Error(de(423)),t),t=Km(e,t,n,s,a);break e}else if(n!==a){a=$r(Error(de(424)),t),t=Km(e,t,n,s,a);break e}else for(Gt=hn(t.stateNode.containerInfo.firstChild),Kt=t,tt=!0,hs=null,s=cp(t,null,n,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ir(),n===a){t=Gs(e,t,s);break e}Dt(e,t,n,s)}t=t.child}return t;case 5:return mp(t),e===null&&Vc(t),n=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,i=a.children,Fc(n,a)?i=null:o!==null&&Fc(n,o)&&(t.flags|=32),Lp(e,t),Dt(e,t,i,s),t.child;case 6:return e===null&&Vc(t),null;case 13:return zp(e,t,s);case 4:return iu(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Or(t,null,n,s):Dt(e,t,n,s),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ds(n,a),Vm(e,t,n,a,s);case 7:return Dt(e,t,t.pendingProps,s),t.child;case 8:return Dt(e,t,t.pendingProps.children,s),t.child;case 12:return Dt(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value,Je(Pi,n._currentValue),n._currentValue=i,o!==null)if(js(o.value,i)){if(o.children===a.children&&!Bt.current){t=Gs(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){i=o.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Us(-1,s&-s),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=s,c=o.alternate,c!==null&&(c.lanes|=s),qc(o.return,s,t),l.lanes|=s;break}c=c.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(de(341));i.lanes|=s,l=i.alternate,l!==null&&(l.lanes|=s),qc(i,s,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}Dt(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Cr(t,s),a=os(a),n=n(a),t.flags|=1,Dt(e,t,n,s),t.child;case 14:return n=t.type,a=ds(n,t.pendingProps),a=ds(n.type,a),qm(e,t,n,a,s);case 15:return Ap(e,t,t.type,t.pendingProps,s);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ds(n,a),li(e,t),t.tag=1,Ht(n)?(e=!0,Ei(t)):e=!1,Cr(t,s),Dp(t,n,a),Kc(t,n,a,s),Jc(null,t,n,!0,e,s);case 19:return Fp(e,t,s);case 22:return $p(e,t,s)}throw Error(de(156,t.tag))};function sg(e,t){return Tf(e,t)}function Yy(e,t,s,n){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ss(e,t,s,n){return new Yy(e,t,s,n)}function wu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Jy(e){if(typeof e=="function")return wu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ud)return 11;if(e===Bd)return 14}return 2}function xn(e,t){var s=e.alternate;return s===null?(s=ss(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function ui(e,t,s,n,a,o){var i=2;if(n=e,typeof e=="function")wu(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case mr:return zn(s.children,a,o,t);case Fd:i=8,a|=8;break;case yc:return e=ss(12,s,t,a|2),e.elementType=yc,e.lanes=o,e;case vc:return e=ss(13,s,t,a),e.elementType=vc,e.lanes=o,e;case bc:return e=ss(19,s,t,a),e.elementType=bc,e.lanes=o,e;case mf:return cl(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case df:i=10;break e;case uf:i=9;break e;case Ud:i=11;break e;case Bd:i=14;break e;case tn:i=16,n=null;break e}throw Error(de(130,e==null?e:typeof e,""))}return t=ss(i,s,t,a),t.elementType=e,t.type=n,t.lanes=o,t}function zn(e,t,s,n){return e=ss(7,e,n,t),e.lanes=s,e}function cl(e,t,s,n){return e=ss(22,e,n,t),e.elementType=mf,e.lanes=s,e.stateNode={isHidden:!1},e}function Zl(e,t,s){return e=ss(6,e,null,t),e.lanes=s,e}function ec(e,t,s){return t=ss(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Xy(e,t,s,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ol(0),this.expirationTimes=Ol(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ol(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Nu(e,t,s,n,a,o,i,l,c){return e=new Xy(e,t,s,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=ss(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},ou(o),e}function Zy(e,t,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ur,key:n==null?null:""+n,children:e,containerInfo:t,implementation:s}}function ng(e){if(!e)return bn;e=e._reactInternals;e:{if(Yn(e)!==e||e.tag!==1)throw Error(de(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ht(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(de(171))}if(e.tag===1){var s=e.type;if(Ht(s))return np(e,s,t)}return t}function rg(e,t,s,n,a,o,i,l,c){return e=Nu(s,n,!0,e,a,o,i,l,c),e.context=ng(null),s=e.current,n=It(),a=gn(s),o=Us(n,a),o.callback=t??null,fn(s,o,a),e.current.lanes=a,lo(e,a,n),Wt(e,n),e}function dl(e,t,s,n){var a=t.current,o=It(),i=gn(a);return s=ng(s),t.context===null?t.context=s:t.pendingContext=s,t=Us(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=fn(a,t,i),e!==null&&(vs(e,a,i,o),ai(e,a,i)),i}function Ui(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function rh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function ku(e,t){rh(e,t),(e=e.alternate)&&rh(e,t)}function ev(){return null}var ag=typeof reportError=="function"?reportError:function(e){console.error(e)};function Su(e){this._internalRoot=e}ul.prototype.render=Su.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(de(409));dl(e,t,null,null)};ul.prototype.unmount=Su.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Vn(function(){dl(null,e,null,null)}),t[Vs]=null}};function ul(e){this._internalRoot=e}ul.prototype.unstable_scheduleHydration=function(e){if(e){var t=$f();e={blockedOn:null,target:e,priority:t};for(var s=0;s<nn.length&&t!==0&&t<nn[s].priority;s++);nn.splice(s,0,e),s===0&&Rf(e)}};function _u(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ml(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ah(){}function tv(e,t,s,n,a){if(a){if(typeof n=="function"){var o=n;n=function(){var d=Ui(i);o.call(d)}}var i=rg(t,n,e,0,null,!1,!1,"",ah);return e._reactRootContainer=i,e[Vs]=i.current,Ba(e.nodeType===8?e.parentNode:e),Vn(),i}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var l=n;n=function(){var d=Ui(c);l.call(d)}}var c=Nu(e,0,!1,null,null,!1,!1,"",ah);return e._reactRootContainer=c,e[Vs]=c.current,Ba(e.nodeType===8?e.parentNode:e),Vn(function(){dl(t,c,s,n)}),c}function hl(e,t,s,n,a){var o=s._reactRootContainer;if(o){var i=o;if(typeof a=="function"){var l=a;a=function(){var c=Ui(i);l.call(c)}}dl(t,i,e,a)}else i=tv(s,t,e,a,n);return Ui(i)}Of=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=da(t.pendingLanes);s!==0&&(Vd(t,s|1),Wt(t,ct()),!(Fe&6)&&(Lr=ct()+500,kn()))}break;case 13:Vn(function(){var n=qs(e,1);if(n!==null){var a=It();vs(n,e,1,a)}}),ku(e,1)}};qd=function(e){if(e.tag===13){var t=qs(e,134217728);if(t!==null){var s=It();vs(t,e,134217728,s)}ku(e,134217728)}};Af=function(e){if(e.tag===13){var t=gn(e),s=qs(e,t);if(s!==null){var n=It();vs(s,e,t,n)}ku(e,t)}};$f=function(){return We};Lf=function(e,t){var s=We;try{return We=e,t()}finally{We=s}};Mc=function(e,t,s){switch(t){case"input":if(Nc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var n=s[t];if(n!==e&&n.form===e.form){var a=nl(n);if(!a)throw Error(de(90));ff(n),Nc(n,a)}}}break;case"textarea":gf(e,s);break;case"select":t=s.value,t!=null&&Nr(e,!!s.multiple,t,!1)}};Nf=vu;kf=Vn;var sv={usingClientEntryPoint:!1,Events:[uo,gr,nl,jf,wf,vu]},na={findFiberByHostInstance:An,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nv={bundleType:na.bundleType,version:na.version,rendererPackageName:na.rendererPackageName,rendererConfig:na.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qs.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Cf(e),e===null?null:e.stateNode},findFiberByHostInstance:na.findFiberByHostInstance||ev,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uo.isDisabled&&Uo.supportsFiber)try{Zi=Uo.inject(nv),Cs=Uo}catch{}}Yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sv;Yt.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_u(t))throw Error(de(200));return Zy(e,t,null,s)};Yt.createRoot=function(e,t){if(!_u(e))throw Error(de(299));var s=!1,n="",a=ag;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Nu(e,1,!1,null,null,s,!1,n,a),e[Vs]=t.current,Ba(e.nodeType===8?e.parentNode:e),new Su(t)};Yt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(de(188)):(e=Object.keys(e).join(","),Error(de(268,e)));return e=Cf(t),e=e===null?null:e.stateNode,e};Yt.flushSync=function(e){return Vn(e)};Yt.hydrate=function(e,t,s){if(!ml(t))throw Error(de(200));return hl(null,e,t,!0,s)};Yt.hydrateRoot=function(e,t,s){if(!_u(e))throw Error(de(405));var n=s!=null&&s.hydratedSources||null,a=!1,o="",i=ag;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(i=s.onRecoverableError)),t=rg(t,null,e,1,s??null,a,!1,o,i),e[Vs]=t.current,Ba(e),n)for(e=0;e<n.length;e++)s=n[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new ul(t)};Yt.render=function(e,t,s){if(!ml(t))throw Error(de(200));return hl(null,e,t,!1,s)};Yt.unmountComponentAtNode=function(e){if(!ml(e))throw Error(de(40));return e._reactRootContainer?(Vn(function(){hl(null,null,e,!1,function(){e._reactRootContainer=null,e[Vs]=null})}),!0):!1};Yt.unstable_batchedUpdates=vu;Yt.unstable_renderSubtreeIntoContainer=function(e,t,s,n){if(!ml(s))throw Error(de(200));if(e==null||e._reactInternals===void 0)throw Error(de(38));return hl(e,t,s,!1,n)};Yt.version="18.3.1-next-f1338f8080-20240426";function og(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(og)}catch(e){console.error(e)}}og(),af.exports=Yt;var rv=af.exports,ig,oh=rv;ig=oh.createRoot,oh.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var av={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ov=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ne=(e,t)=>{const s=h.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:l="",children:c,...d},u)=>h.createElement("svg",{ref:u,...av,width:a,height:a,stroke:n,strokeWidth:i?Number(o)*24/Number(a):o,className:["lucide",`lucide-${ov(e)}`,l].join(" "),...d},[...t.map(([m,f])=>h.createElement(m,f)),...Array.isArray(c)?c:[c]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iv=Ne("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=Ne("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lv=Ne("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cv=Ne("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dv=Ne("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uv=Ne("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mv=Ne("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hv=Ne("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=Ne("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cu=Ne("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=Ne("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fv=Ne("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=Ne("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=Ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cd=Ne("ChefHat",[["path",{d:"M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z",key:"z3ra2g"}],["line",{x1:"6",x2:"18",y1:"17",y2:"17",key:"12q60k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pv=Ne("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gv=Ne("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=Ne("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=Ne("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=Ne("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=Ne("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xv=Ne("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yv=Ne("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vv=Ne("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=Ne("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dg=Ne("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bv=Ne("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=Ne("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jv=Ne("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=Ne("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wv=Ne("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nv=Ne("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hi=Ne("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kv=Ne("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eu=Ne("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=Ne("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sv=Ne("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zr=Ne("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _v=Ne("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ug=Ne("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hi=Ne("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cv=Ne("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=Ne("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=Ne("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ma=Ne("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ev=Ne("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mg=Ne("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hg=Ne("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fg=Ne("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pg=Ne("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qn=Ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tv=Ne("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gg=Ne("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xg=Ne("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mv=Ne("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pv=Ne("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yg=Ne("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fr=Ne("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tu=Ne("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=Ne("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),xs=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():"",Mr=e=>e?xs(e).replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").trim():"",vg=(e,t)=>{const n=[t,e].filter(o=>!!o&&o.trim().length>0).map(o=>Mr(o)).filter(Boolean).join("-")||"item",a=Math.random().toString(36).slice(2,6);return`${n}-${a}`},Dv=(e,t)=>{if(e.codigo&&e.codigo.trim())return e.codigo.trim();const s=t?Mr(t):"",n=Mr(e.nombre),a=Mr(e.id);return[s,n].filter(Boolean).join("-")||a||"item"},bg=(e,t)=>({...e,codigo:Dv(e,t)}),Iv=[{id:"sanduches",titulo:"Sandwiches",items:[{nombre:"Jamn artesano",precio:18500,descripcion:"Salsa verde, queso doble crema, jamn de cerdo, rgula, tomates horneados, parmesano.",keywords:"jamn artesano jamn de cerdo, miel de uvilla, cebolla, tomate horneado, rgula, queso tajado, queso parmesano, salsa verde."},{nombre:"Del huerto",precio:15500,descripcion:"Mayonesa de rostizados, queso feta, rgula, tomates horneados, championes, parmesano, mix de semillas, chips de arracacha.",keywords:"del huerto championes, mayonesa rostizada, queso feta, crocantes de arracacha, tomate horneado, semillas de calabaza, queso tajado."},{nombre:"Pollo Green",precio:16500,descripcion:"Mayonesa de rostizados y verde, jamn de pollo, guacamole, tomate horneado, semillas de girasol, lechuga, tocineta.",keywords:"pollo green jamn de pollo, rgula, championes, parmesano, guacamole, salsa verde, salsa rostizada, lechuga, tomate horneado, semillas."},{nombre:"Pollo Toscano",precio:18500,descripcion:"Salsa verde, Jamn de Pollo, lechuga, rgula, championes, tomates horneados, parmesano, queso doble crema, tocineta, miel de uvilla.",keywords:"pollo toscano jamn de pollo, lechuga, rgula, championes, tomate horneado, queso tajado, queso parmesano, tocineta."},{nombre:"Mexicano",precio:19e3,descripcion:"Frijol refrito, pollo desmechado, pico de gallo, queso crema tajado, guacamole, sour cream, salsa brava.",keywords:"mexicano pollo desmechado, guacamole, pico de gallo, frijol refrito, salsa brava, sour cream, queso tajado."}],side:"left"},{id:"bowlssalados",titulo:"Bowls Salados",subtitulo:"26 oz",items:[{nombre:"Bowl Salado",precio:15e3,descripcion:"Personaliza tu bowl: 2 bases (arroz, pasta, quinua), 4 toppings (maz tierno, championes, pico de gallo, guacamole, tocineta, chips de arracacha, queso feta, zanahoria, pepino) y 1 protena (pechuga de pollo, jamn de cerdo, carne desmechada). Incluye bebida."}],side:"left"},{id:"calientes",titulo:"Bebidas calientes",items:[{nombre:"Capuccino",precio:6e3,keywords:"capuccino"},{nombre:"Latte",precio:5500,keywords:"latte"},{nombre:"Americano",precio:5500,keywords:"americano"},{nombre:"Cocoa",precio:6e3,keywords:"cocoa"},{nombre:"Pitaya latte",precio:8500,keywords:"pitaya latte"},{nombre:"Infusin de frutos rojos",precio:6e3,keywords:"infusin frutos rojos"}],side:"left"},{id:"acompanamientos",titulo:"Acompaamientos",items:[{nombre:"Torta del da",precio:8e3,keywords:"torta del da zanahoria arndanos naranja harina de almendra coco endulzada con banano cubierta yogurt griego"},{nombre:"Galletas de avena",precio:4e3,keywords:"galletas de avena"},{nombre:"Muffin de queso",precio:4500,keywords:"muffin de queso"},{nombre:"Tapitas",precio:1e4,descripcion:"Pan acompaado de queso feta, tomate al horno y albahaca.",keywords:"tapitas pan queso feta tomate al horno albahaca"}],side:"left"}],Ov=[{id:"bowlsfrutales",titulo:"Bowls Frutales",subtitulo:"16 oz",items:[{nombre:"Aa supremo",precio:14500,descripcion:"Base: Aa, fresa, banano, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, fresa, banano, coco, arndanos, semillas, crema de man.",keywords:"aa supremo aa fresa banano yogurt leche bebida vegetal kiwi coco arndanos semillas crema de man"},{nombre:"Tropical",precio:12e3,descripcion:"Base: Mango, pia, banano, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, mango, granola, semillas de girasol, coco.",keywords:"tropical mango pia banano yogurt leche kiwi granola semillas de girasol coco"},{nombre:"Vital",precio:12e3,descripcion:"Base: Mango, banano, pia, espinaca, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, arndano, granola, cha latte, coco.",keywords:"vital mango banano pia espinaca yogurt leche kiwi arndano granola cha latte coco"}],side:"right"},{id:"refrescantes",titulo:"Batidos refrescantes",items:[{nombre:"Amanecer",precio:9500,descripcion:"Mango, pia, menta, semillas de cha.",keywords:"amanecer mango pia menta cha"},{nombre:"Sanda salvaje",precio:9500,descripcion:"Sanda, fresa, hierbabuena, limn, kiwi.",keywords:"sanda salvaje sanda fresa hierbabuena limn kiwi"},{nombre:"Pia rosa",precio:9500,descripcion:"Hierbabuena, pitaya rosada, pia, limn.",keywords:"pia rosa hierbabuena pitaya rosada pia limn"}],side:"right"},{id:"funcionales",titulo:"Batidos funcionales",items:[{nombre:"Golden milk",precio:10500,descripcion:"Mango, banano, yogurt natural, leche, miel, cha, crcuma, maca.",keywords:"golden milk mango banano yogurt leche miel cha crcuma maca"},{nombre:"Digest",precio:10500,descripcion:"Sbila, pia, kiwi, cha, naranja, miel.",keywords:"digest sbila pia kiwi cha naranja miel"},{nombre:"Antioxidante",precio:10500,descripcion:"Sanda, remolacha, jengibre, mora, limn, cha.",keywords:"antioxidante sanda remolacha jengibre mora limn cha"},{nombre:"Saciante",precio:10500,descripcion:"Arndano, fresa, banano, leche, cha, avena.",keywords:"saciante arndano fresa banano leche cha avena"},{nombre:"Detox",precio:10500,descripcion:"Jengibre, apio, perejil, menta fresca, manzana verde, kiwi, pepino, naranja, miel.",keywords:"detox jengibre apio perejil menta fresca manzana verde kiwi pepino naranja miel"}],side:"right"},{id:"especiales",titulo:"Batidos especiales",items:[{nombre:"Pink",precio:12e3,descripcion:"Fresa, banano, yogurt natural, leche, cha, avena.",keywords:"pink fresa banano yogurt leche cha avena"},{nombre:"Mocha energy",precio:12e3,descripcion:"Banano, caf fro, leche, cacao puro, crema de man, avena.",keywords:"mocha energy banano caf fro leche cacao puro crema de man avena"},{nombre:"Matcha protein",precio:16e3,descripcion:"T matcha, scoop de protena whey pure (30 g).",keywords:"matcha protein t matcha protena whey 30g"}],side:"right"},{id:"frias",titulo:"Bebidas fras",items:[{nombre:"Matcha latte helado",precio:11e3,descripcion:"T matcha con leche y hielo.",keywords:"matcha latte helado t matcha leche hielo"},{nombre:"Blue latte helado",precio:10500,descripcion:"T azul en leche o bebida vegetal con hielo.",keywords:"blue latte helado t azul leche bebida vegetal hielo"},{nombre:"Limonada azul",precio:1e4,descripcion:"Mezcla de limn y t azul.",keywords:"limonada azul limn t azul"},{nombre:"Caf Pitaya",precio:10500,descripcion:"Caf y pitaya rosa.",keywords:"caf pitaya caf pitaya rosa"}],side:"right"}],Av=[...Iv,...Ov].flatMap(e=>e.items.map((t,s)=>bg({id:`${e.id}-${s}`,...t,categoria:e.titulo,stock:Math.floor(Math.random()*50)+10,inventarioCategoria:"No inventariables"},e.id))),$v=[{id:"inv-mango",nombre:"Mango",precio:0,categoria:"Frutas",stock:5e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pina",nombre:"Pia",precio:0,categoria:"Frutas",stock:3e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-banano",nombre:"Banano",precio:0,categoria:"Frutas",stock:2e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-fresa",nombre:"Fresa",precio:0,categoria:"Frutas",stock:1500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-kiwi",nombre:"Kiwi",precio:0,categoria:"Frutas",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-sandia",nombre:"Sanda",precio:0,categoria:"Frutas",stock:4e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-arandanos",nombre:"Arndanos",precio:0,categoria:"Frutas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-acai",nombre:"Aa",precio:0,categoria:"Frutas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pitaya",nombre:"Pitaya",precio:0,categoria:"Frutas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-yogurt",nombre:"Yogurt natural",precio:0,categoria:"Lcteos",stock:2e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-leche",nombre:"Leche",precio:0,categoria:"Lcteos",stock:3e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"ml"},{id:"inv-queso-feta",nombre:"Queso feta",precio:0,categoria:"Lcteos",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-queso-crema",nombre:"Queso doble crema",precio:0,categoria:"Lcteos",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jamon-cerdo",nombre:"Jamn de cerdo",precio:0,categoria:"Protenas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jamon-pollo",nombre:"Jamn de pollo",precio:0,categoria:"Protenas",stock:1200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pollo-desmechado",nombre:"Pollo desmechado",precio:0,categoria:"Protenas",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-tocineta",nombre:"Tocineta",precio:0,categoria:"Protenas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-rugula",nombre:"Rgula",precio:0,categoria:"Vegetales",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-lechuga",nombre:"Lechuga",precio:0,categoria:"Vegetales",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-champinones",nombre:"Championes",precio:0,categoria:"Vegetales",stock:600,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-tomate",nombre:"Tomate",precio:0,categoria:"Vegetales",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-espinaca",nombre:"Espinaca",precio:0,categoria:"Vegetales",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-apio",nombre:"Apio",precio:0,categoria:"Vegetales",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pepino",nombre:"Pepino",precio:0,categoria:"Vegetales",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-chia",nombre:"Semillas de cha",precio:0,categoria:"Semillas",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-granola",nombre:"Granola",precio:0,categoria:"Semillas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-avena",nombre:"Avena",precio:0,categoria:"Semillas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-coco",nombre:"Coco rallado",precio:0,categoria:"Semillas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-crema-mani",nombre:"Crema de man",precio:0,categoria:"Semillas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-curcuma",nombre:"Crcuma",precio:0,categoria:"Especias",stock:100,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jengibre",nombre:"Jengibre",precio:0,categoria:"Especias",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-maca",nombre:"Maca",precio:0,categoria:"Especias",stock:150,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-miel",nombre:"Miel",precio:0,categoria:"Especias",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-cafe",nombre:"Caf",precio:0,categoria:"Bebidas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-te-matcha",nombre:"T matcha",precio:0,categoria:"Bebidas",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-cacao",nombre:"Cacao puro",precio:0,categoria:"Bebidas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-proteina",nombre:"Protena whey",precio:0,categoria:"Bebidas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"}],Lv=$v.map(e=>bg(e,"inv")),Rv=[...Av,...Lv],Bo={menuItems:Rv,orders:[],customers:[],empleados:[],gastos:[]},Ke=(e,t)=>{try{const s=localStorage.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error(`Error loading localStorage key "${e}":`,s),t}},Qe=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`Error setting localStorage key "${e}":`,s)}},zv=e=>{try{const t=localStorage.getItem(e);return t===null?{status:"missing",value:void 0}:{status:"ok",value:JSON.parse(t)}}catch(t){return console.warn(`[localData] Error parsing localStorage key "${e}".`,t),{status:"invalid",value:void 0}}},ra=e=>Array.isArray(e);const aa=(e,t,s,n)=>{const{status:a,value:o}=zv(e);if(a!=="ok"){console.info(`[localData] ${n}: ${a==="missing"?"no se encontraron datos previos.":"los datos existentes estn corruptos."} Se inicializan los valores predeterminados.`),Qe(e,t);return}if(!s(o)){console.info(`[localData] ${n}: la estructura encontrada es invlida. Se restauran los valores iniciales.`),Qe(e,t);return}Array.isArray(o)?console.info(`[localData] ${n}: se encontraron ${o.length} registros en localStorage.`):console.info(`[localData] ${n}: datos vlidos detectados en localStorage.`)},Fv=()=>{aa("savia-menuItems",[],ra,"Productos del men"),aa("savia-orders",Bo.orders,ra,"rdenes"),aa("savia-customers",Bo.customers,ra,"Clientes"),aa("savia-empleados",Bo.empleados,ra,"Empleados"),aa("savia-gastos",Bo.gastos,ra,"Gastos")},b={dark:"#0B1C14",beige:"#FEFCED",accent:"#C9C326"},K=e=>{try{return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(e||0)}catch{return`$${e.toLocaleString()}`}},Mu=e=>new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e),jg=e=>{const t=new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}).format(e);return t.charAt(0).toUpperCase()+t.slice(1)},Uv=()=>Math.floor(Math.random()*9e3)+1e3,ze=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},Bv=new Intl.DateTimeFormat("es-CO",{hour:"2-digit",minute:"2-digit"}),Rt=e=>{if(!e)return"";const t=e.trim().match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?$/);if(!t)return e;const s=Number(t[1]),n=Number(t[2]);if(Number.isNaN(s)||Number.isNaN(n))return e;const a=new Date;return a.setHours(s,n,0,0),Bv.format(a)},Hv=/^\d{4}-\d{2}-\d{2}$/,Nt=e=>{if(e instanceof Date&&!Number.isNaN(e.getTime()))return new Date(e.getTime());if(typeof e=="string"){const s=e.trim();if(Hv.test(s)){const[a,o,i]=s.split("-").map(Number);return new Date(a,o-1,i)}const n=new Date(s);if(!Number.isNaN(n.getTime()))return n}const t=new Date;return t.setHours(0,0,0,0),t},Na=()=>ze(new Date),Wv=["efectivo","tarjeta","nequi","provision_caja","credito_empleados"],fi=["efectivo","tarjeta","nequi","credito_empleados"],Vv=["efectivo","nequi","tarjeta"],ns={efectivo:"Efectivo",tarjeta:"Tarjeta",nequi:"Nequi",provision_caja:"Provisin caja",credito_empleados:"Crdito empleados"},fl=e=>Number.isFinite(e)?Math.round(e):0,yn=e=>Array.isArray(e)?e.map(t=>{if(!t||!Wv.includes(t.metodo))return null;const s=fl(Number(t.monto??0));if(s<=0)return null;const n={metodo:t.metodo,monto:s};if(t.metodo==="credito_empleados"){if(!t.empleadoId)return null;n.empleadoId=t.empleadoId,t.empleadoNombre&&(n.empleadoNombre=t.empleadoNombre)}return n}).filter(t=>t!==null):[],Xa=e=>{const t=new Map;return e.forEach(s=>{const n=s.metodo==="credito_empleados"?`${s.metodo}:${s.empleadoId??""}`:s.metodo,a=t.get(n);a?(a.monto+=s.monto,s.empleadoNombre&&!a.empleadoNombre&&(a.empleadoNombre=s.empleadoNombre)):t.set(n,{...s})}),Array.from(t.values()).map(s=>({...s,monto:fl(s.monto)}))},Bs=e=>e.reduce((t,s)=>t+s.monto,0),Ks=e=>{const t=yn(e.paymentAllocations);return t.length>0?Xa(t):e.paymentStatus==="pagado"&&e.metodoPago?[{metodo:e.metodoPago,monto:fl(e.total)}]:[]},wg=e=>{if(e.paymentStatus)return e.paymentStatus;const t=Ks(e),s=Bs(t);return Math.abs(s-fl(e.total))<=1?"pagado":"pendiente"},bs=e=>wg(e)==="pagado",qv=e=>{var t;return e.metodoPago==="credito_empleados"&&((t=e.creditInfo)==null?void 0:t.type)==="empleados"?!0:bs(e)},As=e=>{const t=e.paymentRegisteredAt;return t instanceof Date&&!Number.isNaN(t.getTime())?t:e.timestamp},pl=e=>{var t;if(e.length!==0)return(t=e.slice().sort((s,n)=>n.monto-s.monto)[0])==null?void 0:t.metodo},ho=(e,t)=>e.length===0?"Pago pendiente":e.map(n=>{let a=ns[n.metodo];return n.metodo==="credito_empleados"&&n.empleadoNombre&&(a=`${a} (${n.empleadoNombre})`),`${a}: ${t(n.monto)}`}).join("  ");function Gv({orders:e,menuItems:t,onModuleChange:s,isLoadingOrders:n,isLoadingMenuItems:a}){const o=new Date,i=o.toDateString();if(n||a)return r.jsx("section",{className:"space-y-6 sm:space-y-8",children:r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600 text-sm",children:[r.jsx(nt,{size:18,className:"animate-spin text-gray-500"}),r.jsx("span",{children:"Cargando informacin del dashboard..."})]})});const l=e.filter(p=>p.timestamp.toDateString()===i),d=e.filter(p=>bs(p)&&As(p).toDateString()===i).reduce((p,S)=>p+S.total,0),u=e.filter(p=>p.estado==="pendiente"||p.estado==="preparando").length,m=t.filter(p=>p.inventarioCategoria==="Inventariables"&&p.stock<10),f=[{label:"Ventas del da",value:K(d),icon:cg,color:"green",onClick:()=>s("caja")},{label:"Pedidos hoy",value:l.length.toString(),icon:fg,color:"blue",onClick:()=>s("comandas")},{label:"Pendientes",value:u.toString(),icon:gs,color:"orange",onClick:()=>s("cocina")},{label:"Stock bajo",value:m.length.toString(),icon:Rr,color:"red",onClick:()=>s("inventario")}];return r.jsxs("section",{className:"space-y-6 sm:space-y-8",children:[r.jsxs("div",{className:"text-center px-2 sm:px-0",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:b.dark},children:"Dashboard SAVIA"}),r.jsxs("p",{className:"text-sm lg:text-base text-gray-600",children:["Resumen de operaciones del ",o.toLocaleDateString("es-CO")]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:f.map(p=>{const S=p.icon;return r.jsx("button",{onClick:p.onClick,className:"ui-card ui-card-pad hover:shadow-md transition-all duration-200 hover:scale-[1.02] text-left",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:p.label}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold mt-1",style:{color:b.dark},children:p.value})]}),r.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 rounded-lg flex items-center justify-center",style:{backgroundColor:`${b.accent}20`},children:r.jsx(S,{size:16,className:"sm:w-5 sm:h-5 lg:w-6 lg:h-6",style:{color:b.dark}})})]})},p.label)})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8",children:[r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-semibold mb-4",style:{color:b.dark},children:"ltimos pedidos"}),r.jsxs("div",{className:"space-y-3",children:[e.slice(-5).reverse().map(p=>r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-b border-gray-50 last:border-0 space-y-1 sm:space-y-0",children:[r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium text-sm",children:["#",p.numero]}),r.jsx("span",{className:`ml-0 sm:ml-2 px-2 py-1 rounded-full text-xs inline-block mt-1 sm:mt-0 ${p.estado==="entregado"?"bg-green-100 text-green-800":p.estado==="listo"?"bg-blue-100 text-blue-800":p.estado==="preparando"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:p.estado})]}),r.jsx("span",{className:"font-semibold text-sm",children:K(p.total)})]},p.id)),e.length===0&&r.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"No hay pedidos registrados"})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-semibold mb-4",style:{color:b.dark},children:"Alertas de inventario"}),r.jsxs("div",{className:"space-y-3",children:[m.slice(0,5).map(p=>r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-b border-gray-50 last:border-0 space-y-1 sm:space-y-0",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-sm",children:p.nombre}),r.jsx("span",{className:"text-sm text-gray-500 block",children:p.categoria})]}),r.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${p.stock<5?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:[p.stock," unidades"]})]},p.id)),m.length===0&&r.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"Stock en niveles normales"})]})]})]})]})}const fo=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],Kv=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>oo(async()=>{const{default:n}=await Promise.resolve().then(()=>Kr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)};class Pu extends Error{constructor(t,s="FunctionsError",n){super(t),this.name=s,this.context=n}}class Qv extends Pu{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class ih extends Pu{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class lh extends Pu{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var fd;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(fd||(fd={}));var Yv=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Jv{constructor(t,{headers:s={},customFetch:n,region:a=fd.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=Kv(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var n;return Yv(this,void 0,void 0,function*(){try{const{headers:a,method:o,body:i}=s;let l={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${t}`);c&&c!=="any"&&(l["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;i&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(l["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(l["Content-Type"]="application/json",u=JSON.stringify(i)));const m=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),a),body:u}).catch(E=>{throw new Qv(E)}),f=m.headers.get("x-relay-error");if(f&&f==="true")throw new ih(m);if(!m.ok)throw new lh(m);let p=((n=m.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),S;return p==="application/json"?S=yield m.json():p==="application/octet-stream"?S=yield m.blob():p==="text/event-stream"?S=m:p==="multipart/form-data"?S=yield m.formData():S=yield m.text(),{data:S,error:null,response:m}}catch(a){return{data:null,error:a,response:a instanceof lh||a instanceof ih?a.context:void 0}}})}}var Ft={},Du={},gl={},po={},xl={},yl={},Xv=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Br=Xv();const Zv=Br.fetch,Ng=Br.fetch.bind(Br),kg=Br.Headers,eb=Br.Request,tb=Br.Response,Kr=Object.freeze(Object.defineProperty({__proto__:null,Headers:kg,Request:eb,Response:tb,default:Ng,fetch:Zv},Symbol.toStringTag,{value:"Module"})),sb=Dx(Kr);var vl={};Object.defineProperty(vl,"__esModule",{value:!0});let nb=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};vl.default=nb;var Sg=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yl,"__esModule",{value:!0});const rb=Sg(sb),ab=Sg(vl);let ob=class{constructor(t){var s,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(s=t.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=rb.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=new Headers(this.headers),this.headers.set(t,s),this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,l,c,d;let u=null,m=null,f=null,p=o.status,S=o.statusText;if(o.ok){if(this.method!=="HEAD"){const g=await o.text();g===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?m=g:m=JSON.parse(g))}const T=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),y=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");T&&y&&y.length>1&&(f=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(u={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,f=null,p=406,S="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const T=await o.text();try{u=JSON.parse(T),Array.isArray(u)&&o.status===404&&(m=[],u=null,p=200,S="OK")}catch{o.status===404&&T===""?(p=204,S="No Content"):u={message:T}}if(u&&this.isMaybeSingle&&(!((d=u==null?void 0:u.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,p=200,S="OK"),u&&this.shouldThrowOnError)throw new ab.default(u)}return{error:u,data:m,count:f,status:p,statusText:S}});return this.shouldThrowOnError||(a=a.catch(o=>{var i,l,c;return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(l=o==null?void 0:o.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=o==null?void 0:o.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(t,s)}returns(){return this}overrideTypes(){return this}};yl.default=ob;var ib=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xl,"__esModule",{value:!0});const lb=ib(yl);let cb=class extends lb.default{select(t){let s=!1;const n=(t??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:s=!0,nullsFirst:n,foreignTable:a,referencedTable:o=a}={}){const i=o?`${o}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${t}.${s?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:n=s}={}){const a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this}range(t,s,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"offset":`${a}.offset`,i=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(i,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:s=!1,settings:n=!1,buffers:a=!1,wal:o=!1,format:i="text"}={}){var l;const c=[t?"analyze":null,s?"verbose":null,n?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};xl.default=cb;var db=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(po,"__esModule",{value:!0});const ub=db(xl);let mb=class extends ub.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const n=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:n,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${o}fts${i}.${s}`),this}match(t){return Object.entries(t).forEach(([s,n])=>{this.url.searchParams.append(s,`eq.${n}`)}),this}not(t,s,n){return this.url.searchParams.append(t,`not.${s}.${n}`),this}or(t,{foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.or`:"or";return this.url.searchParams.append(a,`(${t})`),this}filter(t,s,n){return this.url.searchParams.append(t,`${s}.${n}`),this}};po.default=mb;var hb=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(gl,"__esModule",{value:!0});const oa=hb(po);let fb=class{constructor(t,{headers:s={},schema:n,fetch:a}){this.url=t,this.headers=new Headers(s),this.schema=n,this.fetch=a}select(t,{head:s=!1,count:n}={}){const a=s?"HEAD":"GET";let o=!1;const i=(t??"*").split("").map(l=>/\s/.test(l)&&!o?"":(l==='"'&&(o=!o),l)).join("");return this.url.searchParams.set("select",i),n&&this.headers.append("Prefer",`count=${n}`),new oa.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:n=!0}={}){var a;const o="POST";if(s&&this.headers.append("Prefer",`count=${s}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(i.length>0){const l=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new oa.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:n=!1,count:a,defaultToNull:o=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new oa.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:s}={}){var n;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new oa.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var s;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new oa.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};gl.default=fb;var _g=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Du,"__esModule",{value:!0});const pb=_g(gl),gb=_g(po);let xb=class Cg{constructor(t,{headers:s={},schema:n,fetch:a}={}){this.url=t,this.headers=new Headers(s),this.schemaName=n,this.fetch=a}from(t){const s=new URL(`${this.url}/${t}`);return new pb.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new Cg(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:n=!1,get:a=!1,count:o}={}){var i;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;n||a?(l=n?"HEAD":"GET",Object.entries(s).filter(([m,f])=>f!==void 0).map(([m,f])=>[m,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([m,f])=>{c.searchParams.append(m,f)})):(l="POST",d=s);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new gb.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};Du.default=xb;var Qr=as&&as.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ft,"__esModule",{value:!0});Ft.PostgrestError=Ft.PostgrestBuilder=Ft.PostgrestTransformBuilder=Ft.PostgrestFilterBuilder=Ft.PostgrestQueryBuilder=Ft.PostgrestClient=void 0;const Eg=Qr(Du);Ft.PostgrestClient=Eg.default;const Tg=Qr(gl);Ft.PostgrestQueryBuilder=Tg.default;const Mg=Qr(po);Ft.PostgrestFilterBuilder=Mg.default;const Pg=Qr(xl);Ft.PostgrestTransformBuilder=Pg.default;const Dg=Qr(yl);Ft.PostgrestBuilder=Dg.default;const Ig=Qr(vl);Ft.PostgrestError=Ig.default;var yb=Ft.default={PostgrestClient:Eg.default,PostgrestQueryBuilder:Tg.default,PostgrestFilterBuilder:Mg.default,PostgrestTransformBuilder:Pg.default,PostgrestBuilder:Dg.default,PostgrestError:Ig.default};const{PostgrestClient:vb,PostgrestQueryBuilder:Z1,PostgrestFilterBuilder:ek,PostgrestTransformBuilder:tk,PostgrestBuilder:sk,PostgrestError:nk}=yb;class bb{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const s=parseInt(process.versions.node.split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const n=this.getWebSocketConstructor();return new n(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const jb="2.15.4",wb=`realtime-js/${jb}`,Nb="1.0.0",pd=1e4,kb=1e3,Sb=100;var ka;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(ka||(ka={}));var ut;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(ut||(ut={}));var ms;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(ms||(ms={}));var gd;(function(e){e.websocket="websocket"})(gd||(gd={}));var On;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(On||(On={}));class _b{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,s,n)}_decodeBroadcast(t,s,n){const a=s.getUint8(1),o=s.getUint8(2);let i=this.HEADER_LENGTH+2;const l=n.decode(t.slice(i,i+a));i=i+a;const c=n.decode(t.slice(i,i+o));i=i+o;const d=JSON.parse(n.decode(t.slice(i,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class Og{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ye;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Ye||(Ye={}));const ch=(e,t,s={})=>{var n;const a=(n=s.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((o,i)=>(o[i]=Cb(i,e,t,a),o),{})},Cb=(e,t,s,n)=>{const a=t.find(l=>l.name===e),o=a==null?void 0:a.type,i=s[e];return o&&!n.includes(o)?Ag(o,i):xd(i)},Ag=(e,t)=>{if(e.charAt(0)==="_"){const s=e.slice(1,e.length);return Pb(t,s)}switch(e){case Ye.bool:return Eb(t);case Ye.float4:case Ye.float8:case Ye.int2:case Ye.int4:case Ye.int8:case Ye.numeric:case Ye.oid:return Tb(t);case Ye.json:case Ye.jsonb:return Mb(t);case Ye.timestamp:return Db(t);case Ye.abstime:case Ye.date:case Ye.daterange:case Ye.int4range:case Ye.int8range:case Ye.money:case Ye.reltime:case Ye.text:case Ye.time:case Ye.timestamptz:case Ye.timetz:case Ye.tsrange:case Ye.tstzrange:return xd(t);default:return xd(t)}},xd=e=>e,Eb=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Tb=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Mb=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Pb=(e,t)=>{if(typeof e!="string")return e;const s=e.length-1,n=e[s];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,s);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(l=>Ag(t,l))}return e},Db=e=>typeof e=="string"?e.replace(" ","T"):e,$g=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class tc{constructor(t,s,n={},a=pd){this.channel=t,this.event=s,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var n;return this._hasReceived(t)&&s((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var dh;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(dh||(dh={}));class Sa{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Sa.syncState(this.state,a,o,i),this.pendingDiffs.forEach(c=>{this.state=Sa.syncDiff(this.state,c,o,i)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},a=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Sa.syncDiff(this.state,a,o,i),l())}),this.onJoin((a,o,i)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:i})}),this.onLeave((a,o,i)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,n,a){const o=this.cloneDeep(t),i=this.transformState(s),l={},c={};return this.map(o,(d,u)=>{i[d]||(c[d]=u)}),this.map(i,(d,u)=>{const m=o[d];if(m){const f=u.map(T=>T.presence_ref),p=m.map(T=>T.presence_ref),S=u.filter(T=>p.indexOf(T.presence_ref)<0),E=m.filter(T=>f.indexOf(T.presence_ref)<0);S.length>0&&(l[d]=S),E.length>0&&(c[d]=E)}else l[d]=u}),this.syncDiff(o,{joins:l,leaves:c},n,a)}static syncDiff(t,s,n,a){const{joins:o,leaves:i}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(o,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const m=t[l].map(p=>p.presence_ref),f=u.filter(p=>m.indexOf(p.presence_ref)<0);t[l].unshift(...f)}n(l,u,c)}),this.map(i,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(m=>m.presence_ref);d=d.filter(m=>u.indexOf(m.presence_ref)<0),t[l]=d,a(l,d,c),d.length===0&&delete t[l]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(n=>s(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,n)=>{const a=t[n];return"metas"in a?s[n]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):s[n]=a,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var uh;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(uh||(uh={}));var _a;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(_a||(_a={}));var $s;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})($s||($s={}));class Iu{constructor(t,s={config:{}},n){this.topic=t,this.params=s,this.socket=n,this.bindings={},this.state=ut.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new tc(this,ms.join,this.params,this.timeout),this.rejoinTimer=new Og(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ut.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ut.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=ut.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ut.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=ut.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ms.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new Sa(this),this.broadcastEndpointURL=$g(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var n,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==ut.closed){const{config:{broadcast:i,presence:l,private:c}}=this.params,d=(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&a!==void 0?a:[],u=!!this.bindings[_a.PRESENCE]&&this.bindings[_a.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,m={},f={broadcast:i,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(p=>t==null?void 0:t($s.CHANNEL_ERROR,p)),this._onClose(()=>t==null?void 0:t($s.CLOSED)),this.updateJoinPayload(Object.assign({config:f},m)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:p})=>{var S;if(this.socket.setAuth(),p===void 0){t==null||t($s.SUBSCRIBED);return}else{const E=this.bindings.postgres_changes,T=(S=E==null?void 0:E.length)!==null&&S!==void 0?S:0,y=[];for(let g=0;g<T;g++){const x=E[g],{filter:{event:_,schema:F,table:A,filter:H}}=x,R=p&&p[g];if(R&&R.event===_&&R.schema===F&&R.table===A&&R.filter===H)y.push(Object.assign(Object.assign({},x),{id:R.id}));else{this.unsubscribe(),this.state=ut.errored,t==null||t($s.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t($s.SUBSCRIBED);return}}).receive("error",p=>{this.state=ut.errored,t==null||t($s.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{t==null||t($s.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,n){return this.state===ut.joined&&t===_a.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,s,n)}async send(t,s={}){var n,a;if(!this._canPush()&&t.type==="broadcast"){const{event:o,payload:i}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,l,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=ut.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ms.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new tc(this,ms.leave,{},t),n.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ut.closed,this.bindings={}}async _fetchWithTimeout(t,s,n){const a=new AbortController,o=setTimeout(()=>a.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(o),i}_push(t,s,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new tc(this,t,s,n);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>Sb){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,n){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,n){var a,o;const i=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=ms;if(n&&[l,c,d,u].indexOf(i)>=0&&n!==this._joinRef())return;let f=this._onMessage(i,s,n);if(s&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(p=>{var S,E,T;return((S=p.filter)===null||S===void 0?void 0:S.event)==="*"||((T=(E=p.filter)===null||E===void 0?void 0:E.event)===null||T===void 0?void 0:T.toLocaleLowerCase())===i}).map(p=>p.callback(f,n)):(o=this.bindings[i])===null||o===void 0||o.filter(p=>{var S,E,T,y,g,x;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in p){const _=p.id,F=(S=p.filter)===null||S===void 0?void 0:S.event;return _&&((E=s.ids)===null||E===void 0?void 0:E.includes(_))&&(F==="*"||(F==null?void 0:F.toLocaleLowerCase())===((T=s.data)===null||T===void 0?void 0:T.type.toLocaleLowerCase()))}else{const _=(g=(y=p==null?void 0:p.filter)===null||y===void 0?void 0:y.event)===null||g===void 0?void 0:g.toLocaleLowerCase();return _==="*"||_===((x=s==null?void 0:s.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===i}).map(p=>{if(typeof f=="object"&&"ids"in f){const S=f.data,{schema:E,table:T,commit_timestamp:y,type:g,errors:x}=S;f=Object.assign(Object.assign({},{schema:E,table:T,commit_timestamp:y,eventType:g,new:{},old:{},errors:x}),this._getPayloadRecords(S))}p.callback(f,n)})}_isClosed(){return this.state===ut.closed}_isJoined(){return this.state===ut.joined}_isJoining(){return this.state===ut.joining}_isLeaving(){return this.state===ut.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,n){const a=t.toLocaleLowerCase(),o={type:a,filter:s,callback:n};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(t,s){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&Iu.isEqual(a.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(ms.close,{},t)}_onError(t){this._on(ms.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ut.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=ch(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=ch(t.columns,t.old_record)),s}}const sc=()=>{},Ho={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ib=[1e3,2e3,5e3,1e4],Ob=1e4,Ab=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $b{constructor(t,s){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=pd,this.transport=null,this.heartbeatIntervalMs=Ho.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=sc,this.ref=0,this.reconnectTimer=null,this.logger=sc,this.conn=null,this.sendBuffer=[],this.serializer=new _b,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...i)=>oo(async()=>{const{default:l}=await Promise.resolve().then(()=>Kr);return{default:l}},void 0,import.meta.url).then(({default:l})=>l(...i)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...i)=>o(...i)},!(!((n=s==null?void 0:s.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${gd.websocket}`,this.httpEndpoint=$g(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=bb.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Nb}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,n){this.logger(t,s,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ka.connecting:return On.Connecting;case ka.open:return On.Open;case ka.closing:return On.Closing;default:return On.Closed}}isConnected(){return this.connectionState()===On.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const n=`realtime:${t}`,a=this.getChannels().find(o=>o.topic===n);if(a)return a;{const o=new Iu(`realtime:${t}`,s,this);return this.channels.push(o),o}}push(t){const{topic:s,event:n,payload:a,ref:o}=t,i=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${n} (${o})`,a),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(kb,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Ho.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:a,payload:o,ref:i}=s,l=i?`(${i})`:"",c=o.status||"";this.log("receive",`${c} ${n} ${a} ${l}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(a,o,i)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(ms.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const n=t.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${t}${n}${a}`}_workerObjectUrl(t){let s;if(t)s=t;else{const n=new Blob([Ab],{type:"application/javascript"});s=URL.createObjectURL(n)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s;t?s=t:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(n=>{const a={access_token:s,version:wb};s&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push(ms.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(s)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Og(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ho.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,n,a,o,i,l,c,d,u;if(this.transport=(s=t==null?void 0:t.transport)!==null&&s!==void 0?s:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:pd,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:Ho.HEARTBEAT_INTERVAL,this.worker=(o=t==null?void 0:t.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t==null?void 0:t.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:sc,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:m=>Ib[m-1]||Ob,this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(m,f)=>f(JSON.stringify(m)),this.decode=(u=t==null?void 0:t.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class Ou extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function mt(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Lb extends Ou{constructor(t,s,n){super(t),this.name="StorageApiError",this.status=s,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class yd extends Ou{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var Rb=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Lg=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>oo(async()=>{const{default:n}=await Promise.resolve().then(()=>Kr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},zb=()=>Rb(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield oo(()=>Promise.resolve().then(()=>Kr),void 0,import.meta.url)).Response:Response}),vd=e=>{if(Array.isArray(e))return e.map(s=>vd(s));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([s,n])=>{const a=s.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[a]=vd(n)}),t},Fb=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var Jn=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const nc=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ub=(e,t,s)=>Jn(void 0,void 0,void 0,function*(){const n=yield zb();e instanceof n&&!(s!=null&&s.noResolveJson)?e.json().then(a=>{const o=e.status||500,i=(a==null?void 0:a.statusCode)||o+"";t(new Lb(nc(a),o,i))}).catch(a=>{t(new yd(nc(a),a))}):t(new yd(nc(e),e))}),Bb=(e,t,s,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?a:(Fb(n)?(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(n)):a.body=n,t!=null&&t.duplex&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s))};function go(e,t,s,n,a,o){return Jn(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(s,Bb(t,n,a,o)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>Ub(c,l,n))})})}function Wi(e,t,s,n){return Jn(this,void 0,void 0,function*(){return go(e,"GET",t,s,n)})}function ks(e,t,s,n,a){return Jn(this,void 0,void 0,function*(){return go(e,"POST",t,n,a,s)})}function bd(e,t,s,n,a){return Jn(this,void 0,void 0,function*(){return go(e,"PUT",t,n,a,s)})}function Hb(e,t,s,n){return Jn(this,void 0,void 0,function*(){return go(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),n)})}function Rg(e,t,s,n,a){return Jn(this,void 0,void 0,function*(){return go(e,"DELETE",t,n,a,s)})}var Pt=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Wb={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mh={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Vb{constructor(t,s={},n,a){this.url=t,this.headers=s,this.bucketId=n,this.fetch=Lg(a)}uploadOrUpdate(t,s,n,a){return Pt(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},mh),a);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c))):(o=n,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(l=Object.assign(Object.assign({},l),a.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),m=yield(t=="PUT"?bd:ks)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{data:{path:d,id:m.Id,fullPath:m.Key},error:null}}catch(o){if(mt(o))return{data:null,error:o};throw o}})}upload(t,s,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,n)})}uploadToSignedUrl(t,s,n,a){return Pt(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:mh.upsert},a),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const m=yield bd(this.fetch,l.toString(),c,{headers:u});return{data:{path:o,fullPath:m.Key},error:null}}catch(c){if(mt(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return Pt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const o=yield ks(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:a}),i=new URL(this.url+o.url),l=i.searchParams.get("token");if(!l)throw new Ou("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:l},error:null}}catch(n){if(mt(n))return{data:null,error:n};throw n}})}update(t,s,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,n)})}move(t,s,n){return Pt(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(mt(a))return{data:null,error:a};throw a}})}copy(t,s,n){return Pt(this,void 0,void 0,function*(){try{return{data:{path:(yield ks(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(mt(a))return{data:null,error:a};throw a}})}createSignedUrl(t,s,n){return Pt(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),o=yield ks(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(a){if(mt(a))return{data:null,error:a};throw a}})}createSignedUrls(t,s,n){return Pt(this,void 0,void 0,function*(){try{const a=yield ks(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:a.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(a){if(mt(a))return{data:null,error:a};throw a}})}download(t,s){return Pt(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),i=o?`?${o}`:"";try{const l=this._getFinalPath(t);return{data:yield(yield Wi(this.fetch,`${this.url}/${a}/${l}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(mt(l))return{data:null,error:l};throw l}})}info(t){return Pt(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const n=yield Wi(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:vd(n),error:null}}catch(n){if(mt(n))return{data:null,error:n};throw n}})}exists(t){return Pt(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield Hb(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(mt(n)&&n instanceof yd){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,s){const n=this._getFinalPath(t),a=[],o=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";o!==""&&a.push(o);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${d}`)}}}remove(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield Rg(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(mt(s))return{data:null,error:s};throw s}})}list(t,s,n){return Pt(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},Wb),s),{prefix:t||""});return{data:yield ks(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},n),error:null}}catch(a){if(mt(a))return{data:null,error:a};throw a}})}listV2(t,s){return Pt(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield ks(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(mt(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const qb="2.11.1",Gb={"X-Client-Info":`storage-js/${qb}`};var er=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Kb{constructor(t,s={},n,a){const o=new URL(t);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},Gb),s),this.fetch=Lg(n)}listBuckets(){return er(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(mt(t))return{data:null,error:t};throw t}})}getBucket(t){return er(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(mt(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return er(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(mt(n))return{data:null,error:n};throw n}})}updateBucket(t,s){return er(this,void 0,void 0,function*(){try{return{data:yield bd(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(mt(n))return{data:null,error:n};throw n}})}emptyBucket(t){return er(this,void 0,void 0,function*(){try{return{data:yield ks(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(mt(s))return{data:null,error:s};throw s}})}deleteBucket(t){return er(this,void 0,void 0,function*(){try{return{data:yield Rg(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(mt(s))return{data:null,error:s};throw s}})}}class Qb extends Kb{constructor(t,s={},n,a){super(t,s,n,a)}from(t){return new Vb(this.url,this.headers,t,this.fetch)}}const Yb="2.57.0";let ha="";typeof Deno<"u"?ha="deno":typeof document<"u"?ha="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ha="react-native":ha="node";const Jb={"X-Client-Info":`supabase-js-${ha}/${Yb}`},Xb={headers:Jb},Zb={schema:"public"},ej={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tj={};var sj=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const nj=e=>{let t;return e?t=e:typeof fetch>"u"?t=Ng:t=fetch,(...s)=>t(...s)},rj=()=>typeof Headers>"u"?kg:Headers,aj=(e,t,s)=>{const n=nj(s),a=rj();return(o,i)=>sj(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:e;let d=new a(i==null?void 0:i.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(o,Object.assign(Object.assign({},i),{headers:d}))})};var oj=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};function ij(e){return e.endsWith("/")?e:e+"/"}function lj(e,t){var s,n;const{db:a,auth:o,realtime:i,global:l}=e,{db:c,auth:d,realtime:u,global:m}=t,f={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),storage:{},global:Object.assign(Object.assign(Object.assign({},m),l),{headers:Object.assign(Object.assign({},(s=m==null?void 0:m.headers)!==null&&s!==void 0?s:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>oj(this,void 0,void 0,function*(){return""})};return e.accessToken?f.accessToken=e.accessToken:delete f.accessToken,f}const zg="2.71.1",lr=30*1e3,jd=3,rc=jd*lr,cj="http://localhost:9999",dj="supabase.auth.token",uj={"X-Client-Info":`gotrue-js/${zg}`},wd="X-Supabase-Api-Version",Fg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mj=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hj=10*60*1e3;class Au extends Error{constructor(t,s,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=n}}function Pe(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class fj extends Au{constructor(t,s,n){super(t,s,n),this.name="AuthApiError",this.status=s,this.code=n}}function pj(e){return Pe(e)&&e.name==="AuthApiError"}class Ug extends Au{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class Sn extends Au{constructor(t,s,n,a){super(t,n,a),this.name=s,this.status=n}}class Zs extends Sn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function gj(e){return Pe(e)&&e.name==="AuthSessionMissingError"}class Wo extends Sn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Vo extends Sn{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class qo extends Sn{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function xj(e){return Pe(e)&&e.name==="AuthImplicitGrantRedirectError"}class hh extends Sn{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Nd extends Sn{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function ac(e){return Pe(e)&&e.name==="AuthRetryableFetchError"}class fh extends Sn{constructor(t,s,n){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=n}}class kd extends Sn{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Vi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ph=` 	
\r=`.split(""),yj=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<ph.length;t+=1)e[ph[t].charCodeAt(0)]=-2;for(let t=0;t<Vi.length;t+=1)e[Vi[t].charCodeAt(0)]=t;return e})();function gh(e,t,s){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Vi[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Vi[n]),t.queuedBits-=6}}function Bg(e,t,s){const n=yj[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function xh(e){const t=[],s=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=i=>{jj(i,n,s)};for(let i=0;i<e.length;i+=1)Bg(e.charCodeAt(i),a,o);return t.join("")}function vj(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function bj(e,t){for(let s=0;s<e.length;s+=1){let n=e.charCodeAt(s);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(e.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}vj(n,t)}}function jj(e,t,s){if(t.utf8seq===0){if(e<=127){s(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function wj(e){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};for(let a=0;a<e.length;a+=1)Bg(e.charCodeAt(a),s,n);return new Uint8Array(t)}function Nj(e){const t=[];return bj(e,s=>t.push(s)),new Uint8Array(t)}function kj(e){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};return e.forEach(a=>gh(a,s,n)),gh(null,s,n),t.join("")}function Sj(e){return Math.round(Date.now()/1e3)+e}function _j(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const cs=()=>typeof window<"u"&&typeof document<"u",Cn={tested:!1,writable:!1},Hg=()=>{if(!cs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Cn.tested)return Cn.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Cn.tested=!0,Cn.writable=!0}catch{Cn.tested=!0,Cn.writable=!1}return Cn.writable};function Cj(e){const t={},s=new URL(e);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,o)=>{t[o]=a})}catch{}return s.searchParams.forEach((n,a)=>{t[a]=n}),t}const Wg=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>oo(async()=>{const{default:n}=await Promise.resolve().then(()=>Kr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},Ej=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",cr=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},En=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Xs=async(e,t)=>{await e.removeItem(t)};class bl{constructor(){this.promise=new bl.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}bl.promiseConstructor=Promise;function oc(e){const t=e.split(".");if(t.length!==3)throw new kd("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!mj.test(t[n]))throw new kd("JWT not in base64url format");return{header:JSON.parse(xh(t[0])),payload:JSON.parse(xh(t[1])),signature:wj(t[2]),raw:{header:t[0],payload:t[1]}}}async function Tj(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Mj(e,t){return new Promise((n,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){a(i);return}}})()})}function Pj(e){return("0"+e.toString(16)).substr(-2)}function Dj(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=s.length;let a="";for(let o=0;o<56;o++)a+=s.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(t),Array.from(t,Pj).join("")}async function Ij(e){const s=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(n);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function Oj(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const s=await Ij(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tr(e,t,s=!1){const n=Dj();let a=n;s&&(a+="/PASSWORD_RECOVERY"),await cr(e,`${t}-code-verifier`,a);const o=await Oj(n);return[o,n===o?"plain":"s256"]}const Aj=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function $j(e){const t=e.headers.get(wd);if(!t||!t.match(Aj))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Lj(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Rj(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const zj=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function sr(e){if(!zj.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ic(){const e={};return new Proxy(e,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const n=s.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function yh(e){return JSON.parse(JSON.stringify(e))}var Fj=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};const In=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Uj=[502,503,504];async function vh(e){var t;if(!Ej(e))throw new Nd(In(e),0);if(Uj.includes(e.status))throw new Nd(In(e),e.status);let s;try{s=await e.json()}catch(o){throw new Ug(In(o),o)}let n;const a=$j(e);if(a&&a.getTime()>=Fg["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?n=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(n=s.error_code),n){if(n==="weak_password")throw new fh(In(s),e.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Zs}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new fh(In(s),e.status,s.weak_password.reasons);throw new fj(In(s),e.status||500,n)}const Bj=(e,t,s,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),s))};async function Ae(e,t,s,n){var a;const o=Object.assign({},n==null?void 0:n.headers);o[wd]||(o[wd]=Fg["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(i.redirect_to=n.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await Hj(e,t,s+l,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function Hj(e,t,s,n,a,o){const i=Bj(t,n,a,o);let l;try{l=await e(s,Object.assign({},i))}catch(c){throw console.error(c),new Nd(In(c),0)}if(l.ok||await vh(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(c){await vh(c)}}function Ds(e){var t;let s=null;Gj(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=Sj(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:s,user:n},error:null}}function bh(e){const t=Ds(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((s,n)=>s&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function an(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Wj(e){return{data:e,error:null}}function Vj(e){const{action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:o}=e,i=Fj(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:o},c=Object.assign({},i);return{data:{properties:l,user:c},error:null}}function qj(e){return e}function Gj(e){return e.access_token&&e.refresh_token&&e.expires_in}const lc=["global","local","others"];var Kj=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};class Qj{constructor({url:t="",headers:s={},fetch:n}){this.url=t,this.headers=s,this.fetch=Wg(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=lc[0]){if(lc.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${lc.join(", ")}`);try{return await Ae(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,s={}){try{return await Ae(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:an})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:s}=t,n=Kj(t,["options"]),a=Object.assign(Object.assign({},n),s);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await Ae(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Vj,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(Pe(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await Ae(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:an})}catch(s){if(Pe(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,n,a,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await Ae(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:"",per_page:(o=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:qj});if(u.error)throw u.error;const m=await u.json(),f=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,p=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(S=>{const E=parseInt(S.split(";")[0].split("=")[1].substring(0,1)),T=JSON.parse(S.split(";")[1].split("=")[1]);d[`${T}Page`]=E}),d.total=parseInt(f)),{data:Object.assign(Object.assign({},m),d),error:null}}catch(d){if(Pe(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){sr(t);try{return await Ae(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:an})}catch(s){if(Pe(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){sr(t);try{return await Ae(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:an})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,s=!1){sr(t);try{return await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:an})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){sr(t.userId);try{const{data:s,error:n}=await Ae(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:n}}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async _deleteFactor(t){sr(t.userId),sr(t.id);try{return{data:await Ae(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}}}function jh(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}function Yj(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const nr={debug:!!(globalThis&&Hg()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Vg extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Jj extends Vg{}async function Xj(e,t,s){nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),nr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await s()}finally{nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}else{if(t===0)throw nr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Jj(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(nr.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}Yj();const Zj={url:cj,storageKey:dj,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:uj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function wh(e,t,s){return await s()}const rr={};class Za{constructor(t){var s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Za.nextInstanceID,Za.nextInstanceID+=1,this.instanceID>0&&cs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Zj),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Qj({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Wg(a.fetch),this.lock=a.lock||wh,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:cs()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Xj:this.lock=wh,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:Hg()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=jh(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=jh(this.memoryStorage)),cs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var t,s;return(s=(t=rr[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){rr[this.storageKey]=Object.assign(Object.assign({},rr[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=rr[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){rr[this.storageKey]=Object.assign(Object.assign({},rr[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${zg}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=Cj(window.location.href);let n="none";if(this._isImplicitGrantCallback(s)?n="implicit":await this._isPKCECallback(s)&&(n="pkce"),cs()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:o}=await this._getSessionFromURL(s,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),xj(o)){const c=(t=o.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Pe(s)?{error:s}:{error:new Ug("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,n,a;try{const o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:Ds}),{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Pe(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(t){var s,n,a;try{let o;if("email"in t){const{email:u,password:m,options:f}=t;let p=null,S=null;this.flowType==="pkce"&&([p,S]=await tr(this.storage,this.storageKey)),o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:m,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:S},xform:Ds})}else if("phone"in t){const{phone:u,password:m,options:f}=t;o=await Ae(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:m,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(a=f==null?void 0:f.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Ds})}else throw new Vo("You must provide either an email or phone number and a password");const{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Pe(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(t){try{let s;if("email"in t){const{email:o,password:i,options:l}=t;s=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:bh})}else if("phone"in t){const{phone:o,password:i,options:l}=t;s=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:bh})}else throw new Vo("You must provide either an email or phone number and a password");const{data:n,error:a}=s;return a?{data:{user:null,session:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Wo}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(s){if(Pe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,n,a,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;if(s==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(t){var s,n,a,o,i,l,c,d,u,m,f,p;let S,E;if("message"in t)S=t.message,E=t.signature;else{const{chain:T,wallet:y,statement:g,options:x}=t;let _;if(cs())if(typeof y=="object")_=y;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))_=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(x!=null&&x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");_=y}const F=new URL((s=x==null?void 0:x.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in _&&_.signIn){const A=await _.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},x==null?void 0:x.signInWithSolana),{version:"1",domain:F.host,uri:F.href}),g?{statement:g}:null));let H;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")H=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)H=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in H&&"signature"in H&&(typeof H.signedMessage=="string"||H.signedMessage instanceof Uint8Array)&&H.signature instanceof Uint8Array)S=typeof H.signedMessage=="string"?H.signedMessage:new TextDecoder().decode(H.signedMessage),E=H.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in _)||typeof _.signMessage!="function"||!("publicKey"in _)||typeof _!="object"||!_.publicKey||!("toBase58"in _.publicKey)||typeof _.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");S=[`${F.host} wants you to sign in with your Solana account:`,_.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${F.href}`,`Issued At: ${(a=(n=x==null?void 0:x.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=x==null?void 0:x.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...!((i=x==null?void 0:x.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...!((l=x==null?void 0:x.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...!((c=x==null?void 0:x.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...!((d=x==null?void 0:x.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...!((m=(u=x==null?void 0:x.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||m===void 0)&&m.length?["Resources",...x.signInWithSolana.resources.map(H=>`- ${H}`)]:[]].join(`
`);const A=await _.signMessage(new TextEncoder().encode(S),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=A}}try{const{data:T,error:y}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:S,signature:kj(E)},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=t.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Ds});if(y)throw y;return!T||!T.session||!T.user?{data:{user:null,session:null},error:new Wo}:(T.session&&(await this._saveSession(T.session),await this._notifyAllSubscribers("SIGNED_IN",T.session)),{data:Object.assign({},T),error:y})}catch(T){if(Pe(T))return{data:{user:null,session:null},error:T};throw T}}async _exchangeCodeForSession(t){const s=await En(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(s??"").split("/");try{const{data:o,error:i}=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Ds});if(await Xs(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Wo}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:i})}catch(o){if(Pe(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(t){try{const{options:s,provider:n,token:a,access_token:o,nonce:i}=t,l=await Ae(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Ds}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Wo}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(Pe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,n,a,o,i;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await tr(this.storage,this.storageKey));const{error:m}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await Ae(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(o=c==null?void 0:c.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(i=c==null?void 0:c.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new Vo("You must provide either an email or phone number.")}catch(l){if(Pe(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var s,n;try{let a,o;"options"in t&&(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:l}=await Ae(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Ds});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(Pe(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var s,n,a;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await tr(this.storage,this.storageKey)),await Ae(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:Wj})}catch(o){if(Pe(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;if(n)throw n;if(!s)throw new Zs;const{error:a}=await Ae(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(Pe(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:n,type:a,options:o}=t,{error:i}=await Ae(this.fetch,"POST",s,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in t){const{phone:n,type:a,options:o}=t,{data:i,error:l}=await Ae(this.fetch,"POST",s,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:l}}throw new Vo("You must provide either an email or phone number and a type")}catch(s){if(Pe(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=s();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await En(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<rc:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await En(this.userStorage,this.storageKey+"-user");i!=null&&i.user?t.user=i.user:t.user=ic()}if(this.storage.isServer&&t.user){let i=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:a,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{session:null},error:o}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:an}):await this._useSession(async s=>{var n,a,o;const{data:i,error:l}=s;if(l)throw l;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Zs}:await Ae(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=i.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:an})})}catch(s){if(Pe(s))return gj(s)&&(await this._removeSession(),await Xs(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async n=>{const{data:a,error:o}=n;if(o)throw o;if(!a.session)throw new Zs;const i=a.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await tr(this.storage,this.storageKey));const{data:d,error:u}=await Ae(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:i.access_token,xform:an});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(Pe(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Zs;const s=Date.now()/1e3;let n=s,a=!0,o=null;const{payload:i}=oc(t.access_token);if(i.exp&&(n=i.exp,a=n<=s),a){const{session:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;o={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:n-s,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(s){if(Pe(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var n;if(!t){const{data:i,error:l}=s;if(l)throw l;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Zs;const{session:a,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{user:null,session:null},error:o}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(Pe(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!cs())throw new qo("No browser detected.");if(t.error||t.error_description||t.error_code)throw new qo(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new hh("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qo("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new hh("No code detected.");const{data:g,error:x}=await this._exchangeCodeForSession(t.code);if(x)throw x;const _=new URL(window.location.href);return _.searchParams.delete("code"),window.history.replaceState(window.history.state,"",_.toString()),{data:{session:g.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:o,refresh_token:i,expires_in:l,expires_at:c,token_type:d}=t;if(!o||!l||!i||!d)throw new qo("No session defined in URL");const u=Math.round(Date.now()/1e3),m=parseInt(l);let f=u+m;c&&(f=parseInt(c));const p=f-u;p*1e3<=lr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${m}s`);const S=f-m;u-S>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",S,f,u):u-S<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",S,f,u);const{data:E,error:T}=await this._getUser(o);if(T)throw T;const y={provider_token:n,provider_refresh_token:a,access_token:o,expires_in:m,expires_at:f,refresh_token:i,token_type:d,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(n){if(Pe(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await En(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var n;const{data:a,error:o}=s;if(o)return{error:o};const i=(n=a.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:l}=await this.admin.signOut(i,t);if(l&&!(pj(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await Xs(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=_j(),n={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async s=>{var n,a;try{const{data:{session:o},error:i}=s;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,s={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await tr(this.storage,this.storageKey,!0));try{return await Ae(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(o){if(Pe(o))return{data:null,error:o};throw o}}async getUserIdentities(){var t;try{const{data:s,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:n,error:a}=await this._useSession(async o=>{var i,l,c,d,u;const{data:m,error:f}=o;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Ae(this.fetch,"GET",p,{headers:this.headers,jwt:(u=(d=m.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return cs()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:t.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Pe(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var n,a;const{data:o,error:i}=s;if(i)throw i;return await Ae(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const n=Date.now();return await Mj(async a=>(a>0&&await Tj(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await Ae(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ds})),(a,o)=>{const i=200*Math.pow(2,a);return o&&ac(o)&&Date.now()+i-n<lr})}catch(n){if(this._debug(s,"error",n),Pe(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",n),cs()&&!s.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,s;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await En(this.storage,this.storageKey);if(a&&this.userStorage){let i=await En(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:a.user},await cr(this.userStorage,this.storageKey+"-user",i)),a.user=(t=i==null?void 0:i.user)!==null&&t!==void 0?t:ic()}else if(a&&!a.user&&!a.user){const i=await En(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(a.user=i.user,await Xs(this.storage,this.storageKey+"-user"),await cr(this.storage,this.storageKey,a)):a.user=ic()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const o=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<rc;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${rc}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:i}=await this._callRefreshToken(a.refresh_token);i&&(console.error(i),ac(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:l}=await this._getUser(a.access_token);!l&&(i!=null&&i.user)?(a.user=i.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var s,n;if(!t)throw new Zs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new bl;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new Zs;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={session:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(a,"error",o),Pe(o)){const i={session:null,error:o};return ac(o)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,s,n=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",s,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:s});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,s)}catch(c){o.push(c)}});if(await Promise.all(i),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const s=Object.assign({},t),n=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&s.user&&await cr(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const o=yh(a);await cr(this.storage,this.storageKey,o)}else{const a=yh(s);await cr(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Xs(this.storage,this.storageKey),await Xs(this.storage,this.storageKey+"-code-verifier"),await Xs(this.storage,this.storageKey+"-user"),this.userStorage&&await Xs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&cs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),lr);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:n}}=s;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-t)/lr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${lr}ms, refresh threshold is ${jd} ticks`),a<=jd&&await this._callRefreshToken(n.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof Vg)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!cs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,n){const a=[`provider=${encodeURIComponent(s)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await tr(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});a.push(l.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);a.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;return o?{data:null,error:o}:await Ae(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var n,a;const{data:o,error:i}=s;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await Ae(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;if(o)return{data:null,error:o};const{data:i,error:l}=await Ae(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:l})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;return o?{data:null,error:o}:await Ae(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(Pe(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n=(t==null?void 0:t.factors)||[],a=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),o=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:a,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,n;const{data:{session:a},error:o}=t;if(o)return{data:null,error:o};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=oc(a.access_token);let l=null;i.aal&&(l=i.aal);let c=l;((n=(s=a.user.factors)===null||s===void 0?void 0:s.filter(m=>m.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=i.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,s={keys:[]}){let n=s.keys.find(l=>l.kid===t);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+hj>a)return n;const{data:o,error:i}=await Ae(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,n=o.keys.find(l=>l.kid===t),!n)?null:n}async getClaims(t,s={}){try{let n=t;if(!n){const{data:p,error:S}=await this.getSession();if(S||!p.session)return{data:null,error:S};n=p.session.access_token}const{header:a,payload:o,signature:i,raw:{header:l,payload:c}}=oc(n);s!=null&&s.allowExpired||Lj(o.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!d){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:o,header:a,signature:i},error:null}}const u=Rj(a.alg),m=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,m,i,Nj(`${l}.${c}`)))throw new kd("Invalid JWT signature");return{data:{claims:o,header:a,signature:i},error:null}}catch(n){if(Pe(n))return{data:null,error:n};throw n}}}Za.nextInstanceID=0;const ew=Za;class tw extends ew{constructor(t){super(t)}}var sw=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(m){i(m)}}function c(u){try{d(n.throw(u))}catch(m){i(m)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class nw{constructor(t,s,n){var a,o,i;if(this.supabaseUrl=t,this.supabaseKey=s,!t)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=ij(t),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:Zb,realtime:tj,auth:Object.assign(Object.assign({},ej),{storageKey:d}),global:Xb},m=lj(n??{},u);this.storageKey=(a=m.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=m.global.headers)!==null&&o!==void 0?o:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:(f,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=m.auth)!==null&&i!==void 0?i:{},this.headers,m.global.fetch),this.fetch=aj(s,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new vb(new URL("rest/v1",c).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),this.storage=new Qb(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),m.accessToken||this._listenForAuthEvents()}get functions(){return new Jv(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},n={}){return this.rest.rpc(t,s,n)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return sw(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(s=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,userStorage:o,storageKey:i,flowType:l,lock:c,debug:d},u,m){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tw({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:i,autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,userStorage:o,flowType:l,lock:c,debug:d,fetch:m,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new $b(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,n)=>{this._handleTokenChanged(s,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,s,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const rw=(e,t,s)=>new nw(e,t,s);function aw(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}aw()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const ow="https://nrpzetdjwayaxzbcgeba.supabase.co",iw="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ycHpldGRqd2F5YXh6YmNnZWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMDM5NjksImV4cCI6MjA3MjU3OTk2OX0.82VLG5HvSyVTcQdjtnPl2JTvaECvMcMIh0Evn00RAOY",Ce=rw(ow,iw),lw=.1,Hr="Descuento estudiante 10%",cw=e=>(e??"").toLowerCase(),qg=e=>{const t=cw(e.categoria);return t.includes("sandwich")||t.includes("sanduch")},on=e=>typeof e.precioUnitario=="number"?e.precioUnitario:e.item.precio,eo=e=>{const t=on(e);return e.studentDiscount?Math.round(t*(1-lw)):t},to=e=>eo(e)*e.cantidad,Sd=e=>{if(!Number.isFinite(e))return 0;const t=Math.round(e);return t%100===50?t+50:t},en=e=>{const t=e.reduce((s,n)=>s+to(n),0);return Sd(t)},_d=e=>{if(!e)return{studentDiscount:!1,cleanedNotes:void 0};const t=e.split(`
`);let s=!1;const a=t.filter(o=>o.trim().toLowerCase()===Hr.toLowerCase()?(s=!0,!1):!0).join(`
`).trim();return{studentDiscount:s,cleanedNotes:a||void 0}},Gg=(e,t)=>{const{cleanedNotes:s}=_d(e);return t?s?`${s}
${Hr}`:Hr:s},Me=async()=>!0,dw=async()=>{if(!await Me())return"local";try{const{error:e}=await Ce.from("orders").select("id",{head:!0}).limit(1);if(e)throw e;return"online"}catch(e){return console.warn("Supabase connection check failed, falling back to local mode:",e),"local"}},Kg=["efectivo","tarjeta","nequi","provision_caja","credito_empleados"],Gn="savia-employee-credit-updated",Qg="savia-horarios-base",Yg="savia-horarios-semanales",Jg="savia-provision-transfers",Xg="savia-caja-bolsillos",Zg="savia-employee-shifts",ex=()=>{typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent(Gn))},tx=e=>{if(!e||typeof e!="object")return null;const t=e,s={};let n=!1;return fo.forEach(a=>{const o=t[a];if(o&&typeof o=="object"){n=!0;const i=o,l=!!i.active,c=Number(i.hours),d=l&&Number.isFinite(c)?Math.max(0,c):0;s[a]={active:l,hours:d}}else s[a]={active:!1,hours:0}}),n?s:null},Kn=e=>{if(!e||typeof e!="object")return null;const t=e,s={};let n=!1;return fo.forEach(a=>{const o=t[a];o!=null&&(n=!0);const i=Number(o);s[a]=Number.isFinite(i)?Math.max(0,i):0}),n?s:null},sx=e=>{const t={};return fo.forEach(s=>{const n=e[s],a=!!(n!=null&&n.active),o=Number(n==null?void 0:n.hours);t[s]={active:a,hours:a&&Number.isFinite(o)?Math.max(0,o):0}}),t},nx=e=>{const t={};return fo.forEach(s=>{const n=Number(e==null?void 0:e[s]);t[s]=Number.isFinite(n)?Math.max(0,n):0}),t},rx=()=>{const e=Ke(Qg,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a=tx(n);a&&(t[s]=a)}),t},uw=(e,t)=>{const s=rx();s[e]=sx(t),Qe(Qg,s)},jl=()=>{const e=Ke(Yg,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a={};Object.entries(n||{}).forEach(([o,i])=>{const l=Kn(i);l&&(a[o]=l)}),Object.keys(a).length>0&&(t[s]=a)}),t},mw=(e,t,s)=>{const n=jl(),a={...n[e]||{},[t]:nx(s)};n[e]=a,Qe(Yg,n)},Go=e=>{if(e==null||typeof e!="string")return null;const t=e.trim();if(!t)return null;const s=t.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?$/);if(!s)return null;const n=Number(s[1]),a=Number(s[2]),o=s[3]?Number(s[3]):0;if(Number.isNaN(n)||Number.isNaN(a)||Number.isNaN(o)||n<0||n>23||a<0||a>59||o<0||o>59)return null;const i=n.toString().padStart(2,"0"),l=a.toString().padStart(2,"0"),c=o.toString().padStart(2,"0");return`${i}:${l}:${c}`},so=e=>{if(e instanceof Date&&!Number.isNaN(e.getTime())){const t=new Date(e.getTime());return t.setHours(0,0,0,0),ze(t)}if(typeof e=="string"){const t=e.trim();if(!t)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const s=new Date(t);if(!Number.isNaN(s.getTime()))return s.setHours(0,0,0,0),ze(s)}return null},xo=e=>{if(!e||typeof e!="object")return null;const t=e,s=typeof t.id=="string"&&t.id?t.id:void 0,n=typeof t.empleado_id=="string"?t.empleado_id:typeof t.empleadoId=="string"?t.empleadoId:void 0,a=so(t.fecha??t.dia??t.date),o=Go(t.hora_llegada??t.horaLlegada??t.entrada);if(!s||!n||!a||!o)return null;const i=Go(t.hora_salida??t.horaSalida??t.salida),l=!!t.novedad,c=Go(t.novedad_inicio??t.novedadInicio),d=Go(t.novedad_fin??t.novedadFin),u=Number(t.horas_trabajadas??t.horasTrabajadas),m=typeof t.created_at=="string"?t.created_at:typeof t.createdAt=="string"?t.createdAt:void 0,f=typeof t.updated_at=="string"?t.updated_at:typeof t.updatedAt=="string"?t.updatedAt:void 0,p=Number.isFinite(u)?u:void 0;return{id:s,empleadoId:n,fecha:a,horaLlegada:o,horaSalida:i,novedad:l,novedadInicio:c,novedadFin:d,horasTrabajadas:p,createdAt:m,updatedAt:f}},wl=()=>{const e=Ke(Zg,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a=xo({...n,id:s});a&&(t[s]=a)}),t},ax=e=>{const t={};Object.entries(e).forEach(([s,n])=>{t[s]={...n}}),Qe(Zg,t)},Nl=e=>{const t=Array.isArray(e)?e:[e];if(t.length===0)return;const s=wl();let n=!1;t.forEach(a=>{if(!a||!a.id)return;const o=s[a.id];if(!o){s[a.id]={...a},n=!0;return}(o.horaLlegada!==a.horaLlegada||o.horaSalida!==a.horaSalida||o.novedad!==a.novedad||o.novedadInicio!==a.novedadInicio||o.novedadFin!==a.novedadFin||o.horasTrabajadas!==a.horasTrabajadas||o.updatedAt!==a.updatedAt)&&(s[a.id]={...a},n=!0)}),n&&ax(s)},hw=(e,t)=>{const s=wl(),n=s[e];if(!n)return null;const a={...n,...t.empleadoId?{empleadoId:t.empleadoId}:{},...t.fecha?{fecha:t.fecha}:{},...t.horaLlegada!==void 0?{horaLlegada:t.horaLlegada}:{},horaSalida:"horaSalida"in t?t.horaSalida??null:n.horaSalida??null,novedad:"novedad"in t?!!t.novedad:n.novedad,novedadInicio:"novedadInicio"in t?t.novedadInicio??null:n.novedadInicio??null,novedadFin:"novedadFin"in t?t.novedadFin??null:n.novedadFin??null,horasTrabajadas:"horasTrabajadas"in t?t.horasTrabajadas:n.horasTrabajadas,updatedAt:new Date().toISOString()};return s[e]=a,ax(s),a},fw=(e,t,s={})=>{const n=e,a=t,o=s.empleadoId,i=wl();return Object.values(i).filter(l=>!(l.fecha<n||l.fecha>a||o&&l.empleadoId!==o)).sort((l,c)=>{const d=l.fecha.localeCompare(c.fecha);if(d!==0)return d;const u=l.horaLlegada??"",m=c.horaLlegada??"";return u.localeCompare(m)})},pw=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`shift-${Math.random().toString(36).slice(2,12)}`,kl=e=>{const t=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),n=e.getSeconds().toString().padStart(2,"0");return`${t}:${s}:${n}`},gw=e=>{const t={};return"empleadoId"in e&&(t.empleado_id=e.empleadoId),"fecha"in e&&(t.fecha=e.fecha),"horaLlegada"in e&&(t.hora_llegada=e.horaLlegada),"horaSalida"in e&&(t.hora_salida=e.horaSalida??null),"novedad"in e&&(t.novedad=e.novedad),"novedadInicio"in e&&(t.novedad_inicio=e.novedadInicio??null),"novedadFin"in e&&(t.novedad_fin=e.novedadFin??null),"horasTrabajadas"in e&&(t.horas_trabajadas=e.horasTrabajadas??null),Object.keys(t).length>0&&(t.updated_at=new Date().toISOString()),t},xw=e=>{var u,m,f;if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id:(m=(u=e.id)==null?void 0:u.toString)==null?void 0:m.call(u),s=typeof e.empleado_id=="string"?e.empleado_id:typeof e.empleadoId=="string"?e.empleadoId:void 0;if(!t||!s)return null;const n=e.timestamp??e.created_at??new Date().toISOString(),a=new Date(n).toISOString(),o=Math.max(0,Math.round(Number(e.monto)||0)),i=e.tipo==="abono"?"abono":"cargo",l=((f=e==null?void 0:e.empleado)==null?void 0:f.nombre)??(e==null?void 0:e.empleado_nombre)??(e==null?void 0:e.empleadoNombre)??void 0,c=typeof e.order_id=="string"?e.order_id:e.orderId,d=typeof e.order_numero=="number"?e.order_numero:typeof e.orderNumero=="number"?e.orderNumero:void 0;return{id:t,empleadoId:s,empleadoNombre:l,orderId:typeof c=="string"?c:void 0,orderNumero:d,monto:o,tipo:i,timestamp:a}},yw=async()=>{if(!await Me())return[];const{data:e,error:t}=await Ce.from("employee_credit_history").select(`
      id,
      empleado_id,
      order_id,
      order_numero,
      monto,
      tipo,
      timestamp,
      empleado:empleados ( id, nombre )
    `).order("timestamp",{ascending:!0});if(t)throw console.error("[dataService] No se pudo obtener el historial de crdito de empleados.",t),t;const s=new Map;for(const n of e??[]){const a=xw(n);if(!a)continue;const o=a.empleadoId;let i=s.get(o);i||(i={empleadoId:o,empleadoNombre:a.empleadoNombre,saldo:0,history:[]},s.set(o,i)),i.saldo+=a.tipo==="cargo"?a.monto:-a.monto;const l=i.saldo;i.history.push({...a,balanceAfter:l}),!i.empleadoNombre&&a.empleadoNombre&&(i.empleadoNombre=a.empleadoNombre)}return Array.from(s.values()).map(n=>({empleadoId:n.empleadoId,empleadoNombre:n.empleadoNombre,total:Math.round(n.saldo),history:n.history.slice().sort((a,o)=>new Date(o.timestamp).getTime()-new Date(a.timestamp).getTime())})).sort((n,a)=>a.total-n.total)},ox=async({empleadoId:e,monto:t,orderId:s,orderNumero:n})=>{const a=Math.max(0,Math.round(Number(t)||0));if(!e||a<=0)return;if(!await Me())throw new Error("No se pudo registrar el crdito de empleado porque la base de datos no est disponible.");const o={empleado_id:e,order_id:s??null,order_numero:n??null,monto:a,tipo:"cargo"},{error:i}=await Ce.from("employee_credit_history").insert(o);if(i)throw console.error("[dataService] Error registrando crdito de empleado.",i),i;ex()},vw=async({empleadoId:e,monto:t,orderId:s,orderNumero:n})=>{const a=Math.max(0,Math.round(Number(t)||0));if(!e||a<=0)return;if(!await Me())throw new Error("No se pudo registrar el abono del crdito porque la base de datos no est disponible.");const o={empleado_id:e,order_id:s??null,order_numero:n??null,monto:a,tipo:"abono"},{error:i}=await Ce.from("employee_credit_history").insert(o);if(i)throw console.error("[dataService] Error registrando abono de crdito de empleado.",i),i;ex()},$u=e=>{if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const s=t.toLowerCase();return s==="transferencia"?"nequi":s},yo=e=>{const t=$u(e);if(t&&Kg.includes(t))return t},Sl=(e,t="efectivo")=>yo(e)??t,ix=e=>!e||typeof e!="object"?null:typeof e.metodoPago=="string"?e.metodoPago:typeof e.metodopago=="string"?e.metodopago:null,lx="metodopago",qi="inventario_item_id",Lu="inventario_cantidad",Ru="inventario_tipo",zu="inventario_unidad",bw="savia-inventory-updated",Cd=["efectivo","nequi","tarjeta"],Ca={efectivo:"pago_efectivo",nequi:"pago_nequi",tarjeta:"pago_tarjeta"},jw=e=>{const t=Number(e??0);return!Number.isFinite(t)||t<=0?0:Math.round(t)},ww=e=>{if(!e||typeof e!="object")return[];const t=[];for(const s of Cd){const n=Ca[s],a=jw(e[n]);a>0&&t.push({metodo:s,monto:a})}return t},Fu=e=>{const t={efectivo:0,nequi:0,tarjeta:0};return e.forEach(s=>{if(Cd.includes(s.metodo)){const n=s.metodo;t[n]+=Math.round(s.monto)}}),Object.fromEntries(Cd.map(s=>[Ca[s],t[s]]))},cx="savia-order-metadata",Uu=()=>Ke(cx,{}),dx=e=>{Qe(cx,e)},Nw=e=>Uu()[e],no=(e,t)=>{const s=Uu(),a={...s[e]??{}};t.paymentStatus?a.paymentStatus=t.paymentStatus:"paymentStatus"in t&&t.paymentStatus===void 0&&delete a.paymentStatus,"paymentAllocations"in t&&(a.paymentAllocations=yn(t.paymentAllocations??[])),typeof t.paymentRegisteredAt=="string"?a.paymentRegisteredAt=t.paymentRegisteredAt:"paymentRegisteredAt"in t&&t.paymentRegisteredAt===void 0&&delete a.paymentRegisteredAt,"credit"in t&&(t.credit?a.credit=t.credit:delete a.credit);const o=!!a.paymentStatus||a.paymentAllocations&&a.paymentAllocations.length>0||!!a.paymentRegisteredAt,i=!!a.credit;return!o&&!i?delete s[e]:s[e]=a,dx(s),a},kw=e=>{const t=Uu();t[e]&&(delete t[e],dx(t))},Bu=e=>{const t={paymentStatus:e.paymentStatus,paymentAllocations:e.paymentAllocations??[],paymentRegisteredAt:e.paymentRegisteredAt?e.paymentRegisteredAt.toISOString():void 0};e.creditInfo?t.credit={type:e.creditInfo.type,amount:Math.round(e.creditInfo.amount),assignedAt:e.creditInfo.assignedAt.toISOString(),employeeId:e.creditInfo.employeeId,employeeName:e.creditInfo.employeeName}:t.credit=null,no(e.id,t)},pi=e=>{const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return"";const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${a}`},Sw=(e,t)=>{if(e.codigo&&e.codigo.trim())return e.codigo.trim();const s="",n=e.nombre?Mr(e.nombre):"",a=e.id?Mr(e.id):"";return[s,n].filter(Boolean).join("-")||a||"item"},vo=e=>{var l;const t=((l=e.codigo)==null?void 0:l.trim())||vg(e.nombre,e.categoria),s=typeof e.precio=="number"?e.precio:Number(e.precio??0),n=typeof e.stock=="number"?e.stock:Number(e.stock??0),a=e.inventarioCategoria==="Inventariables"?"Inventariables":"No inventariables",o=a==="Inventariables"?e.inventarioTipo:void 0,i=a==="Inventariables"&&o==="gramos"?e.unidadMedida:void 0;return{...e,codigo:t,precio:Number.isFinite(s)?s:0,stock:Number.isFinite(n)?n:0,inventarioCategoria:a,inventarioTipo:o,unidadMedida:i}},ux=e=>{const t=vo(e);return{id:t.id,codigo:t.codigo,nombre:t.nombre,precio:t.precio,descripcion:t.descripcion??null,keywords:t.keywords??null,categoria:t.categoria,stock:t.stock,inventariocategoria:t.inventarioCategoria,inventariotipo:t.inventarioTipo??null,unidadmedida:t.unidadMedida??null}},_w=e=>e==="kg"||e==="g"||e==="mg"||e==="ml"?e:void 0,Ts=e=>{const t=typeof(e==null?void 0:e.id)=="string"&&e.id?e.id:typeof(e==null?void 0:e.codigo)=="string"&&e.codigo?e.codigo:`menu-${Math.random().toString(36).slice(2,10)}`,n=((e==null?void 0:e.inventarioCategoria)??(e==null?void 0:e.inventariocategoria))==="Inventariables"?"Inventariables":"No inventariables",a=(e==null?void 0:e.inventarioTipo)??(e==null?void 0:e.inventariotipo),o=n==="Inventariables"?a==="gramos"?"gramos":a==="cantidad"?"cantidad":void 0:void 0,i=(e==null?void 0:e.unidadMedida)??(e==null?void 0:e.unidadmedida),l=o==="gramos"?_w(i):void 0,c={id:t,codigo:Sw({...e,id:t}),nombre:typeof(e==null?void 0:e.nombre)=="string"?e.nombre:"",precio:typeof(e==null?void 0:e.precio)=="number"?e.precio:Number((e==null?void 0:e.precio)??0),descripcion:(e==null?void 0:e.descripcion)??void 0,keywords:(e==null?void 0:e.keywords)??void 0,categoria:typeof(e==null?void 0:e.categoria)=="string"?e.categoria:"",stock:typeof(e==null?void 0:e.stock)=="number"?e.stock:Number((e==null?void 0:e.stock)??0),inventarioCategoria:n,inventarioTipo:o,unidadMedida:l};return vo(c)},Cw=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const s=Number(e);if(Number.isFinite(s))return s}return t},Ew=e=>Array.isArray(e==null?void 0:e.order_items)?e.order_items.map(t=>{const s=(t==null?void 0:t.menu_item)??(t==null?void 0:t.menu_items)??(t==null?void 0:t.item);if(!s)return null;const n=Ts(s),a=typeof(t==null?void 0:t.cantidad)=="number"?t.cantidad:Number((t==null?void 0:t.cantidad)??0),o=Number.isFinite(a)?Math.max(0,a):0,i=Cw((t==null?void 0:t.precio_unitario)??(t==null?void 0:t.precioUnitario)??(t==null?void 0:t.unitPrice)??(t==null?void 0:t.unit_price),n.precio),l=typeof(t==null?void 0:t.notas)=="string"?t.notas:void 0,{studentDiscount:c,cleanedNotes:d}=_d(l);return{item:n,cantidad:o,notas:d,precioUnitario:i,studentDiscount:c}}).filter(t=>t!==null):Array.isArray(e==null?void 0:e.items)?e.items.map(t=>{const s=(t==null?void 0:t.item)??(t==null?void 0:t.menu_item)??(t==null?void 0:t.menuItem)??t;if(!s)return null;const n=Ts(s),a=typeof(t==null?void 0:t.notas)=="string"?t.notas:void 0,{studentDiscount:o,cleanedNotes:i}=_d(a);return{item:n,cantidad:typeof(t==null?void 0:t.cantidad)=="number"?t.cantidad:Number((t==null?void 0:t.cantidad)??0),notas:i,precioUnitario:typeof(t==null?void 0:t.precioUnitario)=="number"?t.precioUnitario:void 0,studentDiscount:typeof(t==null?void 0:t.studentDiscount)=="boolean"?t.studentDiscount:o}}).filter(t=>t!==null):[],bo=e=>{var ee;const t=Ew(e),s=e!=null&&e.timestamp?new Date(e.timestamp):new Date,n=typeof(e==null?void 0:e.id)=="string"&&e.id?e.id:typeof(e==null?void 0:e.order_id)=="string"&&e.order_id?e.order_id:`order-${Math.random().toString(36).slice(2,10)}`,a=yo(ix(e)),o=Xa(yn(ww(e))),i=t.reduce((te,be)=>te+to(be),0),l=Sd(i),c=Number((e==null?void 0:e.total)??0),d=Number.isFinite(c)&&c>0,u=i>0?l:d?Sd(c):0,m={id:n,numero:typeof(e==null?void 0:e.numero)=="number"?e.numero:Number((e==null?void 0:e.numero)??0),items:t,total:u,estado:(e==null?void 0:e.estado)??"pendiente",timestamp:s,cliente_id:(e==null?void 0:e.cliente_id)??(e==null?void 0:e.clienteId)??void 0,cliente:((ee=e==null?void 0:e.customer)==null?void 0:ee.nombre)??(e==null?void 0:e.cliente)??void 0,metodoPago:a},f=Nw(m.id),p=yn(e==null?void 0:e.paymentAllocations),S=o,E=S.length>0,T=f!=null&&f.paymentAllocations?yn(f.paymentAllocations):void 0,y=f?Array.isArray(f.paymentAllocations)&&f.paymentAllocations.length===0:!1;let g=S;E||(T&&T.length>0?g=T:p.length>0?g=p:y&&(g=[])),g.length===0&&a&&(g=[{metodo:a,monto:Math.round(m.total)}]);const x=g.length>0?Xa(g):g,_=pl(x)??a,F=(()=>{const te=(e==null?void 0:e.paymentStatus)??(e==null?void 0:e.payment_status);if(te==="pagado"||te==="pendiente")return te;if(E){const be=Bs(S),Se=Math.round(m.total);return Math.abs(be-Se)<=1?"pagado":"pendiente"}})(),A=Math.abs(Bs(x)-Math.round(m.total))<=1?"pagado":"pendiente",H=F??(f==null?void 0:f.paymentStatus)??A;let R;const ge=(typeof(e==null?void 0:e.paymentRegisteredAt)=="string"?e.paymentRegisteredAt:void 0)??(typeof(e==null?void 0:e.paid_at)=="string"?e.paid_at:void 0);if(ge){const te=new Date(ge);Number.isNaN(te.getTime())||(R=te)}else if(f!=null&&f.paymentRegisteredAt){const te=new Date(f.paymentRegisteredAt);Number.isNaN(te.getTime())||(R=te)}!R&&H==="pagado"&&(R=new Date(s));let ce;const I=f==null?void 0:f.credit;if(I&&I.type==="empleados"){const te=I.assignedAt?new Date(I.assignedAt):new Date(s),be=Number.isNaN(te.getTime())?new Date(s):te;ce={type:"empleados",amount:Math.round(typeof I.amount=="number"?I.amount:Math.round(m.total)),assignedAt:be,employeeId:I.employeeId,employeeName:I.employeeName}}return{...m,paymentAllocations:x,paymentStatus:H,creditInfo:ce,metodoPago:_,paymentRegisteredAt:R}},Ed=`
  id,
  numero,
  total,
  estado,
  timestamp,
  cliente_id,
  ${Ca.efectivo},
  ${Ca.nequi},
  ${Ca.tarjeta},
  customer:customers ( id, nombre ),
  order_items (
    id,
    cantidad,
    notas,
    menu_item:menu_items (
      id,
      codigo,
      nombre,
      precio,
      descripcion,
      keywords,
      categoria,
      stock,
      inventariocategoria,
      inventariotipo,
      unidadmedida
    )
  )
`,jo=()=>Ke("savia-orders",[]).map(bo),wo=e=>{e.forEach(Bu),Qe("savia-orders",e)},No=e=>{const t=jo(),s=t.findIndex(n=>n.id===e.id);s>=0?t[s]=e:t.push(e),wo(t)},Hs=e=>({id:typeof(e==null?void 0:e.id)=="string"?e.id:`gasto-${Math.random().toString(36).slice(2,10)}`,descripcion:(e==null?void 0:e.descripcion)??"",monto:typeof(e==null?void 0:e.monto)=="number"?e.monto:Number((e==null?void 0:e.monto)??0),categoria:(e==null?void 0:e.categoria)??"",fecha:Nt(e==null?void 0:e.fecha),created_at:e!=null&&e.created_at?new Date(e.created_at):void 0,metodoPago:(()=>{const t=Sl(ix(e));return t==="provision_caja"?"efectivo":t})(),inventarioItemId:typeof(e==null?void 0:e.inventarioItemId)=="string"?e.inventarioItemId:typeof(e==null?void 0:e[qi])=="string"?e[qi]:void 0,inventarioCantidad:(()=>{const t=(e==null?void 0:e.inventarioCantidad)??(e==null?void 0:e[Lu]);if(t==null)return;const s=Number(t);return Number.isFinite(s)?s:void 0})(),inventarioTipo:(()=>{const t=(e==null?void 0:e.inventarioTipo)??(e==null?void 0:e[Ru]);if(t==="gramos")return"gramos";if(t==="cantidad")return"cantidad"})(),inventarioUnidad:(()=>{const t=(e==null?void 0:e.inventarioUnidad)??(e==null?void 0:e[zu]);return t==="kg"||t==="g"||t==="mg"||t==="ml"?t:void 0})()}),mx=e=>{if(!e)return null;const t=typeof e.codigo=="string"&&e.codigo.trim()?e.codigo.trim():null;if(!t)return null;const s=typeof e.nombre=="string"&&e.nombre.trim()?e.nombre.trim():t,n=typeof e.descripcion=="string"&&e.descripcion.trim()?e.descripcion.trim():void 0,a=Sl(e.metodoPago??e.metodo_pago??e.metodo),o=!!(e.esPrincipal??e.es_principal),i=e.created_at??e.createdAt,l=i?new Date(i):void 0;return{codigo:t,nombre:s,descripcion:n,metodoPago:a,esPrincipal:o,created_at:l}},Nh={caja_principal:"Caja principal",provision_caja:"Provisin de caja"},Tw=e=>({codigo:e.codigo,nombre:e.nombre,descripcion:e.descripcion??null,metodoPago:e.metodoPago,esPrincipal:e.esPrincipal,created_at:e.created_at?e.created_at.toISOString():null}),hx=(e,t)=>e.esPrincipal&&!t.esPrincipal?-1:!e.esPrincipal&&t.esPrincipal?1:e.nombre.localeCompare(t.nombre,"es"),fx=()=>(Ke(Xg,[])??[]).map(mx).filter(t=>t!==null).sort(hx),Mw=e=>{const t=e.map(Tw);Qe(Xg,t)},Pw=e=>mx({codigo:e==null?void 0:e.codigo,nombre:e==null?void 0:e.nombre,descripcion:e==null?void 0:e.descripcion,metodoPago:e==null?void 0:e.metodo_pago,esPrincipal:e==null?void 0:e.es_principal,created_at:e==null?void 0:e.created_at}),px=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("caja_bolsillos").select("codigo, nombre, descripcion, metodo_pago, es_principal, created_at").order("es_principal",{ascending:!1}).order("nombre",{ascending:!0});if(t)throw t;const s=(e??[]).map(Pw).filter(n=>n!==null).sort(hx);return Mw(s),s}catch(e){console.warn("[dataService] No se pudieron obtener los bolsillos de caja desde Supabase.",e)}return fx()},qe=e=>typeof e=="string"&&e.trim()?e.trim():void 0,_l=["efectivo","nequi","tarjeta"],gx=e=>{if(!e)return null;const t=Math.max(0,Math.round(Number(e.monto)||0));if(t<=0)return null;const s=Nt(e.fecha);if(!(s instanceof Date)||Number.isNaN(s.getTime()))return null;const n=qe(e.id)??`transfer-${Math.random().toString(36).slice(2,10)}`,a=qe(e.descripcion),o=$u(qe(e.origen)??qe(e.origenMetodo)??qe(e.metodo_origen)??qe(e.metodo)),i=o&&_l.includes(o)?o:"efectivo",l=qe(e.bolsilloOrigen)??qe(e.bolsillo_origen),c=qe(e.bolsilloDestino)??qe(e.bolsillo_destino),d=qe(e.origenNombre)??qe(e.origen_nombre),u=qe(e.destinoNombre)??qe(e.destino_nombre),m=qe(e.destinoMetodo)??qe(e.destino_metodo)??qe(e.destinoMetodoPago)??qe(e.destino_metodo_pago),f=yo(m)??void 0,p=e.created_at??e.createdAt,S=p?new Date(p):void 0;return{id:n,monto:t,descripcion:a,fecha:s,origen:i,created_at:S,bolsilloOrigen:l,bolsilloDestino:c,origenNombre:d,destinoNombre:u,destinoMetodo:f}},Dw=e=>({id:e.id,monto:e.monto,descripcion:e.descripcion??null,fecha:ze(e.fecha instanceof Date?e.fecha:new Date(e.fecha)),origen:e.origen,bolsilloOrigen:e.bolsilloOrigen??null,bolsilloDestino:e.bolsilloDestino??null,origenNombre:e.origenNombre??null,destinoNombre:e.destinoNombre??null,destinoMetodo:e.destinoMetodo??null,created_at:e.created_at?e.created_at.toISOString():new Date().toISOString()}),ro=()=>(Ke(Jg,[])??[]).map(gx).filter(s=>s!==null).sort(Ki),Gi=e=>{const t=e.map(Dw);Qe(Jg,t)},Ki=(e,t)=>{var s,n;return t.fecha.getTime()-e.fecha.getTime()||(((s=t.created_at)==null?void 0:s.getTime())??0)-(((n=e.created_at)==null?void 0:n.getTime())??0)},xx=`
  id,
  fecha,
  monto,
  descripcion,
  bolsillo_origen,
  bolsillo_destino,
  created_at,
  origen_bolsillo:caja_bolsillos!caja_transferencias_bolsillo_origen_fkey (codigo, nombre, metodo_pago),
  destino_bolsillo:caja_bolsillos!caja_transferencias_bolsillo_destino_fkey (codigo, nombre, metodo_pago)
`,yx=e=>{var n,a,o,i,l,c,d,u,m;if(!e)return null;const t=gx({id:e.id,monto:e.monto,descripcion:e.descripcion,fecha:e.fecha,origen:((n=e.origen_bolsillo)==null?void 0:n.metodo_pago)??e.origen??e.metodo_pago??"efectivo",created_at:e.created_at,bolsillo_origen:e.bolsillo_origen,bolsillo_destino:e.bolsillo_destino,origen_nombre:(a=e.origen_bolsillo)==null?void 0:a.nombre,destino_nombre:(o=e.destino_bolsillo)==null?void 0:o.nombre,destino_metodo:(i=e.destino_bolsillo)==null?void 0:i.metodo_pago});if(!t)return null;const s=_l.includes(t.origen)?t.origen:"efectivo";return{...t,origen:s,bolsilloOrigen:t.bolsilloOrigen??qe((l=e.origen_bolsillo)==null?void 0:l.codigo)??qe(e.bolsillo_origen),bolsilloDestino:t.bolsilloDestino??qe((c=e.destino_bolsillo)==null?void 0:c.codigo)??qe(e.bolsillo_destino),origenNombre:t.origenNombre??qe((d=e.origen_bolsillo)==null?void 0:d.nombre),destinoNombre:t.destinoNombre??qe((u=e.destino_bolsillo)==null?void 0:u.nombre),destinoMetodo:t.destinoMetodo??yo((m=e.destino_bolsillo)==null?void 0:m.metodo_pago)??void 0}},cc=()=>({efectivo:0,tarjeta:0,nequi:0,provision_caja:0,credito_empleados:0}),Iw=e=>{const t=new Map;e.forEach(n=>{var l,c;const a=typeof n.order_id=="string"?n.order_id:void 0;if(!a)return;const o=Math.max(0,Math.round(Number(n.monto)||0));if(o<=0)return;let i=t.get(a);if(i||(i={amount:0},t.set(a,i)),n.tipo==="cargo"){i.amount+=o;const d=typeof n.timestamp=="string"?n.timestamp:void 0;if(d){const f=i.assignedAt?new Date(i.assignedAt).getTime():Number.NEGATIVE_INFINITY,p=new Date(d).getTime();!Number.isNaN(p)&&p>=f&&(i.assignedAt=d)}const u=typeof n.empleado_id=="string"?n.empleado_id:((l=n.empleado)==null?void 0:l.id)??void 0;u&&(i.employeeId=u);const m=((c=n.empleado)==null?void 0:c.nombre)??n.empleado_nombre??void 0;m&&(i.employeeName=m)}else n.tipo==="abono"&&(i.amount-=o,i.amount<0&&(i.amount=0))});const s=new Map;return t.forEach((n,a)=>{n.amount>0&&s.set(a,n)}),s},Ow=async e=>{if(e.length===0)return e;const t=e.map(s=>s.id).filter(s=>typeof s=="string"&&s.length>0);if(t.length===0)return e;try{const{data:s,error:n}=await Ce.from("employee_credit_history").select(`
        order_id,
        order_numero,
        monto,
        tipo,
        timestamp,
        empleado_id,
        empleado:empleados ( id, nombre )
      `).in("order_id",t).order("timestamp",{ascending:!0});if(n)throw n;const a=Iw(s??[]);return e.map(o=>{var d;const i=a.get(o.id);if(!i)return o.creditInfo&&o.metodoPago==="credito_empleados"?{...o,creditInfo:void 0,metodoPago:o.metodoPago==="credito_empleados"&&((d=o.paymentAllocations)!=null&&d.length)?pl(o.paymentAllocations)??o.metodoPago:o.metodoPago}:o;const l=i.assignedAt?new Date(i.assignedAt):o.timestamp,c=Number.isNaN(l.getTime())?o.timestamp:l;return{...o,metodoPago:"credito_empleados",paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,creditInfo:{type:"empleados",amount:i.amount,assignedAt:c,employeeId:i.employeeId,employeeName:i.employeeName}}})}catch(s){return console.warn("[dataService] No se pudo obtener el estado de crditos de empleados.",s),e}},Aw=(e,t,s)=>{const n=new Map,a=d=>{let u=n.get(d);return u||(u={ingresosTotales:0,egresosTotales:0,ingresosPorMetodo:cc(),egresosPorMetodo:cc()},n.set(d,u)),u};e.forEach(d=>{if(wg(d)!=="pagado")return;const u=As(d);if(Number.isNaN(u.getTime()))return;const m=pi(u);if(!m)return;const f=a(m),p=Ks(d);if(p.length===0)return;const S=Bs(p);f.ingresosTotales+=S,p.forEach(({metodo:E,monto:T})=>{f.ingresosPorMetodo[E]+=T})}),t.forEach(d=>{const u=new Date(d.fecha);if(Number.isNaN(u.getTime()))return;const m=pi(u);if(!m)return;const f=a(m),p=Sl(d.metodoPago);f.egresosTotales+=d.monto,f.egresosPorMetodo[p]+=d.monto}),s.forEach(d=>{if(!(d.fecha instanceof Date))return;const u=pi(d.fecha);if(!u)return;const m=a(u),f=_l.includes(d.origen)?d.origen:"efectivo",p=d.destinoMetodo&&Kg.includes(d.destinoMetodo)?d.destinoMetodo:void 0;if(d.bolsilloDestino==="provision_caja"){m.ingresosPorMetodo.provision_caja+=d.monto,m.egresosPorMetodo[f]!==void 0&&(m.egresosPorMetodo[f]+=d.monto);return}if(d.bolsilloOrigen==="provision_caja"){m.egresosPorMetodo.provision_caja+=d.monto,p&&m.ingresosPorMetodo[p]!==void 0&&(m.ingresosPorMetodo[p]+=d.monto);return}m.egresosPorMetodo[f]!==void 0&&(m.egresosPorMetodo[f]+=d.monto),p&&m.ingresosPorMetodo[p]!==void 0&&(m.ingresosPorMetodo[p]+=d.monto)});const o=Array.from(n.keys()).sort();if(o.length===0)return[];const i=[];let l=0,c=cc();return o.forEach(d=>{const u=n.get(d),m=u.ingresosPorMetodo.efectivo-u.egresosPorMetodo.efectivo,f=u.ingresosPorMetodo.nequi-u.egresosPorMetodo.nequi,p=u.ingresosPorMetodo.tarjeta-u.egresosPorMetodo.tarjeta,S=u.ingresosPorMetodo.provision_caja-u.egresosPorMetodo.provision_caja,E=u.ingresosPorMetodo.credito_empleados-u.egresosPorMetodo.credito_empleados,T=u.ingresosTotales-u.egresosTotales;l+=T,c={efectivo:c.efectivo+m,tarjeta:c.tarjeta+p,nequi:c.nequi+f,provision_caja:c.provision_caja+S,credito_empleados:c.credito_empleados+E},i.push({fecha:d,ingresosTotales:u.ingresosTotales,egresosTotales:u.egresosTotales,balanceDiario:T,ingresosEfectivo:u.ingresosPorMetodo.efectivo,egresosEfectivo:u.egresosPorMetodo.efectivo,ingresosNequi:u.ingresosPorMetodo.nequi,egresosNequi:u.egresosPorMetodo.nequi,ingresosTarjeta:u.ingresosPorMetodo.tarjeta,egresosTarjeta:u.egresosPorMetodo.tarjeta,ingresosProvisionCaja:u.ingresosPorMetodo.provision_caja,egresosProvisionCaja:u.egresosPorMetodo.provision_caja,saldoEfectivoDia:m,saldoNequiDia:f,saldoTarjetaDia:p,saldoProvisionCajaDia:S,saldoTotalAcumulado:l,saldoEfectivoAcumulado:c.efectivo,saldoNequiAcumulado:c.nequi,saldoTarjetaAcumulado:c.tarjeta,saldoProvisionCajaAcumulado:c.provision_caja})}),i.sort((d,u)=>d.fecha<u.fecha?1:d.fecha>u.fecha?-1:0)},$w=e=>({fecha:pi(e==null?void 0:e.fecha)||String((e==null?void 0:e.fecha)??""),ingresosTotales:Number(e.ingresos_totales??0),egresosTotales:Number(e.egresos_totales??0),balanceDiario:Number(e.balance_diario??0),ingresosEfectivo:Number(e.ingresos_efectivo??0),egresosEfectivo:Number(e.egresos_efectivo??0),ingresosNequi:Number(e.ingresos_nequi??0),egresosNequi:Number(e.egresos_nequi??0),ingresosTarjeta:Number(e.ingresos_tarjeta??0),egresosTarjeta:Number(e.egresos_tarjeta??0),ingresosProvisionCaja:Number(e.ingresos_provision_caja??e.ingresos_provision??0),egresosProvisionCaja:Number(e.egresos_provision_caja??e.egresos_provision??0),saldoEfectivoDia:Number(e.saldo_efectivo_dia??0),saldoNequiDia:Number(e.saldo_nequi_dia??0),saldoTarjetaDia:Number(e.saldo_tarjeta_dia??0),saldoProvisionCajaDia:Number(e.saldo_provision_caja_dia??0),saldoTotalAcumulado:Number(e.saldo_total_acumulado??0),saldoEfectivoAcumulado:Number(e.saldo_efectivo_acumulado??0),saldoNequiAcumulado:Number(e.saldo_nequi_acumulado??0),saldoTarjetaAcumulado:Number(e.saldo_tarjeta_acumulado??0),saldoProvisionCajaAcumulado:Number(e.saldo_provision_caja_acumulado??0)}),dc=e=>{e&&console.warn(`[dataService] Usando datos locales porque: ${e}.`);const s=Ke("savia-menuItems",[]).map(Ts);return console.info(`[dataService] Loaded ${s.length} menu items from local cache.`),s.length===0&&console.warn("[dataService] Local cache does not contain any menu items."),s},Lw=e=>{Qe("savia-menuItems",e)},Rw=e=>{typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent(bw,{detail:{itemIds:e}}))},zw=async e=>{const t=e.filter(i=>i.itemId&&Number.isFinite(i.delta)&&i.delta!==0);if(t.length===0)return[];const s=Ke("savia-menuItems",[]).map(Ts);if(s.length===0)return[];const n=t.reduce((i,l)=>(i[l.itemId]=(i[l.itemId]??0)+l.delta,i),{}),a=s.map(i=>{const l=n[i.id];if(l===void 0)return i;const c=Number.isFinite(i.stock)?i.stock:0,d=Math.max(0,Math.round(c+l));return d===c?i:{...i,stock:d}}),o=a.filter((i,l)=>i!==s[l]);if(o.length===0)return[];if(Lw(a),await Me())try{await Promise.all(o.map(i=>Ce.from("menu_items").update({stock:i.stock}).eq("id",i.id)))}catch(i){console.warn("[dataService] No se pudo sincronizar el ajuste de inventario con Supabase.",i)}return Rw(o.map(i=>i.id)),o},Fw=async()=>{if(console.info("[dataService] Fetching menu items"),await Me())try{const{data:e,error:t}=await Ce.from("menu_items").select("*").order("nombre");if(t)throw t;const s=(e||[]).map(Ts);return s.length>0?(console.info(`[dataService] Supabase returned ${s.length} menu items.`),Qe("savia-menuItems",s),s):(console.warn("[dataService] Supabase returned 0 menu items. Falling back to local cache."),dc("Supabase devolvi una lista vaca"))}catch(e){return console.error("[dataService] Supabase menu fetch failed. Falling back to local cache.",e),dc("hubo un error consultando Supabase")}return console.warn("[dataService] Supabase no est disponible. Usando datos locales."),dc()},Uw=async e=>{const t=vo(e);if(await Me())try{const{data:a,error:o}=await Ce.from("menu_items").insert([ux(t)]).select("*").single();if(o)throw o;return Ts(a)}catch(a){console.warn("Supabase not available, using local data:",a)}const n=[...Ke("savia-menuItems",[]).map(Ts),t];return Qe("savia-menuItems",n),t},Bw=async e=>{const t=vo(e);if(await Me())try{const{data:a,error:o}=await Ce.from("menu_items").update(ux(t)).eq("id",t.id).select("*").single();if(o)throw o;return Ts(a)}catch(a){console.warn("Supabase not available, using local data:",a)}const n=Ke("savia-menuItems",[]).map(Ts).map(a=>a.id===t.id?t:a);return Qe("savia-menuItems",n),t},Hw=async e=>{if(await Me())try{const{error:n}=await Ce.from("menu_items").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-menuItems",[]).map(Ts).filter(n=>n.id!==e);Qe("savia-menuItems",s)},Ww=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("orders").select(Ed).order("timestamp",{ascending:!1});if(t)throw t;let s=(e||[]).map(bo);return s=await Ow(s),wo(s),s}catch(e){console.warn("Supabase not available, using local data:",e)}return jo()},Vw=async(e={})=>{if(!await Me())return()=>{};const{onChange:t,debounceMs:s=250}=e;if(!t)return()=>{};let n;const a=()=>{n&&clearTimeout(n),n=setTimeout(()=>{t()},s)},o=Ce.channel("orders-sync").on("postgres_changes",{event:"*",schema:"public",table:"orders"},a).on("postgres_changes",{event:"*",schema:"public",table:"order_items"},a);let i;try{i=await o.subscribe()}catch(l){return console.warn("No se pudo suscribir a cambios de comandas en Supabase:",l),n&&clearTimeout(n),()=>{}}return()=>{n&&clearTimeout(n),i==null||i.unsubscribe()}},qw=async e=>{const t=e.items.map(u=>({...u,item:vo(u.item),precioUnitario:typeof u.precioUnitario=="number"?u.precioUnitario:u.item.precio})),s=yn(e.paymentAllocations??[]),n=e.paymentStatus??(Math.abs(Bs(s)-Math.round(e.total))<=1?"pagado":"pendiente"),a=s.length>0?s[0].metodo:void 0,o=Sl(e.metodoPago??a),i={...e,items:t,metodoPago:o,paymentAllocations:s,paymentStatus:n};Bu(i);const l=Fu(s);if(await Me())try{const{data:u,error:m}=await Ce.from("orders").insert([{id:i.id,numero:i.numero,total:i.total,estado:i.estado,timestamp:i.timestamp.toISOString(),cliente_id:i.cliente_id??null,...l}]).select("*").single();if(m)throw m;if(i.items.length>0){const p=i.items.map(E=>({order_id:u.id,menu_item_id:E.item.id,cantidad:E.cantidad,notas:Gg(E.notas,E.studentDiscount??!1)??null})),{error:S}=await Ce.from("order_items").insert(p);if(S)throw await Ce.from("orders").delete().eq("id",u.id),S}const f={...i,id:u.id,timestamp:new Date(u.timestamp),cliente_id:u.cliente_id??void 0,metodoPago:pl(s)??i.metodoPago};return No(f),f}catch(u){console.warn("Supabase not available, using local data:",u)}const d=[...jo(),i];return wo(d),i},Gw=async(e,t)=>{const s=Xa(yn(t));if(s.length===0)throw new Error("Debe seleccionar al menos un mtodo de pago.");const n=Bs(s),a=Math.round(e.total),o=Math.abs(n-a)<=1?"pagado":"pendiente",i=pl(s)??e.metodoPago??"efectivo",l=s.filter(m=>m.metodo==="credito_empleados"&&m.empleadoId);for(const m of l)await ox({empleadoId:m.empleadoId,monto:m.monto,orderId:e.id,orderNumero:e.numero});if(await Me())try{const m=Fu(s),{error:f}=await Ce.from("orders").update(m).eq("id",e.id);if(f)throw f}catch(m){console.warn("Supabase not available, using local data:",m)}const d=o==="pagado"?new Date:e.paymentRegisteredAt,u={...e,metodoPago:i,paymentAllocations:s,paymentStatus:o,paymentRegisteredAt:d,creditInfo:o==="pagado"?void 0:e.creditInfo};return Bu(u),No(u),u},Kw=async(e,t)=>{var u,m;const s=Math.max(0,Math.round((t==null?void 0:t.amount)??e.total)),n=new Date,a=(u=t==null?void 0:t.employeeId)==null?void 0:u.trim(),o=a||void 0,i=(m=t==null?void 0:t.employeeName)==null?void 0:m.trim(),l=i||void 0;o&&s>0&&await ox({empleadoId:o,monto:s,orderId:e.id,orderNumero:e.numero});const c={type:"empleados",amount:s,assignedAt:n.toISOString(),employeeId:o,employeeName:l};if(e.estado!=="entregado"&&await Me())try{const{error:f}=await Ce.from("orders").update({estado:"entregado"}).eq("id",e.id);if(f)throw f}catch(f){console.warn("Supabase not available al marcar crdito, se usar cach local:",f)}no(e.id,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,credit:c});const d={...e,estado:"entregado",metodoPago:"credito_empleados",paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,creditInfo:{type:"empleados",amount:s,assignedAt:n,employeeId:o,employeeName:l}};return No(d),d},Qw=e=>["nequi","tarjeta"].includes(e)?e:"efectivo",Yw=async(e,t)=>{if(!e.creditInfo)throw new Error("La orden no tiene un crdito de empleados pendiente.");const s=Math.max(0,Math.round(e.creditInfo.amount??e.total)),n=e.creditInfo.employeeId,a=Qw(t.metodo);n&&s>0&&await vw({empleadoId:n,monto:s,orderId:e.id,orderNumero:e.numero});const o=s>0?[{metodo:a,monto:s}]:[],i=new Date;if(await Me())try{const c={estado:"entregado",...Fu(o)},{error:d}=await Ce.from("orders").update(c).eq("id",e.id);if(d)throw d}catch(c){console.warn("Supabase no disponible al registrar el pago del crdito, se usar cach local:",c)}no(e.id,{paymentStatus:"pagado",paymentAllocations:o,paymentRegisteredAt:i.toISOString(),credit:null});const l={...e,estado:"entregado",metodoPago:a,paymentStatus:"pagado",paymentAllocations:o,paymentRegisteredAt:i,creditInfo:void 0};return No(l),l},Jw=async(e,t)=>{const s=jo();if(await Me())try{const{data:o,error:i}=await Ce.from("orders").update({estado:t}).eq("id",e.id).select(Ed).maybeSingle();if(i)throw i;let l=o;if(!l&&typeof e.numero=="number"){const{data:c,error:d}=await Ce.from("orders").update({estado:t}).eq("numero",e.numero).select(Ed).maybeSingle();if(d)throw d;l=c??void 0}if(l){const c=bo(l);return No(c),c}console.warn(`[dataService] No se encontr la orden ${e.id} en Supabase. Se usar la cach local.`)}catch(o){console.warn("Supabase not available, using local data:",o)}const n=s.findIndex(o=>o.id===e.id);if(n===-1)throw new Error(`No se encontr la orden con id ${e.id} para actualizar su estado.`);const a={...s[n],estado:t};return s[n]=a,wo(s),a},Xw=async(e,t)=>{if(await Me())try{if(t.total!==void 0){const{error:a}=await Ce.from("orders").update({total:t.total}).eq("id",e);if(a)throw a}if(t.items){const{error:a}=await Ce.from("order_items").delete().eq("order_id",e);if(a)throw a;if(t.items.length>0){const o=t.items.map(l=>({order_id:e,menu_item_id:l.item.id,cantidad:l.cantidad,notas:Gg(l.notas,l.studentDiscount??!1)??null})),{error:i}=await Ce.from("order_items").insert(o);if(i)throw i}}no(e,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0});return}catch(a){console.warn("Supabase not available, using local data:",a)}const n=Ke("savia-orders",[]).map(bo).map(a=>a.id===e?{...a,...t.items&&{items:t.items},...t.total!==void 0&&{total:t.total}}:a);Qe("savia-orders",n),no(e,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0})},Zw=async e=>{if(await Me())try{const{error:s}=await Ce.from("order_items").delete().eq("order_id",e);if(s)throw s;const{error:n}=await Ce.from("orders").delete().eq("id",e);if(n)throw n}catch(s){console.warn("Supabase not available, using local data:",s)}kw(e);const t=jo().filter(s=>s.id!==e);wo(t)},eN=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("customers").select("*");if(t)throw t;const s=e||[];return Qe("savia-customers",s),s}catch(e){console.warn("Supabase not available, using local data:",e)}return Ke("savia-customers",[])},tN=async e=>{if(await Me())try{const{data:n,error:a}=await Ce.from("customers").insert([e]).select().single();if(a)throw a;return n}catch(n){console.warn("Supabase not available, using local data:",n)}const s=[...Ke("savia-customers",[]),e];return Qe("savia-customers",s),e},sN=async e=>{if(await Me())try{const{error:n}=await Ce.from("customers").update(e).eq("id",e.id);if(n)throw n;return e}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-customers",[]).map(n=>n.id===e.id?e:n);return Qe("savia-customers",s),e},nN=async e=>{if(await Me())try{const{error:n}=await Ce.from("customers").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-customers",[]).filter(n=>n.id!==e);Qe("savia-customers",s)},rN=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("empleados").select("*").order("nombre");if(t)throw t;const s=e||[];return Qe("savia-empleados",s),s}catch(e){console.warn("Supabase not available, using local data:",e)}return Ke("savia-empleados",[])},aN=async e=>{if(await Me())try{const{data:n,error:a}=await Ce.from("empleados").insert([e]).select().single();if(a)throw a;return n}catch(n){console.warn("Supabase not available, using local data:",n)}const s=[...Ke("savia-empleados",[]),e];return Qe("savia-empleados",s),e},oN=async e=>{if(await Me())try{const{error:n}=await Ce.from("empleados").update(e).eq("id",e.id);if(n)throw n;return e}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-empleados",[]).map(n=>n.id===e.id?e:n);return Qe("savia-empleados",s),e},iN=async e=>{if(await Me())try{const{error:n}=await Ce.from("empleados").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-empleados",[]).filter(n=>n.id!==e);Qe("savia-empleados",s)},lN=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("empleados").select("id, horario_base");if(t)throw t;const s={};for(const n of e??[]){const a=typeof(n==null?void 0:n.id)=="string"?n.id:void 0;if(!a)continue;const o=tx(n==null?void 0:n.horario_base);o&&(s[a]=o)}if(Object.keys(s).length>0)return s}catch(e){console.warn("Supabase not available, using local data:",e)}return rx()},cN=async(e,t)=>{const s=sx(t);let n=null;if(await Me())try{const{error:a}=await Ce.from("empleados").update({horario_base:s}).eq("id",e);if(a)throw a}catch(a){console.error("Error updating employee base schedule in Supabase:",a),n=a}if(uw(e,s),n)throw n},dN=async e=>{if(await Me())try{const{data:n,error:a}=await Ce.from("employee_weekly_hours").select("empleado_id, week_key, horas").eq("week_key",e);if(a)throw a;const o={};for(const i of n??[]){const l=typeof(i==null?void 0:i.empleado_id)=="string"?i.empleado_id:void 0,c=typeof(i==null?void 0:i.week_key)=="string"?i.week_key:void 0;if(!l||c!==e)continue;const d=Kn(i==null?void 0:i.horas);d&&(o[l]=d)}if(Object.keys(o).length>0)return o}catch(n){console.warn("Supabase not available, using local data:",n)}const t=jl(),s={};return Object.entries(t).forEach(([n,a])=>{const o=Kn(a==null?void 0:a[e]);o&&(s[n]=o)}),s},uN=async(e,t)=>{var n;if(await Me())try{const{data:a,error:o}=await Ce.from("employee_weekly_hours").select("horas").eq("empleado_id",e).eq("week_key",t).maybeSingle();if(o)throw o;const i=Kn(a==null?void 0:a.horas);if(i)return i}catch(a){console.warn("Supabase not available, using local data:",a)}const s=jl();return Kn((n=s==null?void 0:s[e])==null?void 0:n[t])},mN=async e=>{if(await Me())try{const{data:a,error:o}=await Ce.from("employee_weekly_hours").select("week_key, horas").eq("empleado_id",e).order("week_key",{ascending:!1});if(o)throw o;const i={};for(const l of a??[]){const c=typeof(l==null?void 0:l.week_key)=="string"?l.week_key:void 0;if(!c)continue;const d=Kn(l==null?void 0:l.horas);d&&(i[c]=d)}if(Object.keys(i).length>0)return i}catch(a){console.warn("Supabase not available, using local data:",a)}const t=jl(),s=t==null?void 0:t[e];if(!s)return{};const n={};return Object.entries(s).forEach(([a,o])=>{const i=Kn(o);i&&(n[a]=i)}),n},hN=async(e,t,s)=>{const n=nx(s);let a=null;if(await Me())try{const{error:o}=await Ce.from("employee_weekly_hours").upsert({empleado_id:e,week_key:t,horas:n},{onConflict:"empleado_id,week_key"});if(o)throw o}catch(o){console.error("Error saving weekly hours in Supabase:",o),a=o}if(mw(e,t,n),a)throw a},Td=e=>[...e].sort((t,s)=>{const n=t.fecha.localeCompare(s.fecha);if(n!==0)return n;const a=t.horaLlegada??"",o=s.horaLlegada??"";return a.localeCompare(o)}),vx=async(e,t,s={})=>{var i;const n=so(e),a=so(t);if(!n||!a)return[];const o=((i=s.empleadoId)==null?void 0:i.trim())||void 0;if(await Me())try{let l=Ce.from("employee_shifts").select("*").gte("fecha",n).lte("fecha",a).order("fecha",{ascending:!0}).order("hora_llegada",{ascending:!0});o&&(l=l.eq("empleado_id",o));const{data:c,error:d}=await l;if(d)throw d;const u=(c??[]).map(xo).filter(m=>!!m);return u.length>0&&Nl(u),Td(u)}catch(l){console.warn("Supabase no disponible al obtener turnos, usando cach local:",l)}return fw(n,a,{empleadoId:o})},fN=async(e,t={})=>{const s=so(e);return s?vx(s,s,t):[]},pN=async(e={})=>{var a;const t=e.date?so(e.date):null,s=((a=e.empleadoId)==null?void 0:a.trim())||void 0;if(await Me())try{let o=Ce.from("employee_shifts").select("*").is("hora_salida",null).order("fecha",{ascending:!0}).order("hora_llegada",{ascending:!0});t&&(o=o.eq("fecha",t)),s&&(o=o.eq("empleado_id",s));const{data:i,error:l}=await o;if(l)throw l;const c=(i??[]).map(xo).filter(d=>!!d);return c.length>0&&Nl(c),Td(c)}catch(o){console.warn("Supabase no disponible al obtener turnos activos, usando cach local:",o)}const n=wl();return Td(Object.values(n).filter(o=>!(o.horaSalida||t&&o.fecha!==t||s&&o.empleadoId!==s)))},gN=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n=new Date(s.getTime());n.setHours(0,0,0,0);const a=ze(n),o=kl(s);let i=null;if(await Me())try{const{data:l,error:c}=await Ce.from("employee_shifts").insert([{empleado_id:e,fecha:a,hora_llegada:o}]).select("*").single();if(c)throw c;i=xo(l)}catch(l){console.warn("Supabase no disponible al crear turno, usando cach local:",l)}if(!i){const l=new Date().toISOString();i={id:pw(),empleadoId:e,fecha:a,horaLlegada:o,horaSalida:null,novedad:!1,novedadInicio:null,novedadFin:null,horasTrabajadas:0,createdAt:l,updatedAt:l}}return Nl(i),i},Cl=async(e,t,s)=>{let n=null;if(await Me())try{const a=gw(t),{data:o,error:i}=await Ce.from("employee_shifts").update(a).eq("id",e).select("*").single();if(i)throw i;n=xo(o)}catch(a){console.warn(s,a)}return n||(n=hw(e,t)),n&&Nl(n),n},xN=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={horaSalida:kl(s)};return Cl(e,n,"Supabase no disponible al cerrar turno, usando cach local:")},yN=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={novedad:!0,novedadInicio:kl(s),novedadFin:null};return Cl(e,n,"Supabase no disponible al iniciar novedad, usando cach local:")},vN=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={novedad:!0,novedadFin:kl(s)};return Cl(e,n,"Supabase no disponible al finalizar novedad, usando cach local:")},bN=async e=>Cl(e,{novedad:!1,novedadInicio:null,novedadFin:null},"Supabase no disponible al limpiar novedad, usando cach local:"),jN=async(e={})=>{if(!await Me())return()=>{};const{onChange:t,empleadoId:s,debounceMs:n=250}=e;if(!t)return()=>{};let a;const o=()=>{a&&clearTimeout(a),a=setTimeout(()=>{t()},n)},i={event:"*",schema:"public",table:"employee_shifts"};s&&(i.filter=`empleado_id=eq.${s}`);const l=Ce.channel(`employee-shifts-${s??"all"}`).on("postgres_changes",i,o);let c;try{c=await l.subscribe()}catch(d){return console.warn("No se pudo suscribir a cambios de turnos en Supabase:",d),a&&clearTimeout(a),()=>{}}return()=>{a&&clearTimeout(a),c==null||c.unsubscribe()}},wN=async()=>{if(await Me())try{const{data:t,error:s}=await Ce.from("gastos").select("*").order("fecha",{ascending:!1});if(s)throw s;const n=(t||[]).map(Hs);return Qe("savia-gastos",n),n}catch(t){console.warn("Supabase not available, using local data:",t)}return Ke("savia-gastos",[]).map(Hs)},NN=async e=>{const s={...Hs(e)};if(await Me())try{const o=ze(s.fecha instanceof Date?s.fecha:new Date(s.fecha)),{data:i,error:l}=await Ce.from("gastos").insert([{id:s.id,descripcion:s.descripcion,monto:s.monto,categoria:s.categoria,fecha:o,created_at:s.created_at instanceof Date?s.created_at.toISOString():s.created_at??new Date().toISOString(),[lx]:s.metodoPago,[qi]:s.inventarioItemId??null,[Lu]:s.inventarioCantidad??null,[Ru]:s.inventarioTipo??null,[zu]:s.inventarioUnidad??null}]).select("*").single();if(l)throw l;return Hs(i)}catch(o){console.warn("Supabase not available, using local data:",o)}const a=[...Ke("savia-gastos",[]).map(Hs),s];return Qe("savia-gastos",a),s},kN=async e=>{const s={...Hs(e)};if(await Me())try{const o=ze(s.fecha instanceof Date?s.fecha:new Date(s.fecha)),{error:i}=await Ce.from("gastos").update({descripcion:s.descripcion,monto:s.monto,categoria:s.categoria,fecha:o,[lx]:s.metodoPago,[qi]:s.inventarioItemId??null,[Lu]:s.inventarioCantidad??null,[Ru]:s.inventarioTipo??null,[zu]:s.inventarioUnidad??null}).eq("id",s.id);if(i)throw i;return s}catch(o){console.warn("Supabase not available, using local data:",o)}const a=Ke("savia-gastos",[]).map(Hs).map(o=>o.id===s.id?s:o);return Qe("savia-gastos",a),s},SN=async e=>{if(await Me())try{const{error:n}=await Ce.from("gastos").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ke("savia-gastos",[]).map(Hs).filter(n=>n.id!==e);Qe("savia-gastos",s)},_N=async()=>{if(await Me())try{const{data:e,error:t}=await Ce.from("caja_transferencias").select(xx).order("fecha",{ascending:!1}).order("created_at",{ascending:!1});if(t)throw t;const s=(e??[]).map(yx).filter(n=>n!==null).filter(n=>!n.bolsilloOrigen&&!n.bolsilloDestino?!0:n.bolsilloDestino==="provision_caja"||n.bolsilloOrigen==="provision_caja").sort(Ki);return Gi(s),s}catch(e){console.warn("[dataService] No se pudo obtener las provisiones desde Supabase.",e)}return ro().filter(e=>!e.bolsilloOrigen&&!e.bolsilloDestino?!0:e.bolsilloDestino==="provision_caja"||e.bolsilloOrigen==="provision_caja")},CN=async e=>{var x;const t=Math.max(0,Math.round(Number(e.monto)||0));if(t<=0)throw new Error("El monto de la provisin debe ser mayor a cero.");const s=e.fecha instanceof Date?new Date(e.fecha.getTime()):new Date(e.fecha);if(Number.isNaN(s.getTime()))throw new Error("La fecha del movimiento de provisin no es vlida.");s.setHours(0,0,0,0);const n=((x=e.descripcion)==null?void 0:x.trim())||void 0,a=await Me(),o=qe(e.bolsilloOrigen)??"caja_principal",i=qe(e.bolsilloDestino)??"provision_caja";if(o===i)throw new Error("Selecciona bolsillos diferentes para origen y destino.");let l=fx(),c=l.find(_=>_.codigo===o),d=l.find(_=>_.codigo===i);if((!c||!d)&&a)try{l=await px(),c=l.find(_=>_.codigo===o)??c,d=l.find(_=>_.codigo===i)??d}catch(_){console.warn("[dataService] No se pudieron refrescar los bolsillos antes de crear la transferencia.",_)}const u=$u(e.origenMetodo??e.origen??(c==null?void 0:c.metodoPago)),m=u&&_l.includes(u)?u:"efectivo",f=yo(e.destinoMetodo??(d==null?void 0:d.metodoPago)??void 0)??void 0,p=qe(e.origenNombre)??(c==null?void 0:c.nombre)??Nh[o]??o,S=qe(e.destinoNombre)??(d==null?void 0:d.nombre)??Nh[i]??i;if(a)try{const{data:_,error:F}=await Ce.from("caja_transferencias").insert({fecha:ze(s),monto:t,descripcion:n??null,bolsillo_origen:o,bolsillo_destino:i}).select(xx).single();if(F)throw F;const A=yx(_);if(A){const H=ro().filter(R=>R.id!==A.id);return Gi([A,...H].sort(Ki)),A}}catch(_){console.warn("[dataService] No se pudo registrar la provisin en Supabase. Usando modo local.",_)}const T={id:e.id&&e.id.trim()?e.id.trim():typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`transfer-${Math.random().toString(36).slice(2,10)}`,monto:t,descripcion:n,fecha:s,origen:m,created_at:new Date,bolsilloOrigen:o,bolsilloDestino:i,origenNombre:p,destinoNombre:S,destinoMetodo:f},y=ro(),g=[T,...y].sort(Ki);return Gi(g),T},EN=async e=>{if(!e)return;if(await Me()){const{error:n}=await Ce.from("caja_transferencias").delete().eq("id",e);if(n)throw n}const s=ro().filter(n=>n.id!==e);Gi(s)},TN=async()=>{if(await Me())try{const{data:n,error:a}=await Ce.from("balance_caja").select("*").order("fecha",{ascending:!1});if(a)throw a;return(n||[]).map($w)}catch(n){console.warn("Supabase not available, using local data:",n)}const e=Ke("savia-orders",[]).map(bo),t=Ke("savia-gastos",[]).map(Hs),s=ro();return Aw(e,t,s)},ye={fetchMenuItems:Fw,createMenuItem:Uw,updateMenuItem:Bw,deleteMenuItem:Hw,fetchOrders:Ww,subscribeToOrders:Vw,createOrder:qw,recordOrderPayment:Gw,assignOrderCredit:Kw,settleOrderEmployeeCredit:Yw,updateOrder:Xw,deleteOrder:Zw,updateOrderStatus:Jw,fetchCustomers:eN,createCustomer:tN,updateCustomer:sN,deleteCustomer:nN,fetchEmpleados:rN,createEmpleado:aN,updateEmpleado:oN,deleteEmpleado:iN,fetchEmployeeBaseSchedules:lN,saveEmployeeBaseSchedule:cN,fetchEmployeeWeeklyHours:uN,fetchEmployeeWeeklyHoursForWeek:dN,fetchEmployeeWeeklyHoursHistory:mN,saveEmployeeWeeklyHours:hN,fetchEmployeeShiftsBetween:vx,fetchEmployeeShiftsForDate:fN,fetchActiveEmployeeShifts:pN,startEmployeeShift:gN,completeEmployeeShift:xN,startEmployeeShiftNovelty:yN,finishEmployeeShiftNovelty:vN,clearEmployeeShiftNovelty:bN,subscribeToEmployeeShifts:jN,fetchEmployeeCredits:yw,fetchGastos:wN,createGasto:NN,updateGasto:kN,deleteGasto:SN,applyInventoryAdjustments:zw,fetchCajaBolsillos:px,fetchProvisionTransfers:_N,createProvisionTransfer:CN,deleteProvisionTransfer:EN,fetchBalanceResumen:TN,checkDatabaseConnection:dw},kh=.4,MN=new Intl.NumberFormat("es-CO",{style:"percent",maximumFractionDigits:1}),PN=new Intl.NumberFormat("es-CO",{minimumFractionDigits:1,maximumFractionDigits:1}),DN=new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"short"});function ao(e){if(!e.length)return{days:0,sales:0,expenses:0,balance:0,avgSales:0,avgExpenses:0,netMarginPct:null};let t=0,s=0,n=0,a,o,i,l=0,c=0,d=Number.POSITIVE_INFINITY;const u=[];e.forEach(g=>{t+=g.sales,s+=g.expenses,n+=g.balance,u.push(g.sales),g.sales>l&&(l=g.sales,a={date:g.date,value:g.sales}),g.expenses>c&&(c=g.expenses,o={date:g.date,value:g.expenses}),g.balance<d&&(d=g.balance,i={date:g.date,value:g.balance})});const m=e.length,f=m>0?t/m:0,p=m>0?s/m:0,S=t>0?n/t*100:null;let E,T;if(u.length>=2){const g=f,x=u.reduce((_,F)=>_+(F-g)**2,0)/u.length;E=Math.sqrt(x),g>0&&E>0&&(T=E/g)}const y=t>0&&l>0?l/t:void 0;return{days:m,sales:t,expenses:s,balance:n,avgSales:f,avgExpenses:p,netMarginPct:S,bestSalesDay:a,highestExpenseDay:o,worstBalanceDay:i,stdSales:E,cvSales:T,shareTopDay:y}}function IN(e,t){if(!t.length||!e.length)return null;const s=t.length,n=t[0].date.getTime(),a=e.findIndex(l=>l.date.getTime()===n);if(a===-1)return null;const o=a-s;if(o<0)return null;const i=e.slice(o,a);return i.length===s?i:null}function gi(e,t){return t===0||t===null||Number.isNaN(t)?null:(e-t)/t*100}function Sh(e){return e.toLocaleDateString("es-CO",{day:"2-digit",month:"short"})}function ON(e){return e===null||Number.isNaN(e)?"":(e>=0?`+${e.toFixed(1)}%`:`${e.toFixed(1)}%`).replace(".",",")}function AN(e,t){if(!e.length)return[];const s=[],n=ao(e),a=t!=null&&t.length?ao(t):null;if(e.length>1){let i=0;for(let c=1;c<e.length;c+=1)e[c].historicalBalance>=e[c-1].historicalBalance&&(i+=1);if(i/(e.length-1)>=.7){const c=e[e.length-1];s.push(`El balance acumulado presenta tendencia ascendente sostenida en ${i} de los ltimos ${e.length-1} das, alcanzando ${K(Math.round(c.historicalBalance))}.`)}}n.bestSalesDay&&s.push(`El mejor da de ventas fue ${Sh(n.bestSalesDay.date)} con ${K(Math.round(n.bestSalesDay.value))}.`),n.worstBalanceDay&&s.push(`El da con peor balance fue ${Sh(n.worstBalanceDay.date)} con ${K(Math.round(n.worstBalanceDay.value))}.`);const o=e.filter(i=>i.sales<=0?!1:i.expenses/i.sales>=kh);if(o.length>=2&&s.push(`Los gastos superaron el ${MN.format(kh)} de las ventas en ${o.length} das, sugiere revisar insumos crticos.`),a){const i=gi(n.sales,a.sales),l=n.netMarginPct!==null&&a.netMarginPct!==null?n.netMarginPct-a.netMarginPct:null,c=ON(i),d=l===null?"":`${l>=0?"+":""}${l.toFixed(1).replace(".",",")} pp`;(i!==null||l!==null)&&s.push(`Frente al periodo anterior, las ventas ${i===null?"se mantuvieron":i>=0?"crecieron":"cayeron"} ${c} y el margen neto ${l===null?"no tuvo variacin relevante":l>=0?`mejor ${d}`:`retrocedi ${d}`}.`)}if(e.length>=5){const i=e[e.length-1].date,l=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),c=n.avgSales*l;s.push(`Con el ritmo actual, las ventas proyectadas al cierre de mes seran ${K(Math.round(c))} (estimacin lineal).`)}return n.shareTopDay&&n.shareTopDay>.35?s.push("Diversifica promociones para reducir la dependencia del da pico de ventas."):s.push("Mantn acciones comerciales enfocadas en replicar los das ms rentables."),s.slice(0,5)}function $N(e){if(!e.length)return!1;const t=new Date,s=t.getMonth(),n=t.getFullYear();return e.every(a=>{const o=a.date;return o.getMonth()===s&&o.getFullYear()===n})}function LN(e,t){const s=t>0?e.sales/t:0,n=[`${DN.format(e.date)}  Ventas ${K(Math.round(e.sales))}`,`Gastos ${K(Math.round(e.expenses))}`,`Balance diario ${K(Math.round(e.balance))}`,`Balance histrico ${K(Math.round(e.historicalBalance))}`];return s>0&&n.push(`Aporta ${PN.format(s*100)}% del periodo`),n}const _h={efectivo:"Efectivo",tarjeta:"Tarjeta",nequi:"Nequi",provision_caja:"Provisin caja",credito_empleados:"Crdito empleados",sin_registro:"Sin registro"},Qi="#e5e7eb",Yi="#16a34a",Ea="#ef4444",Ji="#2563eb",Md="#000000",RN=new Intl.NumberFormat("es-CO",{notation:"compact",compactDisplay:"short",maximumFractionDigits:1}),zN=[{id:"7",label:"Semana"},{id:"30",label:"Mes"},{id:"90",label:"3 meses"},{id:"all",label:"Todo"}],FN=(e,t)=>{if(!e.length)return null;const s=[...e].sort((l,c)=>l-c),n=(s.length-1)*t,a=Math.floor(n),o=Math.ceil(n);if(a===o)return s[a];const i=n-a;return s[a]+(s[o]-s[a])*i},Ko=e=>e.toLocaleDateString("es-CO",{day:"2-digit",month:"short"}),UN=e=>{for(let t=2;t<e.length;t+=1){const s=e[t-1].historicalBalance,n=e[t-2].historicalBalance,a=e[t].historicalBalance;if(s<n&&a<s)return!0}return!1},BN=e=>{for(let t=1;t<e.length;t+=1){const s=e[t-1].historicalBalance,n=e[t].historicalBalance;if(s<=0&&n>=0||s>=0&&n<=0)return t}return null},HN=({data:e,maxOrders:t})=>{if(e.length===0)return null;const s=720,n=260,a={top:16,right:24,bottom:48,left:64},o=s-a.left-a.right,i=n-a.top-a.bottom,l=Math.max(t,1),c=e.length>1?o/(e.length-1):o,d=e.map((T,y)=>{const g=a.left+y*c,x=a.top+i-T.orders/l*i;return{x:g,y:x,entry:T,index:y}}),u=d.map((T,y)=>`${y===0?"M":"L"}${T.x},${T.y}`).join(" "),m=d.map((T,y)=>`${y===0?"M":"L"}${T.x},${T.y}`).join(" ")+` L ${a.left+o},${a.top+i} L ${a.left},${a.top+i} Z`,f=4,p=Array.from({length:f+1},(T,y)=>Math.round(l/f*y)),S=Math.max(1,Math.ceil(e.length/8)),E=d.filter(T=>T.index%S===0||T.index===d.length-1);return r.jsxs("svg",{viewBox:`0 0 ${s} ${n}`,className:"w-full h-64",children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:"hourlyArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"0%",stopColor:b.accent,stopOpacity:.3}),r.jsx("stop",{offset:"100%",stopColor:b.accent,stopOpacity:.05})]})}),r.jsx("rect",{x:a.left,y:a.top,width:o,height:i,fill:"url(#hourlyArea)",opacity:.1}),p.map((T,y)=>{const g=a.top+i-T/l*i;return r.jsxs("g",{children:[r.jsx("line",{x1:a.left,x2:a.left+o,y1:g,y2:g,stroke:Qi,strokeDasharray:"4 4"}),r.jsx("text",{x:a.left-12,y:g+4,textAnchor:"end",className:"text-xs fill-gray-500",children:T})]},`y-grid-${T}`)}),E.map(T=>r.jsx("line",{x1:T.x,x2:T.x,y1:a.top,y2:a.top+i,stroke:Qi,strokeDasharray:"4 4"},`x-grid-${T.index}`)),r.jsx("path",{d:m,fill:"url(#hourlyArea)"}),r.jsx("path",{d:u,fill:"none",stroke:b.accent,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),d.map(T=>r.jsx("circle",{cx:T.x,cy:T.y,r:4,fill:"#fff",stroke:b.accent,strokeWidth:2},`point-${T.index}`)),r.jsx("line",{x1:a.left,x2:a.left+o,y1:a.top+i,y2:a.top+i,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("line",{x1:a.left,x2:a.left,y1:a.top,y2:a.top+i,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("text",{x:a.left/2,y:a.top+i/2,transform:`rotate(-90 ${a.left/2} ${a.top+i/2})`,className:"text-xs font-medium fill-gray-600",children:"Pedidos"}),r.jsx("text",{x:a.left+o/2,y:n-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-600",children:"Hora del da"}),E.map(T=>r.jsx("text",{x:T.x,y:a.top+i+20,textAnchor:"middle",className:"text-xs fill-gray-500",children:T.entry.label},`x-label-${T.index}`))]})},WN=({data:e,totalSales:t,annotations:s=[],targetLineValue:n,targetLineLabel:a})=>{const[o,i]=h.useState(null);if(e.length===0)return r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos suficientes para mostrar la grfica."});const l=720,c=320,d={top:24,right:32,bottom:56,left:80},u=l-d.left-d.right,m=c-d.top-d.bottom,f=n!=null?[n]:[],p=e.flatMap(U=>[U.sales,U.expenses,U.balance,U.historicalBalance]).concat(f),S=Math.max(...p,0),E=Math.min(...p,0),T=S-E||1,y=e.length>1?u/(e.length-1):u,g=U=>d.left+U*y,x=U=>{const Y=(U-E)/T,ue=d.top+m-Y*m;return Math.min(d.top+m,Math.max(d.top,ue))},_=U=>e.map((Y,ue)=>{const ve=U(Y);return{x:g(ue),y:x(ve),value:ve,index:ue,label:Y.label}}),F=U=>U.map((Y,ue)=>`${ue===0?"M":"L"}${Y.x},${Y.y}`).join(" "),A=_(U=>U.sales),H=_(U=>U.expenses),R=_(U=>U.balance),ge=_(U=>U.historicalBalance),ce=5,I=Array.from({length:ce},(U,Y)=>E+T/(ce-1)*Y),ee=Math.max(1,Math.ceil(e.length/6)),te=A.filter(U=>U.index%ee===0||U.index===A.length-1),be=x(0),Se=o!==null?e[o]:null,_e=o!==null?A[o]:null,Ee=Se?LN(Se,t):[],se=(U,Y)=>{switch(U){case"sales":return A[Y];case"expenses":return H[Y];case"balance":return R[Y];case"historical":return ge[Y];default:return}},oe=A.map((U,Y)=>{const ue=Y===0?d.left:(A[Y-1].x+U.x)/2,ve=Y===A.length-1?d.left+u:(U.x+A[Y+1].x)/2,W=Math.max(8,ve-ue);return r.jsx("rect",{x:ue,y:d.top,width:W,height:m,fill:"transparent",onMouseEnter:()=>i(Y),onFocus:()=>i(Y),onMouseLeave:()=>i(null),onTouchStart:()=>i(Y),role:"presentation"},`zone-${U.index}`)}),Q=200,J=24+Ee.length*16,D=_e?Math.min(Math.max(_e.x-Q/2,d.left+8),d.left+u-Q-8):0,le=_e?Math.max(_e.y-J-16,d.top+8):0;return r.jsxs("svg",{viewBox:`0 0 ${l} ${c}`,className:"w-full h-80",onMouseLeave:()=>i(null),children:[I.map((U,Y)=>{const ue=x(U);return r.jsxs("g",{children:[r.jsx("line",{x1:d.left,x2:d.left+u,y1:ue,y2:ue,stroke:Qi,strokeDasharray:"4 4"}),r.jsx("text",{x:d.left-12,y:ue+4,textAnchor:"end",className:"text-xs fill-gray-500",children:RN.format(Math.round(U))})]},`y-financial-${Y}`)}),r.jsx("line",{x1:d.left,x2:d.left+u,y1:be,y2:be,stroke:"#9ca3af",strokeWidth:1.5}),te.map(U=>r.jsx("line",{x1:U.x,x2:U.x,y1:d.top,y2:d.top+m,stroke:Qi,strokeDasharray:"4 4"},`x-financial-${U.index}`)),n!=null&&r.jsxs("g",{children:[r.jsx("line",{x1:d.left,x2:d.left+u,y1:x(n),y2:x(n),stroke:"#4b5563",strokeDasharray:"4 4",strokeWidth:1.5}),a&&r.jsx("text",{x:d.left+u-4,y:x(n)-6,textAnchor:"end",className:"text-xs font-medium fill-gray-600",children:a})]}),r.jsx("path",{d:F(H),fill:"none",stroke:Ea,strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:F(A),fill:"none",stroke:Yi,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:F(R),fill:"none",stroke:Ji,strokeWidth:2.5,strokeDasharray:"6 4",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:F(ge),fill:"none",stroke:Md,strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"}),A.map(U=>r.jsx("circle",{cx:U.x,cy:U.y,r:o===U.index?5:4,fill:"#fff",stroke:Yi,strokeWidth:2},`sales-${U.index}`)),H.map(U=>r.jsx("circle",{cx:U.x,cy:U.y,r:4,fill:"#fff",stroke:Ea,strokeWidth:2},`expenses-${U.index}`)),R.map(U=>r.jsx("circle",{cx:U.x,cy:U.y,r:4,fill:"#fff",stroke:Ji,strokeWidth:2},`balance-${U.index}`)),ge.map(U=>r.jsx("circle",{cx:U.x,cy:U.y,r:4,fill:"#fff",stroke:Md,strokeWidth:2},`historical-balance-${U.index}`)),s.map(U=>{const Y=se(U.anchor,U.index);return Y?r.jsxs("g",{children:[U.variant==="outline"&&r.jsx("circle",{cx:Y.x,cy:Y.y,r:7,fill:"white",stroke:U.color??Ea,strokeWidth:2.5}),U.icon&&r.jsx("text",{x:Y.x,y:Y.y-12,textAnchor:"middle",className:"text-sm",children:U.icon}),r.jsx("text",{x:Y.x,y:U.icon?Y.y-26:Y.y-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-700",children:U.label})]},`${U.anchor}-${U.index}`):null}),_e&&r.jsxs("g",{children:[r.jsx("line",{x1:_e.x,x2:_e.x,y1:d.top,y2:d.top+m,stroke:"#d1d5db",strokeDasharray:"4 4"}),r.jsx("rect",{x:D,y:le,width:Q,height:J,rx:8,ry:8,fill:"white",stroke:"#e5e7eb",strokeWidth:1}),r.jsx("text",{x:D+12,y:le+18,className:"text-xs fill-gray-700",children:Ee.map((U,Y)=>r.jsx("tspan",{x:D+12,dy:Y===0?0:16,children:U},U))})]}),oe,r.jsx("line",{x1:d.left,x2:d.left+u,y1:d.top+m,y2:d.top+m,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("line",{x1:d.left,x2:d.left,y1:d.top,y2:d.top+m,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("text",{x:d.left/2,y:d.top+m/2,transform:`rotate(-90 ${d.left/2} ${d.top+m/2})`,className:"text-xs font-medium fill-gray-600",children:"Valor (COP)"}),r.jsx("text",{x:d.left+u/2,y:c-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-600",children:"Das analizados"}),te.map(U=>r.jsx("text",{x:U.x,y:d.top+m+20,textAnchor:"middle",className:"text-xs fill-gray-500",children:U.label},`label-${U.index}`))]})},Ch=(e,t)=>{const s=e.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}),n=t.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"});return s===n?e.toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}):`${s}  ${n}`},VN=(e,t)=>{const s=Nt(e),n=Nt(t),a=s.getTime(),o=n.getTime(),i=Math.min(a,o),l=Math.max(a,o),c=new Date(i);c.setHours(0,0,0,0);const d=new Date(l);return d.setHours(23,59,59,999),{start:c,end:d}};function bx({orders:e,targetVentasMensual:t,isLoadingOrders:s=!1}){const n=h.useMemo(()=>ze(new Date),[]),a=h.useMemo(()=>{const M=new Date;return M.setDate(M.getDate()-6),ze(M)},[]),[o,i]=h.useState("range"),[l,c]=h.useState(a),[d,u]=h.useState(n),[m,f]=h.useState(n),[p,S]=h.useState([]),[E,T]=h.useState(!0),[y,g]=h.useState("30"),x=s||E;h.useEffect(()=>{let M=!0;return(async()=>{M&&T(!0);try{const fe=await ye.fetchGastos();M&&S(fe)}catch(fe){console.error("[Analitica] Error cargando gastos:",fe)}finally{M&&T(!1)}})(),()=>{M=!1}},[]);const _=h.useMemo(()=>e.reduce((M,re)=>M+re.total,0),[e]),F=h.useMemo(()=>VN(l,d),[l,d]),A=F.start,H=F.end,R=h.useMemo(()=>{if(x||e.length===0)return[];if(o==="single"){const M=m;return e.filter(re=>ze(re.timestamp)===M)}return e.filter(M=>{const re=M.timestamp.getTime();return re>=A.getTime()&&re<=H.getTime()})},[e,o,A,H,m,x]),ge=h.useMemo(()=>{if(x||p.length===0)return[];if(o==="single"){const M=m;return p.filter(re=>ze(re.fecha)===M)}return p.filter(M=>{const fe=(M.fecha instanceof Date?M.fecha:new Date(M.fecha)).getTime();return fe>=A.getTime()&&fe<=H.getTime()})},[p,o,m,A,H,x]),ce=h.useMemo(()=>[...R].sort((M,re)=>re.timestamp.getTime()-M.timestamp.getTime()),[R]),I=h.useMemo(()=>R.reduce((M,re)=>M+re.total,0),[R]),ee=R.length,te=ee>0?I/ee:0,be=R.reduce((M,re)=>re.total>M?re.total:M,0),Se=h.useMemo(()=>{const M=new Map;R.forEach(O=>{const v=O.timestamp.getHours(),w=M.get(v)??{orders:0,total:0};w.orders+=1,w.total+=O.total,M.set(v,w)});const re=Array.from({length:24},(O,v)=>{const w=`${v.toString().padStart(2,"0")}:00`,B=M.get(v);return{hour:v,label:w,orders:(B==null?void 0:B.orders)??0,total:(B==null?void 0:B.total)??0}}),fe=re.filter(O=>O.orders>0).sort((O,v)=>v.orders===O.orders?v.total-O.total:v.orders-O.orders).slice(0,3),ke=re.reduce((O,v)=>v.orders>O?v.orders:O,0),Ie=re.reduce((O,v)=>v.total>O?v.total:O,0);return{dataset:re,busiest:fe,maxOrders:ke,maxTotal:Ie}},[R]),_e=h.useMemo(()=>Se.dataset.filter(M=>M.orders>0||M.total>0),[Se]),Ee=h.useMemo(()=>_e.length>0?ee/_e.length:0,[_e,ee]),se=h.useMemo(()=>{if(_e.length!==0)return _e.reduce((M,re)=>!M||re.total>M.total?re:M,void 0)},[_e]),oe=h.useMemo(()=>{if(R.length===0&&ge.length===0)return[];const M=new Map;R.forEach(ke=>{const Ie=ze(ke.timestamp),O=M.get(Ie)??{sales:0,expenses:0};O.sales+=ke.total,M.set(Ie,O)}),ge.forEach(ke=>{const Ie=ke.fecha instanceof Date?ke.fecha:new Date(ke.fecha),O=ze(Ie),v=M.get(O)??{sales:0,expenses:0};v.expenses+=ke.monto,M.set(O,v)});const re=Array.from(M.entries()).map(([ke,{sales:Ie,expenses:O}])=>{const v=Nt(ke),w=v.toLocaleDateString("es-CO",{day:"2-digit",month:"short"});return{date:v,label:w,sales:Ie,expenses:O,balance:Ie-O}}).sort((ke,Ie)=>ke.date.getTime()-Ie.date.getTime());let fe=0;return re.map(ke=>(fe+=ke.balance,{...ke,historicalBalance:fe}))},[R,ge]),Q=h.useMemo(()=>{if(y==="all")return oe;const M=Number(y);return oe.slice(-M)},[oe,y]),J=h.useMemo(()=>ao(Q),[Q]),D=h.useMemo(()=>IN(oe,Q),[oe,Q]),le=h.useMemo(()=>D?ao(D):null,[D]),U=h.useMemo(()=>{const M=new Map;return R.forEach(re=>{const fe=ze(re.timestamp),ke=M.get(fe)??{total:0,count:0};ke.total+=re.total,ke.count+=1,M.set(fe,ke)}),M},[R]),Y=h.useMemo(()=>{if(Q.length===0)return{total:0,count:0};let M=0,re=0;return Q.forEach(fe=>{const ke=ze(fe.date),Ie=U.get(ke);Ie&&(M+=Ie.total,re+=Ie.count)}),{total:M,count:re}},[U,Q]),ue=h.useMemo(()=>{if(!D)return null;let M=0,re=0;return D.forEach(fe=>{const ke=ze(fe.date),Ie=U.get(ke);Ie&&(M+=Ie.total,re+=Ie.count)}),{total:M,count:re}},[U,D]),ve=Y.count>0?Y.total/Y.count:0,W=ue&&ue.count>0?ue.total/ue.count:null,C=h.useMemo(()=>{if(!le)return null;const M=gi(J.sales,le.sales),re=gi(J.expenses,le.expenses),fe=J.netMarginPct!==null&&le.netMarginPct!==null?J.netMarginPct-le.netMarginPct:null,ke=W!==null?gi(ve,W):null;return{salesChange:M,expensesChange:re,marginChange:fe,ticketChange:ke,prevMargin:le.netMarginPct,prevAvgTicket:W}},[J,le,W,ve]),q=h.useMemo(()=>{const M=Q.map(re=>re.expenses).filter(re=>re>0);return M.length===0?null:FN(M,.9)},[Q]),X=h.useMemo(()=>q===null?[]:Q.map((M,re)=>({point:M,index:re})).filter(({point:M})=>M.expenses>q),[q,Q]),xe=h.useMemo(()=>BN(Q),[Q]),$=h.useMemo(()=>{const M=[];if(J.bestSalesDay){const re=Q.findIndex(fe=>{var ke;return fe.date.getTime()===((ke=J.bestSalesDay)==null?void 0:ke.date.getTime())});re>=0&&M.push({index:re,anchor:"sales",icon:"",label:"Mejor venta",color:Yi})}return X.forEach(({index:re})=>{M.push({index:re,anchor:"expenses",icon:"",label:"Gasto atpico",color:Ea,variant:"outline"})}),xe!==null&&M.push({index:xe,anchor:"historical",icon:"",label:"Balance = 0",color:Ji}),M},[X,J.bestSalesDay,xe,Q]),j=h.useMemo(()=>{const re=[...AN(Q,D??void 0)];if(se&&se.total>0){const fe=`Refuerza surtido en la franja ${se.label}, la ms rentable con ${K(Math.round(se.total))}.`;re.push(fe)}return re.slice(0,5)},[D,se,Q]),k=h.useMemo(()=>{const M=[];if(Q.length>=3&&UN(Q)&&M.push({id:"flow",message:"Dos das de deterioro consecutivo en el balance acumulado."}),J.shareTopDay&&J.shareTopDay>.35&&J.bestSalesDay&&M.push({id:"concentration",message:`Un solo da (${Ko(J.bestSalesDay.date)}) aporta ${Math.round(J.shareTopDay*100)}% de las ventas. Riesgo de concentracin.`}),X.length>0){const re=X.length,fe=X[0];M.push({id:"outlier",message:`${re===1?"Un":`${re}`} da${re>1?"s":""} con gasto atpico, comenz el ${Ko(fe.point.date)}.`})}return M},[X,J.bestSalesDay,J.shareTopDay,Q]),z=h.useMemo(()=>$N(Q),[Q]),P=h.useMemo(()=>{const M=new Date;return new Date(M.getFullYear(),M.getMonth()+1,0).getDate()},[]),Z=typeof t=="number"&&t>0&&z,me=h.useMemo(()=>!Z||!t?null:J.sales/t*100,[J.sales,Z,t]),we=Z&&y==="30"&&t?t/P:null,De=h.useMemo(()=>{if(!z||J.days<5)return null;const M=J.avgSales*P,fe=(J.days>0?J.balance/J.days:0)*P;return{projectedSales:M,projectedBalance:fe}},[P,z,J.avgSales,J.balance,J.days]),Be=h.useMemo(()=>{if(J.days===0)return[];const M=[{id:"avg-sales",label:"Promedio ventas diarias",value:K(Math.round(J.avgSales)),hint:`${J.days} da${J.days>1?"s":""} analizado${J.days>1?"s":""}`},{id:"avg-expenses",label:"Promedio gastos diarios",value:K(Math.round(J.avgExpenses)),hint:"Gasto promedio en el rango visible"},{id:"net-margin",label:"Margen neto del periodo",value:J.netMarginPct===null?"":`${J.netMarginPct>=0?"+":""}${J.netMarginPct.toFixed(1).replace(".",",")}%`,hint:J.netMarginPct===null?"Se requiere al menos una venta.":"Balance acumulado sobre ventas."},{id:"best-day",label:"Da con mayor venta",value:J.bestSalesDay?K(Math.round(J.bestSalesDay.value)):"",hint:J.bestSalesDay?`Fecha ${Ko(J.bestSalesDay.date)}`:"Sin datos disponibles."},{id:"max-expense",label:"Da con mayor gasto",value:J.highestExpenseDay?K(Math.round(J.highestExpenseDay.value)):"",hint:J.highestExpenseDay?`Fecha ${Ko(J.highestExpenseDay.date)}`:"Sin datos disponibles."}];return J.stdSales!==void 0&&J.days>=3&&M.push({id:"volatility",label:"Volatilidad de ventas",value:K(Math.round(J.stdSales)),hint:"Desviacin estndar del ingreso diario."}),J.cvSales!==void 0&&J.days>=3&&M.push({id:"cv-sales",label:"Coeficiente de variacin",value:`${(J.cvSales*100).toFixed(1).replace(".",",")}%`,hint:"Relacin entre volatilidad y promedio."}),M},[J]),He=h.useMemo(()=>{if(Q.length===0)return"";const M=Q[0].date,re=Q[Q.length-1].date;return Ch(M,re)},[Q]),Ve=h.useMemo(()=>{const M={};return R.forEach(re=>{const fe=re.paymentAllocations&&re.paymentAllocations.length>0?re.paymentAllocations:re.metodoPago?[{metodo:re.metodoPago,monto:Math.round(re.total)}]:[];if(fe.length===0){M.sin_registro=(M.sin_registro??0)+re.total;return}fe.forEach(({metodo:ke,monto:Ie})=>{M[ke]=(M[ke]??0)+Ie})}),Object.entries(M).map(([re,fe])=>({method:re,label:_h[re]??re,amount:fe,percentage:I>0?fe/I*100:0})).sort((re,fe)=>fe.amount-re.amount)},[R,I]),et=h.useMemo(()=>{const M=new Map;return R.forEach(re=>{const fe=ze(re.timestamp),ke=M.get(fe)??{total:0,orders:0};ke.total+=re.total,ke.orders+=1,M.set(fe,ke)}),Array.from(M.entries()).map(([re,{total:fe,orders:ke}])=>{const Ie=Nt(re).toLocaleDateString("es-CO",{weekday:"short",day:"2-digit",month:"short",year:"numeric"});return{dateKey:re,displayDate:Ie,total:fe,orders:ke}}).sort((re,fe)=>re.dateKey<fe.dateKey?1:-1)},[R]),it=h.useMemo(()=>{const M=new Map;return R.forEach(re=>{re.items.forEach(({item:fe,cantidad:ke,precioUnitario:Ie})=>{const O=fe.id||fe.nombre,v=typeof Ie=="number"?Ie:fe.precio,w=ke*v,B=M.get(O)??{name:fe.nombre,quantity:0,amount:0};B.name=fe.nombre,B.quantity+=ke,B.amount+=w,M.set(O,B)})}),Array.from(M.values()).sort((re,fe)=>fe.amount-re.amount).slice(0,5)},[R]),xt=h.useMemo(()=>o==="single"?Nt(m).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}):Ch(A,H),[o,m,A,H]),jt=M=>{const re=new Date,fe=new Date;fe.setDate(fe.getDate()-(M-1)),i("range"),c(ze(fe)),u(ze(re))},$t=()=>{const M=new Date,re=new Date(M.getFullYear(),M.getMonth(),1);i("range"),c(ze(re)),u(ze(M))},Lt=()=>{const M=ze(new Date);i("single"),f(M)},_t=[{label:"Ventas en el periodo",value:K(I),description:"Total facturado en el intervalo seleccionado",icon:xg},{label:"Pedidos registrados",value:ee.toString(),description:"Cantidad de pedidos capturados",icon:fg},{label:"Ticket promedio",value:ee>0?K(Math.round(te)):"Sin datos",description:"Promedio por pedido",icon:mv},{label:"Venta ms alta",value:ee>0?K(be):"Sin datos",description:"Pedido de mayor valor en el periodo",icon:Mv}];return x?r.jsx("section",{className:"space-y-6 sm:space-y-8",children:r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600 text-sm",children:[r.jsx(nt,{size:18,className:"animate-spin text-gray-500"}),r.jsx("span",{children:"Cargando analtica..."})]})}):r.jsxs("section",{className:"space-y-6 sm:space-y-8",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:b.dark},children:"Analtica de Ventas"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Analiza el desempeo histrico y descubre tendencias por rangos personalizados o fechas especficas."})]}),r.jsxs("div",{className:"ui-card p-3 text-right",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Total histrico registrado"}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:b.dark},children:K(_)})]})]}),r.jsxs("section",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{className:"inline-flex bg-gray-100 rounded-lg p-1",children:[r.jsxs("button",{type:"button",onClick:()=>i("range"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors ${o==="range"?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Cu,{size:18}),"Rango de fechas"]}),r.jsxs("button",{type:"button",onClick:()=>i("single"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors ${o==="single"?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(hv,{size:18}),"Fecha exacta"]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:[r.jsx("span",{className:"font-semibold text-gray-700",children:"Periodo analizado:"})," ",xt]})]}),o==="range"?r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsxs("label",{className:"flex flex-col text-sm text-gray-700",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Fecha inicial"}),r.jsx("input",{type:"date",value:l,onChange:M=>c(M.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("label",{className:"flex flex-col text-sm text-gray-700",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Fecha final"}),r.jsx("input",{type:"date",value:d,onChange:M=>u(M.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("div",{className:"sm:col-span-2 flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Atajos rpidos:"}),r.jsx("button",{type:"button",onClick:()=>jt(7),className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"ltimos 7 das"}),r.jsx("button",{type:"button",onClick:()=>jt(30),className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"ltimos 30 das"}),r.jsx("button",{type:"button",onClick:$t,className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"Este mes"})]})]})}):r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-4",children:[r.jsxs("label",{className:"flex flex-col text-sm text-gray-700 w-full sm:w-auto",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Selecciona la fecha"}),r.jsx("input",{type:"date",value:m,onChange:M=>f(M.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsx("button",{type:"button",onClick:Lt,className:"px-4 py-2 text-sm font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300 self-start",children:"Ir a hoy"})]})]}),r.jsx("section",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:_t.map(({label:M,value:re,description:fe,icon:ke})=>r.jsxs("div",{className:"ui-card p-4 lg:p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:M}),r.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center",style:{backgroundColor:`${b.accent}15`},children:r.jsx(ke,{size:18,style:{color:b.dark}})})]}),r.jsx("div",{className:"text-xl font-semibold",style:{color:b.dark},children:re}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:fe})]},M))}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[r.jsxs("section",{className:"xl:col-span-2 ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:b.dark},children:"Desempeo diario"}),et.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-600",children:"Fecha"}),r.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-600",children:"Pedidos"}),r.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-600",children:"Ventas"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:et.map(M=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:M.displayDate}),r.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:M.orders}),r.jsx("td",{className:"px-4 py-3 text-right font-semibold",style:{color:b.dark},children:K(M.total)})]},M.dateKey))})]})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos en el periodo seleccionado."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",style:{color:b.dark},children:[r.jsx(ug,{size:18})," Distribucin por mtodo de pago"]}),Ve.length>0?r.jsx("div",{className:"space-y-4",children:Ve.map(M=>r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between text-sm font-medium text-gray-700",children:[r.jsx("span",{children:M.label}),r.jsx("span",{children:K(M.amount)})]}),r.jsx("div",{className:"mt-2 h-2 bg-gray-100 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-2 rounded-full",style:{width:`${M.percentage}%`,backgroundColor:b.accent}})}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[M.percentage.toFixed(1),"% del periodo"]})]},M.method))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay informacin de mtodos de pago para este periodo."})]})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Evolucin financiera por da"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Visualiza cmo se comportan las ventas, los gastos y el balance en el perodo seleccionado."})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Zoom:"}),zN.map(M=>r.jsx("button",{type:"button",onClick:()=>g(M.id),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-colors ${y===M.id?"bg-gray-900 text-white border-gray-900":"border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:M.label},M.id))]})]}),Q.length>0?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx(WN,{data:Q,totalSales:J.sales,annotations:$,targetLineValue:we??void 0,targetLineLabel:we?"Meta diaria":void 0}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Yi}})," Ventas"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Ea}})," Gastos"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2 border-dashed",style:{borderColor:Ji}})," Balance diario"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2",style:{borderColor:Md}})," Balance histrico"]}),we&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2 border-dashed",style:{borderColor:"#4b5563"}})," Meta diaria"]}),He&&r.jsx("div",{className:"ml-auto text-xs text-gray-500",children:He})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Ventas acumuladas"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:K(Math.round(J.sales))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Gastos acumulados"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:K(Math.round(J.expenses))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Balance"}),r.jsx("p",{className:`text-lg font-semibold ${J.balance>=0?"text-green-600":"text-red-600"}`,children:K(Math.round(J.balance))})]})]}),Be.length>0&&r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:Be.map(M=>r.jsxs("div",{className:"ui-card p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:M.label}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:b.dark},children:M.value}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:M.hint})]},M.id))}),Z&&me!==null&&r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Meta mensual"}),r.jsxs("p",{className:"text-sm text-gray-700",children:["Objetivo: ",K(Math.round(t??0))]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Cumplimiento"}),r.jsxs("p",{className:`text-lg font-semibold ${me>=100?"text-green-600":"text-gray-800"}`,children:[me.toFixed(1).replace(".",","),"%"]})]})]}),C&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Comparativo periodo anterior"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{id:"sales",label:"Ventas",value:K(Math.round(J.sales)),change:C.salesChange},{id:"expenses",label:"Gastos",value:K(Math.round(J.expenses)),change:C.expensesChange},{id:"margin",label:"Margen neto",value:J.netMarginPct===null?"":`${J.netMarginPct>=0?"+":""}${J.netMarginPct.toFixed(1).replace(".",",")}%`,margin:!0,change:C.marginChange},{id:"ticket",label:"Ticket promedio",value:ve>0?K(Math.round(ve)):"",change:C.ticketChange}].map(M=>{const re=!!M.margin,fe=M.change,ke=fe===null||Number.isNaN(fe)?"":re?`${fe>=0?"+":""}${fe.toFixed(1).replace(".",",")} pp`:`${fe>=0?"+":""}${fe.toFixed(1).replace(".",",")}%`,Ie=fe===null||Number.isNaN(fe)?"text-gray-500":fe>=0?"text-green-600":"text-red-600",O=fe===null||Number.isNaN(fe)?"":fe>=0?"":"";return r.jsxs("div",{className:"ui-card p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:M.label}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:b.dark},children:M.value}),r.jsxs("p",{className:`text-xs font-medium mt-1 ${Ie}`,children:[O!==""&&r.jsx("span",{className:"mr-1",children:O}),ke]})]},M.id)})})]}),k.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Alertas"}),k.map(M=>r.jsxs("div",{className:"flex items-start gap-2 bg-yellow-50 border border-yellow-100 rounded-md px-3 py-2 text-xs text-yellow-800",children:[r.jsx("span",{className:"text-base leading-none pt-0.5",children:""}),r.jsx("span",{children:M.message})]},M.id))]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Insights del periodo"}),j.length>0?r.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:j.map((M,re)=>{const fe=M.toLowerCase(),ke=fe.includes("riesgo")||fe.includes("gasto")||fe.includes("cada")||fe.includes("retrocedi");return r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:`${ke?"text-yellow-600":"text-green-600"} leading-none pt-0.5`,children:ke?"":""}),r.jsx("span",{children:M})]},`${M}-${re}`)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"Sin insights destacados para este rango."})]}),De&&r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Proyeccin cierre"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-2 text-sm text-gray-700",children:[r.jsxs("span",{children:["Ventas proyectadas:"," ",r.jsx("strong",{className:"text-gray-800",children:K(Math.round(De.projectedSales))})]}),r.jsxs("span",{children:["Balance proyectado:"," ",r.jsx("strong",{className:`text-gray-800 ${De.projectedBalance>=0?"text-green-600":"text-red-600"}`,children:K(Math.round(De.projectedBalance))})]})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Estimacin lineal, no considera estacionalidad."})]})]}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos suficientes para visualizar ventas y gastos."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Comportamiento por hora"}),r.jsxs("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Total pedidos en el periodo:"," ",r.jsx("span",{className:"font-semibold text-gray-700",children:ee})]})]}),Se.dataset.some(M=>M.orders>0)?r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx(HN,{data:Se.dataset,maxOrders:Se.maxOrders}),r.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Eje Y: cantidad de pedidos  Eje X: hora del da."})]}),r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Resumen"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Horas con actividad"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:_e.length})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Promedio por hora"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:Ee.toFixed(1)})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3 sm:col-span-2",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Hora ms rentable"}),r.jsx("p",{className:"text-sm font-semibold text-gray-800",children:se?`${se.label}  ${K(se.total)}`:""})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Horas con mayor actividad"}),Se.busiest.length>0?r.jsx("ul",{className:"space-y-2 text-sm",children:Se.busiest.map(M=>r.jsxs("li",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"font-medium text-gray-700",children:M.label}),r.jsxs("div",{className:"text-right text-xs text-gray-500",children:[r.jsxs("div",{className:"font-semibold text-gray-700",children:[M.orders," pedidos"]}),r.jsxs("div",{children:["Ventas ",K(M.total)]})]})]},M.hour))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay suficientes datos para identificar las horas pico."})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Detalle por hora"}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-xs",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-600",children:"Hora"}),r.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-600",children:"Pedidos"}),r.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-600",children:"Ventas"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:_e.map(M=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 py-2 font-medium text-gray-700",children:M.label}),r.jsx("td",{className:"px-3 py-2 text-right text-gray-600",children:M.orders}),r.jsx("td",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:M.total>0?K(M.total):"-"})]},M.hour))})]})})]})]}):r.jsx("p",{className:"text-sm text-gray-500",children:"No se registran pedidos en el periodo seleccionado."})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:b.dark},children:"Productos ms vendidos"}),it.length>0?r.jsx("ul",{className:"space-y-3 text-sm",children:it.map(M=>r.jsxs("li",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-700",children:M.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[M.quantity," unidades"]})]}),r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:K(M.amount)})]},M.name))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay ventas registradas para calcular este ranking."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:b.dark},children:"Pedidos del periodo"}),ce.length>0?r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:ce.map(M=>r.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 text-sm hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"font-semibold text-gray-700",children:["Pedido #",M.numero]}),r.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 capitalize",children:M.estado})]}),r.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[r.jsx("span",{children:M.timestamp.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),r.jsx("span",{children:M.metodoPago?_h[M.metodoPago]??M.metodoPago:"Sin mtodo"})]}),r.jsx("div",{className:"text-right font-semibold mt-2",style:{color:b.dark},children:K(M.total)})]},M.id))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay pedidos en el periodo seleccionado."})]})]})]})}const Eh={efectivo:"Efectivo",nequi:"Nequi",tarjeta:"Tarjeta",provision_caja:"Provisin caja",credito_empleados:"Crdito empleados"},qN=["efectivo","provision_caja","nequi","tarjeta","credito_empleados"],Ps=e=>e>=0?"text-green-600":"text-red-600",Qo=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t},ar=e=>e?e==="caja_principal"?"Caja principal":e==="provision_caja"?"Provisin de caja":e.replace(/_/g," "):"",Yo=e=>new Date(e).toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}),Jo=["caja","provision","digital"],GN={caja:"Movimientos de caja",provision:"Provisin de caja",digital:"Cuenta digital"},KN={caja:"Ingresos y egresos registrados en efectivo durante el da.",provision:"Depsitos y retiros asociados a la provisin de caja.",digital:"Pagos y gastos registrados en canales digitales (Nequi y tarjeta)."},Xo=e=>e==="efectivo"?"caja":e==="provision_caja"?"provision":"digital",QN=()=>({efectivo:{ingresos:0,egresos:0},nequi:{ingresos:0,egresos:0},tarjeta:{ingresos:0,egresos:0},provision_caja:{ingresos:0,egresos:0},credito_empleados:{ingresos:0,egresos:0}}),Th=(e,t,s)=>{const n=QN();return e.forEach(a=>{if(!bs(a))return;Ks(a).forEach(({metodo:i,monto:l})=>{n[i].ingresos+=l})}),t.forEach(a=>{const o=a.metodoPago??"efectivo";n[o].egresos+=a.monto}),s.forEach(a=>{if(a.bolsilloDestino==="provision_caja"){n.provision_caja.ingresos+=a.monto,n[a.origen].egresos+=a.monto;return}if(a.bolsilloOrigen==="provision_caja"){n.provision_caja.egresos+=a.monto,a.destinoMetodo&&(n[a.destinoMetodo].ingresos+=a.monto);return}n[a.origen].egresos+=a.monto,a.destinoMetodo&&(n[a.destinoMetodo].ingresos+=a.monto)}),n},YN=e=>{if(!e)return null;const[t,s,n]=e.split("-").map(Number);return!t||!s||!n?null:new Date(t,s-1,n)},Mh=e=>{const t=e.getFullYear(),s=`${e.getMonth()+1}`.padStart(2,"0");return`${t}-${s}`},JN=e=>{const[t,s]=e.split("-").map(Number),n=new Date,a=Number.isFinite(t)&&t>1900?t:n.getFullYear(),o=Number.isFinite(s)&&s>=1&&s<=12?s-1:n.getMonth(),i=new Date(a,o,1);i.setHours(0,0,0,0);const l=new Date(a,o+1,0);return l.setHours(23,59,59,999),{start:i,end:l}},XN=e=>e.toLocaleDateString("es-CO",{month:"long",year:"numeric"});function ZN(){const[e,t]=h.useState([]),[s,n]=h.useState([]),[a,o]=h.useState([]),i=h.useMemo(()=>{const j=new Date;return j.setHours(0,0,0,0),j},[]),[l,c]=h.useState(()=>Mh(i)),[d,u]=h.useState(!0),[m,f]=h.useState("");h.useEffect(()=>{let j=!0;return(async()=>{u(!0);try{const[z,P,Z]=await Promise.all([ye.fetchOrders(),ye.fetchGastos(),ye.fetchProvisionTransfers()]);if(!j)return;t(z),n(P),o(Z)}finally{j&&u(!1)}})(),()=>{j=!1}},[]);const p=h.useMemo(()=>JN(l),[l]),S=h.useMemo(()=>{const{start:j,end:k}=p;return e.filter(z=>{if(!bs(z))return!1;const P=As(z);return P.getTime()>=j.getTime()&&P.getTime()<=k.getTime()}).sort((z,P)=>As(P).getTime()-As(z).getTime())},[e,p]),E=h.useMemo(()=>{const{start:j,end:k}=p;return s.filter(z=>{const P=z.fecha instanceof Date?z.fecha:new Date(z.fecha);return P.getTime()>=j.getTime()&&P.getTime()<=k.getTime()}).sort((z,P)=>{const Z=z.fecha instanceof Date?z.fecha:new Date(z.fecha);return(P.fecha instanceof Date?P.fecha:new Date(P.fecha)).getTime()-Z.getTime()})},[s,p]),T=h.useMemo(()=>{const{start:j,end:k}=p;return a.filter(z=>{const P=z.fecha instanceof Date?z.fecha:new Date(z.fecha);return P.getTime()>=j.getTime()&&P.getTime()<=k.getTime()}).sort((z,P)=>{const Z=z.fecha instanceof Date?z.fecha:new Date(z.fecha);return(P.fecha instanceof Date?P.fecha:new Date(P.fecha)).getTime()-Z.getTime()})},[a,p]),y=h.useMemo(()=>YN(m),[m]),g=h.useMemo(()=>{const j=S.reduce((z,P)=>z+P.total,0),k=E.reduce((z,P)=>z+P.monto,0);return{ventas:j,gastos:k,balance:j-k}},[E,S]),x=h.useMemo(()=>{const k=e.filter(bs).reduce((P,Z)=>P+Z.total,0),z=s.reduce((P,Z)=>P+Z.monto,0);return{ventas:k,gastos:z,balance:k-z}},[e,s]),_=e.length>0||s.length>0,F=S.length>0||E.length>0,A=h.useMemo(()=>{const j=S[0]?As(S[0]):null,k=E[0]?E[0].fecha instanceof Date?E[0].fecha:new Date(E[0].fecha):null;return j&&k?j.getTime()>=k.getTime()?j:k:j||k||null},[E,S]),H=h.useMemo(()=>new Intl.DateTimeFormat("es-CO",{dateStyle:"medium"}),[]),R=h.useMemo(()=>XN(p.start),[p.start]),ge=F?`Movimientos en ${R}: ${S.length+E.length}`:`No hay movimientos registrados en ${R}.`,ce=A?`ltimo movimiento: ${Yo(A)}`:_?`No hay movimientos en ${R}.`:"Sin registros disponibles.",I=h.useMemo(()=>Th(S,E,T),[E,S,T]),ee=h.useMemo(()=>Th(e,s,a),[s,e,a]),te=h.useMemo(()=>T.filter(j=>j.bolsilloDestino==="provision_caja").reduce((j,k)=>j+k.monto,0),[T]),be=h.useMemo(()=>a.filter(j=>j.bolsilloDestino==="provision_caja").reduce((j,k)=>j+k.monto,0),[a]),Se=h.useMemo(()=>T.filter(j=>j.bolsilloOrigen==="provision_caja").reduce((j,k)=>j+k.monto,0),[T]),_e=h.useMemo(()=>a.filter(j=>j.bolsilloOrigen==="provision_caja").reduce((j,k)=>j+k.monto,0),[a]),Ee=te-Se,se=be-_e,oe=Ps(Ee),Q=Ps(se),J=h.useMemo(()=>qN.map(j=>({id:j,label:Eh[j],ventas:I[j].ingresos,gastos:I[j].egresos,balance:I[j].ingresos-I[j].egresos,balanceHistorico:ee[j].ingresos-ee[j].egresos})),[I,ee]),D=h.useMemo(()=>{const{start:j,end:k}=p,z=new Date(j.getFullYear(),j.getMonth(),1);z.setHours(0,0,0,0);const P=new Date(k.getFullYear(),k.getMonth(),k.getDate());P.setHours(0,0,0,0);const Z=P.getDate(),me=new Map;S.forEach(He=>{const Ve=As(He),et=ze(Ve);me.set(et,(me.get(et)??0)+He.total)});const we=new Map;E.forEach(He=>{const Ve=He.fecha instanceof Date?He.fecha:new Date(He.fecha),et=ze(Ve);we.set(et,(we.get(et)??0)+He.monto)});const De=[];let Be=0;for(let He=1;He<=Z;He+=1){const Ve=new Date(z.getFullYear(),z.getMonth(),He);Ve.setHours(0,0,0,0);const et=ze(Ve),it=me.get(et)??0,xt=we.get(et)??0,jt=it-xt;Be+=jt,De.push({date:Ve,label:Ve.toLocaleDateString("es-CO",{day:"2-digit",month:"short"}),sales:it,expenses:xt,balance:jt,cumulative:Be})}return De},[p,E,S]),le=h.useMemo(()=>{const j=new Map;return D.forEach(k=>{const z=Qo(k.date);j.set(ze(z),z)}),T.forEach(k=>{const z=Qo(k.fecha instanceof Date?k.fecha:new Date(k.fecha)),P=ze(z);j.has(P)||j.set(P,z)}),Array.from(j.entries()).sort((k,z)=>z[1].getTime()-k[1].getTime()).map(([k,z])=>({key:k,label:z.toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}))},[D,T]);h.useEffect(()=>{f("")},[l]);const U=h.useMemo(()=>D.map(j=>({date:j.date,label:j.label,sales:j.sales,expenses:j.expenses,balance:j.balance,historicalBalance:j.cumulative})),[D]),Y=h.useMemo(()=>{const j={caja:[],provision:[],digital:[]};if(!y)return j;const k=Qo(y).getTime(),z=P=>Qo(P).getTime()===k;return S.forEach(P=>{const Z=As(P);if(!z(Z))return;Ks(P).forEach((we,De)=>{const Be=Xo(we.metodo);j[Be].push({id:`order-${P.id}-${we.metodo}-${De}`,description:P.numero?`Comanda #${P.numero}`:`Venta ${P.id}`,detail:ns[we.metodo]??we.metodo,amount:we.monto,direction:"ingreso",timestamp:Z})})}),E.forEach(P=>{const Z=P.fecha instanceof Date?P.fecha:new Date(P.fecha);if(!z(Z))return;const me=Xo(P.metodoPago??"efectivo");j[me].push({id:`gasto-${P.id}`,description:P.descripcion||"Gasto",detail:P.categoria||void 0,amount:P.monto,direction:"egreso",timestamp:Z})}),T.forEach(P=>{const Z=P.fecha instanceof Date?P.fecha:new Date(P.fecha);if(!z(Z))return;const me=P.descripcion??"Movimiento de provisin";if(P.bolsilloDestino==="provision_caja"){const we=Xo(P.origen);j[we].push({id:`transfer-origin-${P.id}`,description:me,detail:`Depsito desde ${ar(P.bolsilloOrigen)}`,amount:P.monto,direction:"egreso",timestamp:Z}),j.provision.push({id:`transfer-provision-in-${P.id}`,description:me,detail:`Depsito hacia ${ar(P.bolsilloDestino)}`,amount:P.monto,direction:"ingreso",timestamp:Z});return}if(P.bolsilloOrigen==="provision_caja"&&(j.provision.push({id:`transfer-provision-out-${P.id}`,description:me,detail:`Retiro desde ${ar(P.bolsilloOrigen)}`,amount:P.monto,direction:"egreso",timestamp:Z}),P.destinoMetodo)){const we=Xo(P.destinoMetodo);j[we].push({id:`transfer-destination-${P.id}`,description:me,detail:`Retiro hacia ${ar(P.bolsilloDestino)}`,amount:P.monto,direction:"ingreso",timestamp:Z})}}),Jo.forEach(P=>{j[P].sort((Z,me)=>me.timestamp.getTime()-Z.timestamp.getTime())}),j},[E,S,T,y]),ue=h.useMemo(()=>Jo.reduce((j,k)=>{const z=Y[k],P=z.filter(me=>me.direction==="ingreso").reduce((me,we)=>me+we.amount,0),Z=z.filter(me=>me.direction==="egreso").reduce((me,we)=>me+we.amount,0);return j[k]={ingresos:P,egresos:Z,balance:P-Z},j},{caja:{ingresos:0,egresos:0,balance:0},provision:{ingresos:0,egresos:0,balance:0},digital:{ingresos:0,egresos:0,balance:0}}),[Y]),ve=h.useMemo(()=>Jo.some(j=>Y[j].length>0),[Y]),W=h.useMemo(()=>y?y.toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",[y]),C=h.useMemo(()=>U.filter(j=>j.date.getTime()<=i.getTime()),[U,i]),q=h.useMemo(()=>ao(C),[C]),X=h.useMemo(()=>{const j=q.avgSales??0,k=j>0?j:0,z=C.length>0?C[C.length-1].historicalBalance:0;let P=0;return D.map(Z=>{const me=Z.date.getTime()>i.getTime();let we,De=Z.cumulative;return me&&k>0&&(we=Math.round(k)),me?(P+=(we??0)-Z.expenses,De=z+P):P=0,{...Z,estimatedSales:we,projectedBalance:De,isFuture:me}})},[D,q.avgSales,C,i]),xe=h.useMemo(()=>{const j=X.filter(k=>k.isFuture).reduce((k,z)=>k+(z.estimatedSales??0),0);return g.ventas+j},[X,g.ventas]),$=h.useMemo(()=>{if(X.length===0)return g.balance;const j=X[X.length-1];return j.isFuture?j.projectedBalance:j.cumulative},[X,g.balance]);return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"ui-card ui-card-pad flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",style:{color:b.dark},children:"Balance de Caja"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Ventas, gastos y saldo final por mtodo de pago"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ja,{className:"text-gray-500",size:18}),r.jsx("span",{className:"text-sm text-gray-600",children:"Selecciona el mes"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[r.jsx("input",{type:"month",value:l,onChange:j=>c(j.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent}}),r.jsx("button",{type:"button",onClick:()=>c(Mh(i)),className:"px-3 py-2 text-sm font-medium text-white rounded-lg",style:{backgroundColor:b.accent},children:"Mes actual"})]})]})]}),d&&r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500 text-sm",children:"Cargando balance..."}),!d&&!_&&r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500 text-sm",children:"An no hay movimientos registrados en la caja."}),!d&&_&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4",children:[r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Ventas"}),r.jsx(xg,{className:"text-green-600",size:20})]}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold",style:{color:b.dark},children:K(g.ventas)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Gastos"}),r.jsx(gg,{className:"text-red-600",size:20})]}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold text-red-600",children:K(g.gastos)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Balance"}),r.jsx(Tu,{className:Ps(g.balance),size:20})]}),r.jsx("p",{className:`text-sm sm:text-lg lg:text-2xl font-bold ${Ps(g.balance)}`,children:K(g.balance)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5 col-span-2 lg:col-span-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Proyeccin y resumen"}),r.jsx(Hi,{className:"text-indigo-600",size:20})]}),r.jsx("p",{className:"text-xs text-gray-500 mb-1 hidden sm:block",children:ge}),r.jsx("p",{className:"text-xs text-gray-500 mb-2 hidden sm:block",children:ce}),r.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[r.jsxs("p",{children:["Ventas proyectadas:"," ",r.jsx("span",{className:"font-semibold text-green-600",children:K(xe)})]}),r.jsxs("p",{children:["Balance proyectado:"," ",r.jsx("span",{className:`font-semibold ${Ps($)}`,children:K($)})]}),r.jsxs("p",{children:["Balance histrico:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:K(x.balance)})]})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Movimientos por da"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Selecciona un da del mes para revisar los movimientos detallados por tipo de mtodo."})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{htmlFor:"balance-day-select",className:"text-xs font-medium text-gray-600",children:"Da"}),r.jsxs("select",{id:"balance-day-select",value:m,onChange:j=>f(j.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Selecciona un da"}),le.map(j=>r.jsx("option",{value:j.key,children:j.label},j.key))]})]})]}),le.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"An no hay movimientos registrados en este mes."}):y?ve?r.jsxs(r.Fragment,{children:[r.jsxs("p",{className:"text-xs text-gray-500",children:["Mostrando movimientos del ",W,"."]}),r.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:Jo.map(j=>{const k=Y[j],z=ue[j];return r.jsxs("div",{className:"border border-gray-200 rounded-2xl overflow-hidden bg-white shadow-sm",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 bg-gray-50",children:[r.jsx("p",{className:"text-sm font-semibold",style:{color:b.dark},children:GN[j]}),r.jsx("p",{className:"text-[11px] text-gray-500",children:KN[j]})]}),r.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:r.jsxs("div",{className:"flex flex-col gap-2 text-xs text-gray-600",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Ingresos"}),r.jsx("span",{className:"font-semibold text-green-600",children:K(z.ingresos)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Egresos"}),r.jsx("span",{className:"font-semibold text-red-600",children:K(z.egresos)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{children:"Balance"}),r.jsx("span",{className:`font-semibold ${Ps(z.balance)}`,children:K(z.balance)})]})]})}),r.jsxs("div",{className:"divide-y divide-gray-100",children:[k.map(P=>r.jsxs("div",{className:"px-4 py-3 flex items-start justify-between gap-3 hover:bg-gray-50",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-xs font-semibold",style:{color:b.dark},children:P.description}),P.detail&&r.jsx("p",{className:"text-[11px] text-gray-500",children:P.detail}),r.jsx("p",{className:"text-[10px] text-gray-400",children:Yo(P.timestamp)})]}),r.jsxs("span",{className:`text-xs font-semibold ${P.direction==="ingreso"?"text-green-600":"text-red-600"}`,children:[P.direction==="ingreso"?"+":"-",K(P.amount)]})]},P.id)),k.length===0&&r.jsx("div",{className:"px-4 py-5 text-center text-xs text-gray-500",children:"Sin movimientos para este da."})]})]},j)})})]}):r.jsxs("p",{className:"text-sm text-gray-500",children:["No se registraron movimientos en ",W,"."]}):r.jsx("p",{className:"text-sm text-gray-500",children:"Selecciona un da para ver los movimientos detallados."})]}),J.length>0&&r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:J.map(j=>r.jsxs("div",{className:"ui-card p-4 lg:p-5",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:j.label}),r.jsx("p",{className:"text-xs text-gray-500",children:"Ventas en el perodo"}),r.jsx("p",{className:"text-base lg:text-xl font-semibold",style:{color:b.dark},children:K(j.ventas)}),r.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Gastos en el perodo"}),r.jsx("p",{className:"text-sm lg:text-lg font-semibold text-red-600",children:K(j.gastos)}),r.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Balance del perodo"}),r.jsx("p",{className:`text-sm lg:text-lg font-semibold ${Ps(j.balance)}`,children:K(j.balance)}),r.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Balance histrico: ",K(j.balanceHistorico)]})]},j.id))}),r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[r.jsxs("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:["Detalle diario de ",R]}),r.jsx("p",{className:"text-xs text-gray-500",children:"Las filas posteriores a hoy incluyen una estimacin de ventas basada en el promedio del mes."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ventas"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estimado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gastos"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance del da"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance acumulado"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:X.map(j=>{const k=ze(j.date),z=j.estimatedSales,P=j.isFuture?j.projectedBalance:j.cumulative,Z=j.isFuture?(z??0)-j.expenses:j.balance,me=m===k,we=[j.isFuture?"bg-gray-50/70":"","cursor-pointer",me?"ring-1 ring-indigo-300 bg-indigo-50/80":""].filter(Boolean).join(" ");return r.jsxs("tr",{className:we||void 0,onClick:()=>f(k),children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 whitespace-nowrap text-xs text-gray-900",children:j.label}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-700",children:K(j.sales)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:z!==void 0?K(z):""}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-700",children:K(j.expenses)}),r.jsx("td",{className:`px-3 lg:px-6 py-3 text-xs font-semibold ${Ps(Z)}`,children:K(Z)}),r.jsx("td",{className:`px-3 lg:px-6 py-3 text-xs font-semibold ${Ps(P)}`,children:K(P)})]},k)})})]})})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Hi,{size:18,style:{color:b.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Movimientos de provisin de caja"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Depsitos desde caja y gastos realizados usando la provisin en el perodo filtrado."})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs uppercase text-gray-500 font-medium",children:"Saldo histrico"}),r.jsx("p",{className:`text-sm font-semibold ${Q}`,children:K(se)})]})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Depsitos en el perodo"}),r.jsx("p",{className:"text-sm font-semibold",style:{color:b.dark},children:K(te)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Retiros en el perodo"}),r.jsx("p",{className:"text-sm font-semibold text-red-600",children:K(Se)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Saldo del perodo"}),r.jsx("p",{className:`text-sm font-semibold ${oe}`,children:K(Ee)})]})]}),r.jsx("div",{className:"ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripcin"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Desde"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Hacia"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[T.length===0&&r.jsx("tr",{children:r.jsxs("td",{colSpan:5,className:"px-3 lg:px-6 py-6 text-center text-xs lg:text-sm text-gray-500",children:["No hay movimientos de provisin en ",R,"."]})}),T.map(j=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 whitespace-nowrap text-xs text-gray-900",children:H.format(j.fecha)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:j.descripcion??""}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden sm:table-cell",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:b.dark},children:ar(j.bolsilloOrigen)}),r.jsx("span",{className:"text-[10px] text-gray-500",children:ns[j.origen]??j.origen})]})}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden sm:table-cell",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:b.dark},children:ar(j.bolsilloDestino)}),r.jsx("span",{className:"text-[10px] text-gray-500",children:j.destinoMetodo?ns[j.destinoMetodo]??j.destinoMetodo:""})]})}),r.jsxs("td",{className:"px-3 lg:px-6 py-3 whitespace-nowrap text-xs font-semibold",style:{color:j.bolsilloDestino==="provision_caja"?"#15803d":"#dc2626"},children:[j.bolsilloDestino==="provision_caja"?"+":"-",K(j.monto)]})]},j.id))]})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Ventas por comanda"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Detalle de cada comanda registrada en el perodo seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comanda"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Cliente"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Mtodo de pago"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[S.length===0&&r.jsx("tr",{children:r.jsxs("td",{colSpan:5,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:["No hay ventas registradas en ",R,"."]})}),S.map(j=>{const k=Ks(j),z=ho(k,K),P=bs(j);return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-900",children:Yo(As(j))}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-medium",style:{color:b.dark},children:j.numero?`#${j.numero}`:j.id}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden sm:table-cell",children:j.cliente??""}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden lg:table-cell",children:r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:z}),r.jsx("span",{className:`w-max px-2 py-0.5 rounded-full text-[11px] font-medium ${P?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:P?"Pago registrado":"Pago pendiente"})]})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-semibold text-green-600",children:K(j.total)})]},j.id)})]})]})})]}),r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Gastos del perodo"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Desglose de cada gasto registrado en el perodo seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripcin"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Categora"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Mtodo de pago"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[E.length===0&&r.jsx("tr",{children:r.jsxs("td",{colSpan:5,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:["No hay gastos registrados en ",R,"."]})}),E.map(j=>{const k=j.fecha instanceof Date?j.fecha:new Date(j.fecha);return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-900",children:Yo(k)}),r.jsx("td",{className:"px-3 lg:px-6 py-4 text-xs text-gray-600",children:j.descripcion||""}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden sm:table-cell",children:j.categoria||""}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden lg:table-cell",children:Eh[j.metodoPago??"efectivo"]}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-semibold text-red-600",children:K(j.monto)})]},j.id)})]})]})})]})]}),r.jsx(bx,{orders:e,isLoadingOrders:d})]})]})}const e1="bowlssalados-0",jx=["Arroz","Pasta","Quinua"],wx=["Maz tierno","Championes","Pico de gallo","Guacamole","Tocineta","Chips de arracacha","Queso feta","Zanahoria","Pepino"],Nx=["Pechuga de pollo","Jamn de cerdo","Carne desmechada","Championes","Carne Molida"],Ta=1,fs=2,Ma=2,ps=4,kx=e=>e.id===e1||e.nombre.toLowerCase()==="bowl salado",uc=()=>({efectivo:!1,tarjeta:!1,nequi:!1,provision_caja:!1,credito_empleados:!1}),mc=()=>({efectivo:"",tarjeta:"",nequi:"",provision_caja:"",credito_empleados:""}),dr=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.round(t)},t1=(e,t)=>fi.reduce((s,n)=>e[n]?s+dr(t[n]):s,0),s1=e=>{const t=[];if(e.bowlCustomization){const{bases:s,toppings:n,proteina:a}=e.bowlCustomization;s&&s.length>0&&t.push(`Bases: ${s.join(", ")}`),a&&t.push(`Protena: ${a}`),n&&n.length>0&&t.push(`Toppings: ${n.join(", ")}`)}return e.notas&&t.push(`Notas: ${e.notas}`),e.studentDiscount&&t.push("Incluye descuento estudiante"),t},Ph=(e,t,s,n,a)=>{const o=a[s];if(!o)return e;const i=Number.isFinite(n)?Math.floor(n):0,l=e.reduce((u,m)=>m.id===t?u:u+(m.itemQuantities[s]??0),0),c=Math.max(0,o.quantity-l),d=Math.max(0,Math.min(i,c));return e.map(u=>{if(u.id!==t)return u;const m={...u.itemQuantities};return d<=0?delete m[s]:m[s]=d,{...u,itemQuantities:m}})};function Sx({order:e,onClose:t,onSubmit:s,isSubmitting:n=!1,title:a,onAssignCredit:o}){var ne;const i=h.useMemo(()=>Math.round(e.total),[e.total]),l=h.useMemo(()=>e.items.map((N,V)=>{const ae=Math.max(0,Math.round(N.cantidad)),ie=Math.round(eo(N));return{key:`${V}-${N.item.id}-${N.customKey??"default"}`,label:N.item.nombre,quantity:ae,unitPrice:ie,subtotal:ie*ae,details:s1(N)}}),[e.items]),c=h.useMemo(()=>l.reduce((N,V)=>(N[V.key]=V,N),{}),[l]),[d,u]=h.useState([]),[m,f]=h.useState({}),[p,S]=h.useState(""),E=h.useMemo(()=>d.filter(N=>N.activo),[d]),T=E.length>0,y=h.useCallback(N=>{if(!N)return"";const V=E.find(ae=>ae.id===N);return V?V.nombre:""},[E]),g=h.useCallback(N=>{const V=m[N.id]??0;return V>0?`${N.nombre}  ${K(V)} pendientes`:N.nombre},[m]),x=h.useRef(1),_=h.useCallback(N=>{const V=x.current++;return{id:`persona-${V}`,name:(N==null?void 0:N.name)??`Persona ${V}`,method:(N==null?void 0:N.method)??"efectivo",itemQuantities:(N==null?void 0:N.itemQuantities)??{},employeeId:N==null?void 0:N.employeeId}},[]),F=h.useMemo(()=>Ks(e),[e]);h.useEffect(()=>{let N=!0;const V=async()=>{try{const[ie,pe]=await Promise.all([ye.fetchEmpleados(),ye.fetchEmployeeCredits().catch(()=>[])]);if(!N)return;u(ie);const Le=(pe??[]).reduce((Ge,Vt)=>(Ge[Vt.empleadoId]=Math.max(0,Math.round(Vt.total)),Ge),{});f(Le)}catch(ie){console.error("No se pudieron cargar los empleados o crditos.",ie)}};V();const ae=()=>{V()};return typeof window<"u"&&window.addEventListener(Gn,ae),()=>{N=!1,typeof window<"u"&&window.removeEventListener(Gn,ae)}},[]);const[A,H]=h.useState("single"),[R,ge]=h.useState(()=>uc()),[ce,I]=h.useState(()=>mc()),[ee,te]=h.useState(null),[be,Se]=h.useState(null),[_e,Ee]=h.useState(null),[se,oe]=h.useState(""),Q=h.useRef(!1),J=h.useCallback(()=>{x.current=1;const N=F[0],V=F[1],ae=(N==null?void 0:N.metodo)??"efectivo",ie=(V==null?void 0:V.metodo)??ae,pe=(N==null?void 0:N.metodo)==="credito_empleados"?N.empleadoId:void 0,Le=(V==null?void 0:V.metodo)==="credito_empleados"?V.empleadoId:void 0;return[_({name:"Persona 1",method:ae,itemQuantities:{},employeeId:pe}),_({name:"Persona 2",method:ie,itemQuantities:{},employeeId:Le})]},[_,F]),[D,le]=h.useState(J);h.useEffect(()=>{le(J())},[J]),h.useEffect(()=>{if(F.length===0){const ie=uc();ie.efectivo=!0;const pe=mc();pe.efectivo=i>0?String(i):"",ge(ie),I(pe),S(""),te(null);return}const N=uc(),V=mc();let ae;F.forEach(ie=>{N[ie.metodo]=!0,V[ie.metodo]=String(Math.round(ie.monto)),ie.metodo==="credito_empleados"&&ie.empleadoId&&(ae=ie.empleadoId)}),ge(N),I(V),S(ae??""),te(null)},[F,i]),h.useEffect(()=>{var V;if(!R.credito_empleados){p&&S("");return}if(!T){p&&S("");return}if(p&&E.some(ae=>ae.id===p))return;const N=((V=E[0])==null?void 0:V.id)??"";S(N)},[R,p,E,T]),h.useEffect(()=>{le(N=>{let V=!1;const ae=N.map(ie=>{var pe;return ie.method!=="credito_empleados"?ie.employeeId!==void 0?(V=!0,{...ie,employeeId:void 0}):ie:T?ie.employeeId&&E.some(Le=>Le.id===ie.employeeId)?ie:(V=!0,{...ie,employeeId:(pe=E[0])==null?void 0:pe.id}):ie.employeeId!==void 0?(V=!0,{...ie,employeeId:void 0}):ie});return V?ae:N})},[E,T]);const U=h.useRef(e.id);h.useEffect(()=>{U.current!==e.id&&(U.current=e.id,H("single"),te(null))},[e.id]);const Y=N=>{H(N),te(null)},ue=h.useMemo(()=>fi.filter(N=>R[N]),[R]),ve=h.useMemo(()=>ue.map(N=>{const V={metodo:N,monto:dr(ce[N])};if(N==="credito_empleados"&&p){V.empleadoId=p;const ae=y(p);ae&&(V.empleadoNombre=ae)}return V}),[ce,ue,p,y]),W=h.useMemo(()=>Bs(ve),[ve]),C=i-W,q=ve.some(N=>N.monto<=0),X=ue.length>0,xe=Math.abs(C)<=1,$=ue.some(N=>N==="credito_empleados"&&!p),j=X&&!q&&xe&&i>0&&!$,k=h.useMemo(()=>l.reduce((N,V)=>{const ae=D.reduce((ie,pe)=>ie+(pe.itemQuantities[V.key]??0),0);return N[V.key]={assigned:ae,remaining:V.quantity-ae},N},{}),[l,D]),z=h.useMemo(()=>D.reduce((N,V)=>{const ae=l.reduce((ie,pe)=>{const Le=V.itemQuantities[pe.key]??0;return ie+Le*pe.unitPrice},0);return N[V.id]=Math.round(ae),N},{}),[l,D]),P=h.useMemo(()=>D.map(N=>{const V=z[N.id]??0;if(V<=0)return null;const ae={metodo:N.method,monto:V};if(N.method==="credito_empleados"&&N.employeeId){ae.empleadoId=N.employeeId;const ie=y(N.employeeId);ie&&(ae.empleadoNombre=ie)}return ae}).filter(N=>N!==null),[D,z,y]),Z=h.useMemo(()=>Bs(P),[P]),me=h.useMemo(()=>l.every(N=>{var V;return(((V=k[N.key])==null?void 0:V.assigned)??0)===N.quantity}),[l,k]),we=P.length>0,De=Math.abs(Z-i)<=1,Be=h.useMemo(()=>D.some(N=>N.method==="credito_empleados"&&!N.employeeId),[D]),He=A==="split"?Z:W,Ve=i-He,et=R.efectivo,it=dr(ce.efectivo),xt=se.trim()===""?it:dr(se),jt=Math.max(0,xt-it),$t=Math.max(0,it-xt);h.useEffect(()=>{if(!et){Q.current=!1,oe("");return}Q.current||oe(ce.efectivo??"")},[et,ce.efectivo]);const Lt=h.useMemo(()=>ho(A==="split"?P:ve,K),[A,ve,P]),_t=!!e.creditInfo,M=((ne=e.creditInfo)==null?void 0:ne.amount)??i,re=h.useMemo(()=>e.creditInfo?e.creditInfo.assignedAt.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}):"",[e.creditInfo]),fe=N=>{ge(V=>{var pe;const ae=!!V[N];if(!ae&&N==="credito_empleados"&&!T)return te("No hay empleados activos para registrar crditos."),V;if(V.credito_empleados&&N!=="credito_empleados"&&!ae)return te("No puedes combinar el crdito de empleados con otros mtodos."),V;if(N==="credito_empleados")return ae?(I(Le=>({...Le,credito_empleados:""})),S(""),te(null),{...V,credito_empleados:!1}):(I(()=>({efectivo:"",tarjeta:"",nequi:"",credito_empleados:i>0?String(i):""})),(!p||!E.some(Le=>Le.id===p))&&S(((pe=E[0])==null?void 0:pe.id)??""),te(null),{efectivo:!1,tarjeta:!1,nequi:!1,credito_empleados:!0});const ie={...V,[N]:!ae};return I(Le=>{const Ge={...Le};if(ae)Ge[N]="",N==="efectivo"&&(Q.current=!1,oe(""));else{const Vt=t1(V,Le),Zt=Math.max(0,i-Vt);Ge[N]=Zt>0?String(Zt):"",N==="efectivo"&&(Q.current=!1)}return Ge}),te(null),ie})},ke=(N,V)=>{/^[0-9]*$/.test(V)&&(I(ae=>({...ae,[N]:V})),te(null))},Ie=N=>{/^[0-9]*$/.test(N)&&(Q.current=!0,oe(N))},O=N=>{const V=ue.filter(ie=>ie!==N).reduce((ie,pe)=>ie+dr(ce[pe]),0),ae=Math.max(0,i-V);ge(ie=>({...ie,[N]:!0})),I(ie=>({...ie,[N]:ae>0?String(ae):""})),N==="efectivo"&&(Q.current=!1),te(null)},v=()=>{le(N=>[...N,_()]),te(null)},w=N=>{le(V=>V.length<=1?V:V.filter(ae=>ae.id!==N)),te(null)},B=(N,V)=>{le(ae=>ae.map(ie=>ie.id===N?{...ie,name:V}:ie)),te(null)},G=(N,V)=>{if(V==="credito_empleados"&&!T){te("No hay empleados activos para registrar crditos.");return}le(ae=>ae.map(ie=>{var pe;if(ie.id!==N)return ie;if(V==="credito_empleados"){const Le=ie.employeeId&&E.some(Ge=>Ge.id===ie.employeeId)?ie.employeeId:(pe=E[0])==null?void 0:pe.id;return{...ie,method:V,employeeId:Le}}return ie.employeeId!==void 0?{...ie,method:V,employeeId:void 0}:{...ie,method:V}})),te(null)},he=(N,V)=>{le(ae=>ae.map(ie=>ie.id!==N?ie:{...ie,employeeId:V||void 0})),te(null)},Te=(N,V,ae)=>{le(ie=>{var Le;const pe=((Le=ie.find(Ge=>Ge.id===N))==null?void 0:Le.itemQuantities[V])??0;return Ph(ie,N,V,pe+ae,c)}),te(null)},Re=(N,V)=>{Se({personId:N,personName:V})},Oe=()=>{Se(null),Ee(null)},lt=(N,V)=>{if(N.preventDefault(),!be)return;const ae=k[V];((ae==null?void 0:ae.remaining)??0)>0&&Ee(V)},yt=()=>{Ee(null)},Xt=(N,V)=>{if(N.preventDefault(),!be)return;const ae=c[V];if(!ae){Se(null),Ee(null);return}const ie=k[V];if(((ie==null?void 0:ie.remaining)??0)<=0){te(`No hay unidades pendientes de ${ae.label} para asignar.`),Se(null),Ee(null);return}le(Le=>{const Ge=Le.find(_n=>_n.id===be.personId);if(!Ge)return Le;const Zt=(Ge.itemQuantities[V]??0)+1;return Ph(Le,be.personId,V,Zt,c)}),Se(null),Ee(null),te(null)},Ms=async N=>{!o||n||(te(null),await o(N))},L=async()=>{if(A==="single"&&ue.length===1&&ue[0]==="credito_empleados"&&o&&!_t){if($){te("Selecciona el empleado al registrar un crdito.");return}const pe=p,Le=Math.max(0,dr(ce.credito_empleados)||i);if(!pe){te("Selecciona el empleado al registrar un crdito.");return}if(Le<=0){te("El monto a crdito debe ser mayor a cero.");return}await Ms({employeeId:pe,amount:Le,employeeName:y(pe)||void 0});return}if(A==="split"){if(!we){te("Asigna al menos un producto y mtodo de pago para continuar.");return}if(!me){te("Distribuye todos los productos entre las personas antes de confirmar.");return}if(!De){te("Los montos asignados no coinciden con el total del pedido.");return}if(Be){te("Selecciona el empleado correspondiente para cada pago por crdito.");return}}else if(!j){te($?"Selecciona el empleado al registrar un crdito.":"Asegrate de seleccionar al menos un mtodo y que los montos sumen el total.");return}const ae=Xa(yn(A==="split"?P:ve)),ie=Bs(ae);if(Math.abs(ie-i)>1){te("Los montos registrados no coinciden con el total del pedido.");return}te(null),await s(ae)};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:a??"Registrar pago"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Pedido #",e.numero,"  Total ",K(i)]})]}),r.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:r.jsx(Ur,{size:20})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{children:r.jsxs("div",{className:"grid grid-cols-2 bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{type:"button",onClick:()=>Y("single"),className:`py-2 px-3 rounded-md text-sm font-medium transition-colors ${A==="single"?"bg-white shadow text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"Pago completo"}),r.jsx("button",{type:"button",onClick:()=>Y("split"),className:`py-2 px-3 rounded-md text-sm font-medium transition-colors ${A==="split"?"bg-white shadow text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"Dividir cuenta"})]})}),A==="single"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold mb-2",style:{color:b.dark},children:"Selecciona los mtodos de pago"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:fi.map(N=>{const V=R[N],ae=ns[N],ie=R.credito_empleados&&N!=="credito_empleados"||n;return r.jsx("button",{type:"button",onClick:()=>fe(N),disabled:ie,className:`py-2 px-3 rounded-lg border text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed ${V?"border-transparent text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:V?b.dark:"transparent"},children:ae},N)})})]}),ue.length>0&&r.jsx("div",{className:"space-y-3",children:ue.map(N=>{const V=ns[N];return r.jsxs("div",{className:"flex flex-col gap-2 p-3 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium",style:{color:b.dark},children:V}),r.jsx("button",{type:"button",onClick:()=>O(N),className:"text-xs text-gray-600 hover:text-gray-900",children:"Usar restante"})]}),r.jsx("input",{type:"number",min:"0",step:"100",value:ce[N],onChange:ae=>ke(N,ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent},placeholder:"Monto"}),N==="efectivo"&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-600",htmlFor:`cash-received-${e.id}`,children:"Monto recibido"}),r.jsx("input",{id:`cash-received-${e.id}`,type:"number",min:"0",step:"100",value:se,onChange:ae=>Ie(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent},placeholder:"Con cunto paga la persona?"}),it>0&&r.jsx("p",{className:`text-xs font-semibold ${$t>0?"text-red-600":jt>0?"text-green-600":"text-gray-600"}`,children:$t>0?`Faltan ${K($t)} por recibir`:jt>0?`Cambio ${K(jt)}`:"Sin cambio"})]}),N==="credito_empleados"&&r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-600",htmlFor:`credit-employee-${N}`,children:"Empleado"}),T?r.jsxs("select",{id:`credit-employee-${N}`,value:p,onChange:ae=>S(ae.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Selecciona un empleado"}),E.map(ae=>r.jsx("option",{value:ae.id,children:g(ae)},ae.id))]}):r.jsx("p",{className:"text-xs text-red-600",children:"No hay empleados activos disponibles para crdito."})]})]},N)})})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Personas"}),r.jsx("button",{type:"button",onClick:v,className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:"Agregar persona"})]}),r.jsx("div",{className:"space-y-3",children:D.map((N,V)=>{const ae=N.name.trim()?N.name:`Persona ${V+1}`,ie=z[N.id]??0;return r.jsxs("div",{draggable:!0,onDragStart:()=>Re(N.id,ae),onDragEnd:Oe,className:"border border-gray-200 rounded-lg bg-gray-50 p-3 space-y-3 cursor-grab active:cursor-grabbing hover:shadow-md transition-all",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[r.jsx("input",{type:"text",value:N.name,onChange:pe=>B(N.id,pe.target.value),placeholder:`Persona ${V+1}`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}}),D.length>1&&r.jsx("button",{type:"button",onClick:()=>w(N.id),className:"text-xs text-red-600 hover:text-red-700",children:"Eliminar"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3 gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-semibold uppercase text-gray-500",children:"Pago con"}),r.jsx("select",{value:N.method,onChange:pe=>G(N.id,pe.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:fi.map(pe=>r.jsx("option",{value:pe,children:ns[pe]},pe))})]}),N.method==="credito_empleados"&&(T?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-semibold uppercase text-gray-500",children:"Empleado"}),r.jsxs("select",{value:N.employeeId??"",onChange:pe=>he(N.id,pe.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Selecciona un empleado"}),E.map(pe=>r.jsx("option",{value:pe.id,children:g(pe)},pe.id))]})]}):r.jsx("span",{className:"text-xs text-red-600",children:"No hay empleados activos"}))]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:["Total asignado:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:K(ie)})]})]},N.id)})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold mb-2",style:{color:b.dark},children:"Asignar productos"}),r.jsx("div",{className:"space-y-4",children:l.map(N=>{const V=k[N.key],ae=(V==null?void 0:V.assigned)??0,ie=(V==null?void 0:V.remaining)??0,pe=ie>0,Le=_e===N.key;return r.jsxs("div",{onDragOver:Ge=>lt(Ge,N.key),onDragLeave:yt,onDrop:Ge=>Xt(Ge,N.key),className:`border rounded-lg p-3 space-y-3 transition-all ${Le&&pe?"border-2 border-green-500 bg-green-50 shadow-lg":"border-gray-200"}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("p",{className:"text-sm font-medium",style:{color:b.dark},children:N.label}),pe&&r.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"Suelta persona aqu"}),Le&&be&&r.jsxs("span",{className:"text-xs bg-green-500 text-white px-2 py-1 rounded font-medium animate-pulse",children:["Asignar a ",be.personName]})]}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Cantidad: ",N.quantity,"  Precio unidad: ",K(N.unitPrice),"  Subtotal:"," ",K(N.subtotal)]}),N.details.map((Ge,Vt)=>r.jsx("p",{className:"text-xs text-gray-500",children:Ge},Vt))]}),r.jsxs("div",{className:"text-xs font-medium text-gray-600",children:["Asignado: ",ae,"/",N.quantity,ie>0&&r.jsxs("span",{className:"text-red-600",children:["  Pendiente: ",ie]})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[D.map((Ge,Vt)=>{const Zt=Ge.itemQuantities[N.key]??0;if(Zt===0)return null;const _n=Zt*N.unitPrice,El=Ge.name.trim()?Ge.name:`Persona ${Vt+1}`;return r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-full",children:[r.jsx("span",{className:"text-sm font-medium text-blue-900",children:El}),r.jsxs("span",{className:"text-xs text-blue-700",children:["",Zt]}),r.jsxs("span",{className:"text-xs text-blue-600",children:["(",K(_n),")"]}),r.jsx("button",{type:"button",onClick:()=>Te(Ge.id,N.key,-Zt),className:"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none",title:"Quitar asignacin",children:""})]},Ge.id)}),ae===0&&r.jsx("span",{className:"text-xs text-gray-400 italic py-1.5",children:"Sin asignar - arrastra una persona aqu"})]})]},N.key)})}),!me&&r.jsx("p",{className:"text-xs text-red-600",children:"An hay productos sin asignar."})]})]}),r.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between font-medium",children:[r.jsx("span",{children:"Total registrado"}),r.jsx("span",{children:K(He)})]}),r.jsxs("div",{className:"flex justify-between font-medium",children:[r.jsx("span",{children:"Restante"}),r.jsx("span",{className:Ve===0?"text-green-600":"text-red-600",children:K(Math.abs(Ve))})]}),r.jsx("p",{className:"text-xs text-gray-500",children:Lt}),ee&&r.jsx("p",{className:"text-xs text-red-600",children:ee})]}),_t?r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs text-blue-800",children:[r.jsx("p",{className:"font-semibold mb-1",children:"Pedido asignado como crdito de empleados."}),r.jsxs("p",{children:["Monto pendiente: ",K(Math.round(M))]}),r.jsxs("p",{children:["Asignado el: ",re]}),r.jsx("p",{className:"mt-1",children:"Registra el pago cuando el crdito sea cancelado para reflejarlo en el balance."})]}):o&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-xs text-yellow-800",children:[r.jsx("p",{className:"font-semibold mb-1",children:"Crdito de empleados disponible."}),r.jsx("p",{children:'Usa la opcin "Crdito empleados" en los mtodos de pago para enviar este pedido a crdito.'}),r.jsx("p",{className:"mt-1",children:"El monto no se sumar al balance hasta registrar el pago."})]}),r.jsxs("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm",disabled:n,children:"Cancelar"}),r.jsx("button",{type:"button",onClick:L,className:"flex-1 py-2 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-sm disabled:opacity-60 disabled:cursor-not-allowed",style:{backgroundColor:b.dark},disabled:n,children:"Confirmar pago"})]})]})]})})}const Pd=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},n1=e=>{if(!e)return new Date;const[t,s,n]=e.split("-"),a=Number(t),o=Number(s),i=Number(n);if([a,o,i].some(d=>Number.isNaN(d)||d<=0))return new Date;const l=new Date,c=new Date(l);return c.setFullYear(a,o-1,i),c},r1=(e,t)=>t?Pd(e)===t:!1,a1=e=>{const[t,s,n]=e.split("-"),a=Number(t),o=Number(s),i=Number(n);return[a,o,i].some(c=>Number.isNaN(c)||c<=0)?e:new Date(a,o-1,i).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"})};function o1({orders:e,onModuleChange:t,onCreateOrder:s,onRecordOrderPayment:n,onAssignOrderCredit:a}){const[o,i]=h.useState([]),[l,c]=h.useState([]),[d,u]=h.useState(!0),[m,f]=h.useState(null),[p,S]=h.useState([]),[E,T]=h.useState(""),[y,g]=h.useState(""),[x,_]=h.useState(()=>Pd(new Date)),[F,A]=h.useState(!1),[H,R]=h.useState(null),[ge,ce]=h.useState(!1),[I,ee]=h.useState(""),[te,be]=h.useState(null),[Se,_e]=h.useState(null),[Ee,se]=h.useState([]),[oe,Q]=h.useState([]),[J,D]=h.useState(null),[le,U]=h.useState(!1),Y=h.useRef(!0),ue=()=>{se([]),Q([]),D(null)},ve=O=>{if(kx(O)){ue(),_e(O);return}we(O)},W=(O,v,w,B)=>{w(G=>G.includes(O)?G.filter(he=>he!==O):G.length>=B?G:[...G,O])},C=()=>{if(!Se||!J||Ee.length<Ta||Ee.length>fs||oe.length<Ma||oe.length>ps)return;const O=[`Bases: ${Ee.join(", ")}`,`Toppings: ${oe.join(", ")}`,`Protena: ${J}`].join(`
`),v=[Se.id,[...Ee].sort().join("-"),[...oe].sort().join("-"),J].join("|");we(Se,{notas:O,customKey:v,bowlCustomization:{bases:Ee,toppings:oe,proteina:J}}),_e(null),ue()},q=()=>{_e(null),ue()},X=O=>{const v=O.target.value;_(v||Pd(new Date))},xe=O=>{D(v=>v===O?null:O)},$=h.useCallback(async()=>{Y.current&&(u(!0),f(null));try{const[O,v]=await Promise.all([ye.fetchMenuItems(),ye.fetchCustomers()]);if(!Y.current)return;i(O),c(v)}catch(O){console.error("[Caja] Error cargando datos iniciales.",O),Y.current&&f("No se pudieron cargar los datos de caja. Intenta de nuevo.")}finally{Y.current&&u(!1)}},[]);h.useEffect(()=>($(),()=>{Y.current=!1}),[$]);const j=()=>{Y.current&&$()};if(d)return r.jsx("section",{className:"space-y-6 sm:space-y-8",children:r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600 text-sm",children:[r.jsx(nt,{size:18,className:"animate-spin text-gray-500"}),r.jsx("span",{children:"Cargando datos de caja..."})]})});if(m)return r.jsx("section",{className:"space-y-6 sm:space-y-8",children:r.jsxs("div",{className:"ui-card ui-card-pad text-center space-y-3",children:[r.jsx("p",{className:"text-sm text-gray-600",children:m}),r.jsx("button",{type:"button",onClick:j,className:"inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-white rounded-lg",style:{backgroundColor:b.accent},children:"Reintentar carga"})]})});const k=o.filter(O=>O.inventarioCategoria!=="Inventariables").map(O=>O.categoria),z=Array.from(new Set(k)),P=xs(E),Z=o.filter(O=>{const v=!P||xs(O.nombre).includes(P),w=!y||O.categoria===y,B=O.inventarioCategoria!=="Inventariables";return v&&w&&B}),me=O=>p.filter(({item:v})=>v.id===O).reduce((v,w)=>v+w.cantidad,0),we=(O,v)=>{S(w=>w.find(G=>G.item.id===O.id&&G.customKey===(v==null?void 0:v.customKey))?w.map(G=>G.item.id===O.id&&G.customKey===(v==null?void 0:v.customKey)?{...G,cantidad:G.cantidad+1}:G):[...w,{item:O,cantidad:1,notas:v==null?void 0:v.notas,customKey:v==null?void 0:v.customKey,bowlCustomization:v==null?void 0:v.bowlCustomization,precioUnitario:O.precio,studentDiscount:!1}])},De=(O,v,w)=>{w<=0?S(B=>B.filter(G=>!(G.item.id===O&&G.customKey===v))):S(B=>B.map(G=>G.item.id===O&&G.customKey===v?{...G,cantidad:w}:G))},Be=(O,v)=>{S(w=>w.filter(B=>!(B.item.id===O&&B.customKey===v)))},He=(O,v)=>{S(w=>w.map(B=>B.item.id===O&&B.customKey===v?{...B,studentDiscount:!B.studentDiscount}:B))},Ve=Ee.length>=fs,et=oe.length>=ps,it=Ee.length>=Ta&&Ee.length<=fs&&oe.length>=Ma&&oe.length<=ps&&!!J,xt=en(p),jt=h.useMemo(()=>e.filter(O=>r1(O.timestamp,x)),[e,x]),$t=h.useMemo(()=>a1(x),[x]),Lt=[...jt].filter(O=>O.estado==="entregado"&&!bs(O)&&O.metodoPago!=="credito_empleados").sort((O,v)=>v.timestamp.getTime()-O.timestamp.getTime()),_t=Lt.length,M=async()=>{if(p.length===0||le)return;let O=te,v;const w=I.trim();U(!0);try{if(!O&&w){const he=l.find(Te=>Te.nombre.toLowerCase()===w.toLowerCase());if(he)O=he,v=he.id;else{const Te=window.prompt("Ingrese telfono del cliente");if(!Te){alert("Debe ingresar un telfono para continuar");return}const Re={id:crypto.randomUUID(),nombre:w,telefono:Te.trim()},Oe=await ye.createCustomer(Re);O=Oe,v=Oe.id,c(lt=>[...lt,Oe])}}else O&&(v=O.id);const B=(O==null?void 0:O.nombre)??(w||void 0),G={id:crypto.randomUUID(),numero:Uv(),items:p,total:xt,estado:"pendiente",timestamp:n1(x),cliente_id:v,cliente:B,paymentStatus:"pendiente",paymentAllocations:[]};await s(G),S([]),A(!1),ee(""),be(null),t("comandas")}catch(B){console.error("Error al crear el pedido:",B),alert("No se pudo crear el pedido. Intntalo nuevamente.")}finally{U(!1)}},re=O=>{bs(O)||R(O)},fe=()=>{ge||R(null)},ke=async O=>{if(H)try{ce(!0),await n(H,O),R(null)}catch(v){console.error("Error al registrar el pago:",v),alert("No se pudo registrar el pago. Intntalo nuevamente.")}finally{ce(!1)}},Ie=async O=>{if(H)try{ce(!0),await a(H,O),R(null)}catch(v){console.error("Error al asignar el pedido a crdito de empleados:",v),alert("No se pudo asignar el crdito. Intntalo nuevamente.")}finally{ce(!1)}};return r.jsxs("section",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[r.jsxs("div",{className:"order-2 lg:order-1 lg:col-span-2 space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-4",children:[r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Punto de Venta"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3",children:[r.jsx("label",{htmlFor:"caja-date",className:"text-sm font-medium text-gray-600",children:"Fecha del registro"}),r.jsx("input",{id:"caja-date",type:"date",value:x,onChange:X,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm",style:{"--tw-ring-color":b.accent}})]})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:E,onChange:O=>T(O.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("select",{value:y,onChange:O=>g(O.target.value),className:"px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm w-full lg:w-auto",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Todas las categoras"}),z.map(O=>r.jsx("option",{value:O,children:O},O))]})]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 lg:gap-4",children:Z.map(O=>{const v=me(O.id),w=v>0;return r.jsxs("div",{className:`relative ui-card ui-card-pad hover:shadow-md transition-all duration-200 border ${w?"bg-yellow-50 border-yellow-200":"bg-white border-gray-100"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsx("h3",{className:"font-semibold text-sm lg:text-base",style:{color:b.dark},children:O.nombre}),r.jsx("span",{className:"font-bold text-sm lg:text-base",style:{color:b.accent},children:K(O.precio)})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:O.categoria}),O.descripcion&&r.jsx("p",{className:"text-sm text-gray-500 mb-3 line-clamp-2",children:O.descripcion}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-gray-500",children:["Stock: ",O.stock]}),r.jsxs("div",{className:"flex items-center gap-2",children:[w&&r.jsx("span",{className:"inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-full px-2 text-xs font-semibold text-white shadow-sm",style:{backgroundColor:b.accent},children:v}),r.jsx("button",{onClick:()=>ve(O),disabled:O.inventarioCategoria==="Inventariables"&&O.stock===0,className:"px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm",style:{backgroundColor:b.dark},children:r.jsx(jn,{size:16})})]})]})]},O.id)})})]}),r.jsx("div",{className:"order-1 lg:order-2 space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad lg:sticky lg:top-24",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(pg,{size:24,style:{color:b.dark}}),r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:"Carrito"})]}),p.length===0?r.jsx("p",{className:"text-gray-500 text-center py-6 lg:py-8 text-sm",children:"Carrito vaco"}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"space-y-3 mb-4 lg:mb-6 max-h-80 lg:max-h-96 overflow-y-auto",children:p.map(O=>r.jsx("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsx("h4",{className:"font-medium text-sm",children:O.item.nombre}),r.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:["Subtotal: ",K(to(O))]})]}),r.jsxs("div",{className:"text-xs text-gray-600",children:["Precio unidad:"," ",O.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-2",children:K(on(O))}),r.jsx("span",{className:"font-semibold text-green-600",children:K(eo(O))})]}):r.jsx("span",{children:K(on(O))})]}),O.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full",children:Hr}),O.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:O.notas}),qg(O.item)&&r.jsx("button",{onClick:()=>He(O.item.id,O.customKey),className:`mt-1 inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium transition-colors ${O.studentDiscount?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:O.studentDiscount?"Quitar descuento":"Aplicar descuento estudiante"})]}),r.jsxs("div",{className:"flex items-center gap-2 self-start",children:[r.jsx("button",{onClick:()=>De(O.item.id,O.customKey,O.cantidad-1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(Eu,{size:12})}),r.jsx("span",{className:"w-8 text-center font-medium",children:O.cantidad}),r.jsx("button",{onClick:()=>De(O.item.id,O.customKey,O.cantidad+1),className:"w-6 h-6 rounded-full flex items-center justify-center text-white hover:opacity-90",style:{backgroundColor:b.dark},children:r.jsx(jn,{size:12})}),r.jsx("button",{onClick:()=>Be(O.item.id,O.customKey),className:"w-6 h-6 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200",children:r.jsx(qn,{size:12})})]})]})},`${O.item.id}-${O.customKey??"default"}`))}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("span",{className:"text-lg font-bold",children:"Total:"}),r.jsx("span",{className:"text-xl lg:text-2xl font-bold",style:{color:b.accent},children:K(xt)})]}),r.jsx("button",{onClick:()=>A(!0),className:"w-full py-3 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-base",style:{backgroundColor:b.dark},children:"Enviar a comanda"})]})]})]})}),Lt.length>0&&r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:"Pagos de pedidos entregados"}),r.jsx("p",{className:"text-sm text-gray-500",children:_t===1?"1 pago pendiente por registrar":`${_t} pagos pendientes por registrar`}),r.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Fecha seleccionada: ",$t]})]})}),r.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:Lt.map(O=>{const v=Ks(O),w=ho(v,K);return r.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm font-semibold",style:{color:b.dark},children:["Pedido #",O.numero]}),O.cliente&&r.jsxs("p",{className:"text-xs text-gray-500",children:["Cliente: ",O.cliente]})]}),r.jsx("span",{className:"text-sm font-bold",style:{color:b.accent},children:K(O.total)})]}),r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"inline-flex items-center gap-2 px-2 py-1 rounded-full font-medium bg-yellow-100 text-yellow-800",children:"Pago pendiente"}),r.jsx("span",{className:"text-gray-500 text-right flex-1 ml-3 line-clamp-2",children:w})]}),r.jsx("button",{type:"button",onClick:()=>re(O),className:"w-full py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50",children:"Registrar pago"})]},O.id)})})]})]}),Se&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:"Personaliza tu Bowl Salado"}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Selecciona entre ",Ta," y ",fs," bases, entre ",Ma," y ",ps," toppings y 1 protena."]})]}),r.jsx("button",{onClick:q,className:"text-sm text-gray-500 hover:text-gray-700",children:"Cerrar"})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tu base"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[Ee.length,"/",fs]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:jx.map(O=>{const v=Ee.includes(O),w=!v&&Ve;return r.jsxs("button",{type:"button",onClick:()=>W(O,Ee,se,fs),disabled:w,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${v?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${w?"opacity-50 cursor-not-allowed":""}`,style:v?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:O}),v&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},O)})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tus toppings"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[oe.length,"/",ps]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:wx.map(O=>{const v=oe.includes(O),w=!v&&et;return r.jsxs("button",{type:"button",onClick:()=>W(O,oe,Q,ps),disabled:w,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${v?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${w?"opacity-50 cursor-not-allowed":""}`,style:v?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:O}),v&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},O)})})]}),r.jsxs("div",{children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tu protena"})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:Nx.map(O=>{const v=J===O;return r.jsxs("button",{type:"button",onClick:()=>xe(O),className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${v?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"}`,style:v?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:O}),v&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},O)})})]})]}),r.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 sm:justify-end border-t pt-4",children:[r.jsx("button",{onClick:q,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{onClick:C,disabled:!it,className:"px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:b.dark},children:"Agregar al carrito"})]})]})}),F&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:b.dark},children:"Confirmar pedido"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cliente (opcional)"}),r.jsx("input",{type:"text",value:I,onChange:O=>{ee(O.target.value),be(null)},placeholder:"Nombre del cliente",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent pr-10 text-sm",readOnly:!!te}),te&&r.jsx("button",{type:"button",onClick:()=>be(null),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:r.jsx(_v,{size:16})}),I&&!te&&r.jsx("div",{className:"absolute z-10 bg-white border border-gray-200 rounded-lg mt-1 w-full max-h-32 sm:max-h-40 overflow-y-auto",children:l.filter(O=>O.nombre.toLowerCase().includes(I.toLowerCase())).map(O=>r.jsx("button",{onClick:()=>{ee(O.nombre),be(O)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",children:O.nombre},O.id))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-600",children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Fecha del pedido:"})," ",$t]}),r.jsxs("div",{className:"pt-4 border-t",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("span",{className:"text-lg font-bold",children:"Total a pagar:"}),r.jsx("span",{className:"text-xl lg:text-2xl font-bold",style:{color:b.accent},children:K(xt)})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>A(!1),disabled:le,className:"flex-1 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),r.jsx("button",{onClick:M,disabled:le,className:"flex-1 py-3 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:b.dark},children:le?"Procesando...":"Confirmar pedido"})]})]})]})]})}),H&&r.jsx(Sx,{order:H,onClose:fe,onSubmit:ke,isSubmitting:ge,title:"Gestionar pago",onAssignCredit:Ie})]})}const Tn=30,Mn=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},i1=e=>{const[t,s,n]=e.split("-").map(Number);return new Date(t,(s??1)-1,n??1)};function l1({orders:e,onUpdateOrderStatus:t,onSaveOrderChanges:s,onRecordOrderPayment:n,onDeleteOrder:a,isAdmin:o,onAssignOrderCredit:i,focusRequest:l,isLoading:c,isSyncing:d=!1}){const[u,m]=h.useState([]),[f,p]=h.useState(null),[S,E]=h.useState(null),[T,y]=h.useState(!1),[g,x]=h.useState(""),[_,F]=h.useState(null),[A,H]=h.useState([]),[R,ge]=h.useState([]),[ce,I]=h.useState(null),[ee,te]=h.useState(()=>Mn(new Date)),[be,Se]=h.useState(1),[_e,Ee]=h.useState(null),[se,oe]=h.useState(!1),[Q,J]=h.useState(!1),[D,le]=h.useState(null),[U,Y]=h.useState({}),ue=async(L,ne)=>{if(!U[L.id]){Y(N=>({...N,[L.id]:!0}));try{await t(L,ne)}finally{Y(N=>{const{[L.id]:V,...ae}=N;return ae})}}};h.useEffect(()=>{if(!l)return;const{dateKey:L,orderId:ne}=l;if(ne){const N=e.find(V=>V.id===ne);if(N){const V=Mn(N.timestamp);te(V);const ie=e.filter(pe=>Mn(pe.timestamp)===V).sort((pe,Le)=>Le.timestamp.getTime()-pe.timestamp.getTime()).findIndex(pe=>pe.id===ne);if(ie>=0){const pe=Math.floor(ie/Tn)+1;Se(pe)}else Se(1);E(ne),p(null),y(!1);return}}L&&(te(L),Se(1),ne&&E(ne))},[l,e]),h.useEffect(()=>{if(!l){te(Mn(new Date)),Se(1),E(null);return}},[l==null?void 0:l.requestId]);const ve=h.useMemo(()=>[...e].sort((L,ne)=>ne.timestamp.getTime()-L.timestamp.getTime()),[e]),W=h.useMemo(()=>ve.reduce((L,ne)=>{const N=Mn(ne.timestamp);return L[N]||(L[N]=[]),L[N].push(ne),L},{}),[ve]),C=h.useMemo(()=>{if(!ee)return null;const L=i1(ee);return Number.isNaN(L.getTime())?null:L},[ee]),q=C?W[ee]??[]:ve,X=Math.max(1,Math.ceil(q.length/Tn)),xe=h.useMemo(()=>{const L=(be-1)*Tn;return q.slice(L,L+Tn)},[q,be]),$=q.length===0?0:(be-1)*Tn+1,j=Math.min(be*Tn,q.length),k=q.length>Tn,z=C?jg(C):"Todas las comandas",P=()=>{H([]),ge([]),I(null)},Z=(L,ne,N,V)=>{N(ae=>ae.includes(L)?ae.filter(ie=>ie!==L):ae.length>=V?ae:[...ae,L])},me=L=>{I(ne=>ne===L?null:L)};h.useEffect(()=>{we()},[]),h.useEffect(()=>{be>X&&Se(X)},[be,X]);const we=async()=>{const L=await ye.fetchMenuItems();m(L)},De=(L,ne)=>{p(N=>{if(!N)return N;const V=N.items.findIndex(pe=>pe.item.id===L.id&&pe.customKey===(ne==null?void 0:ne.customKey));let ae;V>=0?ae=N.items.map((pe,Le)=>Le===V?{...pe,cantidad:pe.cantidad+1,precioUnitario:typeof pe.precioUnitario=="number"?pe.precioUnitario:L.precio}:pe):ae=[...N.items,{item:L,cantidad:1,notas:ne==null?void 0:ne.notas,customKey:ne==null?void 0:ne.customKey,bowlCustomization:ne==null?void 0:ne.bowlCustomization,precioUnitario:L.precio,studentDiscount:!1}];const ie=en(ae);return{...N,items:ae,total:ie}}),y(!1),x("")},Be=L=>{switch(L){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"preparando":return"bg-blue-100 text-blue-800 border-blue-200";case"listo":return"bg-green-100 text-green-800 border-green-200";case"entregado":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},He=L=>{switch(L){case"pendiente":return r.jsx(gs,{size:16});case"preparando":return r.jsx(gs,{size:16,className:"animate-pulse"});case"listo":return r.jsx(Bi,{size:16});case"entregado":return r.jsx(Bi,{size:16});default:return r.jsx(gs,{size:16})}},Ve=L=>{E(null),p({orderId:L.id,items:L.items.map(ne=>({...ne,precioUnitario:typeof ne.precioUnitario=="number"?ne.precioUnitario:ne.item.precio,studentDiscount:!!ne.studentDiscount})),total:en(L.items)})},et=(L,ne)=>{if(!f)return;const N=[...f.items];N[L]={...N[L],item:{...N[L].item,precio:ne},precioUnitario:ne};const V=en(N);p({...f,items:N,total:V})},it=(L,ne)=>{if(!f)return;if(ne<=0){xt(L);return}const N=[...f.items];N[L]={...N[L],cantidad:ne};const V=en(N);p({...f,items:N,total:V})},xt=L=>{if(!f)return;const ne=f.items.filter((V,ae)=>ae!==L),N=en(ne);p({...f,items:ne,total:N})},jt=L=>{if(!f)return;const ne=[...f.items];ne[L]={...ne[L],studentDiscount:!ne[L].studentDiscount};const N=en(ne);p({...f,items:ne,total:N})},$t=L=>{if(f){if(kx(L)){P(),F(L),y(!1),x("");return}De(L)}},Lt=()=>{if(!_||!ce||A.length<Ta||A.length>fs||R.length<Ma||R.length>ps)return;const L=[`Bases: ${A.join(", ")}`,`Toppings: ${R.join(", ")}`,`Protena: ${ce}`].join(`
`),ne=[_.id,[...A].sort().join("-"),[...R].sort().join("-"),ce].join("|");De(_,{notas:L,customKey:ne,bowlCustomization:{bases:A,toppings:R,proteina:ce}}),F(null),P()},_t=()=>{F(null),P()},M=A.length>=fs,re=R.length>=ps,fe=A.length>=Ta&&A.length<=fs&&R.length>=Ma&&R.length<=ps&&!!ce,ke=async()=>{if(!(!f||Q))try{J(!0),await s(f.orderId,{items:f.items,total:f.total}),p(null),y(!1),x("")}catch(L){console.error("Error updating order:",L),alert("Error al actualizar la orden")}finally{J(!1)}},Ie=()=>{p(null),y(!1),x(""),J(!1)},O=async L=>{if(!(D===L.id||!window.confirm(`Eliminar la comanda #${L.numero}? Esta accin no se puede deshacer.`)))try{le(L.id),await a(L.id),(f==null?void 0:f.orderId)===L.id&&Ie()}catch(N){console.error("Error al eliminar la comanda:",N),alert("No se pudo eliminar la comanda. Intntalo nuevamente.")}finally{le(null)}},v=(L,ne)=>{if(!((ne==null?void 0:ne.force)??!1)&&bs(L))return;const V=ne!=null&&ne.overrideItems?{...L,items:ne.overrideItems,total:ne.overrideTotal??en(ne.overrideItems)}:L;E(null),Ee(V)},w=()=>{se||Ee(null)},B=async L=>{if(_e)try{oe(!0),await n(_e,L),Ee(null)}catch(ne){console.error("Error al registrar el pago:",ne),alert("No se pudo registrar el pago. Intntalo nuevamente.")}finally{oe(!1)}},G=async L=>{if(_e)try{oe(!0),await i(_e,L),Ee(null)}catch(ne){console.error("Error al asignar la comanda a crdito de empleados:",ne),alert("No se pudo asignar el crdito. Intntalo nuevamente.")}finally{oe(!1)}},he=L=>{const ne=L.target.value;te(ne||Mn(new Date)),Se(1)},Te=()=>{Se(L=>Math.max(1,L-1))},Re=()=>{Se(L=>Math.min(X,L+1))},Oe=L=>{Se(L)},lt=L=>{E(ne=>ne===L?null:L)},yt=xs(g),Xt=u.filter(L=>{const ne=!yt||xs(L.nombre).includes(yt),N=L.inventarioCategoria!=="Inventariables";return ne&&N}),Ms=L=>{var qu,Gu,Ku,Qu,Yu;const ne=Ks(L),N=((qu=L.creditInfo)==null?void 0:qu.type)==="empleados";let V="";if(N){const Ue=(Ku=(Gu=L.creditInfo)==null?void 0:Gu.employeeName)==null?void 0:Ku.trim();Ue?V=`  ${Ue}`:(Qu=L.creditInfo)!=null&&Qu.employeeId&&(V=`  Empleado ${L.creditInfo.employeeId}`)}const ae=N?Math.max(0,Math.round(((Yu=L.creditInfo)==null?void 0:Yu.amount)??L.total)):0,ie=N?`Crdito empleados${V}  ${K(ae||L.total)}`:ho(ne,K),pe=bs(L),Le=qv(L),Ge=Le?pe?"Pago registrado":"Pago gestionado":"Pago pendiente",Vt=L.estado!=="pendiente",Zt=o&&Vt&&(pe||!N),_n=Vt&&(pe||!N||o),El=o&&L.estado==="entregado"&&(pe||N),Wu=pe&&o,Vu=D===L.id,ko=S===L.id,Xn=!!U[L.id];return r.jsxs("div",{className:"ui-card ui-card-pad hover:shadow-md transition-shadow duration-200",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start mb-4 space-y-2 lg:space-y-0",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("h3",{className:"text-lg lg:text-xl font-bold mb-1",style:{color:b.dark},children:["#",L.numero]}),r.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:Mu(L.timestamp)})]}),r.jsxs("div",{className:"flex items-center gap-2 self-start",children:[r.jsxs("span",{className:`px-2 lg:px-3 py-1 rounded-full text-xs lg:text-sm font-medium border flex items-center gap-1 ${Be(L.estado)}`,children:[He(L.estado),r.jsx("span",{className:"hidden lg:inline",children:L.estado})]}),L.estado==="entregado"&&El&&(f==null?void 0:f.orderId)!==L.id&&r.jsxs("button",{type:"button",onClick:()=>lt(L.id),className:`flex items-center gap-1 px-2.5 py-1.5 rounded-full text-xs lg:text-sm font-medium border transition-colors shadow-sm ${ko?"bg-blue-600 border-blue-600 text-white hover:bg-blue-700":"text-blue-600 border-blue-200 hover:border-blue-600 hover:bg-blue-600 hover:text-white"}`,title:ko?"Ocultar acciones":"Editar comanda","aria-pressed":ko,children:[r.jsx(zr,{size:14}),r.jsx("span",{className:"hidden sm:inline",children:"Editar"})]}),o&&r.jsx("button",{type:"button",onClick:()=>O(L),disabled:Vu,className:"p-1.5 rounded-full border border-transparent text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Eliminar comanda","aria-label":"Eliminar comanda",children:Vu?r.jsx(nt,{size:16,className:"animate-spin text-red-600"}):r.jsx(qn,{size:16})})]})]}),L.cliente&&r.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs lg:text-sm text-gray-600",children:[r.jsx(yg,{size:14}),r.jsx("span",{children:L.cliente})]}),r.jsx("div",{className:"flex flex-col gap-2 mb-4",children:r.jsxs("div",{className:"flex items-center justify-between text-xs lg:text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Os,{size:14}),r.jsx("span",{className:"text-left",children:ie})]}),r.jsx("span",{className:`px-2 py-1 rounded-full font-medium ${Le?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:Ge})]})}),(f==null?void 0:f.orderId)===L.id?r.jsxs("div",{className:"space-y-3 mb-4",children:[r.jsx("h4",{className:"font-semibold text-sm",children:"Editando pedido:"}),f.items.map((Ue,Ys)=>r.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:r.jsxs("div",{className:"flex flex-col space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("span",{className:"font-medium text-sm",children:Ue.item.nombre}),r.jsx("button",{onClick:()=>xt(Ys),className:"text-red-600 hover:text-red-800 p-1",children:r.jsx(qn,{size:14})})]}),Ue.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full w-fit",children:Hr}),r.jsxs("div",{className:"text-xs text-gray-600",children:["Precio unidad:"," ",Ue.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-2",children:K(on(Ue))}),r.jsx("span",{className:"font-semibold text-green-600",children:K(eo(Ue))})]}):r.jsx("span",{children:K(on(Ue))})]}),Ue.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:Ue.notas}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Cant:"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>it(Ys,Ue.cantidad-1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(Eu,{size:12})}),r.jsx("span",{className:"w-8 text-center text-sm",children:Ue.cantidad}),r.jsx("button",{onClick:()=>it(Ys,Ue.cantidad+1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(jn,{size:12})})]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Precio:"}),r.jsx("input",{type:"number",value:on(Ue),onChange:Mx=>et(Ys,Number(Mx.target.value)),className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded"})]})]}),qg(Ue.item)&&r.jsx("button",{onClick:()=>jt(Ys),className:`self-start inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium transition-colors ${Ue.studentDiscount?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:Ue.studentDiscount?"Quitar descuento":"Aplicar descuento estudiante"}),r.jsx("div",{className:"text-right",children:r.jsxs("span",{className:"text-sm font-medium",children:["Subtotal: ",K(to(Ue))]})})]})},Ys)),r.jsx("div",{className:"flex flex-col lg:flex-row gap-2",children:r.jsxs("button",{onClick:()=>y(!0),disabled:Q,className:"flex-1 py-2 px-3 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(jn,{size:14}),"Agregar producto"]})}),r.jsxs("div",{className:"border-t pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("span",{className:"font-bold",children:"Nuevo Total:"}),r.jsx("span",{className:"font-bold text-lg",style:{color:b.accent},children:K(f.total)})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[_n&&r.jsxs("button",{onClick:()=>v(L,{force:pe,overrideItems:f.items,overrideTotal:f.total}),disabled:Q||pe&&!o,className:"w-full py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Os,{size:14}),pe?"Modificar pago":"Registrar pago"]}),_n&&Wu&&r.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:"Al guardar se restablecer el estado del pago actual."}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:ke,disabled:Q,className:"flex-1 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:Q?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:14,className:"animate-spin"}),"Guardando..."]}):r.jsxs(r.Fragment,{children:[r.jsx(mg,{size:14}),"Guardar"]})}),r.jsxs("button",{onClick:Ie,disabled:Q,className:"flex-1 py-2 bg-gray-400 text-white rounded-lg text-sm font-medium hover:bg-gray-500 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Ur,{size:14}),"Cancelar"]})]})]})]})]}):r.jsx("div",{className:"space-y-2 mb-4",children:L.items.map((Ue,Ys)=>r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between items-center text-xs lg:text-sm",children:[r.jsxs("span",{children:[Ue.cantidad,"x ",Ue.item.nombre]}),r.jsx("span",{className:"font-medium",children:K(to(Ue))})]}),r.jsxs("div",{className:"text-[11px] lg:text-xs text-gray-600",children:["Precio unidad:"," ",Ue.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-1",children:K(on(Ue))}),r.jsx("span",{className:"font-semibold text-green-600",children:K(eo(Ue))})]}):r.jsx("span",{children:K(on(Ue))})]}),Ue.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full",children:Hr}),Ue.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:Ue.notas})]},Ys))}),(f==null?void 0:f.orderId)!==L.id&&r.jsxs(em.Fragment,{children:[r.jsx("div",{className:"border-t pt-3 mb-4",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-bold",children:"Total:"}),r.jsx("span",{className:"font-bold text-lg",style:{color:b.accent},children:K(L.total)})]})}),r.jsx("div",{className:"space-y-2",children:L.estado==="entregado"?r.jsx("div",{className:"space-y-2",children:pe?ko&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("button",{onClick:()=>Ve(L),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),r.jsxs("button",{onClick:()=>v(L,{force:pe}),disabled:!o,className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:[r.jsx(Os,{size:14}),"Modificar pago"]}),Wu&&r.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:"Al guardar los cambios se restablecer el estado del pago."})]}):N?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg text-xs text-yellow-800",children:[r.jsxs("p",{className:"font-semibold",children:["Crdito de empleados en seguimiento",V]}),r.jsx("p",{className:"mt-1 text-[11px] text-yellow-700",children:"Gestiona el cobro desde el mdulo Crdito empleados cuando el colaborador realice el pago."})]}),o&&r.jsxs("button",{onClick:()=>v(L),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Os,{size:14}),"Gestionar crdito"]})]}):r.jsxs("div",{className:"space-y-2",children:[Zt&&r.jsx("button",{onClick:()=>Ve(L),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),r.jsxs("button",{onClick:()=>v(L),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Os,{size:14}),"Registrar pago"]})]})}):r.jsxs(em.Fragment,{children:[L.estado==="pendiente"&&r.jsx("button",{onClick:()=>ue(L,"preparando"),disabled:Xn,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:b.dark},children:Xn?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:16,className:"animate-spin"}),"Procesando..."]}):"Iniciar preparacin"}),L.estado==="preparando"&&r.jsx("button",{onClick:()=>ue(L,"listo"),disabled:Xn,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:b.accent,color:b.dark},children:Xn?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:16,className:"animate-spin"}),"Procesando..."]}):"Marcar como listo"}),L.estado==="listo"&&r.jsx("button",{onClick:()=>ue(L,"entregado"),disabled:Xn,className:"w-full py-2 bg-green-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Xn?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:16,className:"animate-spin"}),"Procesando..."]}):"Entregar pedido"}),Vt&&r.jsxs("div",{className:"space-y-2 mt-2",children:[Zt&&r.jsx("button",{onClick:()=>Ve(L),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),N?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg text-xs text-yellow-800",children:[r.jsxs("p",{className:"font-semibold",children:["Crdito de empleados en seguimiento",V]}),r.jsx("p",{className:"mt-1 text-[11px] text-yellow-700",children:"Gestiona el cobro desde el mdulo Crdito empleados cuando el colaborador realice el pago."})]}),o&&r.jsxs("button",{onClick:()=>v(L),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Os,{size:14}),"Gestionar crdito"]})]}):_n&&r.jsxs("button",{onClick:()=>v(L,pe?{force:!0}:void 0),disabled:pe&&!o,className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Os,{size:14}),pe?"Modificar pago":"Registrar pago"]})]})]})})]})]},L.id)};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:b.dark},children:"Gestin de Comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Control de pedidos y estado de preparacin"})]}),d&&!c&&r.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[r.jsx(nt,{size:16,className:"animate-spin"}),r.jsx("span",{children:"Sincronizando cambios"})]}),c?r.jsxs("div",{className:"ui-card ui-card-pad text-center",children:[r.jsx(nt,{size:40,className:"mx-auto text-gray-400 mb-4 animate-spin"}),r.jsx("h3",{className:"text-lg lg:text-xl font-semibold text-gray-600 mb-2",children:"Cargando comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Estamos obteniendo la informacin ms reciente."})]}):e.length===0?r.jsxs("div",{className:"ui-card ui-card-pad text-center",children:[r.jsx(gs,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg lg:text-xl font-semibold text-gray-600 mb-2",children:"No hay comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Los pedidos aparecern aqu cuando se procesen desde caja"})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:C?`Comandas del ${z}`:z}),r.jsxs("p",{className:"text-sm text-gray-500",children:[q.length===1?"1 comanda registrada":`${q.length} comandas registradas`,q.length>0&&k&&r.jsx("span",{children:`  Mostrando ${$}-${j}`})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:[r.jsx("label",{htmlFor:"comandas-date-picker",className:"text-sm font-medium text-gray-600",children:"Selecciona el da"}),r.jsx("input",{id:"comandas-date-picker",type:"date",value:ee,onChange:he,max:Mn(new Date),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-400"})]})]}),q.length===0?r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500",children:"No hay comandas registradas para esta fecha."}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6",children:xe.map(Ms)}),k&&r.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[r.jsx("button",{type:"button",onClick:Te,className:"px-3 py-1.5 rounded-full border text-sm font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",disabled:be===1,children:"Anterior"}),r.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:X},(L,ne)=>ne+1).map(L=>{const ne=L===be;return r.jsx("button",{type:"button",onClick:()=>Oe(L),className:`w-9 h-9 rounded-full border text-sm font-medium transition-colors ${ne?"shadow-sm":"hover:border-gray-300"}`,style:ne?{backgroundColor:b.accent,color:b.dark,borderColor:b.accent}:void 0,"aria-current":ne?"page":void 0,children:L},L)})}),r.jsx("button",{type:"button",onClick:Re,className:"px-3 py-1.5 rounded-full border text-sm font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",disabled:be===X,children:"Siguiente"})]})]})]}),_e&&r.jsx(Sx,{order:_e,onClose:w,onSubmit:B,isSubmitting:se,title:"Gestionar pago",onAssignCredit:G}),T&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:b.dark},children:"Agregar Producto"}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:g,onChange:L=>x(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent mb-4 text-sm",style:{"--tw-ring-color":b.accent}}),r.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4",children:Xt.slice(0,10).map(L=>r.jsx("button",{onClick:()=>$t(L),className:"w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-sm",children:L.nombre}),r.jsx("p",{className:"text-xs text-gray-600",children:L.categoria})]}),r.jsx("span",{className:"font-bold text-sm",style:{color:b.accent},children:K(L.precio)})]})},L.id))}),r.jsx("button",{onClick:()=>{y(!1),x("")},className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm",children:"Cancelar"})]})}),_&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:b.dark},children:"Personaliza tu Bowl Salado"}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tus bases"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[A.length,"/",fs]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:jx.map(L=>{const ne=A.includes(L),N=!ne&&M;return r.jsxs("button",{type:"button",onClick:()=>Z(L,A,H,fs),disabled:N,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${ne?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${N?"opacity-50 cursor-not-allowed":""}`,style:ne?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:L}),ne&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},L)})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tus toppings"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[R.length,"/",ps]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:wx.map(L=>{const ne=R.includes(L),N=!ne&&re;return r.jsxs("button",{type:"button",onClick:()=>Z(L,R,ge,ps),disabled:N,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${ne?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${N?"opacity-50 cursor-not-allowed":""}`,style:ne?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:L}),ne&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},L)})})]}),r.jsxs("div",{children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("h4",{className:"text-sm font-semibold",style:{color:b.dark},children:"Elige tu protena"})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:Nx.map(L=>{const ne=ce===L;return r.jsxs("button",{type:"button",onClick:()=>me(L),className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${ne?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"}`,style:ne?{backgroundColor:b.beige,color:b.dark,borderColor:b.accent}:void 0,children:[r.jsx("span",{children:L}),ne&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:b.accent,color:b.dark},children:r.jsx(Tr,{size:16})})]},L)})})]})]}),r.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 sm:justify-end border-t pt-4",children:[r.jsx("button",{onClick:_t,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{onClick:Lt,disabled:!fe,className:"px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:b.dark},children:"Agregar al pedido"})]})]})})]})}function c1({menuItems:e,onUpdateMenuItem:t,onCreateMenuItem:s,onDeleteMenuItem:n,isLoading:a}){const[o,i]=h.useState(""),[l,c]=h.useState(""),[d,u]=h.useState("all"),[m,f]=h.useState(null),[p,S]=h.useState(null);if(a)return r.jsx("section",{className:"space-y-6 sm:space-y-8",children:r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600 text-sm",children:[r.jsx(nt,{size:18,className:"animate-spin text-gray-500"}),r.jsx("span",{children:"Cargando inventario..."})]})});const E=h.useMemo(()=>Array.from(new Set(e.filter(I=>I.inventarioCategoria==="Inventariables").map(I=>I.categoria))),[e]),T=h.useMemo(()=>Array.from(new Set(e.filter(I=>I.inventarioCategoria!=="Inventariables").map(I=>I.categoria))),[e]);h.useEffect(()=>{l&&!T.includes(l)&&c("")},[T,l]);const y=xs(o),g=e.filter(I=>{const ee=!y||xs(I.nombre).includes(y),te=!l||I.categoria===l,be=d==="all"||d==="inventariables"&&I.inventarioCategoria==="Inventariables"||d==="no-inventariables"&&I.inventarioCategoria==="No inventariables";return ee&&te&&be}),x=g.filter(I=>I.inventarioCategoria==="Inventariables"),_=g.filter(I=>I.inventarioCategoria!=="Inventariables"),F=g.filter(I=>(I.stock??0)<10),A=g.filter(I=>(I.stock??0)===0),H=(I,ee)=>{const te=e.find(be=>be.id===I);if(te){const be=Math.max(0,(te.stock??0)+ee);t({...te,stock:be})}},R=()=>{m&&(t(m),f(null))},ge=()=>{if(p){const I=vg(p.nombre,p.categoria);s({id:crypto.randomUUID(),codigo:I,nombre:p.nombre,precio:p.precio??0,categoria:p.categoria,stock:p.stock??0,descripcion:p.descripcion,inventarioCategoria:p.inventarioCategoria,inventarioTipo:p.inventarioCategoria==="Inventariables"?p.inventarioTipo:void 0,unidadMedida:p.inventarioCategoria==="Inventariables"&&p.inventarioTipo==="gramos"?p.unidadMedida:void 0}),S(null)}},ce=I=>r.jsx("div",{className:`ui-card ui-card-pad transition-all duration-200 hover:shadow-md border ${I.stock===0?"border-red-200":I.stock<10?"border-yellow-200":"border-gray-100"}`,children:(m==null?void 0:m.id)===I.id?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{className:"border border-gray-300 rounded px-3 py-2",placeholder:"Nombre",value:m.nombre,onChange:ee=>f({...m,nombre:ee.target.value})}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:"Precio (ej. 8500)",value:m.precio===0?"":m.precio,onChange:ee=>{const te=parseInt(ee.target.value,10);f({...m,precio:isNaN(te)?0:te})}}),r.jsx("input",{list:m.inventarioCategoria==="Inventariables"?"inventariable-category-options":"non-inventariable-category-options",className:"border border-gray-300 rounded px-3 py-2",placeholder:"Categora (selecciona o crea)",value:m.categoria,onChange:ee=>f({...m,categoria:ee.target.value})}),r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.inventarioCategoria,onChange:ee=>f({...m,inventarioCategoria:ee.target.value}),children:[r.jsx("option",{value:"Inventariables",children:"Inventariables"}),r.jsx("option",{value:"No inventariables",children:"No inventariables"})]}),m.inventarioCategoria==="Inventariables"&&r.jsxs(r.Fragment,{children:[r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.inventarioTipo??"cantidad",onChange:ee=>f({...m,inventarioTipo:ee.target.value}),children:[r.jsx("option",{value:"cantidad",children:"Cantidad"}),r.jsx("option",{value:"gramos",children:"Gramos"})]}),m.inventarioTipo==="gramos"&&r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.unidadMedida??"kg",onChange:ee=>f({...m,unidadMedida:ee.target.value}),children:[r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"mg",children:"mg"}),r.jsx("option",{value:"ml",children:"ml"})]}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:m.inventarioTipo==="gramos"?"Peso (ej. 10)":"Cantidad (ej. 10)",value:m.stock===0?"":m.stock,onChange:ee=>{const te=parseInt(ee.target.value,10);f({...m,stock:isNaN(te)?0:te})}})]}),r.jsx("textarea",{className:"border border-gray-300 rounded px-3 py-2 md:col-span-2",placeholder:"Descripcin (opcional)",value:m.descripcion||"",onChange:ee=>f({...m,descripcion:ee.target.value})})]}),r.jsxs("div",{className:"mt-4 flex gap-2",children:[r.jsx("button",{onClick:R,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Guardar"}),r.jsx("button",{onClick:()=>f(null),className:"px-3 py-1 bg-gray-400 text-white rounded text-sm hover:bg-gray-500",children:"Cancelar"})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-lg mb-1",style:{color:b.dark},children:I.nombre}),r.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[I.categoria,"  ",I.inventarioCategoria??"No inventariables"]}),r.jsx("p",{className:"text-sm font-medium",style:{color:b.accent},children:K(I.precio)})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${I.stock===0?"bg-red-100 text-red-800":I.stock<10?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,title:"Stock disponible",children:[r.jsx(md,{size:12}),r.jsxs("span",{children:["Stock: ",I.stock??0,I.inventarioTipo==="gramos"&&I.unidadMedida?` ${I.unidadMedida}`:""]})]})})]}),I.descripcion&&r.jsx("p",{className:"text-sm text-gray-500 mb-4 line-clamp-2",children:I.descripcion}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>H(I.id,-1),disabled:(I.stock??0)===0,className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 disabled:opacity-50",children:r.jsx(Eu,{size:14})}),r.jsx("button",{onClick:()=>H(I.id,1),className:"w-8 h-8 rounded-full flex items-center justify-center text-white hover:opacity-90",style:{backgroundColor:b.dark},children:r.jsx(jn,{size:14})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:()=>f(I),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:[r.jsx(zr,{size:14})," Editar"]}),r.jsxs("button",{onClick:()=>n(I.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-red-600 hover:text-red-800",children:[r.jsx(Tv,{size:14})," Eliminar"]})]})]})]})},I.id);return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsx("datalist",{id:"inventariable-category-options",children:E.map(I=>r.jsx("option",{value:I},`inventariable-${I}`))}),r.jsx("datalist",{id:"non-inventariable-category-options",children:T.map(I=>r.jsx("option",{value:I},`non-inventariable-${I}`))}),r.jsxs("div",{className:"text-center px-2 sm:px-0",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:b.dark},children:"Control de Inventario"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Gestin de stock y alertas de productos"})]}),(F.length>0||A.length>0)&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.length>0&&r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg lg:rounded-xl p-3 lg:p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Rr,{size:20,className:"text-red-600"}),r.jsxs("h3",{className:"font-semibold text-red-800 text-sm lg:text-base",children:["Sin stock (",A.length,")"]})]}),r.jsxs("div",{className:"space-y-1",children:[A.slice(0,3).map(I=>r.jsx("p",{className:"text-sm text-red-700",children:I.nombre},I.id)),A.length>3&&r.jsxs("p",{className:"text-sm text-red-600",children:["y ",A.length-3," ms..."]})]})]}),F.length>0&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg lg:rounded-xl p-3 lg:p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Rr,{size:20,className:"text-yellow-600"}),r.jsxs("h3",{className:"font-semibold text-yellow-800 text-sm lg:text-base",children:["Stock bajo (",F.length,")"]})]}),r.jsxs("div",{className:"space-y-1",children:[F.slice(0,3).map(I=>r.jsxs("p",{className:"text-sm text-yellow-700",children:[I.nombre," (",I.stock,I.inventarioTipo==="gramos"&&I.unidadMedida?` ${I.unidadMedida}`:"",")"]},I.id)),F.length>3&&r.jsxs("p",{className:"text-sm text-yellow-600",children:["y ",F.length-3," ms..."]})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx(hg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:o,onChange:I=>i(I.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600",children:[r.jsx(dg,{size:16,className:"text-gray-500"}),r.jsx("span",{children:"Tipo:"})]}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4 w-full sm:w-auto",children:[r.jsxs("select",{value:d,onChange:I=>u(I.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full sm:w-auto",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"all",children:"Todos"}),r.jsx("option",{value:"inventariables",children:"Inventariables"}),r.jsx("option",{value:"no-inventariables",children:"No inventariables"})]}),r.jsxs("select",{value:l,onChange:I=>c(I.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full sm:w-auto",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Todas las categoras"}),T.map(I=>r.jsx("option",{value:I,children:I},I))]})]}),r.jsx("div",{className:"sm:ml-auto w-full sm:w-auto",children:r.jsxs("button",{onClick:()=>S({nombre:"",precio:null,categoria:"",inventarioCategoria:"No inventariables",inventarioTipo:"cantidad",unidadMedida:"kg",stock:null,descripcion:""}),className:"flex w-full sm:w-auto items-center justify-center gap-2 px-4 py-2 rounded-lg text-white text-sm font-medium shadow-sm",style:{backgroundColor:b.accent},children:[r.jsx(jn,{size:16})," Agregar producto"]})})]})]}),p&&r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{className:"border border-gray-300 rounded px-3 py-2",placeholder:"Nombre",value:p.nombre,onChange:I=>S({...p,nombre:I.target.value})}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:"Precio (ej. 8500)",value:p.precio??"",onChange:I=>{const ee=parseInt(I.target.value,10);S({...p,precio:isNaN(ee)?null:ee})}}),r.jsx("input",{list:p.inventarioCategoria==="Inventariables"?"inventariable-category-options":"non-inventariable-category-options",className:"border border-gray-300 rounded px-3 py-2",placeholder:"Categora (selecciona o crea)",value:p.categoria,onChange:I=>S({...p,categoria:I.target.value})}),r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:p.inventarioCategoria,onChange:I=>S({...p,inventarioCategoria:I.target.value}),children:[r.jsx("option",{value:"Inventariables",children:"Inventariables"}),r.jsx("option",{value:"No inventariables",children:"No inventariables"})]}),p.inventarioCategoria==="Inventariables"&&r.jsxs(r.Fragment,{children:[r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:p.inventarioTipo,onChange:I=>S({...p,inventarioTipo:I.target.value}),children:[r.jsx("option",{value:"cantidad",children:"Cantidad"}),r.jsx("option",{value:"gramos",children:"Gramos"})]}),p.inventarioTipo==="gramos"&&r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:p.unidadMedida,onChange:I=>S({...p,unidadMedida:I.target.value}),children:[r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"mg",children:"mg"}),r.jsx("option",{value:"ml",children:"ml"})]}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:p.inventarioTipo==="gramos"?"Peso (ej. 10)":"Cantidad (ej. 10)",value:p.stock??"",onChange:I=>{const ee=parseInt(I.target.value,10);S({...p,stock:isNaN(ee)?null:ee})}})]}),r.jsx("textarea",{className:"border border-gray-300 rounded px-3 py-2 lg:col-span-2",placeholder:"Descripcin (opcional)",value:p.descripcion||"",onChange:I=>S({...p,descripcion:I.target.value})})]}),r.jsxs("div",{className:"mt-4 flex gap-2",children:[r.jsx("button",{onClick:ge,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Guardar"}),r.jsx("button",{onClick:()=>S(null),className:"px-3 py-1 bg-gray-400 text-white rounded text-sm hover:bg-gray-500",children:"Cancelar"})]})]}),r.jsxs("div",{className:"space-y-8",children:[x.length>0&&(d==="all"||d==="inventariables")&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-xl font-semibold mb-4",style:{color:b.dark},children:["Inventariables (",x.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.map(ce)})]}),_.length>0&&(d==="all"||d==="no-inventariables")&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-xl font-semibold mb-4",style:{color:b.dark},children:["No inventariables (",_.length,")"]}),Array.from(new Set(_.map(I=>I.categoria))).map(I=>{const ee=_.filter(te=>te.categoria===I);return r.jsxs("div",{className:"mb-8",children:[r.jsxs("h4",{className:"text-lg font-medium mb-3 text-gray-700 border-b border-gray-200 pb-2",children:[I," (",ee.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ee.map(ce)})]},I)})]}),g.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(md,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No se encontraron productos"}),r.jsx("p",{className:"text-gray-500",children:"Intenta ajustar los filtros de bsqueda"})]})]})]})}function d1({orders:e,onUpdateOrderStatus:t}){const[s,n]=h.useState({}),a=async(d,u)=>{if(!s[d.id]){n(m=>({...m,[d.id]:!0}));try{await t(d,u)}finally{n(m=>{const{[d.id]:f,...p}=m;return p})}}},o=e.filter(d=>d.estado==="pendiente"||d.estado==="preparando").sort((d,u)=>d.timestamp.getTime()-u.timestamp.getTime()),i=e.filter(d=>d.estado==="listo").sort((d,u)=>u.timestamp.getTime()-d.timestamp.getTime()),l=d=>{const u=Math.floor((Date.now()-d.getTime())/6e4);return u<1?"Recin llegado":u===1?"1 minuto":`${u} minutos`},c=d=>{const u=Math.floor((Date.now()-d.getTime())/6e4);return u>15?"urgent":u>10?"warning":"normal"};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:b.dark},children:"Mdulo de Cocina"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Vista de preparacin y seguimiento de pedidos"})]}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[r.jsx("div",{className:"xl:col-span-2 space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(cd,{size:24,style:{color:b.dark}}),r.jsxs("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:["En preparacin (",o.length,")"]})]}),o.length===0?r.jsxs("div",{className:"text-center py-8 lg:py-12",children:[r.jsx(cd,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h4",{className:"text-base lg:text-lg font-semibold text-gray-600 mb-2",children:"No hay pedidos pendientes"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Los nuevos pedidos aparecern aqu"})]}):r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:o.map(d=>{const u=!!s[d.id],m=c(d.timestamp);return r.jsxs("div",{className:`border rounded-xl p-3 sm:p-4 transition-all duration-200 ${m==="urgent"?"border-red-300 bg-red-50":m==="warning"?"border-yellow-300 bg-yellow-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{children:[r.jsxs("h4",{className:"text-base lg:text-lg font-bold",style:{color:b.dark},children:["#",d.numero]}),r.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[r.jsx(gs,{size:14}),r.jsx("span",{children:l(d.timestamp)})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[m==="urgent"&&r.jsx(iv,{size:16,className:"text-red-600"}),m==="warning"&&r.jsx(gs,{size:16,className:"text-yellow-600"}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d.estado==="preparando"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:d.estado})]})]}),d.cliente&&r.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Cliente: ",d.cliente]}),r.jsx("div",{className:"space-y-2 mb-4",children:d.items.map((f,p)=>r.jsx("div",{className:"flex justify-between items-center text-sm",children:r.jsxs("span",{className:"font-medium",children:[f.cantidad,"x ",f.item.nombre]})},p))}),r.jsxs("div",{className:"space-y-2",children:[d.estado==="pendiente"&&r.jsx("button",{onClick:()=>a(d,"preparando"),disabled:u,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:b.dark},children:u?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:16,className:"animate-spin"}),"Procesando..."]}):"Iniciar preparacin"}),d.estado==="preparando"&&r.jsx("button",{onClick:()=>a(d,"listo"),disabled:u,className:"w-full py-2 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:b.accent,color:b.dark},children:u?r.jsxs(r.Fragment,{children:[r.jsx(nt,{size:16,className:"animate-spin"}),"Procesando..."]}):"Marcar como listo"})]})]},d.id)})})]})}),r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Bi,{size:24,className:"text-green-600"}),r.jsxs("h3",{className:"text-lg lg:text-xl font-bold",style:{color:b.dark},children:["Listos (",i.length,")"]})]}),i.length===0?r.jsx("p",{className:"text-gray-500 text-center py-6 lg:py-8 text-sm",children:"No hay pedidos listos"}):r.jsx("div",{className:"space-y-3",children:i.map(d=>r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 lg:p-4",children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsxs("h4",{className:"font-bold text-green-800 text-sm lg:text-base",children:["#",d.numero]}),r.jsx("span",{className:"text-xs text-green-600",children:Mu(d.timestamp)})]}),d.cliente&&r.jsx("p",{className:"text-sm text-green-700 mb-2",children:d.cliente}),r.jsxs("div",{className:"text-sm text-green-700",children:[d.items.length," ",d.items.length===1?"producto":"productos"]})]},d.id))})]})})]})]})}function u1({customers:e,onAddCustomer:t,onUpdateCustomer:s,onDeleteCustomer:n}){const[a,o]=h.useState(""),[i,l]=h.useState(""),[c,d]=h.useState(null),u=()=>{if(!a.trim()||!i.trim())return;const p=a.trim(),S=i.trim();c?s({id:c,nombre:p,telefono:S}):t({id:crypto.randomUUID(),nombre:p,telefono:S}),o(""),l(""),d(null)},m=p=>{d(p.id),o(p.nombre),l(p.telefono)},f=()=>{d(null),o(""),l("")};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Fr,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Clientes"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-stretch",children:[r.jsx("div",{className:"flex-1",children:r.jsx("input",{type:"text",placeholder:"Nombre",value:a,onChange:p=>o(p.target.value),className:"w-full px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent}})}),r.jsx("div",{className:"flex-1",children:r.jsx("input",{type:"tel",placeholder:"Telfono",value:i,onChange:p=>l(p.target.value),className:"w-full px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":b.accent}})}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full lg:w-auto",children:[r.jsx("button",{onClick:u,className:"px-3 lg:px-4 py-2 rounded-lg text-white font-medium text-sm w-full",style:{backgroundColor:b.dark},children:c?"Actualizar":"Agregar"}),c&&r.jsx("button",{onClick:f,className:"px-3 lg:px-4 py-2 rounded-lg border border-gray-300 text-sm w-full",children:"Cancelar"})]})]}),r.jsx("div",{className:"ui-card",children:r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table border border-gray-200 rounded-lg",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-50",children:[r.jsx("th",{className:"px-3 lg:px-4 py-2 text-left text-sm font-semibold text-gray-700",children:"Nombre"}),r.jsx("th",{className:"px-3 lg:px-4 py-2 text-left text-sm font-semibold text-gray-700",children:"Telfono"}),r.jsx("th",{className:"px-3 lg:px-4 py-2"})]})}),r.jsxs("tbody",{children:[e.map(p=>r.jsxs("tr",{className:"border-t",children:[r.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm",children:p.nombre}),r.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm",children:p.telefono}),r.jsxs("td",{className:"px-3 lg:px-4 py-2 flex gap-2",children:[r.jsx("button",{onClick:()=>m(p),className:"p-1 rounded hover:bg-gray-100",children:r.jsx(zr,{size:16})}),r.jsx("button",{onClick:()=>n(p.id),className:"p-1 rounded hover:bg-gray-100 text-red-600",children:r.jsx(qn,{size:16})})]})]},p.id)),e.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:3,className:"px-3 lg:px-4 py-4 text-center text-gray-500 text-sm",children:"No hay clientes registrados"})})]})]})})})]})}const pt=[...fo],Dd={monday:"Lunes",tuesday:"Martes",wednesday:"Mircoles",thursday:"Jueves",friday:"Viernes",saturday:"Sbado",sunday:"Domingo"},Hu=e=>{const t=new Date(e.getTime());t.setHours(0,0,0,0);const s=t.getDay()||7;t.setDate(t.getDate()+4-s);const n=new Date(t.getFullYear(),0,1),a=Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7);return`${t.getFullYear()}-W${a.toString().padStart(2,"0")}`},Fs=()=>Hu(new Date),Wr=e=>{const[t,s]=e.split("-W"),n=Number(t),a=Number(s),o=new Date(n,0,4),i=o.getDay()||7,l=new Date(o);return l.setDate(o.getDate()+(a-1)*7-(i-1)),l.setHours(0,0,0,0),l},m1=e=>{const t=new Date(e);return t.setDate(t.getDate()+6),t},Pa=e=>{try{const t=Wr(e),s=m1(t),n=new Intl.DateTimeFormat("es-ES",{day:"numeric",month:"short"});return`${n.format(t)} - ${n.format(s)}`}catch(t){return console.warn("No se pudo formatear la semana seleccionada",t),e}},Dh=(e,t)=>pt.every(s=>{var n,a,o,i;return((n=e[s])==null?void 0:n.active)===((a=t[s])==null?void 0:a.active)&&Number(((o=e[s])==null?void 0:o.hours)??0)===Number(((i=t[s])==null?void 0:i.hours)??0)}),_x=e=>{const t={};return pt.forEach((s,n)=>{const a=n<e.dias_semana;t[s]={active:a,hours:a?e.horas_dia:0}}),t},Da=(e,t)=>{const s=_x(e);if(!t)return s;const n={};return pt.forEach(a=>{const o=t[a];o?n[a]={active:!!o.active,hours:o.active?Math.max(0,Number(o.hours)||0):0}:n[a]=s[a]}),n},Fn=e=>{const t={};return pt.forEach(s=>{t[s]=e[s].active?e[s].hours:0}),t},_s=e=>pt.reduce((t,s)=>t+(Number(e[s])||0),0),ht=e=>{const t=Number.isNaN(e)?0:e;return Math.abs(t%1)<.01?`${Math.round(t)}`:t.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:2})},Ia=e=>{if(Math.abs(e)<.01)return"Sin variacin";const t=ht(Math.abs(e));return`${e>0?"+":"-"}${t} h vs base`},h1=(e,t)=>pt.every(s=>Math.abs((e[s]??0)-(t[s]??0))<.01),hc=e=>{const t={};return pt.forEach(s=>{t[s]=Number(e[s])||0}),t},f1=1423500,p1=220,Ih=44,g1=2e5,Cx=f1/p1,x1=Cx*1.25,y1=g1/30,fc=e=>Number.isFinite(e)?Math.round(e):0,Oh=e=>{const t=e.trim().toLowerCase();if(!t)return null;const s=t.match(/\b(am|pm)\b/),n=s?s[1]:null,o=t.replace(/\b(am|pm)\b/g,"").trim().match(/^(\d{1,2})(?::(\d{1,2}))?$/);if(!o)return null;let i=Number(o[1]);const l=Number(o[2]??"0");if(Number.isNaN(i)||Number.isNaN(l)||l>=60)return null;if(n)i===12?i=n==="am"?0:12:n==="pm"&&(i+=12);else if(i>23)return null;return i+l/60},v1=e=>{if(!e)return null;const s=e.replace(/[]/g,"-").replace(/\s+/g," ").trim().split(/\s*-\s*/);if(s.length!==2)return null;const[n,a]=s,o=/\b(am|pm)\b/i.test(n)&&/\b(am|pm)\b/i.test(a),i=Oh(n),l=Oh(a);if(i===null||l===null)return null;let c=l-i;if(c<0)if(o)c+=24;else return null;return c<=0||c>24?null:Math.round(c*100)/100},Ah=e=>{const t=e.trim();if(!t)return null;const s=v1(t);if(s!==null)return s;const n=Number(t.replace(",","."));return!Number.isFinite(n)||Number.isNaN(n)?null:Math.round(Math.max(0,n)*100)/100},$h=e=>{const t=_s(e),s=Math.min(t,Ih),n=Math.max(0,t-Ih),a=fc(s*Cx),o=fc(n*x1),i=pt.reduce((d,u)=>Number(e[u]??0)>0?d+1:d,0),l=fc(i*y1),c=a+o+l;return{totalHours:t,regularHours:s,overtimeHours:n,basePay:a,overtimePay:o,transport:l,totalPay:c,daysWorked:i}};function b1(){const[e,t]=h.useState([]),[s,n]=h.useState({}),[a,o]=h.useState({}),[i,l]=h.useState({}),[c,d]=h.useState(Fs()),[u,m]=h.useState({}),[f,p]=h.useState({}),[S,E]=h.useState(!0),[T,y]=h.useState(!1),[g,x]=h.useState(null),[_,F]=h.useState({}),A=h.useRef({}),H=h.useRef(!0);h.useEffect(()=>()=>{H.current=!1},[]);const R=h.useCallback(D=>{const le=A.current[D];le&&(window.clearTimeout(le),delete A.current[D])},[]);h.useEffect(()=>{let D=!0;return(async()=>{try{E(!0);const[U,Y]=await Promise.all([ye.fetchEmpleados(),ye.fetchEmployeeBaseSchedules()]);if(!D)return;t(U);const ue={};U.forEach(ve=>{const W=Y==null?void 0:Y[ve.id];W&&(ue[ve.id]=W)}),n(ue)}catch(U){console.error("No se pudieron cargar los empleados o los horarios base:",U),D&&x("No se pudo cargar la informacin inicial de empleados.")}finally{D&&E(!1)}})(),()=>{D=!1,Object.values(A.current).forEach(U=>window.clearTimeout(U)),A.current={}}},[R]),h.useEffect(()=>{e.length===0&&(o({}),m({}),p({}),F({}),l({}))},[e]);const ge=h.useCallback(D=>{if(!D)return"Sin turno registrado";const le=Rt(D.horaLlegada),U=D.horaSalida?Rt(D.horaSalida):"pendiente";let Y=`Entrada ${le}  Salida ${U}`;return D.novedad&&D.novedadInicio&&(Y+=D.novedadFin?`  Novedad ${Rt(D.novedadInicio)}-${Rt(D.novedadFin)}`:`  Novedad ${Rt(D.novedadInicio)} (en curso)`),Y},[]),ce=h.useCallback(D=>{if(!D)return"Sin turno registrado";const le=[`Entrada: ${Rt(D.horaLlegada)}`,`Salida: ${D.horaSalida?Rt(D.horaSalida):"pendiente"}`];if(D.novedad&&D.novedadInicio){const U=D.novedadFin?`${Rt(D.novedadInicio)}  ${Rt(D.novedadFin)}`:`${Rt(D.novedadInicio)} (en curso)`;le.push(`Novedad: ${U}`)}return typeof D.horasTrabajadas=="number"&&le.push(`Horas: ${ht(D.horasTrabajadas)} h`),le.join(`
`)},[]),I=h.useCallback(async D=>{if(!D)return{};try{const le=Wr(D),U=new Date(le.getTime());U.setDate(U.getDate()+6);const Y=ze(new Date(le.getTime())),ue=ze(U),ve=await ye.fetchEmployeeShiftsBetween(Y,ue),W={};return ve.forEach(C=>{const[q,X,xe]=C.fecha.split("-"),$=Number(q),j=Number(X)-1,k=Number(xe);if([$,j,k].some(et=>Number.isNaN(et)))return;const z=new Date($,j,k);z.setHours(0,0,0,0);const P=Math.floor((z.getTime()-le.getTime())/864e5);if(P<0||P>=pt.length)return;const Z=pt[P],me=W[C.empleadoId]??(W[C.empleadoId]={}),we=me[Z];if(!we){me[Z]=C;return}const De=!!we.horaSalida,Be=!!C.horaSalida,He=we.horaLlegada??"",Ve=C.horaLlegada??"";if(!De&&Be){me[Z]=C;return}Ve>=He&&(me[Z]=C)}),W}catch(le){return console.error("No se pudieron cargar los turnos de la semana:",le),{}}},[]),ee=h.useCallback(async(D,le={})=>{if(!D||!H.current)return;const{preserveEdits:U=!1}=le;U||(y(!0),x(null));try{const[Y,ue]=await Promise.all([ye.fetchEmployeeWeeklyHoursForWeek(D),I(D)]);if(!H.current)return;o(Y),l(ue),U||(m({}),p({}),F({}))}catch(Y){console.error("No se pudieron cargar las horas de la semana seleccionada:",Y),!U&&H.current&&(x("No se pudo cargar la informacin de la semana."),o({}),l({}))}finally{!U&&H.current&&y(!1)}},[I]);h.useEffect(()=>{ee(c)},[c,ee]),h.useEffect(()=>{let D;return(async()=>{D=await ye.subscribeToEmployeeShifts({onChange:()=>{ee(c,{preserveEdits:!0})},debounceMs:400})})(),()=>{D==null||D()}},[ee,c]);const te=D=>{d(D||Fs())},be=(D,le,U,Y)=>{const ue=Number.isNaN(U)?0:Math.max(0,U);m(ve=>{const W=ve[D]?{...ve[D]}:hc(Y);return W[le]=ue,{...ve,[D]:W}}),F(ve=>({...ve,[D]:{status:"idle"}})),R(D)},Se=(D,le,U)=>{p(Y=>{const ue={...Y},ve={...ue[D]??{}};return ve[le]=U,ue[D]=ve,ue}),F(Y=>({...Y,[D]:{status:"idle"}})),R(D)},_e=(D,le,U,Y,ue)=>{const ve=U.trim();if(p(C=>{const q={...C},X={...q[D]??{}};return ve?(X[le]=ve,q[D]=X):(delete X[le],Object.keys(X).length>0?q[D]=X:delete q[D]),q}),!ve){be(D,le,ue[le]??0,Y);return}const W=Ah(ve);W!==null&&be(D,le,W,Y)},Ee=(D,le)=>{m(U=>({...U,[D]:hc(le)})),p(U=>{const Y={...U};return delete Y[D],Y}),F(U=>({...U,[D]:{status:"idle"}})),R(D)},se=D=>{m(le=>{if(!le[D])return le;const U={...le};return delete U[D],U}),p(le=>{const U={...le};return delete U[D],U}),F(le=>({...le,[D]:{status:"idle"}})),R(D)},oe=async(D,le)=>{const U=hc(le);pt.forEach(Y=>{U[Y]=Math.max(0,Number(U[Y])||0)}),F(Y=>({...Y,[D]:{status:"saving"}}));try{await ye.saveEmployeeWeeklyHours(D,c,U),o(Y=>({...Y,[D]:U})),m(Y=>{const ue={...Y};return delete ue[D],ue}),p(Y=>{const ue={...Y};return delete ue[D],ue}),F(Y=>({...Y,[D]:{status:"success",message:"Cambios guardados"}})),R(D),A.current[D]=window.setTimeout(()=>{F(Y=>({...Y,[D]:{status:"idle"}})),delete A.current[D]},3500)}catch(Y){console.error("No se pudieron guardar las horas del empleado:",Y),F(ue=>({...ue,[D]:{status:"error",message:"Error guardando los cambios"}}))}},Q=h.useMemo(()=>{if(e.length===0)return{totalBase:0,totalWorked:0,diff:0,totalPay:0};let D=0,le=0,U=0;return e.forEach(Y=>{const ue=Da(Y,s[Y.id]),ve=Fn(ue),W=a[Y.id]??ve,q=u[Y.id]??W;D+=_s(ve),le+=_s(q),U+=$h(q).totalPay}),{totalBase:D,totalWorked:le,diff:le-D,totalPay:U}},[e,s,a,u]),J=e.length>0;return S?r.jsx("div",{className:"flex min-h-[60vh] items-center justify-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-3 text-gray-500",children:[r.jsx(ma,{className:"animate-spin",size:32}),r.jsx("span",{children:"Cargando empleados"})]})}):r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Histrico semanal de empleados"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Consulta y ajusta las horas registradas por semana para todo el equipo."})]}),r.jsxs("div",{className:"flex flex-col items-start gap-2 sm:flex-row sm:items-center",children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",htmlFor:"week-picker",children:"Semana seleccionada"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{id:"week-picker",type:"week",value:c,onChange:D=>te(D.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2",style:{"--tw-ring-color":b.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:Pa(c)})]})]})]}),g&&r.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Rr,{size:18}),r.jsx("span",{children:g})]})}),r.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-5",children:[r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[r.jsx("span",{children:"Total empleados"}),r.jsx(j1,{count:e.length})]}),r.jsx("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:e.length})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(Ja,{size:18}),r.jsx("span",{children:"Horas base estimadas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:[ht(Q.totalBase)," h"]})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(gs,{size:18}),r.jsx("span",{children:"Horas registradas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:[ht(Q.totalWorked)," h"]})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(ma,{size:18}),r.jsx("span",{children:"Variacin vs base"})]}),r.jsx("p",{className:`mt-2 text-2xl font-bold ${Math.abs(Q.diff)<.01?"text-gray-600":Q.diff>0?"text-green-600":"text-orange-500"}`,children:Ia(Q.diff)})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(Tu,{size:18}),r.jsx("span",{children:"Pago semanal estimado"})]}),r.jsx("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:K(Q.totalPay)})]})]}),T&&r.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-blue-100 bg-blue-50 px-4 py-2 text-sm text-blue-700",children:[r.jsx(ma,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Cargando informacin de la semana seleccionada"})]}),!J&&r.jsx("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-12 text-center text-gray-500",children:"No hay empleados registrados todava."}),J&&r.jsx("div",{className:"overflow-x-auto rounded-2xl border border-gray-100 bg-white shadow-sm",children:r.jsxs("table",{className:"min-w-[900px] w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Empleado"}),pt.map(D=>r.jsx("th",{className:"px-3 py-3 text-center font-semibold",children:Dd[D]},D)),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Total base"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Registrado"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Variacin"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Pago semanal"}),r.jsx("th",{className:"px-4 py-3"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:e.map(D=>{var P,Z;const le=Da(D,s[D.id]),U=Fn(le),Y=a[D.id]??U,ue=u[D.id],ve=ue??Y,W=_s(U),C=_s(ve),q=C-W,X=ue?!h1(ue,Y):!1,xe=((P=_[D.id])==null?void 0:P.status)??"idle",$=(Z=_[D.id])==null?void 0:Z.message,j=$h(ve),k=j.overtimeHours>.01,z=X&&xe!=="saving";return r.jsxs("tr",{className:"hover:bg-gray-50/60",children:[r.jsx("td",{className:"px-4 py-4 align-top",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-semibold text-gray-800",children:D.nombre}),r.jsxs("span",{className:"text-xs text-gray-500",children:["Jornada base: ",D.dias_semana," das  ",D.horas_dia," h/da"]})]})}),pt.map(me=>{var Lt,_t;const we=ue??Y,De=((Lt=f[D.id])==null?void 0:Lt[me])??"",Be=De.trim(),He=Be?Ah(Be):null,Ve=!!Be&&He===null,et=Ve?"#F87171":b.accent,it=(_t=i[D.id])==null?void 0:_t[me],xt=ge(it),jt=ce(it),$t=!!it;return r.jsx("td",{className:"px-3 py-3 text-center align-top",children:r.jsxs("div",{className:"flex flex-col items-center gap-1.5",title:jt,children:[r.jsx("input",{type:"text",value:De,placeholder:"ej. 10:00 am - 7:30 pm",onChange:M=>Se(D.id,me,M.target.value),onBlur:M=>_e(D.id,me,M.target.value,we,Y),onKeyDown:M=>{M.key==="Enter"&&M.currentTarget.blur()},autoComplete:"off",className:`w-40 rounded-lg border px-2 py-1 text-sm focus:border-transparent focus:ring-2 ${Ve?"border-red-300 text-red-700 placeholder:text-red-300":"border-gray-300"}`,style:{"--tw-ring-color":et}}),r.jsx("span",{className:`text-[11px] ${$t?"text-gray-500":"text-gray-400"}`,children:xt}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Calculadas: ",ht(ve[me]??0)," h"]}),r.jsxs("span",{className:"text-[11px] text-gray-400",children:["Base: ",ht(U[me]??0)," h"]}),Ve&&r.jsx("span",{className:"text-[11px] text-red-500",children:'Usa formato "10:00 am - 7:30 pm"'})]})},me)}),r.jsxs("td",{className:"px-4 py-4 text-center font-medium text-gray-600",children:[ht(W)," h"]}),r.jsxs("td",{className:"px-4 py-4 text-center font-semibold text-gray-800",children:[ht(C)," h"]}),r.jsx("td",{className:"px-4 py-4 text-center font-medium",children:r.jsx("span",{className:Math.abs(q)<.01?"text-gray-500":q>0?"text-green-600":"text-orange-500",children:Ia(q)})}),r.jsx("td",{className:"px-4 py-4 text-center align-top text-gray-700",children:r.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[r.jsx("span",{className:"text-base font-semibold text-gray-800",children:K(j.totalPay)}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Base: ",K(j.basePay),k&&`  Extras: ${K(j.overtimePay)}`]}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Aux. transporte: ",K(j.transport)]}),r.jsxs("span",{className:"text-[11px] text-gray-400",children:[ht(j.regularHours)," h base",k&&`  ${ht(j.overtimeHours)} h extra`,"  ",j.daysWorked," da",j.daysWorked===1?"":"s"]})]})}),r.jsx("td",{className:"px-4 py-4",children:r.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>Ee(D.id,U),className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx(Ev,{size:14}),"Base"]}),r.jsx("button",{type:"button",onClick:()=>se(D.id),className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 transition hover:bg-gray-100",disabled:!ue,children:"Limpiar"}),r.jsxs("button",{type:"button",onClick:()=>oe(D.id,ve),disabled:!z,className:`inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-xs font-semibold text-white transition ${z?"hover:scale-105":"cursor-not-allowed opacity-70"}`,style:{backgroundColor:z?b.dark:"#CBD5F5"},children:[xe==="saving"?r.jsx(ma,{className:"h-4 w-4 animate-spin"}):r.jsx(mg,{size:14}),"Guardar"]})]}),xe==="success"&&$&&r.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[r.jsx(fv,{size:14}),r.jsx("span",{children:$})]}),xe==="error"&&$&&r.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600",children:[r.jsx(Rr,{size:14}),r.jsx("span",{children:$})]})]})})]},D.id)})})]})})]})}function j1({count:e}){return r.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600",children:[r.jsx(Fr,{size:14}),e]})}const pc=()=>({expanded:!1,loading:!1,loaded:!1,error:null}),w1=(e,t)=>Wr(t).getTime()-Wr(e).getTime();function N1(){const[e,t]=h.useState([]),[s,n]=h.useState(null),[a,o]=h.useState(!1),[i,l]=h.useState({nombre:"",telefono:"",email:"",horas_dia:8,dias_semana:5,salario_hora:0,activo:!0}),[c,d]=h.useState({}),[u,m]=h.useState({}),[f,p]=h.useState(null),[S,E]=h.useState(Fs()),[T,y]=h.useState(null),[g,x]=h.useState(null),[_,F]=h.useState({}),[A,H]=h.useState({}),R=h.useRef(new Set),[ge,ce]=h.useState(!1),[I,ee]=h.useState({}),[te,be]=h.useState(!1),[Se,_e]=h.useState({}),Ee=h.useMemo(()=>jg(new Date),[]),se=h.useCallback(async()=>{try{const w=(await ye.fetchEmployeeCredits()).reduce((B,G)=>(B[G.empleadoId]=Math.max(0,Math.round(G.total)),B),{});F(w)}catch(v){console.error("Error cargando crditos de empleados:",v)}},[]);h.useEffect(()=>{q()},[]),h.useEffect(()=>{se();const v=()=>{se()};return typeof window<"u"&&window.addEventListener(Gn,v),()=>{typeof window<"u"&&window.removeEventListener(Gn,v)}},[se]);const oe=h.useCallback(async(v={})=>{const{silent:w}=v;w||be(!0);try{const B=ze(new Date),G=await ye.fetchEmployeeShiftsForDate(B),he={};G.forEach(Te=>{he[Te.empleadoId]=Te}),ee(he)}catch(B){console.error("Error cargando los turnos del da:",B)}finally{w||be(!1)}},[]),Q=h.useCallback((v,w)=>{_e(B=>({...B,[v]:w}))},[]);h.useEffect(()=>{oe()},[oe]),h.useEffect(()=>{let v;return(async()=>{v=await ye.subscribeToEmployeeShifts({onChange:()=>{oe({silent:!0})}})})(),()=>{v==null||v()}},[oe]);const J=h.useMemo(()=>{const v=new Map;return e.forEach(w=>{w.activo&&v.set(w.id,w)}),Object.keys(I).forEach(w=>{if(!v.has(w)){const B=e.find(G=>G.id===w);B&&v.set(B.id,B)}}),Array.from(v.values()).sort((w,B)=>w.nombre.localeCompare(B.nombre))},[e,I]),D=h.useCallback(async v=>{const w=v.id;Q(w,"clockIn");try{const B=await ye.startEmployeeShift(w);ee(G=>({...G,[w]:B}))}catch(B){console.error(`No se pudo registrar la llegada de ${v.nombre}:`,B)}finally{Q(w,null),oe({silent:!0})}},[oe,Q]),le=h.useCallback(async(v,w)=>{if(!(w!=null&&w.id))return;const B=v.id;Q(B,"clockOut");try{const G=await ye.completeEmployeeShift(w.id);G&&ee(he=>({...he,[B]:G}))}catch(G){console.error(`No se pudo registrar la salida de ${v.nombre}:`,G)}finally{Q(B,null),oe({silent:!0})}},[oe,Q]),U=h.useCallback(async(v,w)=>{if(!(w!=null&&w.id))return;const B=v.id;Q(B,"startNovelty");try{const G=await ye.startEmployeeShiftNovelty(w.id);G&&ee(he=>({...he,[B]:G}))}catch(G){console.error(`No se pudo marcar la novedad de ${v.nombre}:`,G)}finally{Q(B,null),oe({silent:!0})}},[oe,Q]),Y=h.useCallback(async(v,w)=>{if(!(w!=null&&w.id))return;const B=v.id;Q(B,"finishNovelty");try{const G=await ye.finishEmployeeShiftNovelty(w.id);G&&ee(he=>({...he,[B]:G}))}catch(G){console.error(`No se pudo finalizar la novedad de ${v.nombre}:`,G)}finally{Q(B,null),oe({silent:!0})}},[oe,Q]),ue=h.useCallback(async(v,w)=>{if(!(w!=null&&w.id))return;const B=v.id;Q(B,"clearNovelty");try{const G=await ye.clearEmployeeShiftNovelty(w.id);G&&ee(he=>({...he,[B]:G}))}catch(G){console.error(`No se pudo limpiar la novedad de ${v.nombre}:`,G)}finally{Q(B,null),oe({silent:!0})}},[oe,Q]),ve=h.useCallback(async v=>{try{const w=await ye.fetchEmployeeBaseSchedules();d(B=>{const G={...B},he=new Set(v.map(Re=>Re.id));let Te=!1;return Object.keys(G).forEach(Re=>{he.has(Re)||(delete G[Re],Te=!0)}),v.forEach(Re=>{const Oe=w[Re.id];Oe?(!G[Re.id]||!Dh(G[Re.id],Oe))&&(G[Re.id]=Oe,Te=!0):G[Re.id]&&(delete G[Re.id],Te=!0)}),Te?G:B})}catch(w){console.error("Error cargando horarios base de empleados:",w)}},[]),W=h.useCallback(async v=>{if(!v)return{};if(R.current.has(v)){const w={};return Object.entries(u).forEach(([B,G])=>{const he=G==null?void 0:G[v];he&&(w[B]=he)}),w}try{const w=await ye.fetchEmployeeWeeklyHoursForWeek(v);return R.current.add(v),m(B=>{const G={...B};return Object.entries(w).forEach(([he,Te])=>{G[he]={...G[he]||{},[v]:Te}}),G}),w}catch(w){return console.error("Error cargando horas semanales:",w),{}}},[u]),C=h.useCallback(async(v,w)=>{var he,Te;const B=(he=u[v])==null?void 0:he[w];return B||((await W(w))[v]??((Te=u[v])==null?void 0:Te[w]))},[u,W]);h.useEffect(()=>{e.length!==0&&(ve(e),W(Fs()))},[e,ve,W]),h.useEffect(()=>{e.length!==0&&d(v=>{const w={...v},B=new Set(e.map(he=>he.id));let G=!1;return Object.keys(w).forEach(he=>{B.has(he)||(delete w[he],G=!0)}),e.forEach(he=>{const Te=Da(he,w[he.id]);w[he.id]&&Dh(w[he.id],Te)||(w[he.id]=Te,G=!0)}),G?w:v})},[e]),h.useEffect(()=>{m(v=>{const w={...v},B=new Set(e.map(he=>he.id));let G=!1;return Object.keys(w).forEach(he=>{B.has(he)||(delete w[he],G=!0)}),G?w:v})},[e]),h.useEffect(()=>{H(v=>{const w={...v},B=new Set(e.map(he=>he.id));let G=!1;return Object.keys(w).forEach(he=>{B.has(he)||(delete w[he],G=!0)}),G?w:v})},[e]);const q=async()=>{const v=await ye.fetchEmpleados();t(v)},X=async v=>{if(v.preventDefault(),s)await ye.updateEmpleado({...i,id:s}),q(),j();else{const w={...i,id:crypto.randomUUID()};await ye.createEmpleado(w),q(),j()}},xe=v=>{l({nombre:v.nombre,telefono:v.telefono||"",email:v.email||"",horas_dia:v.horas_dia,dias_semana:v.dias_semana,salario_hora:v.salario_hora,activo:v.activo}),n(v.id),o(!0)},$=async v=>{confirm("Ests seguro de eliminar este empleado?")&&(await ye.deleteEmpleado(v),q())},j=()=>{l({nombre:"",telefono:"",email:"",horas_dia:8,dias_semana:5,salario_hora:0,activo:!0}),n(null),o(!1)},k=v=>Da(v,c[v.id]),z=(v,w,B,G)=>{const he=Fn(B),Te=u[v],Re=G??(Te==null?void 0:Te[w]);return Re&&pt.forEach(Oe=>{const lt=Re[Oe];typeof lt=="number"&&!Number.isNaN(lt)&&(he[Oe]=lt)}),he},P=h.useCallback((v,w)=>{H(B=>{const G=B[v]??pc();return{...B,[v]:w(G)}})},[]),Z=async(v,w)=>{const B=Da(v,c[v.id]),G=w||Fs();p(v),E(G),y(B);const he=await C(v.id,G);x(z(v.id,G,B,he))},me=()=>{p(null),y(null),x(null)},we=async v=>{if(!v||(E(v),!f||!T))return;const w=f.id,B=T,G=await C(w,v);!f||f.id!==w||!T||x(z(w,v,B,G))},De=(v,w)=>{x(B=>{if(!B)return B;const G={...B};return G[v]=Math.max(0,w(B[v]??0)),G})},Be=v=>{!T||!f||y(w=>{if(!w)return w;const B=w[v],G=!B.active,he=B.hours||f.horas_dia,Te={active:G,hours:G?he:0},Re={...w,[v]:Te};return x(Oe=>{if(!Oe)return Oe;const lt=Oe[v]??0,yt=!B.active||Math.abs(lt-B.hours)<.01,Xt=G?yt?Te.hours:lt:0;return{...Oe,[v]:Math.max(0,Xt)}}),Re})},He=(v,w)=>{if(!T)return;const B=Number.isNaN(w)?0:Math.max(0,w);y(G=>{if(!G)return G;const he=G[v],Te={active:he.active,hours:he.active?B:0},Re={...G,[v]:Te};return x(Oe=>{if(!Oe)return Oe;const lt=Oe[v]??0;return he.active&&Math.abs(lt-he.hours)<.01?{...Oe,[v]:B}:Oe}),Re})},Ve=(v,w)=>{const B=Number.isNaN(w)?0:Math.max(0,w);x(G=>G&&{...G,[v]:B})},et=v=>De(v,()=>0),it=v=>{var B;if(!T)return;const w=((B=T[v])==null?void 0:B.hours)??0;De(v,()=>w)},xt=()=>{T&&x(Fn(T))},jt=async()=>{if(!f||!T)return;const v=f.id,w={};pt.forEach(B=>{const G=T[B];w[B]={active:!!G.active,hours:G.active?Math.max(0,Number(G.hours)||0):0}});try{await ye.saveEmployeeBaseSchedule(v,w)}catch(B){console.error("No se pudo guardar el horario base del empleado:",B)}d(B=>({...B,[v]:w})),y(B=>B&&w)},$t=async()=>{if(!f||!g)return;const v=f.id,w=S,B={};pt.forEach(G=>{B[G]=Math.max(0,Number(g[G])||0)});try{await ye.saveEmployeeWeeklyHours(v,w,B),R.current.add(w)}catch(G){console.error("No se pudieron guardar las horas semanales del empleado:",G)}m(G=>{const he={...G[v]||{}};return he[w]=B,{...G,[v]:he}}),x(B),me()},Lt=h.useCallback(async v=>{const w=v.id,B=A[w]??pc();if(!!B.expanded){P(w,he=>({...he,expanded:!1}));return}if(P(w,he=>({...he,expanded:!0,error:null})),!B.loaded){P(w,he=>({...he,loading:!0,expanded:!0,error:null}));try{const he=await ye.fetchEmployeeWeeklyHoursHistory(w);m(Te=>{const Re={...Te},Oe={...Re[w]||{}};return Object.entries(he).forEach(([lt,yt])=>{Oe[lt]=yt,R.current.add(lt)}),Re[w]=Oe,Re}),P(w,Te=>({...Te,loading:!1,loaded:!0,expanded:!0,error:null}))}catch(he){console.error("Error cargando histrico de horas del empleado:",he),P(w,Te=>({...Te,loading:!1,expanded:!0,error:"No se pudo cargar el histrico"}))}}},[A,P]),_t=v=>_s(Fn(v)),M=v=>_t(v)*4.33,re=(v,w)=>M(v)*w,fe=T?_t(T):0,ke=g?_s(g):0,Ie=ke-fe,O=Math.abs(Ie)<.01?"text-gray-600":Ie>0?"text-green-600":"text-orange-500";return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Fr,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Gestin de Empleados"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>ce(v=>!v),className:`flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg border text-sm font-medium transition-all duration-200 ${ge?"text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,style:{backgroundColor:ge?b.dark:"transparent",borderColor:ge?b.dark:"#E5E7EB"},children:[r.jsx(ud,{size:16}),r.jsx("span",{className:"hidden md:inline",children:ge?"Ocultar histrico":"Histrico semanal"}),r.jsx("span",{className:"md:hidden",children:ge?"Ocultar":"Histrico"})]}),r.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm",style:{backgroundColor:b.dark},children:[r.jsx(jn,{size:16}),r.jsx("span",{className:"hidden lg:inline",children:"Agregar Empleado"}),r.jsx("span",{className:"lg:hidden",children:"Agregar"})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Registro diario de turnos"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Registra llegadas, salidas y novedades para mantener sincronizado el control de horas."})]}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(gs,{size:16}),r.jsx("span",{children:Ee})]})]}),te?r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(nt,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Cargando turnos del da"})]}):J.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay empleados activos para registrar turnos hoy."}):r.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:J.map(v=>{const w=I[v.id]??null,B=Se[v.id],G=!!B,he=!!w,Te=!!(w&&!w.horaSalida),Re=v.activo&&(!w||!!w.horaSalida),Oe=!!(Te&&(w!=null&&w.novedad)&&(w!=null&&w.novedadInicio)&&!(w!=null&&w.novedadFin)),lt=!!(Te&&(!(w!=null&&w.novedad)||w!=null&&w.novedadFin)),yt=!!(w!=null&&w.novedad&&(w!=null&&w.novedadInicio)&&(w!=null&&w.novedadFin)),Xt=!!(w!=null&&w.novedad&&(w!=null&&w.novedadInicio)),Ms=Rt(w==null?void 0:w.horaLlegada),L=w!=null&&w.horaSalida?Rt(w.horaSalida):"pendiente",ne=w!=null&&w.novedadInicio?Rt(w.novedadInicio):"",N=w!=null&&w.novedadFin?Rt(w.novedadFin):"",V=typeof(w==null?void 0:w.horasTrabajadas)=="number"?w.horasTrabajadas:void 0;let ae="Sin turno registrado",ie="bg-gray-100 text-gray-600";return Te?(ae=Oe?"Novedad en curso":"Turno activo",ie=Oe?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700"):yt?(ae="Novedad registrada",ie="bg-amber-100 text-amber-700"):he&&(ae="Turno registrado",ie="bg-blue-100 text-blue-700"),r.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white/70 p-4 shadow-sm space-y-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-base font-semibold text-gray-800",children:v.nombre}),r.jsx("p",{className:"text-xs text-gray-500",children:v.activo?"Empleado activo":"Empleado inactivo"})]}),r.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${ie}`,children:ae})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-600",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Entrada"}),r.jsx("p",{className:"font-medium text-gray-800",children:Ms})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Salida"}),r.jsx("p",{className:"font-medium text-gray-800",children:L})]}),r.jsxs("div",{className:"col-span-2",children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Novedad"}),r.jsx("p",{className:"font-medium text-gray-800",children:Xt?Oe?`Inici a las ${ne}`:`${ne}  ${N}`:"Sin novedad"})]}),typeof V=="number"&&(w==null?void 0:w.horaSalida)&&r.jsxs("div",{className:"col-span-2",children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Horas registradas"}),r.jsxs("p",{className:"font-medium text-gray-800",children:[ht(V)," h"]})]})]}),Xt&&r.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-amber-100 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:[r.jsx(bv,{size:14}),r.jsx("span",{children:Oe?`Novedad en curso desde las ${ne}`:`Se descontar el tiempo entre ${ne} y ${N}`})]}),he&&(w==null?void 0:w.horaSalida)&&r.jsxs("div",{className:"rounded-lg border border-blue-100 bg-blue-50 px-3 py-2 text-xs text-blue-700",children:["Turno cerrado a las ",L,". Revisa el histrico si necesitas editar los valores."]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[Re&&r.jsxs("button",{type:"button",onClick:()=>D(v),disabled:!v.activo||G||!Re,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 hover:scale-105",style:{backgroundColor:b.dark},children:[B==="clockIn"?r.jsx(nt,{className:"h-4 w-4 animate-spin"}):r.jsx(Nv,{size:16}),"Registrar llegada"]}),Te&&r.jsxs("button",{type:"button",onClick:()=>le(v,w),disabled:G,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-emerald-600 hover:bg-emerald-700",children:[B==="clockOut"?r.jsx(nt,{className:"h-4 w-4 animate-spin"}):r.jsx(hi,{size:16}),"Registrar salida"]}),lt&&w&&r.jsxs("button",{type:"button",onClick:()=>U(v,w),disabled:G,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-amber-500 hover:bg-amber-600",children:[B==="startNovelty"?r.jsx(nt,{className:"h-4 w-4 animate-spin"}):r.jsx(Sv,{size:16}),"Marcar novedad"]}),Oe&&w&&r.jsxs("button",{type:"button",onClick:()=>Y(v,w),disabled:G,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-indigo-600 hover:bg-indigo-700",children:[B==="finishNovelty"?r.jsx(nt,{className:"h-4 w-4 animate-spin"}):r.jsx(Cv,{size:16}),"Finalizar novedad"]}),Te&&Xt&&!Oe&&w&&r.jsxs("button",{type:"button",onClick:()=>ue(v,w),disabled:G,className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 transition disabled:cursor-not-allowed disabled:opacity-70 hover:bg-gray-100",children:[B==="clearNovelty"?r.jsx(nt,{className:"h-4 w-4 animate-spin"}):r.jsx(xv,{size:16}),"Limpiar novedad"]})]})]},v.id)})})]}),ge&&r.jsx("div",{className:"ui-card ui-card-pad",children:r.jsx(b1,{})}),a&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:b.dark},children:s?"Editar Empleado":"Nuevo Empleado"}),r.jsxs("form",{onSubmit:X,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nombre *"}),r.jsx("input",{type:"text",required:!0,value:i.nombre,onChange:v=>l({...i,nombre:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Telfono"}),r.jsx("input",{type:"tel",value:i.telefono,onChange:v=>l({...i,telefono:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),r.jsx("input",{type:"email",value:i.email,onChange:v=>l({...i,email:v.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Horas por da"}),r.jsx("input",{type:"number",min:"1",max:"12",value:i.horas_dia,onChange:v=>l({...i,horas_dia:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Das por semana"}),r.jsx("input",{type:"number",min:"1",max:"7",value:i.dias_semana,onChange:v=>l({...i,dias_semana:parseInt(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Salario por hora"}),r.jsx("input",{type:"number",min:"0",step:"100",value:i.salario_hora,onChange:v=>l({...i,salario_hora:parseFloat(v.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"activo",checked:i.activo,onChange:v=>l({...i,activo:v.target.checked}),className:"rounded"}),r.jsx("label",{htmlFor:"activo",className:"text-sm font-medium",children:"Empleado activo"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:j,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"submit",className:"flex-1 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105",style:{backgroundColor:b.dark},children:s?"Actualizar":"Guardar"})]})]})]})}),f&&T&&g&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"relative w-full max-w-4xl overflow-hidden rounded-2xl bg-white shadow-xl",children:[r.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Gestin semanal de horarios"}),r.jsxs("p",{className:"text-sm text-gray-500",children:[f.nombre,"  Semana ",Pa(S)]})]}),r.jsxs("button",{onClick:me,className:"rounded-full p-2 text-gray-500 transition hover:bg-gray-100",children:[r.jsx("span",{className:"sr-only",children:"Cerrar"}),r.jsx(Ur,{size:18})]})]}),r.jsxs("div",{className:"max-h-[80vh] overflow-y-auto px-6 py-5 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Selecciona la semana que deseas ajustar"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Puedes modificar horas especficas si hubo ausencias o cambios."})]}),r.jsx("input",{type:"week",value:S,onChange:v=>void we(v.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2 sm:w-auto",style:{"--tw-ring-color":b.accent}})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full min-w-[600px] text-sm",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-50 text-left text-xs uppercase tracking-wide text-gray-500",children:[r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Da"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Horario base"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Horas trabajadas"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Acciones"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:pt.map(v=>{const w=T[v],B=g[v]??0;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:Dd[v]}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-gray-600",children:[r.jsx("input",{type:"checkbox",checked:w.active,onChange:()=>Be(v),className:"rounded"}),"Activo"]}),r.jsx("input",{type:"number",min:"0",step:"0.5",value:w.active?w.hours:0,onChange:G=>He(v,parseFloat(G.target.value)),disabled:!w.active,className:"w-24 rounded-lg border border-gray-300 px-2 py-1 text-sm focus:border-transparent focus:ring-2 disabled:bg-gray-100",style:{"--tw-ring-color":b.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:"horas"})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"number",min:"0",step:"0.5",value:B,onChange:G=>Ve(v,parseFloat(G.target.value)),className:"w-24 rounded-lg border border-gray-300 px-2 py-1 text-sm focus:border-transparent focus:ring-2",style:{"--tw-ring-color":b.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:"horas"})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("button",{type:"button",onClick:()=>it(v),className:"rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:"Usar base"}),r.jsx("button",{type:"button",onClick:()=>et(v),className:"rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:"Ausencia"})]})})]},v)})})]})}),r.jsxs("div",{className:"grid gap-3 rounded-xl bg-gray-50 p-4 text-sm sm:grid-cols-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Horas base de la semana"}),r.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:[ht(fe)," h"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Horas registradas"}),r.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:[ht(ke)," h"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Diferencia semanal"}),r.jsx("p",{className:`text-lg font-semibold ${O}`,children:Ia(Ie)})]})]}),r.jsxs("div",{className:"flex flex-wrap justify-end gap-3",children:[r.jsxs("button",{type:"button",onClick:xt,className:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx(ma,{size:16}),"Restablecer semana"]}),r.jsx("button",{type:"button",onClick:()=>void jt(),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-100",children:"Guardar horario base"}),r.jsx("button",{type:"button",onClick:()=>void $t(),className:"rounded-lg px-3 py-2 text-sm font-semibold text-white transition hover:opacity-90",style:{backgroundColor:b.dark},children:"Guardar horas de la semana"})]})]})]})}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(v=>{const w=k(v),B=_t(w),G=Fs(),he=z(v.id,G,w),Te=_s(he),Re=Te-B,Oe=Math.abs(Re)<.01?"text-gray-500":Re>0?"text-green-600":"text-orange-500",lt=Pa(G),yt=A[v.id]??pc(),Xt=u[v.id]||{},Ms={...Xt};Ms[G]||(Ms[G]=he);const L=Object.entries(Ms).sort((N,V)=>w1(N[0],V[0])),ne=Object.keys(Xt).length>0;return r.jsxs("div",{className:`bg-white rounded-xl p-6 shadow-sm border transition-all duration-200 hover:shadow-md ${v.activo?"border-gray-100":"border-gray-300 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:v.nombre}),r.jsx("div",{className:"flex items-center gap-1 mt-1",children:r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${v.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:v.activo?"Activo":"Inactivo"})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>xe(v),className:"p-1 rounded hover:bg-gray-100",children:r.jsx(zr,{size:16})}),r.jsx("button",{onClick:()=>$(v.id),className:"p-1 rounded hover:bg-gray-100 text-red-600",children:r.jsx(qn,{size:16})})]})]}),(v.telefono||v.email)&&r.jsxs("div",{className:"space-y-1 mb-4 text-sm text-gray-600",children:[v.telefono&&r.jsxs("p",{children:[" ",v.telefono]}),v.email&&r.jsxs("p",{children:[" ",v.email]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ja,{size:18,className:"text-gray-500"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Horario base semanal"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Horas estimadas:"," ",r.jsxs("span",{className:"font-semibold text-gray-700",children:[ht(B)," h"]})]})]})]}),r.jsxs("button",{onClick:()=>void Z(v),className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-100",children:[r.jsx(gs,{size:16}),r.jsx("span",{children:"Gestionar semana"})]})]}),r.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs sm:text-sm",children:pt.map(N=>{const V=w[N];return r.jsxs("div",{className:`flex items-center justify-between rounded-md px-2 py-1 ${V.active?"bg-white text-gray-700 shadow-sm":"text-gray-400"}`,children:[r.jsx("span",{className:"font-medium",children:Dd[N]}),r.jsx("span",{children:V.active?`${ht(V.hours)} h`:"Descanso"})]},N)})})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm sm:grid-cols-2",children:[r.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(gs,{size:16}),r.jsx("span",{children:"Horas programadas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-semibold",style:{color:b.dark},children:[ht(B)," h"]})]}),r.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Ja,{size:16}),r.jsxs("span",{children:["Semana actual (",lt,")"]})]}),r.jsxs("p",{className:"mt-2 text-2xl font-semibold",style:{color:b.dark},children:[ht(Te)," h"]}),r.jsx("p",{className:`mt-1 text-xs font-medium ${Oe}`,children:Ia(Re)})]})]}),r.jsxs("div",{className:"pt-4 border-t",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(cg,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-sm",children:"Salario/hora"})]}),r.jsx("span",{className:"text-sm font-medium",children:K(v.salario_hora)})]}),r.jsxs("div",{className:"text-center p-2 rounded",style:{backgroundColor:`${b.accent}20`},children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Salario mensual estimado"}),r.jsx("p",{className:"font-bold",style:{color:b.dark},children:K(re(w,v.salario_hora))})]})]}),r.jsxs("div",{className:"mt-4 rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Os,{size:16}),r.jsx("span",{children:"Crdito acumulado"})]}),r.jsx("span",{className:"text-sm font-semibold",style:{color:b.dark},children:K(_[v.id]??0)})]}),r.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Registra abonos desde la caja con el mtodo "Crdito empleados".'})]}),r.jsxs("div",{className:"mt-4 rounded-lg border border-gray-100 bg-white/60 p-4",children:[r.jsxs("button",{type:"button",onClick:()=>void Lt(v),className:"flex w-full items-center justify-between text-left text-sm font-medium text-gray-700",children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(ud,{size:16,className:"text-gray-500"}),"Histrico de horas trabajadas"]}),r.jsx("span",{className:"text-xs font-semibold text-gray-500",children:yt.expanded?"Ocultar":"Ver historial"})]}),yt.expanded&&r.jsxs("div",{className:"mt-3 space-y-3",children:[yt.error&&r.jsx("div",{className:"rounded-lg border border-red-100 bg-red-50 px-3 py-2 text-xs text-red-600",children:yt.error}),yt.loading?r.jsx("p",{className:"text-xs text-gray-500",children:"Cargando histrico..."}):r.jsx("div",{className:"overflow-x-auto",children:L.length===0?r.jsx("p",{className:"text-xs text-gray-500",children:"An no hay semanas registradas."}):r.jsxs("table",{className:"w-full min-w-[400px] text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-[11px] uppercase tracking-wide text-gray-500",children:[r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Semana"}),r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Horas trabajadas"}),r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Variacin"}),r.jsx("th",{className:"px-3 py-2 font-semibold text-right",children:"Acciones"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:L.map(([N,V])=>{const ae=_s(V),ie=ae-B,pe=N===G;return r.jsxs("tr",{className:pe?"bg-gray-50":void 0,children:[r.jsx("td",{className:"px-3 py-2",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-semibold text-gray-700",children:Pa(N)}),pe&&r.jsx("span",{className:"text-[11px] text-gray-500",children:"Semana actual"})]})}),r.jsx("td",{className:"px-3 py-2",children:r.jsxs("span",{className:"font-medium text-gray-700",children:[ht(ae)," h"]})}),r.jsx("td",{className:`px-3 py-2 font-medium text-[11px] ${Math.abs(ie)<.01?"text-gray-500":ie>0?"text-green-600":"text-orange-500"}`,children:Ia(ie)}),r.jsx("td",{className:"px-3 py-2 text-right",children:r.jsxs("button",{type:"button",onClick:()=>void Z(v,N),className:"inline-flex items-center gap-1 rounded-lg border border-gray-200 px-2 py-1 text-[11px] font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx(zr,{size:14}),"Ajustar"]})})]},N)})})]})}),!yt.loading&&!ne&&r.jsx("p",{className:"text-[11px] text-gray-500",children:'Los registros guardados aparecern aqu. Usa "Gestionar semana" para almacenar ajustes.'})]})]})]})]},v.id)})}),e.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Fr,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No hay empleados registrados"}),r.jsx("p",{className:"text-gray-500",children:"Agrega tu primer empleado para comenzar"})]})]})}const Lh={mg:.001,g:1,kg:1e3},Rh=e=>e!=="ml",Ex=["mg","g","kg","ml"],k1=e=>!Number.isFinite(e)||Number.isNaN(e)?0:e,zh=(e,t)=>!e||!Ex.includes(e)?t:e,S1=(e,t,s)=>{if(t===s)return e;if(t==="ml"||s==="ml")return t!==s&&console.warn("[inventory] Conversin entre unidades incompatibles. Se conserva el valor original.",{from:t,to:s}),e;const n=Lh[t],a=Lh[s];return e*n/a},xi=({cantidad:e,tipo:t,unidad:s,item:n})=>{const a=k1(Number(e??0));if(!n||n.inventarioCategoria!=="Inventariables"||a===0)return 0;if((t??n.inventarioTipo??"cantidad")!=="gramos")return Math.round(a);const i=zh(n.unidadMedida??"g","g"),l=zh(s??i,i);if(i==="ml")return l!=="ml"?(console.warn("[inventory] No se puede convertir a mililitros desde la unidad especificada.",{fromUnit:l,itemUnit:i}),Math.round(a)):a;if(!Rh(l)||!Rh(i))return Math.round(a);const c=S1(a,l,i);return Math.round(c)};function _1({focusRequest:e,menuItems:t=[],onInventoryItemsUpdated:s}){const[n,a]=h.useState([]),[o,i]=h.useState(!1),[l,c]=h.useState(null),[d,u]=h.useState(!1),[m,f]=h.useState("diario"),[p,S]=h.useState(Na()),[E,T]=h.useState("desc"),[y,g]=h.useState({descripcion:"",monto:0,categoria:"",fecha:Na(),metodoPago:"efectivo"}),[x,_]=h.useState(null),[F,A]=h.useState(""),[H,R]=h.useState("g"),[ge,ce]=h.useState(!1),I=h.useRef(null),ee=Vv,te=ns,be=["Productos Limpieza","Carnes","Frutas/Verduras","Lacteos","Servicios pblicos","Arriendo","Salarios","Papelera","Marketing","Transporte","Otros"],Se=h.useMemo(()=>t.filter($=>$.inventarioCategoria==="Inventariables"),[t]),_e=h.useMemo(()=>new Map(t.map($=>[$.id,$])),[t]),Ee=h.useMemo(()=>{if(!Se.length)return[];const $=y.descripcion.trim();if(!$)return Se.slice(0,8);const j=xs($);return Se.filter(k=>xs(k.nombre).includes(j)).slice(0,8)},[y.descripcion,Se]);h.useEffect(()=>{se()},[]),h.useEffect(()=>()=>{I.current&&window.clearTimeout(I.current)},[]),h.useEffect(()=>{if(!e)return;const{dateKey:$}=e;$&&(f("diario"),S($))},[e]);const se=async()=>{i(!0);try{const j=(await ye.fetchGastos()).map(k=>({...k,fecha:Nt(k.fecha),created_at:k.created_at?k.created_at instanceof Date?new Date(k.created_at.getTime()):new Date(k.created_at):void 0,metodoPago:k.metodoPago??"efectivo"}));a(j)}catch($){console.error("[Gastos] Error cargando los gastos.",$)}finally{i(!1)}},oe=()=>{I.current&&(window.clearTimeout(I.current),I.current=null),ce(!0)},Q=()=>{I.current&&window.clearTimeout(I.current),I.current=window.setTimeout(()=>{ce(!1)},120)},J=$=>{g(j=>({...j,descripcion:$})),oe(),x&&xs($)!==xs(x.nombre)&&(_(null),A(""),R("g"))},D=$=>{_($),g(j=>({...j,descripcion:$.nombre,categoria:j.categoria||$.categoria})),A(""),R($.inventarioTipo==="gramos"?$.unidadMedida??"g":"g"),ce(!1)},le=()=>{_(null),A(""),R("g")},U=h.useMemo(()=>!x||x.inventarioTipo!=="gramos"?[]:x.unidadMedida==="ml"?["ml"]:Ex.filter($=>$!=="ml"),[x]),Y=async $=>{$.preventDefault();const j=Number(y.monto);if(!Number.isFinite(j)||j<=0){alert("Ingresa un monto vlido para el gasto.");return}if(x){const Z=Number(F);if(!Number.isFinite(Z)||Z<=0){alert("Ingresa una cantidad vlida para el inventario.");return}}const k=Nt(y.fecha),z={descripcion:y.descripcion,monto:j,categoria:y.categoria,fecha:k,metodoPago:y.metodoPago,inventarioItemId:void 0,inventarioCantidad:void 0,inventarioTipo:void 0,inventarioUnidad:void 0},P=[];if(x&&x.inventarioCategoria==="Inventariables"){const Z=Number(F);z.inventarioItemId=x.id,z.inventarioCantidad=Z;const me=x.inventarioTipo??"cantidad";if(z.inventarioTipo=me,me==="gramos"){const De=x.unidadMedida??"g",Be=H??De;z.inventarioUnidad=Be}const we=xi({cantidad:Z,tipo:me,unidad:z.inventarioUnidad??x.unidadMedida,item:x});we!==0&&P.push({itemId:x.id,delta:we,reason:"gasto"})}if(l){const Z=n.find(me=>me.id===l);if(Z!=null&&Z.inventarioItemId){const me=_e.get(Z.inventarioItemId);if(me){const we=xi({cantidad:Z.inventarioCantidad,tipo:Z.inventarioTipo??me.inventarioTipo,unidad:Z.inventarioUnidad??me.unidadMedida,item:me});we!==0&&P.push({itemId:me.id,delta:-we,reason:"gasto"})}}await ye.updateGasto({...z,id:l,fecha:k})}else{const Z={...z,id:crypto.randomUUID(),created_at:new Date};await ye.createGasto(Z)}if(P.length){const Z=await ye.applyInventoryAdjustments(P);Z.length&&s&&s(Z)}se(),W()},ue=$=>{g({descripcion:$.descripcion,monto:$.monto,categoria:$.categoria,fecha:ze($.fecha instanceof Date?$.fecha:new Date($.fecha)),metodoPago:$.metodoPago??"efectivo"});const j=$.inventarioItemId?_e.get($.inventarioItemId)??null:null;_(j),A($.inventarioCantidad!==void 0&&$.inventarioCantidad!==null?String($.inventarioCantidad):""),R($.inventarioUnidad??(j==null?void 0:j.unidadMedida)??"g"),ce(!1),c($.id),u(!0)},ve=async $=>{const j=n.find(k=>k.id===$);if(confirm("Ests seguro de eliminar este gasto?")){if(await ye.deleteGasto($),j!=null&&j.inventarioItemId){const k=_e.get(j.inventarioItemId);if(k){const z=xi({cantidad:j.inventarioCantidad,tipo:j.inventarioTipo??k.inventarioTipo,unidad:j.inventarioUnidad??k.unidadMedida,item:k});if(z!==0){const P=await ye.applyInventoryAdjustments([{itemId:k.id,delta:-z,reason:"gasto"}]);P.length&&s&&s(P)}}}se()}},W=()=>{g({descripcion:"",monto:0,categoria:"",fecha:Na(),metodoPago:"efectivo"}),c(null),u(!1),_(null),A(""),R("g"),ce(!1)},q=(()=>{const $=Nt(p),j=z=>{const P=z.created_at instanceof Date?z.created_at.getTime():NaN;if(!Number.isNaN(P))return P;const Z=z.fecha instanceof Date?z.fecha:Nt(z.fecha);return Number.isNaN(Z.getTime())?0:Z.getTime()};return n.filter(z=>{const P=Nt(z.fecha);switch(m){case"diario":return P.toDateString()===$.toDateString();case"semanal":const Z=new Date($);Z.setDate($.getDate()-$.getDay());const me=new Date(Z);return me.setDate(Z.getDate()+6),P>=Z&&P<=me;case"mensual":return P.getMonth()===$.getMonth()&&P.getFullYear()===$.getFullYear();default:return!0}}).sort((z,P)=>{const Z=j(z)-j(P);return E==="asc"?Z:-Z})})(),X=q.reduce(($,j)=>$+j.monto,0),xe=q.reduce(($,j)=>($[j.categoria]=($[j.categoria]||0)+j.monto,$),{});return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(hd,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Control de Gastos"})]}),r.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm",style:{backgroundColor:b.dark},children:[r.jsx(jn,{size:16}),r.jsx("span",{className:"hidden lg:inline",children:"Agregar Gasto"}),r.jsx("span",{className:"lg:hidden",children:"Agregar"})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dg,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:"Vista:"})]}),r.jsx("div",{className:"flex rounded-lg border border-gray-300 overflow-hidden",children:["diario","semanal","mensual"].map($=>r.jsx("button",{onClick:()=>f($),className:`px-3 lg:px-4 py-2 text-sm font-medium transition-colors ${m===$?"text-white":"text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:m===$?b.dark:"transparent"},children:$.charAt(0).toUpperCase()+$.slice(1)},$))})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(lg,{size:16,className:"text-gray-500"}),r.jsx("input",{type:"date",value:p,onChange:$=>S($.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full lg:w-auto",style:{"--tw-ring-color":b.accent}})]})]}),r.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(gg,{size:20,style:{color:b.accent}}),r.jsxs("span",{className:"text-base lg:text-lg font-semibold",children:["Total ",m,":"]})]}),r.jsx("span",{className:"text-lg lg:text-2xl font-bold",style:{color:b.accent},children:K(X)})]})]}),d&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:b.dark},children:l?"Editar Gasto":"Nuevo Gasto"}),r.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Descripcin *"}),r.jsx("input",{type:"text",required:!0,value:y.descripcion,onFocus:oe,onBlur:Q,onChange:$=>J($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},placeholder:"Ej. Compra de tomates"}),ge&&Ee.length>0&&r.jsx("ul",{className:"absolute left-0 right-0 z-30 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-52 overflow-y-auto",children:Ee.map($=>r.jsx("li",{children:r.jsxs("button",{type:"button",onMouseDown:j=>j.preventDefault(),onClick:()=>D($),className:`flex w-full flex-col px-3 py-2 text-sm transition-colors ${(x==null?void 0:x.id)===$.id?"bg-gray-100 font-medium":"hover:bg-gray-50"}`,children:[r.jsx("span",{children:$.nombre}),r.jsxs("span",{className:"text-xs text-gray-500",children:[$.categoria,$.unidadMedida?`  ${$.unidadMedida}`:""]})]})},$.id))}),x&&r.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 rounded-md border border-green-200 bg-green-50 px-2 py-1 text-xs text-green-700",children:[r.jsx("span",{className:"font-medium",children:x.nombre}),r.jsx("button",{type:"button",onClick:le,className:"underline-offset-2 hover:underline",children:"Quitar"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Monto *"}),r.jsx("input",{type:"number",required:!0,min:"0",step:"100",value:y.monto,onChange:$=>g({...y,monto:parseFloat($.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fecha *"}),r.jsx("input",{type:"date",required:!0,value:y.fecha,onChange:$=>g({...y,fecha:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]})]}),x&&r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Cantidad comprada *"}),r.jsx("input",{type:"number",min:"0",step:x.inventarioTipo==="gramos"?"any":1,inputMode:x.inventarioTipo==="gramos"?"decimal":"numeric",value:F,onChange:$=>A($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},placeholder:x.inventarioTipo==="gramos"?"Ej. 500":"Ej. 2"}),r.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Este valor se sumar al stock del inventario seleccionado."})]}),x.inventarioTipo==="gramos"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Unidad"}),r.jsx("select",{value:H??x.unidadMedida??"g",onChange:$=>R($.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:U.map($=>r.jsx("option",{value:$,children:$},$))})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Categora *"}),r.jsxs("select",{required:!0,value:y.categoria,onChange:$=>g({...y,categoria:$.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"",children:"Seleccionar categora"}),be.map($=>r.jsx("option",{value:$,children:$},$))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mtodo de pago *"}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:ee.map($=>r.jsx("button",{type:"button",onClick:()=>g({...y,metodoPago:$}),className:`py-2 px-3 rounded-lg border text-sm font-medium transition-colors ${y.metodoPago===$?"border-transparent text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:y.metodoPago===$?b.dark:"transparent"},children:te[$]},$))})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:W,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"submit",className:"flex-1 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105",style:{backgroundColor:b.dark},children:l?"Actualizar":"Guardar"})]})]})]})}),Object.keys(xe).length>0&&r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:b.dark},children:"Gastos por categora"}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:Object.entries(xe).sort(([$],[j])=>$.localeCompare(j,"es",{sensitivity:"base"})).map(([$,j])=>r.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-sm font-medium",children:$}),r.jsx("span",{className:"font-bold",style:{color:b.accent},children:K(j)})]},$))})]}),r.jsxs("div",{className:"ui-card",children:[r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("button",{type:"button",onClick:()=>T($=>$==="desc"?"asc":"desc"),className:"flex items-center gap-1",children:["Fecha",E==="desc"?r.jsx(lv,{size:14}):r.jsx(cv,{size:14})]})}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripcin"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Categora"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Mtodo"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-6 text-center text-sm text-gray-500",children:"Cargando gastos..."})}):q.map($=>{var j;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs lg:text-sm text-gray-900",children:(()=>{const k=$.created_at instanceof Date&&!Number.isNaN($.created_at.getTime())?$.created_at:$.fecha instanceof Date?$.fecha:Nt($.fecha);return Mu(k)})()}),r.jsx("td",{className:"px-3 lg:px-6 py-4 text-xs lg:text-sm text-gray-900",children:r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:$.descripcion}),$.inventarioItemId&&r.jsxs("span",{className:"text-[11px] text-green-700",children:["Inventario: ",((j=_e.get($.inventarioItemId))==null?void 0:j.nombre)??"",$.inventarioCantidad?`  +${$.inventarioCantidad}${$.inventarioUnidad?` ${$.inventarioUnidad}`:""}`:""]})]})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:$.categoria})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap hidden sm:table-cell",children:r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:te[$.metodoPago??"efectivo"]})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs lg:text-sm font-medium",style:{color:b.accent},children:K($.monto)}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>ue($),className:"text-indigo-600 hover:text-indigo-900",children:r.jsx(zr,{size:16})}),r.jsx("button",{onClick:()=>ve($.id),className:"text-red-600 hover:text-red-900",children:r.jsx(qn,{size:16})})]})})]},$.id)})})]})}),!o&&q.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(hd,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No hay gastos para el perodo seleccionado"}),r.jsx("p",{className:"text-gray-500",children:"Los gastos aparecern aqu cuando los registres"})]})]})]})}const or=["efectivo","nequi","tarjeta","provision_caja"],Fh={efectivo:"Efectivo",nequi:"Nequi",tarjeta:"Tarjeta",provision_caja:"Provisin caja"},Uh=(e,t)=>{var a,o;const s=t.fecha.getTime()-e.fecha.getTime();if(s!==0)return s;const n=(((a=t.created_at)==null?void 0:a.getTime())??0)-(((o=e.created_at)==null?void 0:o.getTime())??0);return n!==0?n:t.id.localeCompare(e.id)},C1=new Intl.DateTimeFormat("es-CO",{month:"long",year:"numeric"}),E1=new Intl.DateTimeFormat("es-CO",{dateStyle:"medium"}),T1=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`,M1=e=>{const[t,s]=e.split("-").map(Number);return!t||!s?e:C1.format(new Date(t,s-1,1))},P1=e=>{const t=[],s=new Set,n=Fs(),a=Wr(n);for(let o=0;o<e;o+=1){const i=new Date(a);i.setDate(a.getDate()-o*7);const l=Hu(i);s.has(l)||(t.push({key:l,label:Pa(l)}),s.add(l))}return t};function D1(){var j;const[e,t]=h.useState(!0),[s,n]=h.useState(null),[a,o]=h.useState([]),[i,l]=h.useState([]),[c,d]=h.useState({}),[u,m]=h.useState([]),f=h.useMemo(()=>P1(16),[]),p=((j=f[0])==null?void 0:j.key)??Fs(),[S,E]=h.useState(p),[T,y]=h.useState({}),[g,x]=h.useState(!1),[_,F]=h.useState([]),[A,H]=h.useState(!1),[R,ge]=h.useState(!1),[ce,I]=h.useState(null),[ee,te]=h.useState({monto:"",fecha:Na(),descripcion:"",origen:"caja_principal",destino:"provision_caja"}),be=h.useMemo(()=>{const k=new Map;return u.forEach(z=>{k.set(z.codigo,z)}),k},[u]),Se=h.useMemo(()=>u.length>0?u:[{codigo:"caja_principal",nombre:"Caja principal",metodoPago:"efectivo",esPrincipal:!0},{codigo:"provision_caja",nombre:"Provisin de caja",metodoPago:"efectivo",esPrincipal:!1}],[u]),_e=h.useCallback(k=>{if(!k)return"";const z=be.get(k);return z?z.nombre:k==="caja_principal"?"Caja principal":k==="provision_caja"?"Provisin de caja":k},[be]);h.useEffect(()=>{var k;E(((k=f[0])==null?void 0:k.key)??Fs())},[f]),h.useEffect(()=>{let k=!0;return(async()=>{t(!0),n(null);try{const[P,Z,me,we,De]=await Promise.all([ye.fetchGastos(),ye.fetchEmpleados(),ye.fetchEmployeeBaseSchedules(),ye.fetchProvisionTransfers(),ye.fetchCajaBolsillos()]);if(!k)return;o(P),l(Z),d(me),F(we),m(De)}catch(P){console.error("Error cargando la informacin de contabilidad:",P),k&&n("No se pudo cargar la informacin. Intenta nuevamente.")}finally{k&&t(!1)}})(),()=>{k=!1}},[]),h.useEffect(()=>{if(!S||T[S])return;let k=!1;return x(!0),(async()=>{try{const P=await ye.fetchEmployeeWeeklyHoursForWeek(S);if(k)return;y(Z=>({...Z,[S]:P}))}catch(P){console.error("Error cargando horas semanales de empleados:",P)}finally{k||x(!1)}})(),()=>{k=!0,x(!1)}},[S,T]);const Ee=h.useMemo(()=>{const k={efectivo:0,nequi:0,tarjeta:0,provision_caja:0};return a.forEach(z=>{const P=z.metodoPago??"efectivo";if(!or.includes(P))return;const Z=P;k[Z]+=z.monto}),k},[a]),se=h.useMemo(()=>or.reduce((k,z)=>k+(Ee[z]??0),0),[Ee]),oe=h.useMemo(()=>{const k=new Map;return a.forEach(z=>{const P=z.fecha instanceof Date?z.fecha:new Date(z.fecha),Z=z.metodoPago??"efectivo";if(!or.includes(Z))return;const me=T1(P),we=k.get(me)??{efectivo:0,nequi:0,tarjeta:0,provision_caja:0,total:0},De=Z;we[De]+=z.monto,we.total+=z.monto,k.set(me,we)}),Array.from(k.entries()).map(([z,P])=>({key:z,label:M1(z),...P})).sort((z,P)=>z.key>P.key?-1:1)},[a]),Q=h.useMemo(()=>{const k=new Map;return a.forEach(z=>{var Z;const P=((Z=z.categoria)==null?void 0:Z.trim())||"Sin categora";k.set(P,(k.get(P)??0)+z.monto)}),Array.from(k.entries()).sort((z,P)=>P[1]-z[1])},[a]),J=h.useMemo(()=>_.slice().sort(Uh),[_]),D=h.useMemo(()=>_.filter(k=>k.bolsilloDestino==="provision_caja").reduce((k,z)=>k+z.monto,0),[_]),le=h.useMemo(()=>_.filter(k=>k.bolsilloOrigen==="provision_caja").reduce((k,z)=>k+z.monto,0),[_]),U=D-le,Y=T[S]||{},ue=h.useMemo(()=>i.length?i.map(k=>{let P=Y[k.id]??null,Z="registro";if(!P){const De=c[k.id];De?(P=Fn(De),Z="base"):(P=Fn(_x(k)),Z="estimado")}const me=_s(P),we=me*(Number(k.salario_hora)||0);return{empleado:k,horas:me,salario:we,origen:Z}}).sort((k,z)=>z.salario-k.salario):[],[i,Y,c]),ve=h.useMemo(()=>ue.reduce((k,z)=>k+z.salario,0),[ue]),W=k=>{E(k.target.value)},C=k=>z=>{const P=z.target.value;te(Z=>({...Z,[k]:P}))},q=k=>z=>{const P=z.target.value;te(Z=>({...Z,[k]:P}))},X=async k=>{k.preventDefault(),I(null);const z=Math.max(0,Math.round(Number(ee.monto)||0));if(z<=0){I("Ingresa un monto mayor a cero.");return}if(!ee.fecha){I("Selecciona la fecha del movimiento.");return}const P=Nt(ee.fecha);if(!(P instanceof Date)||Number.isNaN(P.getTime())){I("La fecha no es vlida.");return}if(!ee.origen||!ee.destino){I("Selecciona los bolsillos de origen y destino.");return}if(ee.origen===ee.destino){I("Elige bolsillos diferentes para origen y destino.");return}const Z=be.get(ee.origen),me=be.get(ee.destino),we=Z==null?void 0:Z.metodoPago,De=we==="nequi"||we==="tarjeta"?we:"efectivo";ge(!0);try{const Be=await ye.createProvisionTransfer({monto:z,fecha:P,descripcion:ee.descripcion,origenMetodo:De,destinoMetodo:me==null?void 0:me.metodoPago,bolsilloOrigen:ee.origen,bolsilloDestino:ee.destino,origenNombre:Z==null?void 0:Z.nombre,destinoNombre:me==null?void 0:me.nombre});F(He=>[Be,...He].sort(Uh)),te({monto:"",fecha:Na(),descripcion:"",origen:ee.origen,destino:ee.destino}),H(!1)}catch(Be){console.error("Error registrando movimiento de provisin:",Be),I(Be instanceof Error&&Be.message||"No se pudo registrar el movimiento.")}finally{ge(!1)}},xe=async k=>{if(k&&window.confirm("Eliminar este movimiento de provisin?"))try{await ye.deleteProvisionTransfer(k),F(z=>z.filter(P=>P.id!==k))}catch(z){console.error("Error eliminando movimiento de provisin:",z),I(z instanceof Error&&z.message||"No se pudo eliminar el movimiento.")}},$=U>=0?"text-green-600":"text-red-600";return e?r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mi,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Contabilidad"})]}),r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600",children:[r.jsx(nt,{className:"animate-spin",size:18}),r.jsx("span",{children:"Cargando informacin"})]})]}):s?r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mi,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Contabilidad"})]}),r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-red-600",children:[r.jsx(Rr,{size:18}),r.jsx("span",{children:s})]})]}):r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(mi,{size:24,style:{color:b.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:b.dark},children:"Contabilidad"})]})}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(dv,{size:18,style:{color:b.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Provisin de caja"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Registra lo que mueves desde la caja y controla el saldo disponible para gastos futuros."})]})]}),r.jsx("button",{type:"button",onClick:()=>{H(k=>!k),I(null)},className:"px-3 py-2 text-sm font-medium text-white rounded-lg",style:{backgroundColor:b.accent},children:A?"Cancelar registro":"Registrar movimiento"})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Transferido a provisin"}),r.jsx("p",{className:"text-lg font-semibold",style:{color:b.dark},children:K(D)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Retirado de provisin"}),r.jsx("p",{className:"text-lg font-semibold text-red-600",children:K(le)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Saldo disponible"}),r.jsx("p",{className:`text-lg font-semibold ${$}`,children:K(U)})]})]}),A&&r.jsxs("form",{className:"grid gap-3 sm:grid-cols-6",onSubmit:X,children:[r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Monto",r.jsx("input",{type:"number",min:"1",step:"1",value:ee.monto,onChange:C("monto"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":b.accent},placeholder:"0",required:!0})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Fecha",r.jsx("input",{type:"date",value:ee.fecha,onChange:C("fecha"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":b.accent},required:!0})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Desde",r.jsx("select",{value:ee.origen,onChange:q("origen"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":b.accent},children:Se.map(k=>{const z=ns[k.metodoPago]??k.metodoPago;return r.jsx("option",{value:k.codigo,disabled:k.codigo===ee.destino,children:`${k.nombre}  ${z}`},k.codigo)})})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Hacia",r.jsx("select",{value:ee.destino,onChange:q("destino"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":b.accent},children:Se.map(k=>{const z=ns[k.metodoPago]??k.metodoPago;return r.jsx("option",{value:k.codigo,disabled:k.codigo===ee.origen,children:`${k.nombre}  ${z}`},k.codigo)})})]}),r.jsxs("label",{className:"flex flex-col gap-1 sm:col-span-6 text-xs font-medium text-gray-600",children:["Descripcin (opcional)",r.jsx("input",{type:"text",value:ee.descripcion,onChange:C("descripcion"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":b.accent},placeholder:"Ej. Arqueo semanal"})]}),r.jsx("div",{className:"sm:col-span-6 flex justify-end gap-2",children:r.jsx("button",{type:"submit",disabled:R,className:"px-3 py-2 text-sm font-semibold text-white rounded-lg disabled:opacity-60",style:{backgroundColor:b.dark},children:R?"Guardando":"Guardar movimiento"})})]}),ce&&r.jsx("p",{className:"text-sm text-red-600",children:ce}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Fecha"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Descripcin"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Desde"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Hacia"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Monto"}),r.jsx("th",{className:"py-2 pr-4 font-medium text-right",children:"Acciones"})]})}),r.jsx("tbody",{children:J.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"py-4 pr-4 text-center text-gray-500",children:"An no registras movimientos de provisin."})}):J.map(k=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:E1.format(k.fecha)}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:k.descripcion??""}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:b.dark},children:_e(k.bolsilloOrigen)}),r.jsx("span",{className:"text-xs text-gray-500",children:ns[k.origen]??k.origen})]})}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:b.dark},children:_e(k.bolsilloDestino)}),r.jsx("span",{className:"text-xs text-gray-500",children:k.destinoMetodo?ns[k.destinoMetodo]??k.destinoMetodo:""})]})}),r.jsx("td",{className:"py-2 pr-4 text-green-600 font-semibold",children:K(k.monto)}),r.jsx("td",{className:"py-2 pr-4 text-right",children:r.jsx("button",{type:"button",onClick:()=>xe(k.id),className:"inline-flex items-center justify-center rounded-md border border-transparent px-2 py-1 text-xs font-medium text-gray-500 hover:text-red-600 hover:bg-red-50",children:r.jsx(qn,{size:16})})})]},k.id))})]})})]}),r.jsx("div",{className:"grid gap-4 md:gap-6 lg:grid-cols-3",children:or.map(k=>{const z=Ee[k]??0,P=se>0?z/se*100:0;return r.jsxs("div",{className:"ui-card ui-card-pad space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Tu,{size:18,style:{color:b.dark}}),r.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-gray-600",children:Fh[k]})]}),r.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Histrico"})]}),r.jsx("p",{className:"text-2xl font-bold",style:{color:b.dark},children:K(z)}),r.jsxs("p",{className:"text-sm text-gray-500",children:[P.toFixed(1),"% de los gastos registrados"]})]},k)})}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ug,{size:18,style:{color:b.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Histrico por mtodo de pago"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Gastos mensuales separados por mtodo en los ltimos registros"})]})]}),oe.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay gastos registrados."}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Mes"}),or.map(k=>r.jsx("th",{className:"py-2 pr-4 font-medium",children:Fh[k]},k)),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Total"})]})}),r.jsx("tbody",{children:oe.map(k=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:k.label}),or.map(z=>r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:K(k[z])},z)),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-semibold",children:K(k.total)})]},k.key))})]})})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Cu,{size:18,style:{color:b.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Nmina semanal estimada"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Calculada segn las horas registradas o la programacin base"})]})]}),r.jsx("select",{value:S,onChange:W,className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2",style:{"--tw-ring-color":b.accent},children:f.map(k=>r.jsx("option",{value:k.key,children:k.label},k.key))})]}),i.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay empleados registrados."}):r.jsxs("div",{className:"space-y-3",children:[g&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(nt,{size:16,className:"animate-spin"}),r.jsx("span",{children:"Cargando horas de la semana seleccionada"})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Empleado"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Horas"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Valor hora"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"A pagar"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Fuente"})]})}),r.jsx("tbody",{children:ue.map(k=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:k.empleado.nombre}),r.jsxs("td",{className:"py-2 pr-4 text-gray-600",children:[ht(k.horas)," h"]}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:K(k.empleado.salario_hora)}),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-semibold",children:K(k.salario)}),r.jsxs("td",{className:"py-2 pr-4 text-gray-500 capitalize",children:[k.origen==="registro"&&"Registro",k.origen==="base"&&"Horario base",k.origen==="estimado"&&"Estimado"]})]},k.empleado.id))}),r.jsx("tfoot",{children:r.jsxs("tr",{className:"border-t border-gray-200",children:[r.jsx("td",{className:"py-2 pr-4 text-sm font-semibold text-gray-600",colSpan:3,children:"Total semanal"}),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-bold",children:K(ve)}),r.jsx("td",{})]})})]})})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Hi,{size:18,style:{color:b.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Gastos por categora"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Distribucin acumulada segn las categoras registradas"})]})]}),Q.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay gastos registrados."}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Categora"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Total"})]})}),r.jsx("tbody",{children:Q.map(([k,z])=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:k}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:K(z)})]},k))})]})})]})]})}const I1=[{username:"admin",password:"299381Be@",role:"admin"},{username:"javier",password:"123450",role:"admin"},{username:"briyith",password:"123450",role:"admin"},{username:"employee",password:"Savia123",role:"employee"},{username:"miguel",password:"1081058106",role:"employee"},{username:"lina",password:"1004236331",role:"admin"}];function O1(e,t){const s=I1.find(n=>n.username===e&&n.password===t);return s?{username:s.username,role:s.role}:null}function A1({onLogin:e}){const[t,s]=h.useState(""),[n,a]=h.useState(""),[o,i]=h.useState(""),[l,c]=h.useState(!1),d=u=>{u.preventDefault();const m=O1(t,n);m?e(m):i("Credenciales invlidas")};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:r.jsxs("div",{className:"bg-white p-8 rounded shadow-md w-96",children:[r.jsx("h1",{className:"text-xl font-bold text-center text-gray-800",children:"Controlador Savia"}),r.jsx("p",{className:"text-center text-sm text-gray-600 mb-6",children:"Sistema de Gestin de Inventario"}),r.jsxs("form",{onSubmit:d,children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"username",children:"Usuario"}),r.jsxs("div",{className:"relative mb-4",children:[r.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",value:t,onChange:u=>s(u.target.value),placeholder:"Ingresa tu usuario",className:"w-full pl-10 p-2 border rounded"}),r.jsx(yg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]}),r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"password",children:"Contrasea"}),r.jsxs("div",{className:"relative mb-4",children:[r.jsx("input",{id:"password",name:"password",type:l?"text":"password",autoComplete:"current-password",value:n,onChange:u=>a(u.target.value),placeholder:"Ingresa tu contrasea",className:"w-full pl-10 pr-10 p-2 border rounded"}),r.jsx(wv,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),r.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",children:l?r.jsx(yv,{size:18}):r.jsx(vv,{size:18})})]}),o&&r.jsx("div",{className:"text-red-500 text-sm mb-3",children:o}),r.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:"Iniciar Sesin"})]}),r.jsx("p",{className:"text-center text-xs text-gray-500 mt-6",children:"La sesin se mantendr activa por 4 horas"}),r.jsx("p",{className:"text-center text-xs text-gray-400 mt-2",children:" 2025 Controlador Roskuki - Sistema Seguro"})]})})}const Bh=[{id:"dashboard",label:"Dashboard",icon:jv},{id:"balance",label:"Balance",icon:Hi},{id:"caja",label:"Caja",icon:pg},{id:"comandas",label:"Comandas",icon:dd},{id:"inventario",label:"Inventario",icon:md},{id:"cocina",label:"Cocina",icon:cd},{id:"clientes",label:"Clientes",icon:Fr},{id:"empleados",label:"Empleados",icon:Pv},{id:"gastos",label:"Gastos",icon:hd},{id:"contabilidad",label:"Contabilidad",icon:mi},{id:"novedades",label:"Novedades",icon:Ja},{id:"creditoEmpleados",label:"Crdito empleados",icon:Os},{id:"analitica",label:"Analtica",icon:uv}];function $1({activeModule:e,onModuleChange:t,user:s,onLogout:n,connectionStatus:a}){const[o,i]=h.useState(!1),[l,c]=h.useState(!1),d=s.role==="admin"?Bh:Bh.filter(T=>["caja","comandas","cocina","clientes","gastos","inventario"].includes(T.id)),m={checking:{label:"Verificando conexin",dotClass:"bg-yellow-400 animate-pulse",textClass:"text-yellow-700"},online:{label:"Conectado a Base de Datos",dotClass:"bg-green-500",textClass:"text-green-700"},local:{label:"Modo sin conexin (local)",dotClass:"bg-red-500",textClass:"text-red-600"}}[a],f=T=>{t(T),i(!1)},p=()=>{n(),i(!1)},S=l?26:20,E=l?"w-10 h-10 text-lg":"w-8 h-8 text-base";return r.jsxs(r.Fragment,{children:[r.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm",children:r.jsxs("div",{className:`ui-page transition-all duration-300 ease-out ${l?"mx-0 px-6":""}`,style:l?{maxWidth:"100%"}:void 0,children:[r.jsx("div",{className:"hidden lg:block",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:l?r.jsxs("div",{className:"flex items-center justify-between gap-6 py-4",children:[r.jsx("div",{className:"flex items-center gap-3 flex-shrink-0",children:r.jsx("div",{className:`${E} rounded-lg flex items-center justify-center text-white font-bold transition-all duration-300`,style:{backgroundColor:b.accent},children:"S"})}),r.jsxs("div",{className:"flex flex-1 flex-wrap items-end justify-center gap-3 min-w-0",children:[d.map(({id:T,label:y,icon:g})=>r.jsxs("button",{onClick:()=>f(T),className:`
                        group flex flex-col items-center gap-1 rounded-xl px-3 py-2 transition-all duration-200
                        ${e===T?"text-white shadow-md":"text-gray-700 hover:text-gray-900 hover:bg-gray-100"}
                      `,style:{backgroundColor:e===T?b.dark:"transparent"},children:[r.jsx(g,{size:S,className:`transition-transform duration-200 ${e===T?"":"group-hover:scale-110"}`}),r.jsx("span",{className:"text-[11px] font-medium uppercase tracking-wide",children:y})]},T)),r.jsxs("button",{onClick:p,className:"group flex flex-col items-center gap-1 rounded-xl px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-all duration-200",children:[r.jsx(hi,{size:S,className:"transition-transform duration-200 group-hover:scale-110"}),r.jsx("span",{className:"text-[11px] font-medium uppercase tracking-wide",children:"Salir"})]})]}),r.jsxs("div",{className:`flex items-center gap-2 text-sm font-medium flex-shrink-0 ${m.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${m.dotClass}`}),r.jsx("span",{children:m.label})]})]}):r.jsxs("div",{className:"flex items-center justify-between gap-3 py-4",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[r.jsx("div",{className:`${E} rounded-lg flex items-center justify-center text-white font-bold transition-all duration-300`,style:{backgroundColor:b.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold hidden sm:block",style:{color:b.dark},children:"SAVIA Gestin"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:`flex items-center gap-2 text-sm font-medium ${m.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${m.dotClass}`}),r.jsx("span",{children:m.label})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-nowrap",children:[d.map(({id:T,label:y,icon:g})=>r.jsxs("button",{onClick:()=>f(T),className:`
                          group relative flex items-center justify-center rounded-lg p-2.5 transition-all duration-200
                          ${e===T?"text-white shadow-md transform scale-105":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}
                        `,style:{backgroundColor:e===T?b.dark:"transparent"},title:y,"aria-label":y,children:[r.jsx(g,{size:S,className:"flex-shrink-0"}),r.jsx("span",{className:"sr-only",children:y}),r.jsx("span",{className:"pointer-events-none absolute left-1/2 top-full z-10 mt-2 -translate-x-1/2 translate-y-0 whitespace-nowrap rounded-md bg-gray-900 px-2 py-1 text-xs font-medium text-white opacity-0 shadow-lg transition-all duration-150 hidden lg:block group-hover:translate-y-1 group-hover:opacity-100 group-focus:translate-y-1 group-focus:opacity-100",children:y})]},T)),r.jsxs("button",{onClick:p,className:"group relative flex items-center justify-center rounded-lg p-2.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100",title:"Salir","aria-label":"Salir",children:[r.jsx(hi,{size:S,className:"flex-shrink-0"}),r.jsx("span",{className:"sr-only",children:"Salir"}),r.jsx("span",{className:"pointer-events-none absolute left-1/2 top-full z-10 mt-2 -translate-x-1/2 translate-y-0 whitespace-nowrap rounded-md bg-gray-900 px-2 py-1 text-xs font-medium text-white opacity-0 shadow-lg transition-all duration-150 hidden lg:block group-hover:translate-y-1 group-hover:opacity-100 group-focus:translate-y-1 group-focus:opacity-100",children:"Salir"})]})]})]})]})}),r.jsxs("div",{className:"flex items-center justify-between gap-3 py-3 lg:hidden",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-base",style:{backgroundColor:b.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold",style:{color:b.dark},children:"SAVIA Gestin"})]}),r.jsx("button",{onClick:()=>i(!o),className:"p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":o?"Cerrar men":"Abrir men",children:o?r.jsx(Ur,{size:24}):r.jsx(kv,{size:24})})]})]})}),o&&r.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black bg-opacity-50",onClick:()=>i(!1),children:r.jsxs("div",{className:"fixed inset-y-0 left-0 w-full max-w-xs sm:max-w-sm bg-white shadow-xl flex flex-col h-full",onClick:T=>T.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-base",style:{backgroundColor:b.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold",style:{color:b.dark},children:"SAVIA Gestin"})]}),r.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100",children:r.jsx(Ur,{size:20})})]}),r.jsxs("div",{className:"py-4 flex-1 overflow-y-auto",children:[r.jsxs("div",{className:`px-4 pb-4 text-sm font-medium flex items-center gap-2 ${m.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${m.dotClass}`}),r.jsx("span",{children:m.label})]}),d.map(({id:T,label:y,icon:g})=>r.jsxs("button",{onClick:()=>f(T),className:`
                    w-full flex items-center gap-3 px-4 py-3 text-left transition-colors
                    ${e===T?"text-white":"text-gray-700 hover:bg-gray-100"}
                  `,style:{backgroundColor:e===T?b.dark:"transparent"},children:[r.jsx(g,{size:20}),r.jsx("span",{className:"font-medium",children:y})]},T)),r.jsx("div",{className:"border-t border-gray-200 mt-4 pt-4",children:r.jsxs("button",{onClick:p,className:"w-full flex items-center gap-3 px-4 py-3 text-left text-gray-700 hover:bg-gray-100 transition-colors",children:[r.jsx(hi,{size:20}),r.jsx("span",{className:"font-medium",children:"Salir"})]})})]})]})})]})}const gc="__sin_empleado__",Tx=[{value:"efectivo",label:"Efectivo",description:"Pago recibido en caja."},{value:"nequi",label:"Nequi",description:"Transferencia recibida a Nequi."},{value:"tarjeta",label:"Tarjeta",description:"Pago con datafono o tarjeta."}],Hh=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t},Wh=e=>{const t=new Date(e);return t.setHours(23,59,59,999),t},L1=e=>e.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}),R1=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"Fecha desconocida":t.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"})},Zo=(e,t)=>t&&t.trim().length>0?t.trim():`Empleado ${e.slice(0,6)}`,z1=e=>Tx.some(t=>t.value===e)?e:"efectivo";function F1({orders:e,onSettleCredit:t,onViewOrder:s}){const[n,a]=h.useState([]),[o,i]=h.useState(!0),[l,c]=h.useState(null),d=h.useMemo(()=>{const W=new Date;return W.setDate(1),ze(W)},[]),u=h.useMemo(()=>ze(new Date),[]),[m,f]=h.useState(d),[p,S]=h.useState(u),[E,T]=h.useState(""),[y,g]=h.useState("todos"),[x,_]=h.useState("todos"),[F,A]=h.useState(null),[H,R]=h.useState(null),[ge,ce]=h.useState("efectivo"),[I,ee]=h.useState(null);h.useEffect(()=>{let W=!0;const C=async()=>{i(!0),c(null);try{const X=await ye.fetchEmployeeCredits();if(!W)return;a(X)}catch(X){if(console.error("Error cargando el historial de crdito de empleados:",X),!W)return;c("No se pudo cargar el historial de crditos de empleados.")}finally{W&&i(!1)}};C();const q=()=>{C()};return typeof window<"u"&&window.addEventListener(Gn,q),()=>{W=!1,typeof window<"u"&&window.removeEventListener(Gn,q)}},[]);const te=h.useMemo(()=>e.filter(W=>{const C=W.creditInfo;return!C||C.type!=="empleados"?!1:!bs(W)}).map(W=>{var k;const C=W.creditInfo,q=C.assignedAt??W.timestamp,X=Math.max(0,Math.round(C.amount??W.total)),xe=(k=C.employeeName)==null?void 0:k.trim(),$=C.employeeId??void 0,j=xe&&xe.length>0?xe:$?`Empleado ${$}`:"Empleado sin asignar";return{order:W,assignedAt:q,amount:X,employeeLabel:j,employeeId:$}}).sort((W,C)=>C.assignedAt.getTime()-W.assignedAt.getTime()),[e]),be=h.useMemo(()=>{const W=Hh(Nt(m)),C=Wh(Nt(p));if(E){const q=Nt(E),X=Hh(q),xe=Wh(q);return{start:X.getTime(),end:xe.getTime(),isExact:!0}}return{start:W.getTime(),end:C.getTime(),isExact:!1}},[m,p,E]),Se=h.useMemo(()=>{const W=new Map;return n.forEach(C=>{const q=Zo(C.empleadoId,C.empleadoNombre);W.set(C.empleadoId,q)}),te.forEach(({employeeId:C,employeeLabel:q})=>{C&&(W.has(C)||W.set(C,q))}),te.some(C=>!C.employeeId)&&W.set(gc,"Crditos sin empleado asignado"),Array.from(W.entries()).map(([C,q])=>({key:C,label:q})).sort((C,q)=>C.label.localeCompare(q.label,"es"))},[n,te]);h.useEffect(()=>{if(y==="todos")return;Se.findIndex(C=>C.key===y)!==-1||y===gc&&te.some(C=>!C.employeeId)||g("todos")},[Se,te,y]);const _e=h.useMemo(()=>{const W=be.start,C=be.end;return te.filter(({assignedAt:q,employeeId:X})=>{const xe=q.getTime();return xe<W||xe>C?!1:y==="todos"?!0:y===gc?!X:X===y})},[te,be,y]),Ee=h.useMemo(()=>_e.reduce((W,C)=>W+C.amount,0),[_e]),se=h.useMemo(()=>n.reduce((W,C)=>W+Math.round(C.total),0),[n]),oe=h.useMemo(()=>n.flatMap(W=>W.history.map(C=>({...C,empleadoId:W.empleadoId,empleadoNombre:C.empleadoNombre??W.empleadoNombre??Zo(W.empleadoId)}))).sort((W,C)=>new Date(C.timestamp).getTime()-new Date(W.timestamp).getTime()),[n]),Q=h.useMemo(()=>{const W=be.start,C=be.end;return oe.filter(q=>{const X=new Date(q.timestamp).getTime();return!(Number.isNaN(X)||X<W||X>C||y!=="todos"&&q.empleadoId!==y||x!=="todos"&&q.tipo!==x)})},[be,oe,y,x]),J=h.useMemo(()=>Q.filter(W=>W.tipo==="cargo").reduce((W,C)=>W+C.monto,0),[Q]),D=h.useMemo(()=>Q.filter(W=>W.tipo==="abono").reduce((W,C)=>W+C.monto,0),[Q]),le=h.useMemo(()=>J-D,[J,D]),U=h.useMemo(()=>n.map(W=>({key:W.empleadoId,label:Zo(W.empleadoId,W.empleadoNombre),total:Math.round(W.total)})).sort((W,C)=>C.total-W.total),[n]),Y=W=>{R(W),ce("efectivo"),ee(null)},ue=()=>{F||(R(null),ee(null))},ve=async()=>{if(!H)return;const W=z1(ge);try{ee(null),A(H.order.id),await t(H.order,{metodo:W}),R(null)}catch(C){console.error("Error registrando el pago del crdito del empleado:",C),ee("No se pudo registrar el pago. Intntalo nuevamente.")}finally{A(null)}};return r.jsxs("section",{className:"space-y-6",children:[r.jsxs("header",{className:"space-y-2",children:[r.jsx("h2",{className:"text-2xl font-bold",style:{color:b.dark},children:"Crdito empleados"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Consulta los crditos asignados a colaboradores, revisa el historial de movimientos y liquida los pendientes directamente desde la plataforma."}),l&&r.jsx("div",{className:"mt-2 px-3 py-2 rounded-md bg-red-50 border border-red-200 text-sm text-red-600",children:l})]}),r.jsxs("section",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(Cu,{size:18}),r.jsx("span",{children:"Rango de fechas"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Desde",r.jsx("input",{type:"date",value:m,max:p,onChange:W=>f(W.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Hasta",r.jsx("input",{type:"date",value:p,min:m,onChange:W=>S(W.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]})]}),r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Fecha exacta (opcional)",r.jsx("input",{type:"date",value:E,max:u,onChange:W=>T(W.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent}})]}),E&&r.jsx("p",{className:"text-[11px] text-gray-500",children:"Al seleccionar una fecha exacta se ignora el rango indicado arriba."})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(Fr,{size:18}),r.jsx("span",{children:"Filtrar resultados"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("select",{value:y,onChange:W=>g(W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"todos",children:"Todos los empleados"}),Se.map(({key:W,label:C})=>r.jsx("option",{value:W,children:C},W))]}),r.jsxs("select",{value:x,onChange:W=>_(W.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":b.accent},children:[r.jsx("option",{value:"todos",children:"Todos los movimientos"}),r.jsx("option",{value:"cargo",children:"Solo cargos (crditos otorgados)"}),r.jsx("option",{value:"abono",children:"Solo abonos (pagos)"})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(dd,{size:18}),r.jsx("span",{children:"Resumen del perodo"})]}),r.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[r.jsxs("p",{children:["Total pendiente (global):"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:K(se)})]}),r.jsxs("p",{children:["Crditos pendientes filtrados:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.accent},children:K(Ee)})]}),r.jsxs("p",{children:["Cargos filtrados:"," ",r.jsx("span",{className:"font-semibold text-rose-600",children:K(J)})]}),r.jsxs("p",{children:["Abonos filtrados:"," ",r.jsx("span",{className:"font-semibold text-green-600",children:K(D)})]}),r.jsxs("p",{children:["Neto del perodo:"," ",r.jsx("span",{className:"font-semibold",style:{color:le>=0?b.dark:"#047857"},children:K(le)})]}),r.jsxs("p",{children:["Movimientos filtrados:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:Q.length})]})]})]})]}),r.jsxs("section",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"xl:col-span-2 ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Crditos pendientes por pedido"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Pedidos asignados como crdito de empleados dentro del filtro seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha asignacin"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empleado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Pedido"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Estado actual"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor pendiente"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-100",children:[_e.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay crditos de empleados para el filtro seleccionado."})}),_e.map(W=>{const{order:C,assignedAt:q,amount:X,employeeLabel:xe}=W,$=C.creditInfo?"Crdito empleados en seguimiento":ho(Ks(C),K),j=F===C.id;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:L1(q)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:xe}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden md:table-cell",children:C.numero?`#${C.numero}`:C.id}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-500 hidden lg:table-cell",children:$}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs font-semibold",style:{color:b.accent},children:K(X)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:[s&&r.jsxs("button",{type:"button",onClick:()=>s(C),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-blue-200 text-blue-600 hover:border-blue-600 hover:bg-blue-600 hover:text-white transition-colors",children:[r.jsx(dd,{size:14}),"Ver comanda"]}),r.jsxs("button",{type:"button",onClick:()=>Y(W),disabled:j,className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full bg-green-600 text-white font-semibold hover:bg-green-700 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[j?r.jsx(nt,{size:14,className:"animate-spin"}):r.jsx(Bi,{size:14}),j?"Procesando...":"Registrar pago"]})]})})]},C.id)})]})]})})]}),r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Saldo por empleado"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Total de crditos pendientes acumulados por colaborador."})]}),r.jsxs("div",{className:"divide-y divide-gray-100",children:[U.length===0&&r.jsx("p",{className:"px-4 py-6 text-xs lg:text-sm text-gray-500 text-center",children:"No hay crditos pendientes registrados."}),U.map(({key:W,label:C,total:q})=>r.jsxs("div",{className:"px-4 py-3 flex items-center justify-between text-sm",children:[r.jsx("span",{className:"font-medium text-gray-600",children:C}),r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:K(q)})]},W))]})]})]}),r.jsxs("section",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Historial de movimientos"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Registros de cargos (crditos asignados) y abonos (pagos) segn los filtros seleccionados."})]}),r.jsx(ud,{size:18,className:"text-gray-400"})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empleado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Movimiento"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Pedido relacionado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Saldo acumulado"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-100",children:[o&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"Cargando historial de movimientos..."})}),!o&&Q.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay movimientos registrados para los filtros seleccionados."})}),!o&&Q.map(W=>{const C=W.tipo==="cargo"?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700";return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:R1(W.timestamp)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:W.empleadoNombre??Zo(W.empleadoId)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs",children:r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-[11px] font-semibold ${C}`,children:W.tipo==="cargo"?"Cargo":"Abono"})}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden md:table-cell",children:typeof W.orderNumero=="number"?`#${W.orderNumero}`:W.orderId?W.orderId.slice(0,8):""}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-right font-semibold",style:{color:W.tipo==="cargo"?b.accent:"#047857"},children:K(W.monto)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-right text-gray-600 hidden lg:table-cell",children:typeof W.balanceAfter=="number"?K(W.balanceAfter):""})]},W.id)})]})]})})]}),H&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-lg shadow-xl",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:b.dark},children:"Registrar pago del crdito"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Selecciona el mtodo con el que el colaborador liquida el crdito pendiente."})]}),r.jsx("button",{type:"button",onClick:ue,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:r.jsx(Ur,{size:18})})]}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[r.jsxs("p",{children:["Pedido:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:H.order.numero?`#${H.order.numero}`:H.order.id})]}),r.jsxs("p",{children:["Empleado:"," ",r.jsx("span",{className:"font-semibold",style:{color:b.dark},children:H.employeeLabel})]}),r.jsxs("p",{children:["Monto pendiente:"," ",r.jsx("span",{className:"font-semibold text-green-600",children:K(H.amount)})]})]}),r.jsxs("div",{className:"mt-4 space-y-2",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Mtodo de pago recibido"}),r.jsx("div",{className:"space-y-2",children:Tx.map(W=>{const C=ge===W.value;return r.jsxs("label",{className:`flex items-start gap-3 border rounded-lg p-3 cursor-pointer transition-colors ${C?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-200"}`,children:[r.jsx("input",{type:"radio",className:"mt-1",checked:C,onChange:()=>ce(W.value)}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold text-gray-700",children:W.label}),r.jsx("p",{className:"text-xs text-gray-500",children:W.description})]})]},W.value)})})]}),I&&r.jsx("p",{className:"mt-3 text-sm text-red-600",children:I}),r.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[r.jsx("button",{type:"button",onClick:ue,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"button",onClick:ve,disabled:F===H.order.id,className:"px-4 py-2 rounded-lg bg-green-600 text-white text-sm font-semibold hover:bg-green-700 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:F===H.order.id?r.jsxs("span",{className:"inline-flex items-center gap-2",children:[r.jsx(nt,{size:16,className:"animate-spin"})," Procesando"]}):"Registrar pago"})]})]})})]})}const Vh={gastos:{label:"Gastos",bg:"bg-red-50",text:"text-red-700",border:"border-red-200",dot:"bg-red-400"},horarios:{label:"Horarios",bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",dot:"bg-blue-400"},ventas:{label:"Ventas",bg:"bg-emerald-50",text:"text-emerald-700",border:"border-emerald-200",dot:"bg-emerald-400"}};function ia(e){const t=e.getFullYear(),s=`${e.getMonth()+1}`.padStart(2,"0"),n=`${e.getDate()}`.padStart(2,"0");return`${t}-${s}-${n}`}function U1(e){return`${["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][e.getMonth()]} ${e.getFullYear()}`}function qh(e,t){return new Date(e.getFullYear(),e.getMonth()+t,1)}function B1(e){const t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0),n=(t.getDay()+6)%7,a=(s.getDay()+6)%7,o=new Date(t);o.setDate(t.getDate()-n);const i=new Date(s);i.setDate(s.getDate()+(6-a));const l=[],c=new Date(o);for(;c<=i;)l.push(new Date(c)),c.setDate(c.getDate()+1);return l}const H1=["Lun","Mar","Mi","Jue","Vie","Sb","Dom"],Gh={gastos:0,horarios:1,ventas:2};function W1({onNavigateToComandas:e,onNavigateToGastos:t}){const[s,n]=h.useState(()=>{const g=new Date;return new Date(g.getFullYear(),g.getMonth(),1)}),[a,o]=h.useState([]),[i,l]=h.useState([]),[c,d]=h.useState({}),u=h.useRef(new Set),[m,f]=h.useState(!0),[p,S]=h.useState(null),E=h.useMemo(()=>B1(s),[s]);h.useEffect(()=>{let g=!0;return(async()=>{f(!0);try{const[_,F]=await Promise.all([ye.fetchOrders(),ye.fetchGastos()]);if(!g)return;o(_),l(F),S(null)}catch(_){console.error("[Novedades] No se pudieron cargar todas las novedades.",_),g&&S("No se pudieron cargar todas las novedades.")}finally{g&&f(!1)}})(),()=>{g=!1}},[]),h.useEffect(()=>{if(E.length===0)return;Array.from(new Set(E.map(x=>Hu(x)))).forEach(x=>{!x||u.current.has(x)||(u.current.add(x),ye.fetchEmployeeWeeklyHoursForWeek(x).then(_=>{d(F=>({...F,[x]:_}))}).catch(_=>{console.error(`[Novedades] Error cargando horas semanales para ${x}.`,_)}))})},[E]);const T=h.useMemo(()=>{const g={},x=_=>(g[_]||(g[_]={ventasTotal:0,ventasCount:0,gastosTotal:0,gastosCount:0,horariosCount:0}),g[_]);return a.forEach(_=>{const F=_.timestamp instanceof Date?_.timestamp:new Date(_.timestamp);if(Number.isNaN(F.getTime()))return;const A=ia(F),H=x(A),R=Math.max(0,Math.round(Number(_.total)||0));H.ventasTotal+=R,H.ventasCount+=1}),i.forEach(_=>{const F=_.fecha instanceof Date?_.fecha:new Date(_.fecha);if(Number.isNaN(F.getTime()))return;const A=ia(F),H=x(A),R=Math.max(0,Math.round(Number(_.monto)||0));H.gastosTotal+=R,H.gastosCount+=1}),Object.entries(c).forEach(([_,F])=>{if(!F)return;const A=Wr(_);Number.isNaN(A.getTime())||pt.forEach((H,R)=>{const ge=new Date(A);ge.setDate(A.getDate()+R);const ce=ia(ge);Object.values(F).forEach(I=>{const ee=Number(I==null?void 0:I[H]);if(!Number.isFinite(ee)||ee<=0)return;const te=x(ce);te.horariosCount+=1})})}),g},[i,c,a]),y=ia(new Date);return r.jsx("section",{className:"min-h-[calc(100vh-4rem)] bg-white",children:r.jsxs("div",{className:"mx-auto max-w-7xl px-6 py-10",children:[r.jsxs("header",{className:"flex flex-col gap-6 pb-8 border-b border-gray-200",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 rounded-xl bg-gray-900 text-white shadow-sm",children:r.jsx(lg,{size:28})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Novedades"}),r.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Calendario de novedades"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{type:"button",onClick:()=>n(g=>qh(g,-1)),className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:r.jsx(pv,{size:20})}),r.jsx("span",{className:"text-lg font-semibold text-gray-900 capitalize min-w-[140px] text-center",children:U1(s)}),r.jsx("button",{type:"button",onClick:()=>n(g=>qh(g,1)),className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:r.jsx(gv,{size:20})})]})]}),r.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries(Vh).map(([g,x])=>r.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full border ${x.bg} ${x.border}`,children:[r.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${x.dot}`}),r.jsx("span",{className:`text-sm font-medium ${x.text}`,children:x.label})]},g))})]}),r.jsxs("div",{className:"pt-8",children:[m&&r.jsx("p",{className:"mb-4 text-sm text-gray-500",children:"Cargando novedades..."}),p&&!m&&r.jsx("p",{className:"mb-4 text-sm text-red-500",children:p}),r.jsx("div",{className:"grid grid-cols-7 text-center text-sm font-semibold text-gray-500 uppercase tracking-wide",children:H1.map(g=>r.jsx("div",{className:"py-2",children:g},g))}),r.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-xl overflow-hidden shadow-sm",children:E.map(g=>{const x=ia(g),_=T[x],F=[];if(_!=null&&_.ventasCount&&F.push({key:"ventas",label:`Ventas  ${K(_.ventasTotal)}`,onClick:e?()=>e(x):void 0}),_!=null&&_.gastosCount&&F.push({key:"gastos",label:`Gastos  ${K(_.gastosTotal)}`,onClick:t?()=>t(x):void 0}),_!=null&&_.horariosCount){const R=_.horariosCount;F.push({key:"horarios",label:`Horarios  ${R} ${R===1?"novedad":"novedades"}`})}F.sort((R,ge)=>Gh[R.key]-Gh[ge.key]);const A=g.getMonth()===s.getMonth(),H=x===y;return r.jsxs("div",{className:`bg-white p-3 min-h-[140px] flex flex-col gap-2 transition-colors ${A?"text-gray-900":"text-gray-400"} ${H?"ring-2 ring-gray-900 ring-offset-2 ring-offset-white":""}`,children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsx("span",{className:`text-sm font-semibold ${H?"text-gray-900":""}`,children:g.getDate()})}),r.jsx("div",{className:"flex-1 space-y-2 overflow-hidden",children:F.length===0?r.jsx("p",{className:"text-xs text-gray-300 font-medium",children:"Sin novedades"}):r.jsx("ul",{className:"space-y-2",children:F.map(R=>{const ge=Vh[R.key],ce=r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`h-2 w-2 rounded-full ${ge.dot}`}),r.jsx("span",{className:`text-xs font-semibold ${ge.text} truncate`,children:R.label})]});return r.jsx("li",{children:R.onClick?r.jsx("button",{type:"button",onClick:R.onClick,className:`w-full text-left rounded-lg border ${ge.bg} ${ge.border} px-3 py-2 transition-shadow hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900`,children:ce}):r.jsx("div",{className:`rounded-lg border ${ge.bg} ${ge.border} px-3 py-2`,children:ce})},R.key)})})})]},x+g.getDate())})})]})]})})}const ir="savia-user-session",V1=13*60*60*1e3;function q1(){const[e,t]=h.useState(null),[s,n]=h.useState("dashboard"),[a,o]=h.useState([]),[i,l]=h.useState(!1),[c,d]=h.useState([]),[u,m]=h.useState([]),[f,p]=h.useState("checking"),[S,E]=h.useState(null),[T,y]=h.useState(null),[g,x]=h.useState(!1),[_,F]=h.useState(!1);h.useEffect(()=>{Fv();try{const C=localStorage.getItem(ir);if(!C)return;const q=JSON.parse(C);if(!(q&&q.user&&typeof q.timestamp=="number")){localStorage.removeItem(ir);return}if(Date.now()-q.timestamp>V1){localStorage.removeItem(ir);return}t(q.user)}catch(C){console.error("[App] No se pudo restaurar la sesin guardada.",C),localStorage.removeItem(ir)}},[]),h.useEffect(()=>{if(!e){l(!1);return}let C=!0;return(async()=>{try{C&&l(!0);const X=await ye.fetchMenuItems();C&&o(X)}catch(X){console.error("[App] Error obteniendo items de men.",X)}finally{C&&l(!1)}})(),()=>{C=!1}},[e]),h.useEffect(()=>{let C=!0;const q=async()=>{try{const xe=await ye.checkDatabaseConnection();C&&p(xe)}catch(xe){console.error("[App] Error verificando la conexin con la base de datos.",xe),C&&p("local")}};q();const X=window.setInterval(q,3e4);return()=>{C=!1,window.clearInterval(X)}},[]),h.useEffect(()=>{if(!e){x(!1),F(!1);return}let C=!0;return(async()=>{try{C&&x(!0);const X=await ye.fetchOrders();C&&d(X)}catch(X){console.error("[App] Error obteniendo comandas.",X)}finally{C&&x(!1)}})(),()=>{C=!1}},[e]),h.useEffect(()=>{if(!e)return;let C=!0,q,X=!1;const xe=async()=>{if(!(!C||X)){X=!0,F(!0);try{const j=await ye.fetchOrders();C&&d(j)}catch(j){console.error("[App] Error actualizando comandas tras cambios remotos.",j)}finally{C&&F(!1),X=!1}}};return(async()=>{try{q=await ye.subscribeToOrders({onChange:xe,debounceMs:400})}catch(j){console.error("[App] No se pudo suscribir a los cambios de comandas.",j)}})(),()=>{C=!1,q&&q()}},[e]),h.useEffect(()=>{if(!e)return;let C=!0;return(async()=>{const X=await ye.fetchCustomers();C&&m(X)})(),()=>{C=!1}},[e]);const A=C=>{t(C);try{const q={user:C,timestamp:Date.now()};localStorage.setItem(ir,JSON.stringify(q))}catch(q){console.error("[App] No se pudo guardar la sesin del usuario.",q)}},H=()=>{t(null),n("dashboard"),o([]),d([]),m([]);try{localStorage.removeItem(ir)}catch(C){console.error("[App] No se pudo limpiar la sesin guardada.",C)}},R=C=>{(C==="analitica"||C==="contabilidad")&&(e==null?void 0:e.role)!=="admin"||(C==="comandas"&&E(null),n(C))},ge=C=>{const q=C.getFullYear(),X=String(C.getMonth()+1).padStart(2,"0"),xe=String(C.getDate()).padStart(2,"0");return`${q}-${X}-${xe}`},ce=(C,q)=>({dateKey:C,orderId:q,requestId:Date.now()}),I=C=>{E(ce(C)),n("comandas")},ee=C=>{const q=ge(C.timestamp);E(ce(q,C.id)),n("comandas")},te=C=>{y(ce(C)),n("gastos")},be=C=>{C.length&&o(q=>{const X=new Map(C.map(j=>[j.id,j]));let xe=!1;const $=q.map(j=>{const k=X.get(j.id);return k?(xe=!0,k):j});return xe?$:q})},Se=C=>{const q=[];return C.items.forEach(X=>{const xe=X.item;if(xe.inventarioCategoria!=="Inventariables")return;const $=xi({cantidad:X.cantidad,tipo:xe.inventarioTipo,unidad:xe.unidadMedida,item:xe});$!==0&&q.push({itemId:xe.id,delta:-$,reason:"venta"})}),q},_e=async C=>{const q=await ye.createMenuItem(C);o([...a,q])},Ee=async C=>{const q=await ye.updateMenuItem(C);o(a.map(X=>X.id===q.id?q:X))},se=async C=>{await ye.deleteMenuItem(C),o(a.filter(q=>q.id!==C))},oe=async C=>{const q=await ye.createOrder(C);d(xe=>[...xe,q]);const X=Se(q);if(X.length)try{const xe=await ye.applyInventoryAdjustments(X);xe.length&&be(xe)}catch(xe){console.error("[App] No se pudo actualizar el inventario tras registrar la venta.",xe)}},Q=async(C,q)=>{try{const X=await ye.recordOrderPayment(C,q);d(xe=>xe.map($=>$.id===X.id?X:$))}catch(X){throw console.error("Error registrando el pago del pedido:",X),X}},J=async(C,q)=>{try{const X=await ye.assignOrderCredit(C,q);d(xe=>xe.map($=>$.id===X.id?X:$))}catch(X){throw console.error("Error asignando el pedido a crdito de empleados:",X),X}},D=async(C,q)=>{try{const X=await ye.settleOrderEmployeeCredit(C,q);d(xe=>xe.map($=>$.id===X.id?X:$))}catch(X){throw console.error("Error marcando el crdito de empleados como pagado:",X),X}},le=async(C,q)=>{try{const X=await ye.updateOrderStatus(C,q);d(xe=>{const $=xe.findIndex(k=>k.id===X.id);if($===-1)return xe;const j=[...xe];return j[$]=X,j})}catch(X){console.error("Error actualizando el estado del pedido:",X),alert("No se pudo actualizar el estado del pedido. Intntalo nuevamente.")}},U=async(C,q)=>{try{await ye.updateOrder(C,q),d(X=>X.map(xe=>xe.id===C?{...xe,items:q.items,total:q.total,paymentAllocations:[],paymentStatus:"pendiente",paymentRegisteredAt:void 0}:xe))}catch(X){throw console.error("Error actualizando la orden:",X),X}},Y=async C=>{try{await ye.deleteOrder(C),d(q=>q.filter(X=>X.id!==C))}catch(q){throw console.error("Error eliminando la comanda:",q),q}},ue=async C=>{const q=await ye.createCustomer(C);m([...u,q])},ve=async C=>{await ye.updateCustomer(C),m(u.map(q=>q.id===C.id?C:q))},W=async C=>{await ye.deleteCustomer(C),m(u.filter(q=>q.id!==C))};return e?r.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[r.jsx($1,{activeModule:s,onModuleChange:R,user:e,onLogout:H,connectionStatus:f}),r.jsx("main",{className:"ui-page py-6",children:r.jsxs("div",{className:"ui-page-stack",children:[s==="dashboard"&&r.jsx(Gv,{orders:c,menuItems:a,onModuleChange:R,isLoadingOrders:g,isLoadingMenuItems:i}),s==="balance"&&r.jsx(ZN,{}),s==="caja"&&r.jsx(o1,{orders:c,onModuleChange:R,onCreateOrder:oe,onRecordOrderPayment:Q,onAssignOrderCredit:J}),s==="comandas"&&r.jsx(l1,{orders:c,onUpdateOrderStatus:le,onSaveOrderChanges:U,onRecordOrderPayment:Q,onDeleteOrder:Y,isAdmin:e.role==="admin",onAssignOrderCredit:J,focusRequest:S,isLoading:g,isSyncing:_}),s==="inventario"&&r.jsx(c1,{menuItems:a,onUpdateMenuItem:Ee,onCreateMenuItem:_e,onDeleteMenuItem:se,isLoading:i}),s==="cocina"&&r.jsx(d1,{orders:c,onUpdateOrderStatus:le}),s==="clientes"&&r.jsx(u1,{customers:u,onAddCustomer:ue,onUpdateCustomer:ve,onDeleteCustomer:W}),s==="empleados"&&r.jsx(N1,{}),s==="gastos"&&r.jsx(_1,{focusRequest:T,menuItems:a,onInventoryItemsUpdated:be}),s==="contabilidad"&&e.role==="admin"&&r.jsx(D1,{}),s==="novedades"&&r.jsx(W1,{onNavigateToComandas:I,onNavigateToGastos:te}),s==="creditoEmpleados"&&r.jsx(F1,{orders:c,onSettleCredit:D,onViewOrder:ee}),s==="analitica"&&e.role==="admin"&&r.jsx(bx,{orders:c,isLoadingOrders:g})]})})]}):r.jsx(A1,{onLogin:A})}ig(document.getElementById("root")).render(r.jsx(h.StrictMode,{children:r.jsx(q1,{})}));
