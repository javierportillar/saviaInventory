import{_ as no}from"./index.js";var ns=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function jx(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var s=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};s.prototype=t.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(s,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}),s}var zm={exports:{}},Vi={},Fm={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ro=Symbol.for("react.element"),wx=Symbol.for("react.portal"),Nx=Symbol.for("react.fragment"),kx=Symbol.for("react.strict_mode"),Sx=Symbol.for("react.profiler"),_x=Symbol.for("react.provider"),Cx=Symbol.for("react.context"),Ex=Symbol.for("react.forward_ref"),Tx=Symbol.for("react.suspense"),Mx=Symbol.for("react.memo"),Px=Symbol.for("react.lazy"),qu=Symbol.iterator;function Dx(e){return e===null||typeof e!="object"?null:(e=qu&&e[qu]||e["@@iterator"],typeof e=="function"?e:null)}var Um={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bm=Object.assign,Hm={};function Br(e,t,s){this.props=e,this.context=t,this.refs=Hm,this.updater=s||Um}Br.prototype.isReactComponent={};Br.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Br.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Wm(){}Wm.prototype=Br.prototype;function Md(e,t,s){this.props=e,this.context=t,this.refs=Hm,this.updater=s||Um}var Pd=Md.prototype=new Wm;Pd.constructor=Md;Bm(Pd,Br.prototype);Pd.isPureReactComponent=!0;var Vu=Array.isArray,qm=Object.prototype.hasOwnProperty,Dd={current:null},Vm={key:!0,ref:!0,__self:!0,__source:!0};function Gm(e,t,s){var n,a={},o=null,i=null;if(t!=null)for(n in t.ref!==void 0&&(i=t.ref),t.key!==void 0&&(o=""+t.key),t)qm.call(t,n)&&!Vm.hasOwnProperty(n)&&(a[n]=t[n]);var l=arguments.length-2;if(l===1)a.children=s;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps,l)a[n]===void 0&&(a[n]=l[n]);return{$$typeof:ro,type:e,key:o,ref:i,props:a,_owner:Dd.current}}function Ox(e,t){return{$$typeof:ro,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Od(e){return typeof e=="object"&&e!==null&&e.$$typeof===ro}function Ix(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(s){return t[s]})}var Gu=/\/+/g;function Nl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ix(""+e.key):t.toString(36)}function Go(e,t,s,n,a){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var i=!1;if(e===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case ro:case wx:i=!0}}if(i)return i=e,a=a(i),e=n===""?"."+Nl(i,0):n,Vu(a)?(s="",e!=null&&(s=e.replace(Gu,"$&/")+"/"),Go(a,t,s,"",function(d){return d})):a!=null&&(Od(a)&&(a=Ox(a,s+(!a.key||i&&i.key===a.key?"":(""+a.key).replace(Gu,"$&/")+"/")+e)),t.push(a)),1;if(i=0,n=n===""?".":n+":",Vu(e))for(var l=0;l<e.length;l++){o=e[l];var c=n+Nl(o,l);i+=Go(o,t,s,c,a)}else if(c=Dx(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=n+Nl(o,l++),i+=Go(o,t,s,c,a);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function wo(e,t,s){if(e==null)return e;var n=[],a=0;return Go(e,n,"","",function(o){return t.call(s,o,a++)}),n}function Ax(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(s){(e._status===0||e._status===-1)&&(e._status=1,e._result=s)},function(s){(e._status===0||e._status===-1)&&(e._status=2,e._result=s)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var It={current:null},Ko={transition:null},$x={ReactCurrentDispatcher:It,ReactCurrentBatchConfig:Ko,ReactCurrentOwner:Dd};function Km(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:wo,forEach:function(e,t,s){wo(e,function(){t.apply(this,arguments)},s)},count:function(e){var t=0;return wo(e,function(){t++}),t},toArray:function(e){return wo(e,function(t){return t})||[]},only:function(e){if(!Od(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Oe.Component=Br;Oe.Fragment=Nx;Oe.Profiler=Sx;Oe.PureComponent=Md;Oe.StrictMode=kx;Oe.Suspense=Tx;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$x;Oe.act=Km;Oe.cloneElement=function(e,t,s){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Bm({},e.props),a=e.key,o=e.ref,i=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,i=Dd.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)qm.call(t,c)&&!Vm.hasOwnProperty(c)&&(n[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)n.children=s;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:ro,type:e.type,key:a,ref:o,props:n,_owner:i}};Oe.createContext=function(e){return e={$$typeof:Cx,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:_x,_context:e},e.Consumer=e};Oe.createElement=Gm;Oe.createFactory=function(e){var t=Gm.bind(null,e);return t.type=e,t};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(e){return{$$typeof:Ex,render:e}};Oe.isValidElement=Od;Oe.lazy=function(e){return{$$typeof:Px,_payload:{_status:-1,_result:e},_init:Ax}};Oe.memo=function(e,t){return{$$typeof:Mx,type:e,compare:t===void 0?null:t}};Oe.startTransition=function(e){var t=Ko.transition;Ko.transition={};try{e()}finally{Ko.transition=t}};Oe.unstable_act=Km;Oe.useCallback=function(e,t){return It.current.useCallback(e,t)};Oe.useContext=function(e){return It.current.useContext(e)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(e){return It.current.useDeferredValue(e)};Oe.useEffect=function(e,t){return It.current.useEffect(e,t)};Oe.useId=function(){return It.current.useId()};Oe.useImperativeHandle=function(e,t,s){return It.current.useImperativeHandle(e,t,s)};Oe.useInsertionEffect=function(e,t){return It.current.useInsertionEffect(e,t)};Oe.useLayoutEffect=function(e,t){return It.current.useLayoutEffect(e,t)};Oe.useMemo=function(e,t){return It.current.useMemo(e,t)};Oe.useReducer=function(e,t,s){return It.current.useReducer(e,t,s)};Oe.useRef=function(e){return It.current.useRef(e)};Oe.useState=function(e){return It.current.useState(e)};Oe.useSyncExternalStore=function(e,t,s){return It.current.useSyncExternalStore(e,t,s)};Oe.useTransition=function(){return It.current.useTransition()};Oe.version="18.3.1";Fm.exports=Oe;var p=Fm.exports;const Ku=bx(p);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rx=p,Lx=Symbol.for("react.element"),zx=Symbol.for("react.fragment"),Fx=Object.prototype.hasOwnProperty,Ux=Rx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bx={key:!0,ref:!0,__self:!0,__source:!0};function Qm(e,t,s){var n,a={},o=null,i=null;s!==void 0&&(o=""+s),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)Fx.call(t,n)&&!Bx.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:Lx,type:e,key:o,ref:i,props:a,_owner:Ux.current}}Vi.Fragment=zx;Vi.jsx=Qm;Vi.jsxs=Qm;zm.exports=Vi;var r=zm.exports,Ym={exports:{}},Qt={},Jm={exports:{}},Xm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(re,ae){var _=re.length;re.push(ae);e:for(;0<_;){var ie=_-1>>>1,O=re[ie];if(0<a(O,ae))re[ie]=ae,re[_]=O,_=ie;else break e}}function s(re){return re.length===0?null:re[0]}function n(re){if(re.length===0)return null;var ae=re[0],_=re.pop();if(_!==ae){re[0]=_;e:for(var ie=0,O=re.length,se=O>>>1;ie<se;){var R=2*(ie+1)-1,C=re[R],H=R+1,Q=re[H];if(0>a(C,_))H<O&&0>a(Q,C)?(re[ie]=Q,re[H]=_,ie=H):(re[ie]=C,re[R]=_,ie=R);else if(H<O&&0>a(Q,_))re[ie]=Q,re[H]=_,ie=H;else break e}}return ae}function a(re,ae){var _=re.sortIndex-ae.sortIndex;return _!==0?_:re.id-ae.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var i=Date,l=i.now();e.unstable_now=function(){return i.now()-l}}var c=[],d=[],u=1,h=null,m=3,x=!1,w=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(re){for(var ae=s(d);ae!==null;){if(ae.callback===null)n(d);else if(ae.startTime<=re)n(d),ae.sortIndex=ae.expirationTime,t(c,ae);else break;ae=s(d)}}function b(re){if(S=!1,g(re),!w)if(s(c)!==null)w=!0,ue($);else{var ae=s(d);ae!==null&&Z(b,ae.startTime-re)}}function $(re,ae){w=!1,S&&(S=!1,y(z),z=-1),x=!0;var _=m;try{for(g(ae),h=s(c);h!==null&&(!(h.expirationTime>ae)||re&&!D());){var ie=h.callback;if(typeof ie=="function"){h.callback=null,m=h.priorityLevel;var O=ie(h.expirationTime<=ae);ae=e.unstable_now(),typeof O=="function"?h.callback=O:h===s(c)&&n(c),g(ae)}else n(c);h=s(c)}if(h!==null)var se=!0;else{var R=s(d);R!==null&&Z(b,R.startTime-ae),se=!1}return se}finally{h=null,m=_,x=!1}}var A=!1,B=null,z=-1,de=5,P=-1;function D(){return!(e.unstable_now()-P<de)}function Y(){if(B!==null){var re=e.unstable_now();P=re;var ae=!0;try{ae=B(!0,re)}finally{ae?K():(A=!1,B=null)}}else A=!1}var K;if(typeof f=="function")K=function(){f(Y)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,ye=pe.port2;pe.port1.onmessage=Y,K=function(){ye.postMessage(null)}}else K=function(){E(Y,0)};function ue(re){B=re,A||(A=!0,K())}function Z(re,ae){z=E(function(){re(e.unstable_now())},ae)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(re){re.callback=null},e.unstable_continueExecution=function(){w||x||(w=!0,ue($))},e.unstable_forceFrameRate=function(re){0>re||125<re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):de=0<re?Math.floor(1e3/re):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return s(c)},e.unstable_next=function(re){switch(m){case 1:case 2:case 3:var ae=3;break;default:ae=m}var _=m;m=ae;try{return re()}finally{m=_}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(re,ae){switch(re){case 1:case 2:case 3:case 4:case 5:break;default:re=3}var _=m;m=re;try{return ae()}finally{m=_}},e.unstable_scheduleCallback=function(re,ae,_){var ie=e.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?ie+_:ie):_=ie,re){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=_+O,re={id:u++,callback:ae,priorityLevel:re,startTime:_,expirationTime:O,sortIndex:-1},_>ie?(re.sortIndex=_,t(d,re),s(c)===null&&re===s(d)&&(S?(y(z),z=-1):S=!0,Z(b,_-ie))):(re.sortIndex=O,t(c,re),w||x||(w=!0,ue($))),re},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(re){var ae=m;return function(){var _=m;m=ae;try{return re.apply(this,arguments)}finally{m=_}}}})(Xm);Jm.exports=Xm;var Hx=Jm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wx=p,Kt=Hx;function oe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,s=1;s<arguments.length;s++)t+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Zm=new Set,Da={};function Gn(e,t){Er(e,t),Er(e+"Capture",t)}function Er(e,t){for(Da[e]=t,e=0;e<t.length;e++)Zm.add(t[e])}var Fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fc=Object.prototype.hasOwnProperty,qx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qu={},Yu={};function Vx(e){return fc.call(Yu,e)?!0:fc.call(Qu,e)?!1:qx.test(e)?Yu[e]=!0:(Qu[e]=!0,!1)}function Gx(e,t,s,n){if(s!==null&&s.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:s!==null?!s.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Kx(e,t,s,n){if(t===null||typeof t>"u"||Gx(e,t,s,n))return!0;if(n)return!1;if(s!==null)switch(s.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function At(e,t,s,n,a,o,i){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=i}var kt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){kt[e]=new At(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];kt[t]=new At(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){kt[e]=new At(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){kt[e]=new At(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){kt[e]=new At(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){kt[e]=new At(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){kt[e]=new At(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){kt[e]=new At(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){kt[e]=new At(e,5,!1,e.toLowerCase(),null,!1,!1)});var Id=/[\-:]([a-z])/g;function Ad(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Id,Ad);kt[t]=new At(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Id,Ad);kt[t]=new At(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Id,Ad);kt[t]=new At(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){kt[e]=new At(e,1,!1,e.toLowerCase(),null,!1,!1)});kt.xlinkHref=new At("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){kt[e]=new At(e,1,!1,e.toLowerCase(),null,!0,!0)});function $d(e,t,s,n){var a=kt.hasOwnProperty(t)?kt[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Kx(t,s,a,n)&&(s=null),n||a===null?Vx(t)&&(s===null?e.removeAttribute(t):e.setAttribute(t,""+s)):a.mustUseProperty?e[a.propertyName]=s===null?a.type===3?!1:"":s:(t=a.attributeName,n=a.attributeNamespace,s===null?e.removeAttribute(t):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,n?e.setAttributeNS(n,t,s):e.setAttribute(t,s))))}var qs=Wx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,No=Symbol.for("react.element"),lr=Symbol.for("react.portal"),cr=Symbol.for("react.fragment"),Rd=Symbol.for("react.strict_mode"),pc=Symbol.for("react.profiler"),ef=Symbol.for("react.provider"),tf=Symbol.for("react.context"),Ld=Symbol.for("react.forward_ref"),gc=Symbol.for("react.suspense"),xc=Symbol.for("react.suspense_list"),zd=Symbol.for("react.memo"),Js=Symbol.for("react.lazy"),sf=Symbol.for("react.offscreen"),Ju=Symbol.iterator;function Gr(e){return e===null||typeof e!="object"?null:(e=Ju&&e[Ju]||e["@@iterator"],typeof e=="function"?e:null)}var nt=Object.assign,kl;function oa(e){if(kl===void 0)try{throw Error()}catch(s){var t=s.stack.trim().match(/\n( *(at )?)/);kl=t&&t[1]||""}return`
`+kl+e}var Sl=!1;function _l(e,t){if(!e||Sl)return"";Sl=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(d){var n=d}Reflect.construct(e,[],t)}else{try{t.call()}catch(d){n=d}e.call(t.prototype)}else{try{throw Error()}catch(d){n=d}e()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var a=d.stack.split(`
`),o=n.stack.split(`
`),i=a.length-1,l=o.length-1;1<=i&&0<=l&&a[i]!==o[l];)l--;for(;1<=i&&0<=l;i--,l--)if(a[i]!==o[l]){if(i!==1||l!==1)do if(i--,l--,0>l||a[i]!==o[l]){var c=`
`+a[i].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=i&&0<=l);break}}}finally{Sl=!1,Error.prepareStackTrace=s}return(e=e?e.displayName||e.name:"")?oa(e):""}function Qx(e){switch(e.tag){case 5:return oa(e.type);case 16:return oa("Lazy");case 13:return oa("Suspense");case 19:return oa("SuspenseList");case 0:case 2:case 15:return e=_l(e.type,!1),e;case 11:return e=_l(e.type.render,!1),e;case 1:return e=_l(e.type,!0),e;default:return""}}function yc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case cr:return"Fragment";case lr:return"Portal";case pc:return"Profiler";case Rd:return"StrictMode";case gc:return"Suspense";case xc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case tf:return(e.displayName||"Context")+".Consumer";case ef:return(e._context.displayName||"Context")+".Provider";case Ld:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case zd:return t=e.displayName||null,t!==null?t:yc(e.type)||"Memo";case Js:t=e._payload,e=e._init;try{return yc(e(t))}catch{}}return null}function Yx(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yc(t);case 8:return t===Rd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function pn(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function nf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Jx(e){var t=nf(e)?"checked":"value",s=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,o=s.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(i){n=""+i,o.call(this,i)}}),Object.defineProperty(e,t,{enumerable:s.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ko(e){e._valueTracker||(e._valueTracker=Jx(e))}function rf(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var s=t.getValue(),n="";return e&&(n=nf(e)?e.checked?"true":"false":e.value),e=n,e!==s?(t.setValue(e),!0):!1}function di(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function vc(e,t){var s=t.checked;return nt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??e._wrapperState.initialChecked})}function Xu(e,t){var s=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;s=pn(t.value!=null?t.value:s),e._wrapperState={initialChecked:n,initialValue:s,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function af(e,t){t=t.checked,t!=null&&$d(e,"checked",t,!1)}function bc(e,t){af(e,t);var s=pn(t.value),n=t.type;if(s!=null)n==="number"?(s===0&&e.value===""||e.value!=s)&&(e.value=""+s):e.value!==""+s&&(e.value=""+s);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?jc(e,t.type,s):t.hasOwnProperty("defaultValue")&&jc(e,t.type,pn(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Zu(e,t,s){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,s||t===e.value||(e.value=t),e.defaultValue=t}s=e.name,s!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,s!==""&&(e.name=s)}function jc(e,t,s){(t!=="number"||di(e.ownerDocument)!==e)&&(s==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+s&&(e.defaultValue=""+s))}var ia=Array.isArray;function br(e,t,s,n){if(e=e.options,t){t={};for(var a=0;a<s.length;a++)t["$"+s[a]]=!0;for(s=0;s<e.length;s++)a=t.hasOwnProperty("$"+e[s].value),e[s].selected!==a&&(e[s].selected=a),a&&n&&(e[s].defaultSelected=!0)}else{for(s=""+pn(s),t=null,a=0;a<e.length;a++){if(e[a].value===s){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function wc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(oe(91));return nt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function eh(e,t){var s=t.value;if(s==null){if(s=t.children,t=t.defaultValue,s!=null){if(t!=null)throw Error(oe(92));if(ia(s)){if(1<s.length)throw Error(oe(93));s=s[0]}t=s}t==null&&(t=""),s=t}e._wrapperState={initialValue:pn(s)}}function of(e,t){var s=pn(t.value),n=pn(t.defaultValue);s!=null&&(s=""+s,s!==e.value&&(e.value=s),t.defaultValue==null&&e.defaultValue!==s&&(e.defaultValue=s)),n!=null&&(e.defaultValue=""+n)}function th(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function lf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?lf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var So,cf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,s,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,s,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(So=So||document.createElement("div"),So.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=So.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Oa(e,t){if(t){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=t;return}}e.textContent=t}var ha={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xx=["Webkit","ms","Moz","O"];Object.keys(ha).forEach(function(e){Xx.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ha[t]=ha[e]})});function df(e,t,s){return t==null||typeof t=="boolean"||t===""?"":s||typeof t!="number"||t===0||ha.hasOwnProperty(e)&&ha[e]?(""+t).trim():t+"px"}function uf(e,t){e=e.style;for(var s in t)if(t.hasOwnProperty(s)){var n=s.indexOf("--")===0,a=df(s,t[s],n);s==="float"&&(s="cssFloat"),n?e.setProperty(s,a):e[s]=a}}var Zx=nt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kc(e,t){if(t){if(Zx[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(oe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(oe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(oe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(oe(62))}}function Sc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _c=null;function Fd(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Cc=null,jr=null,wr=null;function sh(e){if(e=io(e)){if(typeof Cc!="function")throw Error(oe(280));var t=e.stateNode;t&&(t=Ji(t),Cc(e.stateNode,e.type,t))}}function hf(e){jr?wr?wr.push(e):wr=[e]:jr=e}function mf(){if(jr){var e=jr,t=wr;if(wr=jr=null,sh(e),t)for(e=0;e<t.length;e++)sh(t[e])}}function ff(e,t){return e(t)}function pf(){}var Cl=!1;function gf(e,t,s){if(Cl)return e(t,s);Cl=!0;try{return ff(e,t,s)}finally{Cl=!1,(jr!==null||wr!==null)&&(pf(),mf())}}function Ia(e,t){var s=e.stateNode;if(s===null)return null;var n=Ji(s);if(n===null)return null;s=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(oe(231,t,typeof s));return s}var Ec=!1;if(Fs)try{var Kr={};Object.defineProperty(Kr,"passive",{get:function(){Ec=!0}}),window.addEventListener("test",Kr,Kr),window.removeEventListener("test",Kr,Kr)}catch{Ec=!1}function ey(e,t,s,n,a,o,i,l,c){var d=Array.prototype.slice.call(arguments,3);try{t.apply(s,d)}catch(u){this.onError(u)}}var ma=!1,ui=null,hi=!1,Tc=null,ty={onError:function(e){ma=!0,ui=e}};function sy(e,t,s,n,a,o,i,l,c){ma=!1,ui=null,ey.apply(ty,arguments)}function ny(e,t,s,n,a,o,i,l,c){if(sy.apply(this,arguments),ma){if(ma){var d=ui;ma=!1,ui=null}else throw Error(oe(198));hi||(hi=!0,Tc=d)}}function Kn(e){var t=e,s=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(s=t.return),e=t.return;while(e)}return t.tag===3?s:null}function xf(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function nh(e){if(Kn(e)!==e)throw Error(oe(188))}function ry(e){var t=e.alternate;if(!t){if(t=Kn(e),t===null)throw Error(oe(188));return t!==e?null:e}for(var s=e,n=t;;){var a=s.return;if(a===null)break;var o=a.alternate;if(o===null){if(n=a.return,n!==null){s=n;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===s)return nh(a),e;if(o===n)return nh(a),t;o=o.sibling}throw Error(oe(188))}if(s.return!==n.return)s=a,n=o;else{for(var i=!1,l=a.child;l;){if(l===s){i=!0,s=a,n=o;break}if(l===n){i=!0,n=a,s=o;break}l=l.sibling}if(!i){for(l=o.child;l;){if(l===s){i=!0,s=o,n=a;break}if(l===n){i=!0,n=o,s=a;break}l=l.sibling}if(!i)throw Error(oe(189))}}if(s.alternate!==n)throw Error(oe(190))}if(s.tag!==3)throw Error(oe(188));return s.stateNode.current===s?e:t}function yf(e){return e=ry(e),e!==null?vf(e):null}function vf(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=vf(e);if(t!==null)return t;e=e.sibling}return null}var bf=Kt.unstable_scheduleCallback,rh=Kt.unstable_cancelCallback,ay=Kt.unstable_shouldYield,oy=Kt.unstable_requestPaint,ot=Kt.unstable_now,iy=Kt.unstable_getCurrentPriorityLevel,Ud=Kt.unstable_ImmediatePriority,jf=Kt.unstable_UserBlockingPriority,mi=Kt.unstable_NormalPriority,ly=Kt.unstable_LowPriority,wf=Kt.unstable_IdlePriority,Gi=null,_s=null;function cy(e){if(_s&&typeof _s.onCommitFiberRoot=="function")try{_s.onCommitFiberRoot(Gi,e,void 0,(e.current.flags&128)===128)}catch{}}var xs=Math.clz32?Math.clz32:hy,dy=Math.log,uy=Math.LN2;function hy(e){return e>>>=0,e===0?32:31-(dy(e)/uy|0)|0}var _o=64,Co=4194304;function la(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function fi(e,t){var s=e.pendingLanes;if(s===0)return 0;var n=0,a=e.suspendedLanes,o=e.pingedLanes,i=s&268435455;if(i!==0){var l=i&~a;l!==0?n=la(l):(o&=i,o!==0&&(n=la(o)))}else i=s&~a,i!==0?n=la(i):o!==0&&(n=la(o));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,o=t&-t,a>=o||a===16&&(o&4194240)!==0))return t;if(n&4&&(n|=s&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)s=31-xs(t),a=1<<s,n|=e[s],t&=~a;return n}function my(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fy(e,t){for(var s=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,o=e.pendingLanes;0<o;){var i=31-xs(o),l=1<<i,c=a[i];c===-1?(!(l&s)||l&n)&&(a[i]=my(l,t)):c<=t&&(e.expiredLanes|=l),o&=~l}}function Mc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Nf(){var e=_o;return _o<<=1,!(_o&4194240)&&(_o=64),e}function El(e){for(var t=[],s=0;31>s;s++)t.push(e);return t}function ao(e,t,s){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xs(t),e[t]=s}function py(e,t){var s=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<s;){var a=31-xs(s),o=1<<a;t[a]=0,n[a]=-1,e[a]=-1,s&=~o}}function Bd(e,t){var s=e.entangledLanes|=t;for(e=e.entanglements;s;){var n=31-xs(s),a=1<<n;a&t|e[n]&t&&(e[n]|=t),s&=~a}}var He=0;function kf(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Sf,Hd,_f,Cf,Ef,Pc=!1,Eo=[],an=null,on=null,ln=null,Aa=new Map,$a=new Map,Zs=[],gy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ah(e,t){switch(e){case"focusin":case"focusout":an=null;break;case"dragenter":case"dragleave":on=null;break;case"mouseover":case"mouseout":ln=null;break;case"pointerover":case"pointerout":Aa.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":$a.delete(t.pointerId)}}function Qr(e,t,s,n,a,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:s,eventSystemFlags:n,nativeEvent:o,targetContainers:[a]},t!==null&&(t=io(t),t!==null&&Hd(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function xy(e,t,s,n,a){switch(t){case"focusin":return an=Qr(an,e,t,s,n,a),!0;case"dragenter":return on=Qr(on,e,t,s,n,a),!0;case"mouseover":return ln=Qr(ln,e,t,s,n,a),!0;case"pointerover":var o=a.pointerId;return Aa.set(o,Qr(Aa.get(o)||null,e,t,s,n,a)),!0;case"gotpointercapture":return o=a.pointerId,$a.set(o,Qr($a.get(o)||null,e,t,s,n,a)),!0}return!1}function Tf(e){var t=Dn(e.target);if(t!==null){var s=Kn(t);if(s!==null){if(t=s.tag,t===13){if(t=xf(s),t!==null){e.blockedOn=t,Ef(e.priority,function(){_f(s)});return}}else if(t===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Qo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var s=Dc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(s===null){s=e.nativeEvent;var n=new s.constructor(s.type,s);_c=n,s.target.dispatchEvent(n),_c=null}else return t=io(s),t!==null&&Hd(t),e.blockedOn=s,!1;t.shift()}return!0}function oh(e,t,s){Qo(e)&&s.delete(t)}function yy(){Pc=!1,an!==null&&Qo(an)&&(an=null),on!==null&&Qo(on)&&(on=null),ln!==null&&Qo(ln)&&(ln=null),Aa.forEach(oh),$a.forEach(oh)}function Yr(e,t){e.blockedOn===t&&(e.blockedOn=null,Pc||(Pc=!0,Kt.unstable_scheduleCallback(Kt.unstable_NormalPriority,yy)))}function Ra(e){function t(a){return Yr(a,e)}if(0<Eo.length){Yr(Eo[0],e);for(var s=1;s<Eo.length;s++){var n=Eo[s];n.blockedOn===e&&(n.blockedOn=null)}}for(an!==null&&Yr(an,e),on!==null&&Yr(on,e),ln!==null&&Yr(ln,e),Aa.forEach(t),$a.forEach(t),s=0;s<Zs.length;s++)n=Zs[s],n.blockedOn===e&&(n.blockedOn=null);for(;0<Zs.length&&(s=Zs[0],s.blockedOn===null);)Tf(s),s.blockedOn===null&&Zs.shift()}var Nr=qs.ReactCurrentBatchConfig,pi=!0;function vy(e,t,s,n){var a=He,o=Nr.transition;Nr.transition=null;try{He=1,Wd(e,t,s,n)}finally{He=a,Nr.transition=o}}function by(e,t,s,n){var a=He,o=Nr.transition;Nr.transition=null;try{He=4,Wd(e,t,s,n)}finally{He=a,Nr.transition=o}}function Wd(e,t,s,n){if(pi){var a=Dc(e,t,s,n);if(a===null)Ll(e,t,n,gi,s),ah(e,n);else if(xy(a,e,t,s,n))n.stopPropagation();else if(ah(e,n),t&4&&-1<gy.indexOf(e)){for(;a!==null;){var o=io(a);if(o!==null&&Sf(o),o=Dc(e,t,s,n),o===null&&Ll(e,t,n,gi,s),o===a)break;a=o}a!==null&&n.stopPropagation()}else Ll(e,t,n,null,s)}}var gi=null;function Dc(e,t,s,n){if(gi=null,e=Fd(n),e=Dn(e),e!==null)if(t=Kn(e),t===null)e=null;else if(s=t.tag,s===13){if(e=xf(t),e!==null)return e;e=null}else if(s===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return gi=e,null}function Mf(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iy()){case Ud:return 1;case jf:return 4;case mi:case ly:return 16;case wf:return 536870912;default:return 16}default:return 16}}var nn=null,qd=null,Yo=null;function Pf(){if(Yo)return Yo;var e,t=qd,s=t.length,n,a="value"in nn?nn.value:nn.textContent,o=a.length;for(e=0;e<s&&t[e]===a[e];e++);var i=s-e;for(n=1;n<=i&&t[s-n]===a[o-n];n++);return Yo=a.slice(e,1<n?1-n:void 0)}function Jo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function To(){return!0}function ih(){return!1}function Yt(e){function t(s,n,a,o,i){this._reactName=s,this._targetInst=a,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(s=e[l],this[l]=s?s(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?To:ih,this.isPropagationStopped=ih,this}return nt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=To)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=To)},persist:function(){},isPersistent:To}),t}var Hr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vd=Yt(Hr),oo=nt({},Hr,{view:0,detail:0}),jy=Yt(oo),Tl,Ml,Jr,Ki=nt({},oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jr&&(Jr&&e.type==="mousemove"?(Tl=e.screenX-Jr.screenX,Ml=e.screenY-Jr.screenY):Ml=Tl=0,Jr=e),Tl)},movementY:function(e){return"movementY"in e?e.movementY:Ml}}),lh=Yt(Ki),wy=nt({},Ki,{dataTransfer:0}),Ny=Yt(wy),ky=nt({},oo,{relatedTarget:0}),Pl=Yt(ky),Sy=nt({},Hr,{animationName:0,elapsedTime:0,pseudoElement:0}),_y=Yt(Sy),Cy=nt({},Hr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ey=Yt(Cy),Ty=nt({},Hr,{data:0}),ch=Yt(Ty),My={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Py={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Oy(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Dy[e])?!!t[e]:!1}function Gd(){return Oy}var Iy=nt({},oo,{key:function(e){if(e.key){var t=My[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Jo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Py[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gd,charCode:function(e){return e.type==="keypress"?Jo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Jo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ay=Yt(Iy),$y=nt({},Ki,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dh=Yt($y),Ry=nt({},oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gd}),Ly=Yt(Ry),zy=nt({},Hr,{propertyName:0,elapsedTime:0,pseudoElement:0}),Fy=Yt(zy),Uy=nt({},Ki,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),By=Yt(Uy),Hy=[9,13,27,32],Kd=Fs&&"CompositionEvent"in window,fa=null;Fs&&"documentMode"in document&&(fa=document.documentMode);var Wy=Fs&&"TextEvent"in window&&!fa,Df=Fs&&(!Kd||fa&&8<fa&&11>=fa),uh=" ",hh=!1;function Of(e,t){switch(e){case"keyup":return Hy.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function If(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var dr=!1;function qy(e,t){switch(e){case"compositionend":return If(t);case"keypress":return t.which!==32?null:(hh=!0,uh);case"textInput":return e=t.data,e===uh&&hh?null:e;default:return null}}function Vy(e,t){if(dr)return e==="compositionend"||!Kd&&Of(e,t)?(e=Pf(),Yo=qd=nn=null,dr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Df&&t.locale!=="ko"?null:t.data;default:return null}}var Gy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mh(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Gy[e.type]:t==="textarea"}function Af(e,t,s,n){hf(n),t=xi(t,"onChange"),0<t.length&&(s=new Vd("onChange","change",null,s,n),e.push({event:s,listeners:t}))}var pa=null,La=null;function Ky(e){Vf(e,0)}function Qi(e){var t=mr(e);if(rf(t))return e}function Qy(e,t){if(e==="change")return t}var $f=!1;if(Fs){var Dl;if(Fs){var Ol="oninput"in document;if(!Ol){var fh=document.createElement("div");fh.setAttribute("oninput","return;"),Ol=typeof fh.oninput=="function"}Dl=Ol}else Dl=!1;$f=Dl&&(!document.documentMode||9<document.documentMode)}function ph(){pa&&(pa.detachEvent("onpropertychange",Rf),La=pa=null)}function Rf(e){if(e.propertyName==="value"&&Qi(La)){var t=[];Af(t,La,e,Fd(e)),gf(Ky,t)}}function Yy(e,t,s){e==="focusin"?(ph(),pa=t,La=s,pa.attachEvent("onpropertychange",Rf)):e==="focusout"&&ph()}function Jy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Qi(La)}function Xy(e,t){if(e==="click")return Qi(t)}function Zy(e,t){if(e==="input"||e==="change")return Qi(t)}function e0(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bs=typeof Object.is=="function"?Object.is:e0;function za(e,t){if(bs(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var s=Object.keys(e),n=Object.keys(t);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var a=s[n];if(!fc.call(t,a)||!bs(e[a],t[a]))return!1}return!0}function gh(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function xh(e,t){var s=gh(e);e=0;for(var n;s;){if(s.nodeType===3){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=gh(s)}}function Lf(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Lf(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function zf(){for(var e=window,t=di();t instanceof e.HTMLIFrameElement;){try{var s=typeof t.contentWindow.location.href=="string"}catch{s=!1}if(s)e=t.contentWindow;else break;t=di(e.document)}return t}function Qd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function t0(e){var t=zf(),s=e.focusedElem,n=e.selectionRange;if(t!==s&&s&&s.ownerDocument&&Lf(s.ownerDocument.documentElement,s)){if(n!==null&&Qd(s)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in s)s.selectionStart=t,s.selectionEnd=Math.min(e,s.value.length);else if(e=(t=s.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=s.textContent.length,o=Math.min(n.start,a);n=n.end===void 0?o:Math.min(n.end,a),!e.extend&&o>n&&(a=n,n=o,o=a),a=xh(s,o);var i=xh(s,n);a&&i&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==i.node||e.focusOffset!==i.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(i.node,i.offset)):(t.setEnd(i.node,i.offset),e.addRange(t)))}}for(t=[],e=s;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<t.length;s++)e=t[s],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var s0=Fs&&"documentMode"in document&&11>=document.documentMode,ur=null,Oc=null,ga=null,Ic=!1;function yh(e,t,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ic||ur==null||ur!==di(n)||(n=ur,"selectionStart"in n&&Qd(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ga&&za(ga,n)||(ga=n,n=xi(Oc,"onSelect"),0<n.length&&(t=new Vd("onSelect","select",null,t,s),e.push({event:t,listeners:n}),t.target=ur)))}function Mo(e,t){var s={};return s[e.toLowerCase()]=t.toLowerCase(),s["Webkit"+e]="webkit"+t,s["Moz"+e]="moz"+t,s}var hr={animationend:Mo("Animation","AnimationEnd"),animationiteration:Mo("Animation","AnimationIteration"),animationstart:Mo("Animation","AnimationStart"),transitionend:Mo("Transition","TransitionEnd")},Il={},Ff={};Fs&&(Ff=document.createElement("div").style,"AnimationEvent"in window||(delete hr.animationend.animation,delete hr.animationiteration.animation,delete hr.animationstart.animation),"TransitionEvent"in window||delete hr.transitionend.transition);function Yi(e){if(Il[e])return Il[e];if(!hr[e])return e;var t=hr[e],s;for(s in t)if(t.hasOwnProperty(s)&&s in Ff)return Il[e]=t[s];return e}var Uf=Yi("animationend"),Bf=Yi("animationiteration"),Hf=Yi("animationstart"),Wf=Yi("transitionend"),qf=new Map,vh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yn(e,t){qf.set(e,t),Gn(t,[e])}for(var Al=0;Al<vh.length;Al++){var $l=vh[Al],n0=$l.toLowerCase(),r0=$l[0].toUpperCase()+$l.slice(1);yn(n0,"on"+r0)}yn(Uf,"onAnimationEnd");yn(Bf,"onAnimationIteration");yn(Hf,"onAnimationStart");yn("dblclick","onDoubleClick");yn("focusin","onFocus");yn("focusout","onBlur");yn(Wf,"onTransitionEnd");Er("onMouseEnter",["mouseout","mouseover"]);Er("onMouseLeave",["mouseout","mouseover"]);Er("onPointerEnter",["pointerout","pointerover"]);Er("onPointerLeave",["pointerout","pointerover"]);Gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Gn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ca="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),a0=new Set("cancel close invalid load scroll toggle".split(" ").concat(ca));function bh(e,t,s){var n=e.type||"unknown-event";e.currentTarget=s,ny(n,t,void 0,e),e.currentTarget=null}function Vf(e,t){t=(t&4)!==0;for(var s=0;s<e.length;s++){var n=e[s],a=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var i=n.length-1;0<=i;i--){var l=n[i],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==o&&a.isPropagationStopped())break e;bh(a,l,d),o=c}else for(i=0;i<n.length;i++){if(l=n[i],c=l.instance,d=l.currentTarget,l=l.listener,c!==o&&a.isPropagationStopped())break e;bh(a,l,d),o=c}}}if(hi)throw e=Tc,hi=!1,Tc=null,e}function Je(e,t){var s=t[zc];s===void 0&&(s=t[zc]=new Set);var n=e+"__bubble";s.has(n)||(Gf(t,e,2,!1),s.add(n))}function Rl(e,t,s){var n=0;t&&(n|=4),Gf(s,e,n,t)}var Po="_reactListening"+Math.random().toString(36).slice(2);function Fa(e){if(!e[Po]){e[Po]=!0,Zm.forEach(function(s){s!=="selectionchange"&&(a0.has(s)||Rl(s,!1,e),Rl(s,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Po]||(t[Po]=!0,Rl("selectionchange",!1,t))}}function Gf(e,t,s,n){switch(Mf(t)){case 1:var a=vy;break;case 4:a=by;break;default:a=Wd}s=a.bind(null,t,s,e),a=void 0,!Ec||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,s,{capture:!0,passive:a}):e.addEventListener(t,s,!0):a!==void 0?e.addEventListener(t,s,{passive:a}):e.addEventListener(t,s,!1)}function Ll(e,t,s,n,a){var o=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var l=n.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(i===4)for(i=n.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;i=i.return}for(;l!==null;){if(i=Dn(l),i===null)return;if(c=i.tag,c===5||c===6){n=o=i;continue e}l=l.parentNode}}n=n.return}gf(function(){var d=o,u=Fd(s),h=[];e:{var m=qf.get(e);if(m!==void 0){var x=Vd,w=e;switch(e){case"keypress":if(Jo(s)===0)break e;case"keydown":case"keyup":x=Ay;break;case"focusin":w="focus",x=Pl;break;case"focusout":w="blur",x=Pl;break;case"beforeblur":case"afterblur":x=Pl;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=lh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Ny;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=Ly;break;case Uf:case Bf:case Hf:x=_y;break;case Wf:x=Fy;break;case"scroll":x=jy;break;case"wheel":x=By;break;case"copy":case"cut":case"paste":x=Ey;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=dh}var S=(t&4)!==0,E=!S&&e==="scroll",y=S?m!==null?m+"Capture":null:m;S=[];for(var f=d,g;f!==null;){g=f;var b=g.stateNode;if(g.tag===5&&b!==null&&(g=b,y!==null&&(b=Ia(f,y),b!=null&&S.push(Ua(f,b,g)))),E)break;f=f.return}0<S.length&&(m=new x(m,w,null,s,u),h.push({event:m,listeners:S}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",x=e==="mouseout"||e==="pointerout",m&&s!==_c&&(w=s.relatedTarget||s.fromElement)&&(Dn(w)||w[Us]))break e;if((x||m)&&(m=u.window===u?u:(m=u.ownerDocument)?m.defaultView||m.parentWindow:window,x?(w=s.relatedTarget||s.toElement,x=d,w=w?Dn(w):null,w!==null&&(E=Kn(w),w!==E||w.tag!==5&&w.tag!==6)&&(w=null)):(x=null,w=d),x!==w)){if(S=lh,b="onMouseLeave",y="onMouseEnter",f="mouse",(e==="pointerout"||e==="pointerover")&&(S=dh,b="onPointerLeave",y="onPointerEnter",f="pointer"),E=x==null?m:mr(x),g=w==null?m:mr(w),m=new S(b,f+"leave",x,s,u),m.target=E,m.relatedTarget=g,b=null,Dn(u)===d&&(S=new S(y,f+"enter",w,s,u),S.target=g,S.relatedTarget=E,b=S),E=b,x&&w)t:{for(S=x,y=w,f=0,g=S;g;g=Jn(g))f++;for(g=0,b=y;b;b=Jn(b))g++;for(;0<f-g;)S=Jn(S),f--;for(;0<g-f;)y=Jn(y),g--;for(;f--;){if(S===y||y!==null&&S===y.alternate)break t;S=Jn(S),y=Jn(y)}S=null}else S=null;x!==null&&jh(h,m,x,S,!1),w!==null&&E!==null&&jh(h,E,w,S,!0)}}e:{if(m=d?mr(d):window,x=m.nodeName&&m.nodeName.toLowerCase(),x==="select"||x==="input"&&m.type==="file")var $=Qy;else if(mh(m))if($f)$=Zy;else{$=Jy;var A=Yy}else(x=m.nodeName)&&x.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&($=Xy);if($&&($=$(e,d))){Af(h,$,s,u);break e}A&&A(e,m,d),e==="focusout"&&(A=m._wrapperState)&&A.controlled&&m.type==="number"&&jc(m,"number",m.value)}switch(A=d?mr(d):window,e){case"focusin":(mh(A)||A.contentEditable==="true")&&(ur=A,Oc=d,ga=null);break;case"focusout":ga=Oc=ur=null;break;case"mousedown":Ic=!0;break;case"contextmenu":case"mouseup":case"dragend":Ic=!1,yh(h,s,u);break;case"selectionchange":if(s0)break;case"keydown":case"keyup":yh(h,s,u)}var B;if(Kd)e:{switch(e){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else dr?Of(e,s)&&(z="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(z="onCompositionStart");z&&(Df&&s.locale!=="ko"&&(dr||z!=="onCompositionStart"?z==="onCompositionEnd"&&dr&&(B=Pf()):(nn=u,qd="value"in nn?nn.value:nn.textContent,dr=!0)),A=xi(d,z),0<A.length&&(z=new ch(z,e,null,s,u),h.push({event:z,listeners:A}),B?z.data=B:(B=If(s),B!==null&&(z.data=B)))),(B=Wy?qy(e,s):Vy(e,s))&&(d=xi(d,"onBeforeInput"),0<d.length&&(u=new ch("onBeforeInput","beforeinput",null,s,u),h.push({event:u,listeners:d}),u.data=B))}Vf(h,t)})}function Ua(e,t,s){return{instance:e,listener:t,currentTarget:s}}function xi(e,t){for(var s=t+"Capture",n=[];e!==null;){var a=e,o=a.stateNode;a.tag===5&&o!==null&&(a=o,o=Ia(e,s),o!=null&&n.unshift(Ua(e,o,a)),o=Ia(e,t),o!=null&&n.push(Ua(e,o,a))),e=e.return}return n}function Jn(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function jh(e,t,s,n,a){for(var o=t._reactName,i=[];s!==null&&s!==n;){var l=s,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,a?(c=Ia(s,o),c!=null&&i.unshift(Ua(s,c,l))):a||(c=Ia(s,o),c!=null&&i.push(Ua(s,c,l)))),s=s.return}i.length!==0&&e.push({event:t,listeners:i})}var o0=/\r\n?/g,i0=/\u0000|\uFFFD/g;function wh(e){return(typeof e=="string"?e:""+e).replace(o0,`
`).replace(i0,"")}function Do(e,t,s){if(t=wh(t),wh(e)!==t&&s)throw Error(oe(425))}function yi(){}var Ac=null,$c=null;function Rc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Lc=typeof setTimeout=="function"?setTimeout:void 0,l0=typeof clearTimeout=="function"?clearTimeout:void 0,Nh=typeof Promise=="function"?Promise:void 0,c0=typeof queueMicrotask=="function"?queueMicrotask:typeof Nh<"u"?function(e){return Nh.resolve(null).then(e).catch(d0)}:Lc;function d0(e){setTimeout(function(){throw e})}function zl(e,t){var s=t,n=0;do{var a=s.nextSibling;if(e.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(n===0){e.removeChild(a),Ra(t);return}n--}else s!=="$"&&s!=="$?"&&s!=="$!"||n++;s=a}while(s);Ra(t)}function cn(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function kh(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"){if(t===0)return e;t--}else s==="/$"&&t++}e=e.previousSibling}return null}var Wr=Math.random().toString(36).slice(2),ks="__reactFiber$"+Wr,Ba="__reactProps$"+Wr,Us="__reactContainer$"+Wr,zc="__reactEvents$"+Wr,u0="__reactListeners$"+Wr,h0="__reactHandles$"+Wr;function Dn(e){var t=e[ks];if(t)return t;for(var s=e.parentNode;s;){if(t=s[Us]||s[ks]){if(s=t.alternate,t.child!==null||s!==null&&s.child!==null)for(e=kh(e);e!==null;){if(s=e[ks])return s;e=kh(e)}return t}e=s,s=e.parentNode}return null}function io(e){return e=e[ks]||e[Us],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function mr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(oe(33))}function Ji(e){return e[Ba]||null}var Fc=[],fr=-1;function vn(e){return{current:e}}function Xe(e){0>fr||(e.current=Fc[fr],Fc[fr]=null,fr--)}function Qe(e,t){fr++,Fc[fr]=e.current,e.current=t}var gn={},Mt=vn(gn),Ft=vn(!1),Ln=gn;function Tr(e,t){var s=e.type.contextTypes;if(!s)return gn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},o;for(o in s)a[o]=t[o];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ut(e){return e=e.childContextTypes,e!=null}function vi(){Xe(Ft),Xe(Mt)}function Sh(e,t,s){if(Mt.current!==gn)throw Error(oe(168));Qe(Mt,t),Qe(Ft,s)}function Kf(e,t,s){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return s;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(oe(108,Yx(e)||"Unknown",a));return nt({},s,n)}function bi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||gn,Ln=Mt.current,Qe(Mt,e),Qe(Ft,Ft.current),!0}function _h(e,t,s){var n=e.stateNode;if(!n)throw Error(oe(169));s?(e=Kf(e,t,Ln),n.__reactInternalMemoizedMergedChildContext=e,Xe(Ft),Xe(Mt),Qe(Mt,e)):Xe(Ft),Qe(Ft,s)}var Os=null,Xi=!1,Fl=!1;function Qf(e){Os===null?Os=[e]:Os.push(e)}function m0(e){Xi=!0,Qf(e)}function bn(){if(!Fl&&Os!==null){Fl=!0;var e=0,t=He;try{var s=Os;for(He=1;e<s.length;e++){var n=s[e];do n=n(!0);while(n!==null)}Os=null,Xi=!1}catch(a){throw Os!==null&&(Os=Os.slice(e+1)),bf(Ud,bn),a}finally{He=t,Fl=!1}}return null}var pr=[],gr=0,ji=null,wi=0,Zt=[],es=0,zn=null,Is=1,As="";function En(e,t){pr[gr++]=wi,pr[gr++]=ji,ji=e,wi=t}function Yf(e,t,s){Zt[es++]=Is,Zt[es++]=As,Zt[es++]=zn,zn=e;var n=Is;e=As;var a=32-xs(n)-1;n&=~(1<<a),s+=1;var o=32-xs(t)+a;if(30<o){var i=a-a%5;o=(n&(1<<i)-1).toString(32),n>>=i,a-=i,Is=1<<32-xs(t)+a|s<<a|n,As=o+e}else Is=1<<o|s<<a|n,As=e}function Yd(e){e.return!==null&&(En(e,1),Yf(e,1,0))}function Jd(e){for(;e===ji;)ji=pr[--gr],pr[gr]=null,wi=pr[--gr],pr[gr]=null;for(;e===zn;)zn=Zt[--es],Zt[es]=null,As=Zt[--es],Zt[es]=null,Is=Zt[--es],Zt[es]=null}var Gt=null,Vt=null,et=!1,hs=null;function Jf(e,t){var s=ts(5,null,null,0);s.elementType="DELETED",s.stateNode=t,s.return=e,t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)}function Ch(e,t){switch(e.tag){case 5:var s=e.type;return t=t.nodeType!==1||s.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Gt=e,Vt=cn(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Gt=e,Vt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(s=zn!==null?{id:Is,overflow:As}:null,e.memoizedState={dehydrated:t,treeContext:s,retryLane:1073741824},s=ts(18,null,null,0),s.stateNode=t,s.return=e,e.child=s,Gt=e,Vt=null,!0):!1;default:return!1}}function Uc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Bc(e){if(et){var t=Vt;if(t){var s=t;if(!Ch(e,t)){if(Uc(e))throw Error(oe(418));t=cn(s.nextSibling);var n=Gt;t&&Ch(e,t)?Jf(n,s):(e.flags=e.flags&-4097|2,et=!1,Gt=e)}}else{if(Uc(e))throw Error(oe(418));e.flags=e.flags&-4097|2,et=!1,Gt=e}}}function Eh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Gt=e}function Oo(e){if(e!==Gt)return!1;if(!et)return Eh(e),et=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Rc(e.type,e.memoizedProps)),t&&(t=Vt)){if(Uc(e))throw Xf(),Error(oe(418));for(;t;)Jf(e,t),t=cn(t.nextSibling)}if(Eh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(oe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"){if(t===0){Vt=cn(e.nextSibling);break e}t--}else s!=="$"&&s!=="$!"&&s!=="$?"||t++}e=e.nextSibling}Vt=null}}else Vt=Gt?cn(e.stateNode.nextSibling):null;return!0}function Xf(){for(var e=Vt;e;)e=cn(e.nextSibling)}function Mr(){Vt=Gt=null,et=!1}function Xd(e){hs===null?hs=[e]:hs.push(e)}var f0=qs.ReactCurrentBatchConfig;function Xr(e,t,s){if(e=s.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(oe(309));var n=s.stateNode}if(!n)throw Error(oe(147,e));var a=n,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(i){var l=a.refs;i===null?delete l[o]:l[o]=i},t._stringRef=o,t)}if(typeof e!="string")throw Error(oe(284));if(!s._owner)throw Error(oe(290,e))}return e}function Io(e,t){throw e=Object.prototype.toString.call(t),Error(oe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Th(e){var t=e._init;return t(e._payload)}function Zf(e){function t(y,f){if(e){var g=y.deletions;g===null?(y.deletions=[f],y.flags|=16):g.push(f)}}function s(y,f){if(!e)return null;for(;f!==null;)t(y,f),f=f.sibling;return null}function n(y,f){for(y=new Map;f!==null;)f.key!==null?y.set(f.key,f):y.set(f.index,f),f=f.sibling;return y}function a(y,f){return y=mn(y,f),y.index=0,y.sibling=null,y}function o(y,f,g){return y.index=g,e?(g=y.alternate,g!==null?(g=g.index,g<f?(y.flags|=2,f):g):(y.flags|=2,f)):(y.flags|=1048576,f)}function i(y){return e&&y.alternate===null&&(y.flags|=2),y}function l(y,f,g,b){return f===null||f.tag!==6?(f=Gl(g,y.mode,b),f.return=y,f):(f=a(f,g),f.return=y,f)}function c(y,f,g,b){var $=g.type;return $===cr?u(y,f,g.props.children,b,g.key):f!==null&&(f.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Js&&Th($)===f.type)?(b=a(f,g.props),b.ref=Xr(y,f,g),b.return=y,b):(b=ri(g.type,g.key,g.props,null,y.mode,b),b.ref=Xr(y,f,g),b.return=y,b)}function d(y,f,g,b){return f===null||f.tag!==4||f.stateNode.containerInfo!==g.containerInfo||f.stateNode.implementation!==g.implementation?(f=Kl(g,y.mode,b),f.return=y,f):(f=a(f,g.children||[]),f.return=y,f)}function u(y,f,g,b,$){return f===null||f.tag!==7?(f=$n(g,y.mode,b,$),f.return=y,f):(f=a(f,g),f.return=y,f)}function h(y,f,g){if(typeof f=="string"&&f!==""||typeof f=="number")return f=Gl(""+f,y.mode,g),f.return=y,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case No:return g=ri(f.type,f.key,f.props,null,y.mode,g),g.ref=Xr(y,null,f),g.return=y,g;case lr:return f=Kl(f,y.mode,g),f.return=y,f;case Js:var b=f._init;return h(y,b(f._payload),g)}if(ia(f)||Gr(f))return f=$n(f,y.mode,g,null),f.return=y,f;Io(y,f)}return null}function m(y,f,g,b){var $=f!==null?f.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return $!==null?null:l(y,f,""+g,b);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case No:return g.key===$?c(y,f,g,b):null;case lr:return g.key===$?d(y,f,g,b):null;case Js:return $=g._init,m(y,f,$(g._payload),b)}if(ia(g)||Gr(g))return $!==null?null:u(y,f,g,b,null);Io(y,g)}return null}function x(y,f,g,b,$){if(typeof b=="string"&&b!==""||typeof b=="number")return y=y.get(g)||null,l(f,y,""+b,$);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case No:return y=y.get(b.key===null?g:b.key)||null,c(f,y,b,$);case lr:return y=y.get(b.key===null?g:b.key)||null,d(f,y,b,$);case Js:var A=b._init;return x(y,f,g,A(b._payload),$)}if(ia(b)||Gr(b))return y=y.get(g)||null,u(f,y,b,$,null);Io(f,b)}return null}function w(y,f,g,b){for(var $=null,A=null,B=f,z=f=0,de=null;B!==null&&z<g.length;z++){B.index>z?(de=B,B=null):de=B.sibling;var P=m(y,B,g[z],b);if(P===null){B===null&&(B=de);break}e&&B&&P.alternate===null&&t(y,B),f=o(P,f,z),A===null?$=P:A.sibling=P,A=P,B=de}if(z===g.length)return s(y,B),et&&En(y,z),$;if(B===null){for(;z<g.length;z++)B=h(y,g[z],b),B!==null&&(f=o(B,f,z),A===null?$=B:A.sibling=B,A=B);return et&&En(y,z),$}for(B=n(y,B);z<g.length;z++)de=x(B,y,z,g[z],b),de!==null&&(e&&de.alternate!==null&&B.delete(de.key===null?z:de.key),f=o(de,f,z),A===null?$=de:A.sibling=de,A=de);return e&&B.forEach(function(D){return t(y,D)}),et&&En(y,z),$}function S(y,f,g,b){var $=Gr(g);if(typeof $!="function")throw Error(oe(150));if(g=$.call(g),g==null)throw Error(oe(151));for(var A=$=null,B=f,z=f=0,de=null,P=g.next();B!==null&&!P.done;z++,P=g.next()){B.index>z?(de=B,B=null):de=B.sibling;var D=m(y,B,P.value,b);if(D===null){B===null&&(B=de);break}e&&B&&D.alternate===null&&t(y,B),f=o(D,f,z),A===null?$=D:A.sibling=D,A=D,B=de}if(P.done)return s(y,B),et&&En(y,z),$;if(B===null){for(;!P.done;z++,P=g.next())P=h(y,P.value,b),P!==null&&(f=o(P,f,z),A===null?$=P:A.sibling=P,A=P);return et&&En(y,z),$}for(B=n(y,B);!P.done;z++,P=g.next())P=x(B,y,z,P.value,b),P!==null&&(e&&P.alternate!==null&&B.delete(P.key===null?z:P.key),f=o(P,f,z),A===null?$=P:A.sibling=P,A=P);return e&&B.forEach(function(Y){return t(y,Y)}),et&&En(y,z),$}function E(y,f,g,b){if(typeof g=="object"&&g!==null&&g.type===cr&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case No:e:{for(var $=g.key,A=f;A!==null;){if(A.key===$){if($=g.type,$===cr){if(A.tag===7){s(y,A.sibling),f=a(A,g.props.children),f.return=y,y=f;break e}}else if(A.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===Js&&Th($)===A.type){s(y,A.sibling),f=a(A,g.props),f.ref=Xr(y,A,g),f.return=y,y=f;break e}s(y,A);break}else t(y,A);A=A.sibling}g.type===cr?(f=$n(g.props.children,y.mode,b,g.key),f.return=y,y=f):(b=ri(g.type,g.key,g.props,null,y.mode,b),b.ref=Xr(y,f,g),b.return=y,y=b)}return i(y);case lr:e:{for(A=g.key;f!==null;){if(f.key===A)if(f.tag===4&&f.stateNode.containerInfo===g.containerInfo&&f.stateNode.implementation===g.implementation){s(y,f.sibling),f=a(f,g.children||[]),f.return=y,y=f;break e}else{s(y,f);break}else t(y,f);f=f.sibling}f=Kl(g,y.mode,b),f.return=y,y=f}return i(y);case Js:return A=g._init,E(y,f,A(g._payload),b)}if(ia(g))return w(y,f,g,b);if(Gr(g))return S(y,f,g,b);Io(y,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,f!==null&&f.tag===6?(s(y,f.sibling),f=a(f,g),f.return=y,y=f):(s(y,f),f=Gl(g,y.mode,b),f.return=y,y=f),i(y)):s(y,f)}return E}var Pr=Zf(!0),ep=Zf(!1),Ni=vn(null),ki=null,xr=null,Zd=null;function eu(){Zd=xr=ki=null}function tu(e){var t=Ni.current;Xe(Ni),e._currentValue=t}function Hc(e,t,s){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===s)break;e=e.return}}function kr(e,t){ki=e,Zd=xr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(zt=!0),e.firstContext=null)}function rs(e){var t=e._currentValue;if(Zd!==e)if(e={context:e,memoizedValue:t,next:null},xr===null){if(ki===null)throw Error(oe(308));xr=e,ki.dependencies={lanes:0,firstContext:e}}else xr=xr.next=e;return t}var On=null;function su(e){On===null?On=[e]:On.push(e)}function tp(e,t,s,n){var a=t.interleaved;return a===null?(s.next=s,su(t)):(s.next=a.next,a.next=s),t.interleaved=s,Bs(e,n)}function Bs(e,t){e.lanes|=t;var s=e.alternate;for(s!==null&&(s.lanes|=t),s=e,e=e.return;e!==null;)e.childLanes|=t,s=e.alternate,s!==null&&(s.childLanes|=t),s=e,e=e.return;return s.tag===3?s.stateNode:null}var Xs=!1;function nu(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function sp(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Rs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function dn(e,t,s){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Le&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Bs(e,s)}return a=n.interleaved,a===null?(t.next=t,su(n)):(t.next=a.next,a.next=t),n.interleaved=t,Bs(e,s)}function Xo(e,t,s){if(t=t.updateQueue,t!==null&&(t=t.shared,(s&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,s|=n,t.lanes=s,Bd(e,s)}}function Mh(e,t){var s=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var a=null,o=null;if(s=s.firstBaseUpdate,s!==null){do{var i={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};o===null?a=o=i:o=o.next=i,s=s.next}while(s!==null);o===null?a=o=t:o=o.next=t}else a=o=t;s={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:o,shared:n.shared,effects:n.effects},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=t:e.next=t,s.lastBaseUpdate=t}function Si(e,t,s,n){var a=e.updateQueue;Xs=!1;var o=a.firstBaseUpdate,i=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,d=c.next;c.next=null,i===null?o=d:i.next=d,i=c;var u=e.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==i&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(o!==null){var h=a.baseState;i=0,u=d=c=null,l=o;do{var m=l.lane,x=l.eventTime;if((n&m)===m){u!==null&&(u=u.next={eventTime:x,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var w=e,S=l;switch(m=t,x=s,S.tag){case 1:if(w=S.payload,typeof w=="function"){h=w.call(x,h,m);break e}h=w;break e;case 3:w.flags=w.flags&-65537|128;case 0:if(w=S.payload,m=typeof w=="function"?w.call(x,h,m):w,m==null)break e;h=nt({},h,m);break e;case 2:Xs=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,m=a.effects,m===null?a.effects=[l]:m.push(l))}else x={eventTime:x,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=x,c=h):u=u.next=x,i|=m;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;m=l,l=m.next,m.next=null,a.lastBaseUpdate=m,a.shared.pending=null}}while(!0);if(u===null&&(c=h),a.baseState=c,a.firstBaseUpdate=d,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do i|=a.lane,a=a.next;while(a!==t)}else o===null&&(a.shared.lanes=0);Un|=i,e.lanes=i,e.memoizedState=h}}function Ph(e,t,s){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=s,typeof a!="function")throw Error(oe(191,a));a.call(n)}}}var lo={},Cs=vn(lo),Ha=vn(lo),Wa=vn(lo);function In(e){if(e===lo)throw Error(oe(174));return e}function ru(e,t){switch(Qe(Wa,t),Qe(Ha,e),Qe(Cs,lo),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Nc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Nc(t,e)}Xe(Cs),Qe(Cs,t)}function Dr(){Xe(Cs),Xe(Ha),Xe(Wa)}function np(e){In(Wa.current);var t=In(Cs.current),s=Nc(t,e.type);t!==s&&(Qe(Ha,e),Qe(Cs,s))}function au(e){Ha.current===e&&(Xe(Cs),Xe(Ha))}var tt=vn(0);function _i(e){for(var t=e;t!==null;){if(t.tag===13){var s=t.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ul=[];function ou(){for(var e=0;e<Ul.length;e++)Ul[e]._workInProgressVersionPrimary=null;Ul.length=0}var Zo=qs.ReactCurrentDispatcher,Bl=qs.ReactCurrentBatchConfig,Fn=0,st=null,mt=null,vt=null,Ci=!1,xa=!1,qa=0,p0=0;function Ct(){throw Error(oe(321))}function iu(e,t){if(t===null)return!1;for(var s=0;s<t.length&&s<e.length;s++)if(!bs(e[s],t[s]))return!1;return!0}function lu(e,t,s,n,a,o){if(Fn=o,st=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Zo.current=e===null||e.memoizedState===null?v0:b0,e=s(n,a),xa){o=0;do{if(xa=!1,qa=0,25<=o)throw Error(oe(301));o+=1,vt=mt=null,t.updateQueue=null,Zo.current=j0,e=s(n,a)}while(xa)}if(Zo.current=Ei,t=mt!==null&&mt.next!==null,Fn=0,vt=mt=st=null,Ci=!1,t)throw Error(oe(300));return e}function cu(){var e=qa!==0;return qa=0,e}function ws(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?st.memoizedState=vt=e:vt=vt.next=e,vt}function as(){if(mt===null){var e=st.alternate;e=e!==null?e.memoizedState:null}else e=mt.next;var t=vt===null?st.memoizedState:vt.next;if(t!==null)vt=t,mt=e;else{if(e===null)throw Error(oe(310));mt=e,e={memoizedState:mt.memoizedState,baseState:mt.baseState,baseQueue:mt.baseQueue,queue:mt.queue,next:null},vt===null?st.memoizedState=vt=e:vt=vt.next=e}return vt}function Va(e,t){return typeof t=="function"?t(e):t}function Hl(e){var t=as(),s=t.queue;if(s===null)throw Error(oe(311));s.lastRenderedReducer=e;var n=mt,a=n.baseQueue,o=s.pending;if(o!==null){if(a!==null){var i=a.next;a.next=o.next,o.next=i}n.baseQueue=a=o,s.pending=null}if(a!==null){o=a.next,n=n.baseState;var l=i=null,c=null,d=o;do{var u=d.lane;if((Fn&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:e(n,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,i=n):c=c.next=h,st.lanes|=u,Un|=u}d=d.next}while(d!==null&&d!==o);c===null?i=n:c.next=l,bs(n,t.memoizedState)||(zt=!0),t.memoizedState=n,t.baseState=i,t.baseQueue=c,s.lastRenderedState=n}if(e=s.interleaved,e!==null){a=e;do o=a.lane,st.lanes|=o,Un|=o,a=a.next;while(a!==e)}else a===null&&(s.lanes=0);return[t.memoizedState,s.dispatch]}function Wl(e){var t=as(),s=t.queue;if(s===null)throw Error(oe(311));s.lastRenderedReducer=e;var n=s.dispatch,a=s.pending,o=t.memoizedState;if(a!==null){s.pending=null;var i=a=a.next;do o=e(o,i.action),i=i.next;while(i!==a);bs(o,t.memoizedState)||(zt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),s.lastRenderedState=o}return[o,n]}function rp(){}function ap(e,t){var s=st,n=as(),a=t(),o=!bs(n.memoizedState,a);if(o&&(n.memoizedState=a,zt=!0),n=n.queue,du(lp.bind(null,s,n,e),[e]),n.getSnapshot!==t||o||vt!==null&&vt.memoizedState.tag&1){if(s.flags|=2048,Ga(9,ip.bind(null,s,n,a,t),void 0,null),bt===null)throw Error(oe(349));Fn&30||op(s,t,a)}return a}function op(e,t,s){e.flags|=16384,e={getSnapshot:t,value:s},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.stores=[e]):(s=t.stores,s===null?t.stores=[e]:s.push(e))}function ip(e,t,s,n){t.value=s,t.getSnapshot=n,cp(t)&&dp(e)}function lp(e,t,s){return s(function(){cp(t)&&dp(e)})}function cp(e){var t=e.getSnapshot;e=e.value;try{var s=t();return!bs(e,s)}catch{return!0}}function dp(e){var t=Bs(e,1);t!==null&&ys(t,e,1,-1)}function Dh(e){var t=ws();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:e},t.queue=e,e=e.dispatch=y0.bind(null,st,e),[t.memoizedState,e]}function Ga(e,t,s,n){return e={tag:e,create:t,destroy:s,deps:n,next:null},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.lastEffect=e.next=e):(s=t.lastEffect,s===null?t.lastEffect=e.next=e:(n=s.next,s.next=e,e.next=n,t.lastEffect=e)),e}function up(){return as().memoizedState}function ei(e,t,s,n){var a=ws();st.flags|=e,a.memoizedState=Ga(1|t,s,void 0,n===void 0?null:n)}function Zi(e,t,s,n){var a=as();n=n===void 0?null:n;var o=void 0;if(mt!==null){var i=mt.memoizedState;if(o=i.destroy,n!==null&&iu(n,i.deps)){a.memoizedState=Ga(t,s,o,n);return}}st.flags|=e,a.memoizedState=Ga(1|t,s,o,n)}function Oh(e,t){return ei(8390656,8,e,t)}function du(e,t){return Zi(2048,8,e,t)}function hp(e,t){return Zi(4,2,e,t)}function mp(e,t){return Zi(4,4,e,t)}function fp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function pp(e,t,s){return s=s!=null?s.concat([e]):null,Zi(4,4,fp.bind(null,t,e),s)}function uu(){}function gp(e,t){var s=as();t=t===void 0?null:t;var n=s.memoizedState;return n!==null&&t!==null&&iu(t,n[1])?n[0]:(s.memoizedState=[e,t],e)}function xp(e,t){var s=as();t=t===void 0?null:t;var n=s.memoizedState;return n!==null&&t!==null&&iu(t,n[1])?n[0]:(e=e(),s.memoizedState=[e,t],e)}function yp(e,t,s){return Fn&21?(bs(s,t)||(s=Nf(),st.lanes|=s,Un|=s,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,zt=!0),e.memoizedState=s)}function g0(e,t){var s=He;He=s!==0&&4>s?s:4,e(!0);var n=Bl.transition;Bl.transition={};try{e(!1),t()}finally{He=s,Bl.transition=n}}function vp(){return as().memoizedState}function x0(e,t,s){var n=hn(e);if(s={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null},bp(e))jp(t,s);else if(s=tp(e,t,s,n),s!==null){var a=Ot();ys(s,e,n,a),wp(s,t,n)}}function y0(e,t,s){var n=hn(e),a={lane:n,action:s,hasEagerState:!1,eagerState:null,next:null};if(bp(e))jp(t,a);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var i=t.lastRenderedState,l=o(i,s);if(a.hasEagerState=!0,a.eagerState=l,bs(l,i)){var c=t.interleaved;c===null?(a.next=a,su(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}s=tp(e,t,a,n),s!==null&&(a=Ot(),ys(s,e,n,a),wp(s,t,n))}}function bp(e){var t=e.alternate;return e===st||t!==null&&t===st}function jp(e,t){xa=Ci=!0;var s=e.pending;s===null?t.next=t:(t.next=s.next,s.next=t),e.pending=t}function wp(e,t,s){if(s&4194240){var n=t.lanes;n&=e.pendingLanes,s|=n,t.lanes=s,Bd(e,s)}}var Ei={readContext:rs,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useInsertionEffect:Ct,useLayoutEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useMutableSource:Ct,useSyncExternalStore:Ct,useId:Ct,unstable_isNewReconciler:!1},v0={readContext:rs,useCallback:function(e,t){return ws().memoizedState=[e,t===void 0?null:t],e},useContext:rs,useEffect:Oh,useImperativeHandle:function(e,t,s){return s=s!=null?s.concat([e]):null,ei(4194308,4,fp.bind(null,t,e),s)},useLayoutEffect:function(e,t){return ei(4194308,4,e,t)},useInsertionEffect:function(e,t){return ei(4,2,e,t)},useMemo:function(e,t){var s=ws();return t=t===void 0?null:t,e=e(),s.memoizedState=[e,t],e},useReducer:function(e,t,s){var n=ws();return t=s!==void 0?s(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=x0.bind(null,st,e),[n.memoizedState,e]},useRef:function(e){var t=ws();return e={current:e},t.memoizedState=e},useState:Dh,useDebugValue:uu,useDeferredValue:function(e){return ws().memoizedState=e},useTransition:function(){var e=Dh(!1),t=e[0];return e=g0.bind(null,e[1]),ws().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,s){var n=st,a=ws();if(et){if(s===void 0)throw Error(oe(407));s=s()}else{if(s=t(),bt===null)throw Error(oe(349));Fn&30||op(n,t,s)}a.memoizedState=s;var o={value:s,getSnapshot:t};return a.queue=o,Oh(lp.bind(null,n,o,e),[e]),n.flags|=2048,Ga(9,ip.bind(null,n,o,s,t),void 0,null),s},useId:function(){var e=ws(),t=bt.identifierPrefix;if(et){var s=As,n=Is;s=(n&~(1<<32-xs(n)-1)).toString(32)+s,t=":"+t+"R"+s,s=qa++,0<s&&(t+="H"+s.toString(32)),t+=":"}else s=p0++,t=":"+t+"r"+s.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},b0={readContext:rs,useCallback:gp,useContext:rs,useEffect:du,useImperativeHandle:pp,useInsertionEffect:hp,useLayoutEffect:mp,useMemo:xp,useReducer:Hl,useRef:up,useState:function(){return Hl(Va)},useDebugValue:uu,useDeferredValue:function(e){var t=as();return yp(t,mt.memoizedState,e)},useTransition:function(){var e=Hl(Va)[0],t=as().memoizedState;return[e,t]},useMutableSource:rp,useSyncExternalStore:ap,useId:vp,unstable_isNewReconciler:!1},j0={readContext:rs,useCallback:gp,useContext:rs,useEffect:du,useImperativeHandle:pp,useInsertionEffect:hp,useLayoutEffect:mp,useMemo:xp,useReducer:Wl,useRef:up,useState:function(){return Wl(Va)},useDebugValue:uu,useDeferredValue:function(e){var t=as();return mt===null?t.memoizedState=e:yp(t,mt.memoizedState,e)},useTransition:function(){var e=Wl(Va)[0],t=as().memoizedState;return[e,t]},useMutableSource:rp,useSyncExternalStore:ap,useId:vp,unstable_isNewReconciler:!1};function cs(e,t){if(e&&e.defaultProps){t=nt({},t),e=e.defaultProps;for(var s in e)t[s]===void 0&&(t[s]=e[s]);return t}return t}function Wc(e,t,s,n){t=e.memoizedState,s=s(n,t),s=s==null?t:nt({},t,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var el={isMounted:function(e){return(e=e._reactInternals)?Kn(e)===e:!1},enqueueSetState:function(e,t,s){e=e._reactInternals;var n=Ot(),a=hn(e),o=Rs(n,a);o.payload=t,s!=null&&(o.callback=s),t=dn(e,o,a),t!==null&&(ys(t,e,a,n),Xo(t,e,a))},enqueueReplaceState:function(e,t,s){e=e._reactInternals;var n=Ot(),a=hn(e),o=Rs(n,a);o.tag=1,o.payload=t,s!=null&&(o.callback=s),t=dn(e,o,a),t!==null&&(ys(t,e,a,n),Xo(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var s=Ot(),n=hn(e),a=Rs(s,n);a.tag=2,t!=null&&(a.callback=t),t=dn(e,a,n),t!==null&&(ys(t,e,n,s),Xo(t,e,n))}};function Ih(e,t,s,n,a,o,i){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,o,i):t.prototype&&t.prototype.isPureReactComponent?!za(s,n)||!za(a,o):!0}function Np(e,t,s){var n=!1,a=gn,o=t.contextType;return typeof o=="object"&&o!==null?o=rs(o):(a=Ut(t)?Ln:Mt.current,n=t.contextTypes,o=(n=n!=null)?Tr(e,a):gn),t=new t(s,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=el,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ah(e,t,s,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(s,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(s,n),t.state!==e&&el.enqueueReplaceState(t,t.state,null)}function qc(e,t,s,n){var a=e.stateNode;a.props=s,a.state=e.memoizedState,a.refs={},nu(e);var o=t.contextType;typeof o=="object"&&o!==null?a.context=rs(o):(o=Ut(t)?Ln:Mt.current,a.context=Tr(e,o)),a.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Wc(e,t,o,s),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&el.enqueueReplaceState(a,a.state,null),Si(e,s,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Or(e,t){try{var s="",n=t;do s+=Qx(n),n=n.return;while(n);var a=s}catch(o){a=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:a,digest:null}}function ql(e,t,s){return{value:e,source:null,stack:s??null,digest:t??null}}function Vc(e,t){try{console.error(t.value)}catch(s){setTimeout(function(){throw s})}}var w0=typeof WeakMap=="function"?WeakMap:Map;function kp(e,t,s){s=Rs(-1,s),s.tag=3,s.payload={element:null};var n=t.value;return s.callback=function(){Mi||(Mi=!0,sd=n),Vc(e,t)},s}function Sp(e,t,s){s=Rs(-1,s),s.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;s.payload=function(){return n(a)},s.callback=function(){Vc(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(s.callback=function(){Vc(e,t),typeof n!="function"&&(un===null?un=new Set([this]):un.add(this));var i=t.stack;this.componentDidCatch(t.value,{componentStack:i!==null?i:""})}),s}function $h(e,t,s){var n=e.pingCache;if(n===null){n=e.pingCache=new w0;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(s)||(a.add(s),e=$0.bind(null,e,t,s),t.then(e,e))}function Rh(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Lh(e,t,s,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(t=Rs(-1,1),t.tag=2,dn(s,t,1))),s.lanes|=1),e)}var N0=qs.ReactCurrentOwner,zt=!1;function Dt(e,t,s,n){t.child=e===null?ep(t,null,s,n):Pr(t,e.child,s,n)}function zh(e,t,s,n,a){s=s.render;var o=t.ref;return kr(t,a),n=lu(e,t,s,n,o,a),s=cu(),e!==null&&!zt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a)):(et&&s&&Yd(t),t.flags|=1,Dt(e,t,n,a),t.child)}function Fh(e,t,s,n,a){if(e===null){var o=s.type;return typeof o=="function"&&!vu(o)&&o.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(t.tag=15,t.type=o,_p(e,t,o,n,a)):(e=ri(s.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&a)){var i=o.memoizedProps;if(s=s.compare,s=s!==null?s:za,s(i,n)&&e.ref===t.ref)return Hs(e,t,a)}return t.flags|=1,e=mn(o,n),e.ref=t.ref,e.return=t,t.child=e}function _p(e,t,s,n,a){if(e!==null){var o=e.memoizedProps;if(za(o,n)&&e.ref===t.ref)if(zt=!1,t.pendingProps=n=o,(e.lanes&a)!==0)e.flags&131072&&(zt=!0);else return t.lanes=e.lanes,Hs(e,t,a)}return Gc(e,t,s,n,a)}function Cp(e,t,s){var n=t.pendingProps,a=n.children,o=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(vr,qt),qt|=s;else{if(!(s&1073741824))return e=o!==null?o.baseLanes|s:s,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Qe(vr,qt),qt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:s,Qe(vr,qt),qt|=n}else o!==null?(n=o.baseLanes|s,t.memoizedState=null):n=s,Qe(vr,qt),qt|=n;return Dt(e,t,a,s),t.child}function Ep(e,t){var s=t.ref;(e===null&&s!==null||e!==null&&e.ref!==s)&&(t.flags|=512,t.flags|=2097152)}function Gc(e,t,s,n,a){var o=Ut(s)?Ln:Mt.current;return o=Tr(t,o),kr(t,a),s=lu(e,t,s,n,o,a),n=cu(),e!==null&&!zt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a)):(et&&n&&Yd(t),t.flags|=1,Dt(e,t,s,a),t.child)}function Uh(e,t,s,n,a){if(Ut(s)){var o=!0;bi(t)}else o=!1;if(kr(t,a),t.stateNode===null)ti(e,t),Np(t,s,n),qc(t,s,n,a),n=!0;else if(e===null){var i=t.stateNode,l=t.memoizedProps;i.props=l;var c=i.context,d=s.contextType;typeof d=="object"&&d!==null?d=rs(d):(d=Ut(s)?Ln:Mt.current,d=Tr(t,d));var u=s.getDerivedStateFromProps,h=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";h||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==n||c!==d)&&Ah(t,i,n,d),Xs=!1;var m=t.memoizedState;i.state=m,Si(t,n,i,a),c=t.memoizedState,l!==n||m!==c||Ft.current||Xs?(typeof u=="function"&&(Wc(t,s,u,n),c=t.memoizedState),(l=Xs||Ih(t,s,l,n,m,c,d))?(h||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(t.flags|=4194308)):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),i.props=n,i.state=c,i.context=d,n=l):(typeof i.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{i=t.stateNode,sp(e,t),l=t.memoizedProps,d=t.type===t.elementType?l:cs(t.type,l),i.props=d,h=t.pendingProps,m=i.context,c=s.contextType,typeof c=="object"&&c!==null?c=rs(c):(c=Ut(s)?Ln:Mt.current,c=Tr(t,c));var x=s.getDerivedStateFromProps;(u=typeof x=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(l!==h||m!==c)&&Ah(t,i,n,c),Xs=!1,m=t.memoizedState,i.state=m,Si(t,n,i,a);var w=t.memoizedState;l!==h||m!==w||Ft.current||Xs?(typeof x=="function"&&(Wc(t,s,x,n),w=t.memoizedState),(d=Xs||Ih(t,s,d,n,m,w,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,w,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,w,c)),typeof i.componentDidUpdate=="function"&&(t.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=w),i.props=n,i.state=w,i.context=c,n=d):(typeof i.componentDidUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),n=!1)}return Kc(e,t,s,n,o,a)}function Kc(e,t,s,n,a,o){Ep(e,t);var i=(t.flags&128)!==0;if(!n&&!i)return a&&_h(t,s,!1),Hs(e,t,o);n=t.stateNode,N0.current=t;var l=i&&typeof s.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&i?(t.child=Pr(t,e.child,null,o),t.child=Pr(t,null,l,o)):Dt(e,t,l,o),t.memoizedState=n.state,a&&_h(t,s,!0),t.child}function Tp(e){var t=e.stateNode;t.pendingContext?Sh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Sh(e,t.context,!1),ru(e,t.containerInfo)}function Bh(e,t,s,n,a){return Mr(),Xd(a),t.flags|=256,Dt(e,t,s,n),t.child}var Qc={dehydrated:null,treeContext:null,retryLane:0};function Yc(e){return{baseLanes:e,cachePool:null,transitions:null}}function Mp(e,t,s){var n=t.pendingProps,a=tt.current,o=!1,i=(t.flags&128)!==0,l;if((l=i)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Qe(tt,a&1),e===null)return Bc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(i=n.children,e=n.fallback,o?(n=t.mode,o=t.child,i={mode:"hidden",children:i},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=nl(i,n,0,null),e=$n(e,n,s,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Yc(s),t.memoizedState=Qc,e):hu(t,i));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return k0(e,t,i,n,l,a,s);if(o){o=n.fallback,i=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:n.children};return!(i&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=c,t.deletions=null):(n=mn(a,c),n.subtreeFlags=a.subtreeFlags&14680064),l!==null?o=mn(l,o):(o=$n(o,i,s,null),o.flags|=2),o.return=t,n.return=t,n.sibling=o,t.child=n,n=o,o=t.child,i=e.child.memoizedState,i=i===null?Yc(s):{baseLanes:i.baseLanes|s,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~s,t.memoizedState=Qc,n}return o=e.child,e=o.sibling,n=mn(o,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=s),n.return=t,n.sibling=null,e!==null&&(s=t.deletions,s===null?(t.deletions=[e],t.flags|=16):s.push(e)),t.child=n,t.memoizedState=null,n}function hu(e,t){return t=nl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ao(e,t,s,n){return n!==null&&Xd(n),Pr(t,e.child,null,s),e=hu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function k0(e,t,s,n,a,o,i){if(s)return t.flags&256?(t.flags&=-257,n=ql(Error(oe(422))),Ao(e,t,i,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=n.fallback,a=t.mode,n=nl({mode:"visible",children:n.children},a,0,null),o=$n(o,a,i,null),o.flags|=2,n.return=t,o.return=t,n.sibling=o,t.child=n,t.mode&1&&Pr(t,e.child,null,i),t.child.memoizedState=Yc(i),t.memoizedState=Qc,o);if(!(t.mode&1))return Ao(e,t,i,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var l=n.dgst;return n=l,o=Error(oe(419)),n=ql(o,n,void 0),Ao(e,t,i,n)}if(l=(i&e.childLanes)!==0,zt||l){if(n=bt,n!==null){switch(i&-i){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|i)?0:a,a!==0&&a!==o.retryLane&&(o.retryLane=a,Bs(e,a),ys(n,e,a,-1))}return yu(),n=ql(Error(oe(421))),Ao(e,t,i,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=R0.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,Vt=cn(a.nextSibling),Gt=t,et=!0,hs=null,e!==null&&(Zt[es++]=Is,Zt[es++]=As,Zt[es++]=zn,Is=e.id,As=e.overflow,zn=t),t=hu(t,n.children),t.flags|=4096,t)}function Hh(e,t,s){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Hc(e.return,t,s)}function Vl(e,t,s,n,a){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=s,o.tailMode=a)}function Pp(e,t,s){var n=t.pendingProps,a=n.revealOrder,o=n.tail;if(Dt(e,t,n.children,s),n=tt.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Hh(e,s,t);else if(e.tag===19)Hh(e,s,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Qe(tt,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(s=t.child,a=null;s!==null;)e=s.alternate,e!==null&&_i(e)===null&&(a=s),s=s.sibling;s=a,s===null?(a=t.child,t.child=null):(a=s.sibling,s.sibling=null),Vl(t,!1,a,s,o);break;case"backwards":for(s=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&_i(e)===null){t.child=a;break}e=a.sibling,a.sibling=s,s=a,a=e}Vl(t,!0,s,null,o);break;case"together":Vl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ti(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,s){if(e!==null&&(t.dependencies=e.dependencies),Un|=t.lanes,!(s&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(oe(153));if(t.child!==null){for(e=t.child,s=mn(e,e.pendingProps),t.child=s,s.return=t;e.sibling!==null;)e=e.sibling,s=s.sibling=mn(e,e.pendingProps),s.return=t;s.sibling=null}return t.child}function S0(e,t,s){switch(t.tag){case 3:Tp(t),Mr();break;case 5:np(t);break;case 1:Ut(t.type)&&bi(t);break;case 4:ru(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Qe(Ni,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Qe(tt,tt.current&1),t.flags|=128,null):s&t.child.childLanes?Mp(e,t,s):(Qe(tt,tt.current&1),e=Hs(e,t,s),e!==null?e.sibling:null);Qe(tt,tt.current&1);break;case 19:if(n=(s&t.childLanes)!==0,e.flags&128){if(n)return Pp(e,t,s);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Qe(tt,tt.current),n)break;return null;case 22:case 23:return t.lanes=0,Cp(e,t,s)}return Hs(e,t,s)}var Dp,Jc,Op,Ip;Dp=function(e,t){for(var s=t.child;s!==null;){if(s.tag===5||s.tag===6)e.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Jc=function(){};Op=function(e,t,s,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,In(Cs.current);var o=null;switch(s){case"input":a=vc(e,a),n=vc(e,n),o=[];break;case"select":a=nt({},a,{value:void 0}),n=nt({},n,{value:void 0}),o=[];break;case"textarea":a=wc(e,a),n=wc(e,n),o=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=yi)}kc(s,n);var i;s=null;for(d in a)if(!n.hasOwnProperty(d)&&a.hasOwnProperty(d)&&a[d]!=null)if(d==="style"){var l=a[d];for(i in l)l.hasOwnProperty(i)&&(s||(s={}),s[i]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Da.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in n){var c=n[d];if(l=a!=null?a[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(s||(s={}),s[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(s||(s={}),s[i]=c[i])}else s||(o||(o=[]),o.push(d,s)),s=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Da.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Je("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}s&&(o=o||[]).push("style",s);var d=o;(t.updateQueue=d)&&(t.flags|=4)}};Ip=function(e,t,s,n){s!==n&&(t.flags|=4)};function Zr(e,t){if(!et)switch(e.tailMode){case"hidden":t=e.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Et(e){var t=e.alternate!==null&&e.alternate.child===e.child,s=0,n=0;if(t)for(var a=e.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)s|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=s,t}function _0(e,t,s){var n=t.pendingProps;switch(Jd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(t),null;case 1:return Ut(t.type)&&vi(),Et(t),null;case 3:return n=t.stateNode,Dr(),Xe(Ft),Xe(Mt),ou(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Oo(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,hs!==null&&(ad(hs),hs=null))),Jc(e,t),Et(t),null;case 5:au(t);var a=In(Wa.current);if(s=t.type,e!==null&&t.stateNode!=null)Op(e,t,s,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(oe(166));return Et(t),null}if(e=In(Cs.current),Oo(t)){n=t.stateNode,s=t.type;var o=t.memoizedProps;switch(n[ks]=t,n[Ba]=o,e=(t.mode&1)!==0,s){case"dialog":Je("cancel",n),Je("close",n);break;case"iframe":case"object":case"embed":Je("load",n);break;case"video":case"audio":for(a=0;a<ca.length;a++)Je(ca[a],n);break;case"source":Je("error",n);break;case"img":case"image":case"link":Je("error",n),Je("load",n);break;case"details":Je("toggle",n);break;case"input":Xu(n,o),Je("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},Je("invalid",n);break;case"textarea":eh(n,o),Je("invalid",n)}kc(s,o),a=null;for(var i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="children"?typeof l=="string"?n.textContent!==l&&(o.suppressHydrationWarning!==!0&&Do(n.textContent,l,e),a=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Do(n.textContent,l,e),a=["children",""+l]):Da.hasOwnProperty(i)&&l!=null&&i==="onScroll"&&Je("scroll",n)}switch(s){case"input":ko(n),Zu(n,o,!0);break;case"textarea":ko(n),th(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=yi)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{i=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=lf(s)),e==="http://www.w3.org/1999/xhtml"?s==="script"?(e=i.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=i.createElement(s,{is:n.is}):(e=i.createElement(s),s==="select"&&(i=e,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):e=i.createElementNS(e,s),e[ks]=t,e[Ba]=n,Dp(e,t,!1,!1),t.stateNode=e;e:{switch(i=Sc(s,n),s){case"dialog":Je("cancel",e),Je("close",e),a=n;break;case"iframe":case"object":case"embed":Je("load",e),a=n;break;case"video":case"audio":for(a=0;a<ca.length;a++)Je(ca[a],e);a=n;break;case"source":Je("error",e),a=n;break;case"img":case"image":case"link":Je("error",e),Je("load",e),a=n;break;case"details":Je("toggle",e),a=n;break;case"input":Xu(e,n),a=vc(e,n),Je("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=nt({},n,{value:void 0}),Je("invalid",e);break;case"textarea":eh(e,n),a=wc(e,n),Je("invalid",e);break;default:a=n}kc(s,a),l=a;for(o in l)if(l.hasOwnProperty(o)){var c=l[o];o==="style"?uf(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&cf(e,c)):o==="children"?typeof c=="string"?(s!=="textarea"||c!=="")&&Oa(e,c):typeof c=="number"&&Oa(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Da.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Je("scroll",e):c!=null&&$d(e,o,c,i))}switch(s){case"input":ko(e),Zu(e,n,!1);break;case"textarea":ko(e),th(e);break;case"option":n.value!=null&&e.setAttribute("value",""+pn(n.value));break;case"select":e.multiple=!!n.multiple,o=n.value,o!=null?br(e,!!n.multiple,o,!1):n.defaultValue!=null&&br(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=yi)}switch(s){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Et(t),null;case 6:if(e&&t.stateNode!=null)Ip(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(oe(166));if(s=In(Wa.current),In(Cs.current),Oo(t)){if(n=t.stateNode,s=t.memoizedProps,n[ks]=t,(o=n.nodeValue!==s)&&(e=Gt,e!==null))switch(e.tag){case 3:Do(n.nodeValue,s,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Do(n.nodeValue,s,(e.mode&1)!==0)}o&&(t.flags|=4)}else n=(s.nodeType===9?s:s.ownerDocument).createTextNode(n),n[ks]=t,t.stateNode=n}return Et(t),null;case 13:if(Xe(tt),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(et&&Vt!==null&&t.mode&1&&!(t.flags&128))Xf(),Mr(),t.flags|=98560,o=!1;else if(o=Oo(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(oe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(oe(317));o[ks]=t}else Mr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Et(t),o=!1}else hs!==null&&(ad(hs),hs=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=s,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||tt.current&1?gt===0&&(gt=3):yu())),t.updateQueue!==null&&(t.flags|=4),Et(t),null);case 4:return Dr(),Jc(e,t),e===null&&Fa(t.stateNode.containerInfo),Et(t),null;case 10:return tu(t.type._context),Et(t),null;case 17:return Ut(t.type)&&vi(),Et(t),null;case 19:if(Xe(tt),o=t.memoizedState,o===null)return Et(t),null;if(n=(t.flags&128)!==0,i=o.rendering,i===null)if(n)Zr(o,!1);else{if(gt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(i=_i(e),i!==null){for(t.flags|=128,Zr(o,!1),n=i.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=s,s=t.child;s!==null;)o=s,e=n,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,e=i.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s=s.sibling;return Qe(tt,tt.current&1|2),t.child}e=e.sibling}o.tail!==null&&ot()>Ir&&(t.flags|=128,n=!0,Zr(o,!1),t.lanes=4194304)}else{if(!n)if(e=_i(i),e!==null){if(t.flags|=128,n=!0,s=e.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),Zr(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!et)return Et(t),null}else 2*ot()-o.renderingStartTime>Ir&&s!==1073741824&&(t.flags|=128,n=!0,Zr(o,!1),t.lanes=4194304);o.isBackwards?(i.sibling=t.child,t.child=i):(s=o.last,s!==null?s.sibling=i:t.child=i,o.last=i)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=ot(),t.sibling=null,s=tt.current,Qe(tt,n?s&1|2:s&1),t):(Et(t),null);case 22:case 23:return xu(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?qt&1073741824&&(Et(t),t.subtreeFlags&6&&(t.flags|=8192)):Et(t),null;case 24:return null;case 25:return null}throw Error(oe(156,t.tag))}function C0(e,t){switch(Jd(t),t.tag){case 1:return Ut(t.type)&&vi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Dr(),Xe(Ft),Xe(Mt),ou(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return au(t),null;case 13:if(Xe(tt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(oe(340));Mr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Xe(tt),null;case 4:return Dr(),null;case 10:return tu(t.type._context),null;case 22:case 23:return xu(),null;case 24:return null;default:return null}}var $o=!1,Tt=!1,E0=typeof WeakSet=="function"?WeakSet:Set,ve=null;function yr(e,t){var s=e.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(n){at(e,t,n)}else s.current=null}function Xc(e,t,s){try{s()}catch(n){at(e,t,n)}}var Wh=!1;function T0(e,t){if(Ac=pi,e=zf(),Qd(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var a=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{s.nodeType,o.nodeType}catch{s=null;break e}var i=0,l=-1,c=-1,d=0,u=0,h=e,m=null;t:for(;;){for(var x;h!==s||a!==0&&h.nodeType!==3||(l=i+a),h!==o||n!==0&&h.nodeType!==3||(c=i+n),h.nodeType===3&&(i+=h.nodeValue.length),(x=h.firstChild)!==null;)m=h,h=x;for(;;){if(h===e)break t;if(m===s&&++d===a&&(l=i),m===o&&++u===n&&(c=i),(x=h.nextSibling)!==null)break;h=m,m=h.parentNode}h=x}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for($c={focusedElem:e,selectionRange:s},pi=!1,ve=t;ve!==null;)if(t=ve,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,ve=e;else for(;ve!==null;){t=ve;try{var w=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(w!==null){var S=w.memoizedProps,E=w.memoizedState,y=t.stateNode,f=y.getSnapshotBeforeUpdate(t.elementType===t.type?S:cs(t.type,S),E);y.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var g=t.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(b){at(t,t.return,b)}if(e=t.sibling,e!==null){e.return=t.return,ve=e;break}ve=t.return}return w=Wh,Wh=!1,w}function ya(e,t,s){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,o!==void 0&&Xc(t,s,o)}a=a.next}while(a!==n)}}function tl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var s=t=t.next;do{if((s.tag&e)===e){var n=s.create;s.destroy=n()}s=s.next}while(s!==t)}}function Zc(e){var t=e.ref;if(t!==null){var s=e.stateNode;switch(e.tag){case 5:e=s;break;default:e=s}typeof t=="function"?t(e):t.current=e}}function Ap(e){var t=e.alternate;t!==null&&(e.alternate=null,Ap(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ks],delete t[Ba],delete t[zc],delete t[u0],delete t[h0])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function $p(e){return e.tag===5||e.tag===3||e.tag===4}function qh(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||$p(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ed(e,t,s){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?s.nodeType===8?s.parentNode.insertBefore(e,t):s.insertBefore(e,t):(s.nodeType===8?(t=s.parentNode,t.insertBefore(e,s)):(t=s,t.appendChild(e)),s=s._reactRootContainer,s!=null||t.onclick!==null||(t.onclick=yi));else if(n!==4&&(e=e.child,e!==null))for(ed(e,t,s),e=e.sibling;e!==null;)ed(e,t,s),e=e.sibling}function td(e,t,s){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?s.insertBefore(e,t):s.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(td(e,t,s),e=e.sibling;e!==null;)td(e,t,s),e=e.sibling}var jt=null,ds=!1;function Gs(e,t,s){for(s=s.child;s!==null;)Rp(e,t,s),s=s.sibling}function Rp(e,t,s){if(_s&&typeof _s.onCommitFiberUnmount=="function")try{_s.onCommitFiberUnmount(Gi,s)}catch{}switch(s.tag){case 5:Tt||yr(s,t);case 6:var n=jt,a=ds;jt=null,Gs(e,t,s),jt=n,ds=a,jt!==null&&(ds?(e=jt,s=s.stateNode,e.nodeType===8?e.parentNode.removeChild(s):e.removeChild(s)):jt.removeChild(s.stateNode));break;case 18:jt!==null&&(ds?(e=jt,s=s.stateNode,e.nodeType===8?zl(e.parentNode,s):e.nodeType===1&&zl(e,s),Ra(e)):zl(jt,s.stateNode));break;case 4:n=jt,a=ds,jt=s.stateNode.containerInfo,ds=!0,Gs(e,t,s),jt=n,ds=a;break;case 0:case 11:case 14:case 15:if(!Tt&&(n=s.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var o=a,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&Xc(s,t,i),a=a.next}while(a!==n)}Gs(e,t,s);break;case 1:if(!Tt&&(yr(s,t),n=s.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=s.memoizedProps,n.state=s.memoizedState,n.componentWillUnmount()}catch(l){at(s,t,l)}Gs(e,t,s);break;case 21:Gs(e,t,s);break;case 22:s.mode&1?(Tt=(n=Tt)||s.memoizedState!==null,Gs(e,t,s),Tt=n):Gs(e,t,s);break;default:Gs(e,t,s)}}function Vh(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var s=e.stateNode;s===null&&(s=e.stateNode=new E0),t.forEach(function(n){var a=L0.bind(null,e,n);s.has(n)||(s.add(n),n.then(a,a))})}}function is(e,t){var s=t.deletions;if(s!==null)for(var n=0;n<s.length;n++){var a=s[n];try{var o=e,i=t,l=i;e:for(;l!==null;){switch(l.tag){case 5:jt=l.stateNode,ds=!1;break e;case 3:jt=l.stateNode.containerInfo,ds=!0;break e;case 4:jt=l.stateNode.containerInfo,ds=!0;break e}l=l.return}if(jt===null)throw Error(oe(160));Rp(o,i,a),jt=null,ds=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(d){at(a,t,d)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Lp(t,e),t=t.sibling}function Lp(e,t){var s=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(is(t,e),js(e),n&4){try{ya(3,e,e.return),tl(3,e)}catch(S){at(e,e.return,S)}try{ya(5,e,e.return)}catch(S){at(e,e.return,S)}}break;case 1:is(t,e),js(e),n&512&&s!==null&&yr(s,s.return);break;case 5:if(is(t,e),js(e),n&512&&s!==null&&yr(s,s.return),e.flags&32){var a=e.stateNode;try{Oa(a,"")}catch(S){at(e,e.return,S)}}if(n&4&&(a=e.stateNode,a!=null)){var o=e.memoizedProps,i=s!==null?s.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&af(a,o),Sc(l,i);var d=Sc(l,o);for(i=0;i<c.length;i+=2){var u=c[i],h=c[i+1];u==="style"?uf(a,h):u==="dangerouslySetInnerHTML"?cf(a,h):u==="children"?Oa(a,h):$d(a,u,h,d)}switch(l){case"input":bc(a,o);break;case"textarea":of(a,o);break;case"select":var m=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var x=o.value;x!=null?br(a,!!o.multiple,x,!1):m!==!!o.multiple&&(o.defaultValue!=null?br(a,!!o.multiple,o.defaultValue,!0):br(a,!!o.multiple,o.multiple?[]:"",!1))}a[Ba]=o}catch(S){at(e,e.return,S)}}break;case 6:if(is(t,e),js(e),n&4){if(e.stateNode===null)throw Error(oe(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(S){at(e,e.return,S)}}break;case 3:if(is(t,e),js(e),n&4&&s!==null&&s.memoizedState.isDehydrated)try{Ra(t.containerInfo)}catch(S){at(e,e.return,S)}break;case 4:is(t,e),js(e);break;case 13:is(t,e),js(e),a=e.child,a.flags&8192&&(o=a.memoizedState!==null,a.stateNode.isHidden=o,!o||a.alternate!==null&&a.alternate.memoizedState!==null||(pu=ot())),n&4&&Vh(e);break;case 22:if(u=s!==null&&s.memoizedState!==null,e.mode&1?(Tt=(d=Tt)||u,is(t,e),Tt=d):is(t,e),js(e),n&8192){if(d=e.memoizedState!==null,(e.stateNode.isHidden=d)&&!u&&e.mode&1)for(ve=e,u=e.child;u!==null;){for(h=ve=u;ve!==null;){switch(m=ve,x=m.child,m.tag){case 0:case 11:case 14:case 15:ya(4,m,m.return);break;case 1:yr(m,m.return);var w=m.stateNode;if(typeof w.componentWillUnmount=="function"){n=m,s=m.return;try{t=n,w.props=t.memoizedProps,w.state=t.memoizedState,w.componentWillUnmount()}catch(S){at(n,s,S)}}break;case 5:yr(m,m.return);break;case 22:if(m.memoizedState!==null){Kh(h);continue}}x!==null?(x.return=m,ve=x):Kh(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{a=h.stateNode,d?(o=a.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=h.stateNode,c=h.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=df("display",i))}catch(S){at(e,e.return,S)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(S){at(e,e.return,S)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:is(t,e),js(e),n&4&&Vh(e);break;case 21:break;default:is(t,e),js(e)}}function js(e){var t=e.flags;if(t&2){try{e:{for(var s=e.return;s!==null;){if($p(s)){var n=s;break e}s=s.return}throw Error(oe(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Oa(a,""),n.flags&=-33);var o=qh(e);td(e,o,a);break;case 3:case 4:var i=n.stateNode.containerInfo,l=qh(e);ed(e,l,i);break;default:throw Error(oe(161))}}catch(c){at(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function M0(e,t,s){ve=e,zp(e)}function zp(e,t,s){for(var n=(e.mode&1)!==0;ve!==null;){var a=ve,o=a.child;if(a.tag===22&&n){var i=a.memoizedState!==null||$o;if(!i){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Tt;l=$o;var d=Tt;if($o=i,(Tt=c)&&!d)for(ve=a;ve!==null;)i=ve,c=i.child,i.tag===22&&i.memoizedState!==null?Qh(a):c!==null?(c.return=i,ve=c):Qh(a);for(;o!==null;)ve=o,zp(o),o=o.sibling;ve=a,$o=l,Tt=d}Gh(e)}else a.subtreeFlags&8772&&o!==null?(o.return=a,ve=o):Gh(e)}}function Gh(e){for(;ve!==null;){var t=ve;if(t.flags&8772){var s=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Tt||tl(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Tt)if(s===null)n.componentDidMount();else{var a=t.elementType===t.type?s.memoizedProps:cs(t.type,s.memoizedProps);n.componentDidUpdate(a,s.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Ph(t,o,n);break;case 3:var i=t.updateQueue;if(i!==null){if(s=null,t.child!==null)switch(t.child.tag){case 5:s=t.child.stateNode;break;case 1:s=t.child.stateNode}Ph(t,i,s)}break;case 5:var l=t.stateNode;if(s===null&&t.flags&4){s=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&s.focus();break;case"img":c.src&&(s.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var d=t.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Ra(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Tt||t.flags&512&&Zc(t)}catch(m){at(t,t.return,m)}}if(t===e){ve=null;break}if(s=t.sibling,s!==null){s.return=t.return,ve=s;break}ve=t.return}}function Kh(e){for(;ve!==null;){var t=ve;if(t===e){ve=null;break}var s=t.sibling;if(s!==null){s.return=t.return,ve=s;break}ve=t.return}}function Qh(e){for(;ve!==null;){var t=ve;try{switch(t.tag){case 0:case 11:case 15:var s=t.return;try{tl(4,t)}catch(c){at(t,s,c)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(c){at(t,a,c)}}var o=t.return;try{Zc(t)}catch(c){at(t,o,c)}break;case 5:var i=t.return;try{Zc(t)}catch(c){at(t,i,c)}}}catch(c){at(t,t.return,c)}if(t===e){ve=null;break}var l=t.sibling;if(l!==null){l.return=t.return,ve=l;break}ve=t.return}}var P0=Math.ceil,Ti=qs.ReactCurrentDispatcher,mu=qs.ReactCurrentOwner,ss=qs.ReactCurrentBatchConfig,Le=0,bt=null,lt=null,Nt=0,qt=0,vr=vn(0),gt=0,Ka=null,Un=0,sl=0,fu=0,va=null,Rt=null,pu=0,Ir=1/0,Ms=null,Mi=!1,sd=null,un=null,Ro=!1,rn=null,Pi=0,ba=0,nd=null,si=-1,ni=0;function Ot(){return Le&6?ot():si!==-1?si:si=ot()}function hn(e){return e.mode&1?Le&2&&Nt!==0?Nt&-Nt:f0.transition!==null?(ni===0&&(ni=Nf()),ni):(e=He,e!==0||(e=window.event,e=e===void 0?16:Mf(e.type)),e):1}function ys(e,t,s,n){if(50<ba)throw ba=0,nd=null,Error(oe(185));ao(e,s,n),(!(Le&2)||e!==bt)&&(e===bt&&(!(Le&2)&&(sl|=s),gt===4&&en(e,Nt)),Bt(e,n),s===1&&Le===0&&!(t.mode&1)&&(Ir=ot()+500,Xi&&bn()))}function Bt(e,t){var s=e.callbackNode;fy(e,t);var n=fi(e,e===bt?Nt:0);if(n===0)s!==null&&rh(s),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(s!=null&&rh(s),t===1)e.tag===0?m0(Yh.bind(null,e)):Qf(Yh.bind(null,e)),c0(function(){!(Le&6)&&bn()}),s=null;else{switch(kf(n)){case 1:s=Ud;break;case 4:s=jf;break;case 16:s=mi;break;case 536870912:s=wf;break;default:s=mi}s=Gp(s,Fp.bind(null,e))}e.callbackPriority=t,e.callbackNode=s}}function Fp(e,t){if(si=-1,ni=0,Le&6)throw Error(oe(327));var s=e.callbackNode;if(Sr()&&e.callbackNode!==s)return null;var n=fi(e,e===bt?Nt:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=Di(e,n);else{t=n;var a=Le;Le|=2;var o=Bp();(bt!==e||Nt!==t)&&(Ms=null,Ir=ot()+500,An(e,t));do try{I0();break}catch(l){Up(e,l)}while(!0);eu(),Ti.current=o,Le=a,lt!==null?t=0:(bt=null,Nt=0,t=gt)}if(t!==0){if(t===2&&(a=Mc(e),a!==0&&(n=a,t=rd(e,a))),t===1)throw s=Ka,An(e,0),en(e,n),Bt(e,ot()),s;if(t===6)en(e,n);else{if(a=e.current.alternate,!(n&30)&&!D0(a)&&(t=Di(e,n),t===2&&(o=Mc(e),o!==0&&(n=o,t=rd(e,o))),t===1))throw s=Ka,An(e,0),en(e,n),Bt(e,ot()),s;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(oe(345));case 2:Tn(e,Rt,Ms);break;case 3:if(en(e,n),(n&130023424)===n&&(t=pu+500-ot(),10<t)){if(fi(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){Ot(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Lc(Tn.bind(null,e,Rt,Ms),t);break}Tn(e,Rt,Ms);break;case 4:if(en(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var i=31-xs(n);o=1<<i,i=t[i],i>a&&(a=i),n&=~o}if(n=a,n=ot()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*P0(n/1960))-n,10<n){e.timeoutHandle=Lc(Tn.bind(null,e,Rt,Ms),n);break}Tn(e,Rt,Ms);break;case 5:Tn(e,Rt,Ms);break;default:throw Error(oe(329))}}}return Bt(e,ot()),e.callbackNode===s?Fp.bind(null,e):null}function rd(e,t){var s=va;return e.current.memoizedState.isDehydrated&&(An(e,t).flags|=256),e=Di(e,t),e!==2&&(t=Rt,Rt=s,t!==null&&ad(t)),e}function ad(e){Rt===null?Rt=e:Rt.push.apply(Rt,e)}function D0(e){for(var t=e;;){if(t.flags&16384){var s=t.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var n=0;n<s.length;n++){var a=s[n],o=a.getSnapshot;a=a.value;try{if(!bs(o(),a))return!1}catch{return!1}}}if(s=t.child,t.subtreeFlags&16384&&s!==null)s.return=t,t=s;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function en(e,t){for(t&=~fu,t&=~sl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var s=31-xs(t),n=1<<s;e[s]=-1,t&=~n}}function Yh(e){if(Le&6)throw Error(oe(327));Sr();var t=fi(e,0);if(!(t&1))return Bt(e,ot()),null;var s=Di(e,t);if(e.tag!==0&&s===2){var n=Mc(e);n!==0&&(t=n,s=rd(e,n))}if(s===1)throw s=Ka,An(e,0),en(e,t),Bt(e,ot()),s;if(s===6)throw Error(oe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tn(e,Rt,Ms),Bt(e,ot()),null}function gu(e,t){var s=Le;Le|=1;try{return e(t)}finally{Le=s,Le===0&&(Ir=ot()+500,Xi&&bn())}}function Bn(e){rn!==null&&rn.tag===0&&!(Le&6)&&Sr();var t=Le;Le|=1;var s=ss.transition,n=He;try{if(ss.transition=null,He=1,e)return e()}finally{He=n,ss.transition=s,Le=t,!(Le&6)&&bn()}}function xu(){qt=vr.current,Xe(vr)}function An(e,t){e.finishedWork=null,e.finishedLanes=0;var s=e.timeoutHandle;if(s!==-1&&(e.timeoutHandle=-1,l0(s)),lt!==null)for(s=lt.return;s!==null;){var n=s;switch(Jd(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&vi();break;case 3:Dr(),Xe(Ft),Xe(Mt),ou();break;case 5:au(n);break;case 4:Dr();break;case 13:Xe(tt);break;case 19:Xe(tt);break;case 10:tu(n.type._context);break;case 22:case 23:xu()}s=s.return}if(bt=e,lt=e=mn(e.current,null),Nt=qt=t,gt=0,Ka=null,fu=sl=Un=0,Rt=va=null,On!==null){for(t=0;t<On.length;t++)if(s=On[t],n=s.interleaved,n!==null){s.interleaved=null;var a=n.next,o=s.pending;if(o!==null){var i=o.next;o.next=a,n.next=i}s.pending=n}On=null}return e}function Up(e,t){do{var s=lt;try{if(eu(),Zo.current=Ei,Ci){for(var n=st.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Ci=!1}if(Fn=0,vt=mt=st=null,xa=!1,qa=0,mu.current=null,s===null||s.return===null){gt=1,Ka=t,lt=null;break}e:{var o=e,i=s.return,l=s,c=t;if(t=Nt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var m=u.alternate;m?(u.updateQueue=m.updateQueue,u.memoizedState=m.memoizedState,u.lanes=m.lanes):(u.updateQueue=null,u.memoizedState=null)}var x=Rh(i);if(x!==null){x.flags&=-257,Lh(x,i,l,o,t),x.mode&1&&$h(o,d,t),t=x,c=d;var w=t.updateQueue;if(w===null){var S=new Set;S.add(c),t.updateQueue=S}else w.add(c);break e}else{if(!(t&1)){$h(o,d,t),yu();break e}c=Error(oe(426))}}else if(et&&l.mode&1){var E=Rh(i);if(E!==null){!(E.flags&65536)&&(E.flags|=256),Lh(E,i,l,o,t),Xd(Or(c,l));break e}}o=c=Or(c,l),gt!==4&&(gt=2),va===null?va=[o]:va.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var y=kp(o,c,t);Mh(o,y);break e;case 1:l=c;var f=o.type,g=o.stateNode;if(!(o.flags&128)&&(typeof f.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(un===null||!un.has(g)))){o.flags|=65536,t&=-t,o.lanes|=t;var b=Sp(o,l,t);Mh(o,b);break e}}o=o.return}while(o!==null)}Wp(s)}catch($){t=$,lt===s&&s!==null&&(lt=s=s.return);continue}break}while(!0)}function Bp(){var e=Ti.current;return Ti.current=Ei,e===null?Ei:e}function yu(){(gt===0||gt===3||gt===2)&&(gt=4),bt===null||!(Un&268435455)&&!(sl&268435455)||en(bt,Nt)}function Di(e,t){var s=Le;Le|=2;var n=Bp();(bt!==e||Nt!==t)&&(Ms=null,An(e,t));do try{O0();break}catch(a){Up(e,a)}while(!0);if(eu(),Le=s,Ti.current=n,lt!==null)throw Error(oe(261));return bt=null,Nt=0,gt}function O0(){for(;lt!==null;)Hp(lt)}function I0(){for(;lt!==null&&!ay();)Hp(lt)}function Hp(e){var t=Vp(e.alternate,e,qt);e.memoizedProps=e.pendingProps,t===null?Wp(e):lt=t,mu.current=null}function Wp(e){var t=e;do{var s=t.alternate;if(e=t.return,t.flags&32768){if(s=C0(s,t),s!==null){s.flags&=32767,lt=s;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{gt=6,lt=null;return}}else if(s=_0(s,t,qt),s!==null){lt=s;return}if(t=t.sibling,t!==null){lt=t;return}lt=t=e}while(t!==null);gt===0&&(gt=5)}function Tn(e,t,s){var n=He,a=ss.transition;try{ss.transition=null,He=1,A0(e,t,s,n)}finally{ss.transition=a,He=n}return null}function A0(e,t,s,n){do Sr();while(rn!==null);if(Le&6)throw Error(oe(327));s=e.finishedWork;var a=e.finishedLanes;if(s===null)return null;if(e.finishedWork=null,e.finishedLanes=0,s===e.current)throw Error(oe(177));e.callbackNode=null,e.callbackPriority=0;var o=s.lanes|s.childLanes;if(py(e,o),e===bt&&(lt=bt=null,Nt=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||Ro||(Ro=!0,Gp(mi,function(){return Sr(),null})),o=(s.flags&15990)!==0,s.subtreeFlags&15990||o){o=ss.transition,ss.transition=null;var i=He;He=1;var l=Le;Le|=4,mu.current=null,T0(e,s),Lp(s,e),t0($c),pi=!!Ac,$c=Ac=null,e.current=s,M0(s),oy(),Le=l,He=i,ss.transition=o}else e.current=s;if(Ro&&(Ro=!1,rn=e,Pi=a),o=e.pendingLanes,o===0&&(un=null),cy(s.stateNode),Bt(e,ot()),t!==null)for(n=e.onRecoverableError,s=0;s<t.length;s++)a=t[s],n(a.value,{componentStack:a.stack,digest:a.digest});if(Mi)throw Mi=!1,e=sd,sd=null,e;return Pi&1&&e.tag!==0&&Sr(),o=e.pendingLanes,o&1?e===nd?ba++:(ba=0,nd=e):ba=0,bn(),null}function Sr(){if(rn!==null){var e=kf(Pi),t=ss.transition,s=He;try{if(ss.transition=null,He=16>e?16:e,rn===null)var n=!1;else{if(e=rn,rn=null,Pi=0,Le&6)throw Error(oe(331));var a=Le;for(Le|=4,ve=e.current;ve!==null;){var o=ve,i=o.child;if(ve.flags&16){var l=o.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(ve=d;ve!==null;){var u=ve;switch(u.tag){case 0:case 11:case 15:ya(8,u,o)}var h=u.child;if(h!==null)h.return=u,ve=h;else for(;ve!==null;){u=ve;var m=u.sibling,x=u.return;if(Ap(u),u===d){ve=null;break}if(m!==null){m.return=x,ve=m;break}ve=x}}}var w=o.alternate;if(w!==null){var S=w.child;if(S!==null){w.child=null;do{var E=S.sibling;S.sibling=null,S=E}while(S!==null)}}ve=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,ve=i;else e:for(;ve!==null;){if(o=ve,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ya(9,o,o.return)}var y=o.sibling;if(y!==null){y.return=o.return,ve=y;break e}ve=o.return}}var f=e.current;for(ve=f;ve!==null;){i=ve;var g=i.child;if(i.subtreeFlags&2064&&g!==null)g.return=i,ve=g;else e:for(i=f;ve!==null;){if(l=ve,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:tl(9,l)}}catch($){at(l,l.return,$)}if(l===i){ve=null;break e}var b=l.sibling;if(b!==null){b.return=l.return,ve=b;break e}ve=l.return}}if(Le=a,bn(),_s&&typeof _s.onPostCommitFiberRoot=="function")try{_s.onPostCommitFiberRoot(Gi,e)}catch{}n=!0}return n}finally{He=s,ss.transition=t}}return!1}function Jh(e,t,s){t=Or(s,t),t=kp(e,t,1),e=dn(e,t,1),t=Ot(),e!==null&&(ao(e,1,t),Bt(e,t))}function at(e,t,s){if(e.tag===3)Jh(e,e,s);else for(;t!==null;){if(t.tag===3){Jh(t,e,s);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(un===null||!un.has(n))){e=Or(s,e),e=Sp(t,e,1),t=dn(t,e,1),e=Ot(),t!==null&&(ao(t,1,e),Bt(t,e));break}}t=t.return}}function $0(e,t,s){var n=e.pingCache;n!==null&&n.delete(t),t=Ot(),e.pingedLanes|=e.suspendedLanes&s,bt===e&&(Nt&s)===s&&(gt===4||gt===3&&(Nt&130023424)===Nt&&500>ot()-pu?An(e,0):fu|=s),Bt(e,t)}function qp(e,t){t===0&&(e.mode&1?(t=Co,Co<<=1,!(Co&130023424)&&(Co=4194304)):t=1);var s=Ot();e=Bs(e,t),e!==null&&(ao(e,t,s),Bt(e,s))}function R0(e){var t=e.memoizedState,s=0;t!==null&&(s=t.retryLane),qp(e,s)}function L0(e,t){var s=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(s=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(oe(314))}n!==null&&n.delete(t),qp(e,s)}var Vp;Vp=function(e,t,s){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ft.current)zt=!0;else{if(!(e.lanes&s)&&!(t.flags&128))return zt=!1,S0(e,t,s);zt=!!(e.flags&131072)}else zt=!1,et&&t.flags&1048576&&Yf(t,wi,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;ti(e,t),e=t.pendingProps;var a=Tr(t,Mt.current);kr(t,s),a=lu(null,t,n,e,a,s);var o=cu();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ut(n)?(o=!0,bi(t)):o=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,nu(t),a.updater=el,t.stateNode=a,a._reactInternals=t,qc(t,n,e,s),t=Kc(null,t,n,!0,o,s)):(t.tag=0,et&&o&&Yd(t),Dt(null,t,a,s),t=t.child),t;case 16:n=t.elementType;e:{switch(ti(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=F0(n),e=cs(n,e),a){case 0:t=Gc(null,t,n,e,s);break e;case 1:t=Uh(null,t,n,e,s);break e;case 11:t=zh(null,t,n,e,s);break e;case 14:t=Fh(null,t,n,cs(n.type,e),s);break e}throw Error(oe(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:cs(n,a),Gc(e,t,n,a,s);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:cs(n,a),Uh(e,t,n,a,s);case 3:e:{if(Tp(t),e===null)throw Error(oe(387));n=t.pendingProps,o=t.memoizedState,a=o.element,sp(e,t),Si(t,n,null,s);var i=t.memoizedState;if(n=i.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){a=Or(Error(oe(423)),t),t=Bh(e,t,n,s,a);break e}else if(n!==a){a=Or(Error(oe(424)),t),t=Bh(e,t,n,s,a);break e}else for(Vt=cn(t.stateNode.containerInfo.firstChild),Gt=t,et=!0,hs=null,s=ep(t,null,n,s),t.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Mr(),n===a){t=Hs(e,t,s);break e}Dt(e,t,n,s)}t=t.child}return t;case 5:return np(t),e===null&&Bc(t),n=t.type,a=t.pendingProps,o=e!==null?e.memoizedProps:null,i=a.children,Rc(n,a)?i=null:o!==null&&Rc(n,o)&&(t.flags|=32),Ep(e,t),Dt(e,t,i,s),t.child;case 6:return e===null&&Bc(t),null;case 13:return Mp(e,t,s);case 4:return ru(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Pr(t,null,n,s):Dt(e,t,n,s),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:cs(n,a),zh(e,t,n,a,s);case 7:return Dt(e,t,t.pendingProps,s),t.child;case 8:return Dt(e,t,t.pendingProps.children,s),t.child;case 12:return Dt(e,t,t.pendingProps.children,s),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,o=t.memoizedProps,i=a.value,Qe(Ni,n._currentValue),n._currentValue=i,o!==null)if(bs(o.value,i)){if(o.children===a.children&&!Ft.current){t=Hs(e,t,s);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var l=o.dependencies;if(l!==null){i=o.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(o.tag===1){c=Rs(-1,s&-s),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=s,c=o.alternate,c!==null&&(c.lanes|=s),Hc(o.return,s,t),l.lanes|=s;break}c=c.next}}else if(o.tag===10)i=o.type===t.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(oe(341));i.lanes|=s,l=i.alternate,l!==null&&(l.lanes|=s),Hc(i,s,t),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===t){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}Dt(e,t,a.children,s),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,kr(t,s),a=rs(a),n=n(a),t.flags|=1,Dt(e,t,n,s),t.child;case 14:return n=t.type,a=cs(n,t.pendingProps),a=cs(n.type,a),Fh(e,t,n,a,s);case 15:return _p(e,t,t.type,t.pendingProps,s);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:cs(n,a),ti(e,t),t.tag=1,Ut(n)?(e=!0,bi(t)):e=!1,kr(t,s),Np(t,n,a),qc(t,n,a,s),Kc(null,t,n,!0,e,s);case 19:return Pp(e,t,s);case 22:return Cp(e,t,s)}throw Error(oe(156,t.tag))};function Gp(e,t){return bf(e,t)}function z0(e,t,s,n){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ts(e,t,s,n){return new z0(e,t,s,n)}function vu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function F0(e){if(typeof e=="function")return vu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ld)return 11;if(e===zd)return 14}return 2}function mn(e,t){var s=e.alternate;return s===null?(s=ts(e.tag,t,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=t,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&14680064,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,t=e.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s}function ri(e,t,s,n,a,o){var i=2;if(n=e,typeof e=="function")vu(e)&&(i=1);else if(typeof e=="string")i=5;else e:switch(e){case cr:return $n(s.children,a,o,t);case Rd:i=8,a|=8;break;case pc:return e=ts(12,s,t,a|2),e.elementType=pc,e.lanes=o,e;case gc:return e=ts(13,s,t,a),e.elementType=gc,e.lanes=o,e;case xc:return e=ts(19,s,t,a),e.elementType=xc,e.lanes=o,e;case sf:return nl(s,a,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ef:i=10;break e;case tf:i=9;break e;case Ld:i=11;break e;case zd:i=14;break e;case Js:i=16,n=null;break e}throw Error(oe(130,e==null?e:typeof e,""))}return t=ts(i,s,t,a),t.elementType=e,t.type=n,t.lanes=o,t}function $n(e,t,s,n){return e=ts(7,e,n,t),e.lanes=s,e}function nl(e,t,s,n){return e=ts(22,e,n,t),e.elementType=sf,e.lanes=s,e.stateNode={isHidden:!1},e}function Gl(e,t,s){return e=ts(6,e,null,t),e.lanes=s,e}function Kl(e,t,s){return t=ts(4,e.children!==null?e.children:[],e.key,t),t.lanes=s,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function U0(e,t,s,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=El(0),this.expirationTimes=El(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=El(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function bu(e,t,s,n,a,o,i,l,c){return e=new U0(e,t,s,l,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=ts(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},nu(o),e}function B0(e,t,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:lr,key:n==null?null:""+n,children:e,containerInfo:t,implementation:s}}function Kp(e){if(!e)return gn;e=e._reactInternals;e:{if(Kn(e)!==e||e.tag!==1)throw Error(oe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ut(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(oe(171))}if(e.tag===1){var s=e.type;if(Ut(s))return Kf(e,s,t)}return t}function Qp(e,t,s,n,a,o,i,l,c){return e=bu(s,n,!0,e,a,o,i,l,c),e.context=Kp(null),s=e.current,n=Ot(),a=hn(s),o=Rs(n,a),o.callback=t??null,dn(s,o,a),e.current.lanes=a,ao(e,a,n),Bt(e,n),e}function rl(e,t,s,n){var a=t.current,o=Ot(),i=hn(a);return s=Kp(s),t.context===null?t.context=s:t.pendingContext=s,t=Rs(o,i),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=dn(a,t,i),e!==null&&(ys(e,a,i,o),Xo(e,a,i)),i}function Oi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Xh(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<t?s:t}}function ju(e,t){Xh(e,t),(e=e.alternate)&&Xh(e,t)}function H0(){return null}var Yp=typeof reportError=="function"?reportError:function(e){console.error(e)};function wu(e){this._internalRoot=e}al.prototype.render=wu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(oe(409));rl(e,t,null,null)};al.prototype.unmount=wu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Bn(function(){rl(null,e,null,null)}),t[Us]=null}};function al(e){this._internalRoot=e}al.prototype.unstable_scheduleHydration=function(e){if(e){var t=Cf();e={blockedOn:null,target:e,priority:t};for(var s=0;s<Zs.length&&t!==0&&t<Zs[s].priority;s++);Zs.splice(s,0,e),s===0&&Tf(e)}};function Nu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Zh(){}function W0(e,t,s,n,a){if(a){if(typeof n=="function"){var o=n;n=function(){var d=Oi(i);o.call(d)}}var i=Qp(t,n,e,0,null,!1,!1,"",Zh);return e._reactRootContainer=i,e[Us]=i.current,Fa(e.nodeType===8?e.parentNode:e),Bn(),i}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var l=n;n=function(){var d=Oi(c);l.call(d)}}var c=bu(e,0,!1,null,null,!1,!1,"",Zh);return e._reactRootContainer=c,e[Us]=c.current,Fa(e.nodeType===8?e.parentNode:e),Bn(function(){rl(t,c,s,n)}),c}function il(e,t,s,n,a){var o=s._reactRootContainer;if(o){var i=o;if(typeof a=="function"){var l=a;a=function(){var c=Oi(i);l.call(c)}}rl(t,i,e,a)}else i=W0(s,t,e,a,n);return Oi(i)}Sf=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var s=la(t.pendingLanes);s!==0&&(Bd(t,s|1),Bt(t,ot()),!(Le&6)&&(Ir=ot()+500,bn()))}break;case 13:Bn(function(){var n=Bs(e,1);if(n!==null){var a=Ot();ys(n,e,1,a)}}),ju(e,1)}};Hd=function(e){if(e.tag===13){var t=Bs(e,134217728);if(t!==null){var s=Ot();ys(t,e,134217728,s)}ju(e,134217728)}};_f=function(e){if(e.tag===13){var t=hn(e),s=Bs(e,t);if(s!==null){var n=Ot();ys(s,e,t,n)}ju(e,t)}};Cf=function(){return He};Ef=function(e,t){var s=He;try{return He=e,t()}finally{He=s}};Cc=function(e,t,s){switch(t){case"input":if(bc(e,s),t=s.name,s.type==="radio"&&t!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<s.length;t++){var n=s[t];if(n!==e&&n.form===e.form){var a=Ji(n);if(!a)throw Error(oe(90));rf(n),bc(n,a)}}}break;case"textarea":of(e,s);break;case"select":t=s.value,t!=null&&br(e,!!s.multiple,t,!1)}};ff=gu;pf=Bn;var q0={usingClientEntryPoint:!1,Events:[io,mr,Ji,hf,mf,gu]},ea={findFiberByHostInstance:Dn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},V0={bundleType:ea.bundleType,version:ea.version,rendererPackageName:ea.rendererPackageName,rendererConfig:ea.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:qs.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=yf(e),e===null?null:e.stateNode},findFiberByHostInstance:ea.findFiberByHostInstance||H0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lo.isDisabled&&Lo.supportsFiber)try{Gi=Lo.inject(V0),_s=Lo}catch{}}Qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q0;Qt.createPortal=function(e,t){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nu(t))throw Error(oe(200));return B0(e,t,null,s)};Qt.createRoot=function(e,t){if(!Nu(e))throw Error(oe(299));var s=!1,n="",a=Yp;return t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=bu(e,1,!1,null,null,s,!1,n,a),e[Us]=t.current,Fa(e.nodeType===8?e.parentNode:e),new wu(t)};Qt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(oe(188)):(e=Object.keys(e).join(","),Error(oe(268,e)));return e=yf(t),e=e===null?null:e.stateNode,e};Qt.flushSync=function(e){return Bn(e)};Qt.hydrate=function(e,t,s){if(!ol(t))throw Error(oe(200));return il(null,e,t,!0,s)};Qt.hydrateRoot=function(e,t,s){if(!Nu(e))throw Error(oe(405));var n=s!=null&&s.hydratedSources||null,a=!1,o="",i=Yp;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onRecoverableError!==void 0&&(i=s.onRecoverableError)),t=Qp(t,null,e,1,s??null,a,!1,o,i),e[Us]=t.current,Fa(e),n)for(e=0;e<n.length;e++)s=n[e],a=s._getVersion,a=a(s._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[s,a]:t.mutableSourceEagerHydrationData.push(s,a);return new al(t)};Qt.render=function(e,t,s){if(!ol(t))throw Error(oe(200));return il(null,e,t,!1,s)};Qt.unmountComponentAtNode=function(e){if(!ol(e))throw Error(oe(40));return e._reactRootContainer?(Bn(function(){il(null,null,e,!1,function(){e._reactRootContainer=null,e[Us]=null})}),!0):!1};Qt.unstable_batchedUpdates=gu;Qt.unstable_renderSubtreeIntoContainer=function(e,t,s,n){if(!ol(s))throw Error(oe(200));if(e==null||e._reactInternals===void 0)throw Error(oe(38));return il(e,t,s,!1,n)};Qt.version="18.3.1-next-f1338f8080-20240426";function Jp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Jp)}catch(e){console.error(e)}}Jp(),Ym.exports=Qt;var G0=Ym.exports,Xp,em=G0;Xp=em.createRoot,em.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var K0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q0=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),we=(e,t)=>{const s=p.forwardRef(({color:n="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:l="",children:c,...d},u)=>p.createElement("svg",{ref:u,...K0,width:a,height:a,stroke:n,strokeWidth:i?Number(o)*24/Number(a):o,className:["lucide",`lucide-${Q0(e)}`,l].join(" "),...d},[...t.map(([h,m])=>p.createElement(h,m)),...Array.isArray(c)?c:[c]]));return s.displayName=`${e}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y0=we("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=we("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J0=we("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X0=we("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z0=we("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ev=we("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tv=we("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sv=we("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=we("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ku=we("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zp=we("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nv=we("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ii=we("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=we("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const od=we("ChefHat",[["path",{d:"M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z",key:"z3ra2g"}],["line",{x1:"6",x2:"18",y1:"17",y2:"17",key:"12q60k"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rv=we("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const av=we("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=we("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=we("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=we("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eg=we("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ov=we("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iv=we("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lv=we("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ai=we("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tg=we("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cv=we("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ld=we("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dv=we("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=we("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uv=we("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hv=we("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=we("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mv=we("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Su=we("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cd=we("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fv=we("PauseCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=we("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pv=we("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sg=we("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=we("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2h0V5z",key:"uf6l00"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h0",key:"k2aug8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gv=we("PlayCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=we("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=we("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const da=we("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xv=we("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=we("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rg=we("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ag=we("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const og=we("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hn=we("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yv=we("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=we("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=we("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vv=we("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bv=we("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=we("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=we("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _u=we("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=we("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Wn=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():"",Cr=e=>e?Wn(e).replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"").trim():"",dg=(e,t)=>{const n=[t,e].filter(o=>!!o&&o.trim().length>0).map(o=>Cr(o)).filter(Boolean).join("-")||"item",a=Math.random().toString(36).slice(2,6);return`${n}-${a}`},jv=(e,t)=>{if(e.codigo&&e.codigo.trim())return e.codigo.trim();const s=t?Cr(t):"",n=Cr(e.nombre),a=Cr(e.id);return[s,n].filter(Boolean).join("-")||a||"item"},ug=(e,t)=>({...e,codigo:jv(e,t)}),wv=[{id:"sanduches",titulo:"Sandwiches",items:[{nombre:"Jamón artesano",precio:18500,descripcion:"Salsa verde, queso doble crema, jamón de cerdo, rúgula, tomates horneados, parmesano.",keywords:"jamón artesano jamón de cerdo, miel de uvilla, cebolla, tomate horneado, rúgula, queso tajado, queso parmesano, salsa verde."},{nombre:"Del huerto",precio:15500,descripcion:"Mayonesa de rostizados, queso feta, rúgula, tomates horneados, champiñones, parmesano, mix de semillas, chips de arracacha.",keywords:"del huerto champiñones, mayonesa rostizada, queso feta, crocantes de arracacha, tomate horneado, semillas de calabaza, queso tajado."},{nombre:"Pollo Green",precio:16500,descripcion:"Mayonesa de rostizados y verde, jamón de pollo, guacamole, tomate horneado, semillas de girasol, lechuga, tocineta.",keywords:"pollo green jamón de pollo, rúgula, champiñones, parmesano, guacamole, salsa verde, salsa rostizada, lechuga, tomate horneado, semillas."},{nombre:"Pollo Toscano",precio:18500,descripcion:"Salsa verde, Jamón de Pollo, lechuga, rúgula, champiñones, tomates horneados, parmesano, queso doble crema, tocineta, miel de uvilla.",keywords:"pollo toscano jamón de pollo, lechuga, rúgula, champiñones, tomate horneado, queso tajado, queso parmesano, tocineta."},{nombre:"Mexicano",precio:19e3,descripcion:"Frijol refrito, pollo desmechado, pico de gallo, queso crema tajado, guacamole, sour cream, salsa brava.",keywords:"mexicano pollo desmechado, guacamole, pico de gallo, frijol refrito, salsa brava, sour cream, queso tajado."}],side:"left"},{id:"bowlssalados",titulo:"Bowls Salados",subtitulo:"26 oz",items:[{nombre:"Bowl Salado",precio:15e3,descripcion:"Personaliza tu bowl: 2 bases (arroz, pasta, quinua), 4 toppings (maíz tierno, champiñones, pico de gallo, guacamole, tocineta, chips de arracacha, queso feta, zanahoria, pepino) y 1 proteína (pechuga de pollo, jamón de cerdo, carne desmechada). Incluye bebida."}],side:"left"},{id:"calientes",titulo:"Bebidas calientes",items:[{nombre:"Capuccino",precio:6e3,keywords:"capuccino"},{nombre:"Latte",precio:5500,keywords:"latte"},{nombre:"Americano",precio:5500,keywords:"americano"},{nombre:"Cocoa",precio:6e3,keywords:"cocoa"},{nombre:"Pitaya latte",precio:8500,keywords:"pitaya latte"},{nombre:"Infusión de frutos rojos",precio:6e3,keywords:"infusión frutos rojos"}],side:"left"},{id:"acompanamientos",titulo:"Acompañamientos",items:[{nombre:"Torta del día",precio:8e3,keywords:"torta del día zanahoria arándanos naranja harina de almendra coco endulzada con banano cubierta yogurt griego"},{nombre:"Galletas de avena",precio:4e3,keywords:"galletas de avena"},{nombre:"Muffin de queso",precio:4500,keywords:"muffin de queso"},{nombre:"Tapitas",precio:1e4,descripcion:"Pan acompañado de queso feta, tomate al horno y albahaca.",keywords:"tapitas pan queso feta tomate al horno albahaca"}],side:"left"}],Nv=[{id:"bowlsfrutales",titulo:"Bowls Frutales",subtitulo:"16 oz",items:[{nombre:"Açaí supremo",precio:14500,descripcion:"Base: Açaí, fresa, banano, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, fresa, banano, coco, arándanos, semillas, crema de maní.",keywords:"açaí supremo açaí fresa banano yogurt leche bebida vegetal kiwi coco arándanos semillas crema de maní"},{nombre:"Tropical",precio:12e3,descripcion:"Base: Mango, piña, banano, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, mango, granola, semillas de girasol, coco.",keywords:"tropical mango piña banano yogurt leche kiwi granola semillas de girasol coco"},{nombre:"Vital",precio:12e3,descripcion:"Base: Mango, banano, piña, espinaca, yogurt natural, leche o bebida vegetal. Toppings: Kiwi, arándano, granola, chía latte, coco.",keywords:"vital mango banano piña espinaca yogurt leche kiwi arándano granola chía latte coco"}],side:"right"},{id:"refrescantes",titulo:"Batidos refrescantes",items:[{nombre:"Amanecer",precio:9500,descripcion:"Mango, piña, menta, semillas de chía.",keywords:"amanecer mango piña menta chía"},{nombre:"Sandía salvaje",precio:9500,descripcion:"Sandía, fresa, hierbabuena, limón, kiwi.",keywords:"sandía salvaje sandía fresa hierbabuena limón kiwi"},{nombre:"Piña rosa",precio:9500,descripcion:"Hierbabuena, pitaya rosada, piña, limón.",keywords:"piña rosa hierbabuena pitaya rosada piña limón"}],side:"right"},{id:"funcionales",titulo:"Batidos funcionales",items:[{nombre:"Golden milk",precio:10500,descripcion:"Mango, banano, yogurt natural, leche, miel, chía, cúrcuma, maca.",keywords:"golden milk mango banano yogurt leche miel chía cúrcuma maca"},{nombre:"Digest",precio:10500,descripcion:"Sábila, piña, kiwi, chía, naranja, miel.",keywords:"digest sábila piña kiwi chía naranja miel"},{nombre:"Antioxidante",precio:10500,descripcion:"Sandía, remolacha, jengibre, mora, limón, chía.",keywords:"antioxidante sandía remolacha jengibre mora limón chía"},{nombre:"Saciante",precio:10500,descripcion:"Arándano, fresa, banano, leche, chía, avena.",keywords:"saciante arándano fresa banano leche chía avena"},{nombre:"Detox",precio:10500,descripcion:"Jengibre, apio, perejil, menta fresca, manzana verde, kiwi, pepino, naranja, miel.",keywords:"detox jengibre apio perejil menta fresca manzana verde kiwi pepino naranja miel"}],side:"right"},{id:"especiales",titulo:"Batidos especiales",items:[{nombre:"Pink",precio:12e3,descripcion:"Fresa, banano, yogurt natural, leche, chía, avena.",keywords:"pink fresa banano yogurt leche chía avena"},{nombre:"Mocha energy",precio:12e3,descripcion:"Banano, café frío, leche, cacao puro, crema de maní, avena.",keywords:"mocha energy banano café frío leche cacao puro crema de maní avena"},{nombre:"Matcha protein",precio:16e3,descripcion:"Té matcha, scoop de proteína whey pure (30 g).",keywords:"matcha protein té matcha proteína whey 30g"}],side:"right"},{id:"frias",titulo:"Bebidas frías",items:[{nombre:"Matcha latte helado",precio:11e3,descripcion:"Té matcha con leche y hielo.",keywords:"matcha latte helado té matcha leche hielo"},{nombre:"Blue latte helado",precio:10500,descripcion:"Té azul en leche o bebida vegetal con hielo.",keywords:"blue latte helado té azul leche bebida vegetal hielo"},{nombre:"Limonada azul",precio:1e4,descripcion:"Mezcla de limón y té azul.",keywords:"limonada azul limón té azul"},{nombre:"Café Pitaya",precio:10500,descripcion:"Café y pitaya rosa.",keywords:"café pitaya café pitaya rosa"}],side:"right"}],kv=[...wv,...Nv].flatMap(e=>e.items.map((t,s)=>ug({id:`${e.id}-${s}`,...t,categoria:e.titulo,stock:Math.floor(Math.random()*50)+10,inventarioCategoria:"No inventariables"},e.id))),Sv=[{id:"inv-mango",nombre:"Mango",precio:0,categoria:"Frutas",stock:5e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pina",nombre:"Piña",precio:0,categoria:"Frutas",stock:3e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-banano",nombre:"Banano",precio:0,categoria:"Frutas",stock:2e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-fresa",nombre:"Fresa",precio:0,categoria:"Frutas",stock:1500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-kiwi",nombre:"Kiwi",precio:0,categoria:"Frutas",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-sandia",nombre:"Sandía",precio:0,categoria:"Frutas",stock:4e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-arandanos",nombre:"Arándanos",precio:0,categoria:"Frutas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-acai",nombre:"Açaí",precio:0,categoria:"Frutas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pitaya",nombre:"Pitaya",precio:0,categoria:"Frutas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-yogurt",nombre:"Yogurt natural",precio:0,categoria:"Lácteos",stock:2e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-leche",nombre:"Leche",precio:0,categoria:"Lácteos",stock:3e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"ml"},{id:"inv-queso-feta",nombre:"Queso feta",precio:0,categoria:"Lácteos",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-queso-crema",nombre:"Queso doble crema",precio:0,categoria:"Lácteos",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jamon-cerdo",nombre:"Jamón de cerdo",precio:0,categoria:"Proteínas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jamon-pollo",nombre:"Jamón de pollo",precio:0,categoria:"Proteínas",stock:1200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pollo-desmechado",nombre:"Pollo desmechado",precio:0,categoria:"Proteínas",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-tocineta",nombre:"Tocineta",precio:0,categoria:"Proteínas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-rugula",nombre:"Rúgula",precio:0,categoria:"Vegetales",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-lechuga",nombre:"Lechuga",precio:0,categoria:"Vegetales",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-champinones",nombre:"Champiñones",precio:0,categoria:"Vegetales",stock:600,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-tomate",nombre:"Tomate",precio:0,categoria:"Vegetales",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-espinaca",nombre:"Espinaca",precio:0,categoria:"Vegetales",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-apio",nombre:"Apio",precio:0,categoria:"Vegetales",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-pepino",nombre:"Pepino",precio:0,categoria:"Vegetales",stock:800,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-chia",nombre:"Semillas de chía",precio:0,categoria:"Semillas",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-granola",nombre:"Granola",precio:0,categoria:"Semillas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-avena",nombre:"Avena",precio:0,categoria:"Semillas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-coco",nombre:"Coco rallado",precio:0,categoria:"Semillas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-crema-mani",nombre:"Crema de maní",precio:0,categoria:"Semillas",stock:400,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-curcuma",nombre:"Cúrcuma",precio:0,categoria:"Especias",stock:100,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-jengibre",nombre:"Jengibre",precio:0,categoria:"Especias",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-maca",nombre:"Maca",precio:0,categoria:"Especias",stock:150,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-miel",nombre:"Miel",precio:0,categoria:"Especias",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-cafe",nombre:"Café",precio:0,categoria:"Bebidas",stock:1e3,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-te-matcha",nombre:"Té matcha",precio:0,categoria:"Bebidas",stock:200,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-cacao",nombre:"Cacao puro",precio:0,categoria:"Bebidas",stock:300,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"},{id:"inv-proteina",nombre:"Proteína whey",precio:0,categoria:"Bebidas",stock:500,inventarioCategoria:"Inventariables",inventarioTipo:"gramos",unidadMedida:"g"}],_v=Sv.map(e=>ug(e,"inv")),Cv=[...kv,..._v],ta={menuItems:Cv,orders:[],customers:[],empleados:[],gastos:[]},Ye=(e,t)=>{try{const s=localStorage.getItem(e);return s?JSON.parse(s):t}catch(s){return console.error(`Error loading localStorage key "${e}":`,s),t}},rt=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`Error setting localStorage key "${e}":`,s)}},Ev=e=>{try{const t=localStorage.getItem(e);return t===null?{status:"missing",value:void 0}:{status:"ok",value:JSON.parse(t)}}catch(t){return console.warn(`[localData] Error parsing localStorage key "${e}".`,t),{status:"invalid",value:void 0}}},zo=e=>Array.isArray(e),Tv=e=>Array.isArray(e)&&e.length>0,sa=(e,t,s,n)=>{const{status:a,value:o}=Ev(e);if(a!=="ok"){console.info(`[localData] ${n}: ${a==="missing"?"no se encontraron datos previos.":"los datos existentes están corruptos."} Se inicializan los valores predeterminados.`),rt(e,t);return}if(!s(o)){console.info(`[localData] ${n}: la estructura encontrada es inválida. Se restauran los valores iniciales.`),rt(e,t);return}Array.isArray(o)?console.info(`[localData] ${n}: se encontraron ${o.length} registros en localStorage.`):console.info(`[localData] ${n}: datos válidos detectados en localStorage.`)},Mv=()=>{sa("savia-menuItems",ta.menuItems,Tv,"Productos del menú"),sa("savia-orders",ta.orders,zo,"Órdenes"),sa("savia-customers",ta.customers,zo,"Clientes"),sa("savia-empleados",ta.empleados,zo,"Empleados"),sa("savia-gastos",ta.gastos,zo,"Gastos")},v={dark:"#0B1C14",beige:"#FEFCED",accent:"#C9C326"},W=e=>{try{return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(e||0)}catch{return`$${e.toLocaleString()}`}},Cu=e=>new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e),hg=e=>{const t=new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}).format(e);return t.charAt(0).toUpperCase()+t.slice(1)},Pv=()=>Math.floor(Math.random()*9e3)+1e3,Be=e=>{if(!(e instanceof Date)||Number.isNaN(e.getTime()))return"";const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},Dv=new Intl.DateTimeFormat("es-CO",{hour:"2-digit",minute:"2-digit"}),$t=e=>{if(!e)return"—";const t=e.trim().match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?$/);if(!t)return e;const s=Number(t[1]),n=Number(t[2]);if(Number.isNaN(s)||Number.isNaN(n))return e;const a=new Date;return a.setHours(s,n,0,0),Dv.format(a)},Ov=/^\d{4}-\d{2}-\d{2}$/,wt=e=>{if(e instanceof Date&&!Number.isNaN(e.getTime()))return new Date(e.getTime());if(typeof e=="string"){const s=e.trim();if(Ov.test(s)){const[a,o,i]=s.split("-").map(Number);return new Date(a,o-1,i)}const n=new Date(s);if(!Number.isNaN(n.getTime()))return n}const t=new Date;return t.setHours(0,0,0,0),t},ja=()=>Be(new Date),Iv=["efectivo","tarjeta","nequi","provision_caja","credito_empleados"],ii=["efectivo","tarjeta","nequi","credito_empleados"],Av=["efectivo","nequi","tarjeta"],gs={efectivo:"Efectivo",tarjeta:"Tarjeta",nequi:"Nequi",provision_caja:"Provisión caja",credito_empleados:"Crédito empleados"},ll=e=>Number.isFinite(e)?Math.round(e):0,fn=e=>Array.isArray(e)?e.map(t=>{if(!t||!Iv.includes(t.metodo))return null;const s=ll(Number(t.monto??0));if(s<=0)return null;const n={metodo:t.metodo,monto:s};if(t.metodo==="credito_empleados"){if(!t.empleadoId)return null;n.empleadoId=t.empleadoId,t.empleadoNombre&&(n.empleadoNombre=t.empleadoNombre)}return n}).filter(t=>t!==null):[],Ya=e=>{const t=new Map;return e.forEach(s=>{const n=s.metodo==="credito_empleados"?`${s.metodo}:${s.empleadoId??""}`:s.metodo,a=t.get(n);a?(a.monto+=s.monto,s.empleadoNombre&&!a.empleadoNombre&&(a.empleadoNombre=s.empleadoNombre)):t.set(n,{...s})}),Array.from(t.values()).map(s=>({...s,monto:ll(s.monto)}))},Ls=e=>e.reduce((t,s)=>t+s.monto,0),jn=e=>{const t=fn(e.paymentAllocations);return t.length>0?Ya(t):e.paymentStatus==="pagado"&&e.metodoPago?[{metodo:e.metodoPago,monto:ll(e.total)}]:[]},mg=e=>{if(e.paymentStatus)return e.paymentStatus;const t=jn(e),s=Ls(t);return Math.abs(s-ll(e.total))<=1?"pagado":"pendiente"},vs=e=>mg(e)==="pagado",$v=e=>{var t;return e.metodoPago==="credito_empleados"&&((t=e.creditInfo)==null?void 0:t.type)==="empleados"?!0:vs(e)},$i=e=>{const t=e.paymentRegisteredAt;return t instanceof Date&&!Number.isNaN(t.getTime())?t:e.timestamp},cl=e=>{var t;if(e.length!==0)return(t=e.slice().sort((s,n)=>n.monto-s.monto)[0])==null?void 0:t.metodo},co=(e,t)=>e.length===0?"Pago pendiente":e.map(n=>{let a=gs[n.metodo];return n.metodo==="credito_empleados"&&n.empleadoNombre&&(a=`${a} (${n.empleadoNombre})`),`${a}: ${t(n.monto)}`}).join(" · ");function Rv({orders:e,menuItems:t,onModuleChange:s}){const n=new Date,a=n.toDateString(),o=e.filter(h=>h.timestamp.toDateString()===a),l=e.filter(h=>vs(h)&&$i(h).toDateString()===a).reduce((h,m)=>h+m.total,0),c=e.filter(h=>h.estado==="pendiente"||h.estado==="preparando").length,d=t.filter(h=>h.inventarioCategoria==="Inventariables"&&h.stock<10),u=[{label:"Ventas del día",value:W(l),icon:eg,color:"green",onClick:()=>s("caja")},{label:"Pedidos hoy",value:o.length.toString(),icon:ag,color:"blue",onClick:()=>s("comandas")},{label:"Pendientes",value:c.toString(),icon:ps,color:"orange",onClick:()=>s("cocina")},{label:"Stock bajo",value:d.length.toString(),icon:Ar,color:"red",onClick:()=>s("inventario")}];return r.jsxs("section",{className:"space-y-6 sm:space-y-8",children:[r.jsxs("div",{className:"text-center px-2 sm:px-0",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:v.dark},children:"Dashboard SAVIA"}),r.jsxs("p",{className:"text-sm lg:text-base text-gray-600",children:["Resumen de operaciones del ",n.toLocaleDateString("es-CO")]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:u.map(h=>{const m=h.icon;return r.jsx("button",{onClick:h.onClick,className:"ui-card ui-card-pad hover:shadow-md transition-all duration-200 hover:scale-[1.02] text-left",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:h.label}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold mt-1",style:{color:v.dark},children:h.value})]}),r.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 lg:w-12 lg:h-12 rounded-lg flex items-center justify-center",style:{backgroundColor:`${v.accent}20`},children:r.jsx(m,{size:16,className:"sm:w-5 sm:h-5 lg:w-6 lg:h-6",style:{color:v.dark}})})]})},h.label)})}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8",children:[r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-semibold mb-4",style:{color:v.dark},children:"Últimos pedidos"}),r.jsxs("div",{className:"space-y-3",children:[e.slice(-5).reverse().map(h=>r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-b border-gray-50 last:border-0 space-y-1 sm:space-y-0",children:[r.jsxs("div",{children:[r.jsxs("span",{className:"font-medium text-sm",children:["#",h.numero]}),r.jsx("span",{className:`ml-0 sm:ml-2 px-2 py-1 rounded-full text-xs inline-block mt-1 sm:mt-0 ${h.estado==="entregado"?"bg-green-100 text-green-800":h.estado==="listo"?"bg-blue-100 text-blue-800":h.estado==="preparando"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:h.estado})]}),r.jsx("span",{className:"font-semibold text-sm",children:W(h.total)})]},h.id)),e.length===0&&r.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"No hay pedidos registrados"})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-semibold mb-4",style:{color:v.dark},children:"Alertas de inventario"}),r.jsxs("div",{className:"space-y-3",children:[d.slice(0,5).map(h=>r.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 border-b border-gray-50 last:border-0 space-y-1 sm:space-y-0",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-medium text-sm",children:h.nombre}),r.jsx("span",{className:"text-sm text-gray-500 block",children:h.categoria})]}),r.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h.stock<5?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:[h.stock," unidades"]})]},h.id)),d.length===0&&r.jsx("p",{className:"text-gray-500 text-center py-4 text-sm",children:"Stock en niveles normales"})]})]})]})]})}const uo=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],Lv=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>no(async()=>{const{default:n}=await Promise.resolve().then(()=>qr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)};class Eu extends Error{constructor(t,s="FunctionsError",n){super(t),this.name=s,this.context=n}}class zv extends Eu{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class tm extends Eu{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class sm extends Eu{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var ud;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(ud||(ud={}));var Fv=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Uv{constructor(t,{headers:s={},customFetch:n,region:a=ud.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=Lv(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var n;return Fv(this,void 0,void 0,function*(){try{const{headers:a,method:o,body:i}=s;let l={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${t}`);c&&c!=="any"&&(l["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;i&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(l["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(l["Content-Type"]="application/json",u=JSON.stringify(i)));const h=yield this.fetch(d.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),a),body:u}).catch(S=>{throw new zv(S)}),m=h.headers.get("x-relay-error");if(m&&m==="true")throw new tm(h);if(!h.ok)throw new sm(h);let x=((n=h.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),w;return x==="application/json"?w=yield h.json():x==="application/octet-stream"?w=yield h.blob():x==="text/event-stream"?w=h:x==="multipart/form-data"?w=yield h.formData():w=yield h.text(),{data:w,error:null,response:h}}catch(a){return{data:null,error:a,response:a instanceof sm||a instanceof tm?a.context:void 0}}})}}var Lt={},Tu={},dl={},ho={},ul={},hl={},Bv=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},zr=Bv();const Hv=zr.fetch,fg=zr.fetch.bind(zr),pg=zr.Headers,Wv=zr.Request,qv=zr.Response,qr=Object.freeze(Object.defineProperty({__proto__:null,Headers:pg,Request:Wv,Response:qv,default:fg,fetch:Hv},Symbol.toStringTag,{value:"Module"})),Vv=jx(qr);var ml={};Object.defineProperty(ml,"__esModule",{value:!0});let Gv=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};ml.default=Gv;var gg=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(hl,"__esModule",{value:!0});const Kv=gg(Vv),Qv=gg(ml);let Yv=class{constructor(t){var s,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(s=t.shouldThrowOnError)!==null&&s!==void 0?s:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Kv.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=new Headers(this.headers),this.headers.set(t,s),this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let a=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var i,l,c,d;let u=null,h=null,m=null,x=o.status,w=o.statusText;if(o.ok){if(this.method!=="HEAD"){const f=await o.text();f===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?h=f:h=JSON.parse(f))}const E=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),y=(c=o.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");E&&y&&y.length>1&&(m=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(u={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,m=null,x=406,w="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const E=await o.text();try{u=JSON.parse(E),Array.isArray(u)&&o.status===404&&(h=[],u=null,x=200,w="OK")}catch{o.status===404&&E===""?(x=204,w="No Content"):u={message:E}}if(u&&this.isMaybeSingle&&(!((d=u==null?void 0:u.details)===null||d===void 0)&&d.includes("0 rows"))&&(u=null,x=200,w="OK"),u&&this.shouldThrowOnError)throw new Qv.default(u)}return{error:u,data:h,count:m,status:x,statusText:w}});return this.shouldThrowOnError||(a=a.catch(o=>{var i,l,c;return{error:{message:`${(i=o==null?void 0:o.name)!==null&&i!==void 0?i:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(l=o==null?void 0:o.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=o==null?void 0:o.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),a.then(t,s)}returns(){return this}overrideTypes(){return this}};hl.default=Yv;var Jv=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ul,"__esModule",{value:!0});const Xv=Jv(hl);let Zv=class extends Xv.default{select(t){let s=!1;const n=(t??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:s=!0,nullsFirst:n,foreignTable:a,referencedTable:o=a}={}){const i=o?`${o}.order`:"order",l=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${l?`${l},`:""}${t}.${s?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:n=s}={}){const a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this}range(t,s,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"offset":`${a}.offset`,i=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${t}`),this.url.searchParams.set(i,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:s=!1,settings:n=!1,buffers:a=!1,wal:o=!1,format:i="text"}={}){var l;const c=[t?"analyze":null,s?"verbose":null,n?"settings":null,a?"buffers":null,o?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${d}"; options=${c};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};ul.default=Zv;var eb=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ho,"__esModule",{value:!0});const tb=eb(ul);let sb=class extends tb.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const n=Array.from(new Set(s)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:n,type:a}={}){let o="";a==="plain"?o="pl":a==="phrase"?o="ph":a==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${o}fts${i}.${s}`),this}match(t){return Object.entries(t).forEach(([s,n])=>{this.url.searchParams.append(s,`eq.${n}`)}),this}not(t,s,n){return this.url.searchParams.append(t,`not.${s}.${n}`),this}or(t,{foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.or`:"or";return this.url.searchParams.append(a,`(${t})`),this}filter(t,s,n){return this.url.searchParams.append(t,`${s}.${n}`),this}};ho.default=sb;var nb=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dl,"__esModule",{value:!0});const na=nb(ho);let rb=class{constructor(t,{headers:s={},schema:n,fetch:a}){this.url=t,this.headers=new Headers(s),this.schema=n,this.fetch=a}select(t,{head:s=!1,count:n}={}){const a=s?"HEAD":"GET";let o=!1;const i=(t??"*").split("").map(l=>/\s/.test(l)&&!o?"":(l==='"'&&(o=!o),l)).join("");return this.url.searchParams.set("select",i),n&&this.headers.append("Prefer",`count=${n}`),new na.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:s,defaultToNull:n=!0}={}){var a;const o="POST";if(s&&this.headers.append("Prefer",`count=${s}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(i.length>0){const l=[...new Set(i)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new na.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}upsert(t,{onConflict:s,ignoreDuplicates:n=!1,count:a,defaultToNull:o=!0}={}){var i;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),a&&this.headers.append("Prefer",`count=${a}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new na.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:s}={}){var n;const a="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new na.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var s;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new na.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};dl.default=rb;var xg=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Tu,"__esModule",{value:!0});const ab=xg(dl),ob=xg(ho);let ib=class yg{constructor(t,{headers:s={},schema:n,fetch:a}={}){this.url=t,this.headers=new Headers(s),this.schemaName=n,this.fetch=a}from(t){const s=new URL(`${this.url}/${t}`);return new ab.default(s,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new yg(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:n=!1,get:a=!1,count:o}={}){var i;let l;const c=new URL(`${this.url}/rpc/${t}`);let d;n||a?(l=n?"HEAD":"GET",Object.entries(s).filter(([h,m])=>m!==void 0).map(([h,m])=>[h,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([h,m])=>{c.searchParams.append(h,m)})):(l="POST",d=s);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new ob.default({method:l,url:c,headers:u,schema:this.schemaName,body:d,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};Tu.default=ib;var Vr=ns&&ns.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Lt,"__esModule",{value:!0});Lt.PostgrestError=Lt.PostgrestBuilder=Lt.PostgrestTransformBuilder=Lt.PostgrestFilterBuilder=Lt.PostgrestQueryBuilder=Lt.PostgrestClient=void 0;const vg=Vr(Tu);Lt.PostgrestClient=vg.default;const bg=Vr(dl);Lt.PostgrestQueryBuilder=bg.default;const jg=Vr(ho);Lt.PostgrestFilterBuilder=jg.default;const wg=Vr(ul);Lt.PostgrestTransformBuilder=wg.default;const Ng=Vr(hl);Lt.PostgrestBuilder=Ng.default;const kg=Vr(ml);Lt.PostgrestError=kg.default;var lb=Lt.default={PostgrestClient:vg.default,PostgrestQueryBuilder:bg.default,PostgrestFilterBuilder:jg.default,PostgrestTransformBuilder:wg.default,PostgrestBuilder:Ng.default,PostgrestError:kg.default};const{PostgrestClient:cb,PostgrestQueryBuilder:AN,PostgrestFilterBuilder:$N,PostgrestTransformBuilder:RN,PostgrestBuilder:LN,PostgrestError:zN}=lb;class db{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const s=parseInt(process.versions.node.split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const n=this.getWebSocketConstructor();return new n(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const ub="2.15.4",hb=`realtime-js/${ub}`,mb="1.0.0",hd=1e4,fb=1e3,pb=100;var wa;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(wa||(wa={}));var dt;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(dt||(dt={}));var us;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(us||(us={}));var md;(function(e){e.websocket="websocket"})(md||(md={}));var Pn;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Pn||(Pn={}));class gb{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),n=new TextDecoder;return this._decodeBroadcast(t,s,n)}_decodeBroadcast(t,s,n){const a=s.getUint8(1),o=s.getUint8(2);let i=this.HEADER_LENGTH+2;const l=n.decode(t.slice(i,i+a));i=i+a;const c=n.decode(t.slice(i,i+o));i=i+o;const d=JSON.parse(n.decode(t.slice(i,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class Sg{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ke;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Ke||(Ke={}));const nm=(e,t,s={})=>{var n;const a=(n=s.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(t).reduce((o,i)=>(o[i]=xb(i,e,t,a),o),{})},xb=(e,t,s,n)=>{const a=t.find(l=>l.name===e),o=a==null?void 0:a.type,i=s[e];return o&&!n.includes(o)?_g(o,i):fd(i)},_g=(e,t)=>{if(e.charAt(0)==="_"){const s=e.slice(1,e.length);return jb(t,s)}switch(e){case Ke.bool:return yb(t);case Ke.float4:case Ke.float8:case Ke.int2:case Ke.int4:case Ke.int8:case Ke.numeric:case Ke.oid:return vb(t);case Ke.json:case Ke.jsonb:return bb(t);case Ke.timestamp:return wb(t);case Ke.abstime:case Ke.date:case Ke.daterange:case Ke.int4range:case Ke.int8range:case Ke.money:case Ke.reltime:case Ke.text:case Ke.time:case Ke.timestamptz:case Ke.timetz:case Ke.tsrange:case Ke.tstzrange:return fd(t);default:return fd(t)}},fd=e=>e,yb=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},vb=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},bb=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},jb=(e,t)=>{if(typeof e!="string")return e;const s=e.length-1,n=e[s];if(e[0]==="{"&&n==="}"){let o;const i=e.slice(1,s);try{o=JSON.parse("["+i+"]")}catch{o=i?i.split(","):[]}return o.map(l=>_g(t,l))}return e},wb=e=>typeof e=="string"?e.replace(" ","T"):e,Cg=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Ql{constructor(t,s,n={},a=hd){this.channel=t,this.event=s,this.payload=n,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var n;return this._hasReceived(t)&&s((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var rm;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(rm||(rm={}));class Na{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(s==null?void 0:s.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},a=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Na.syncState(this.state,a,o,i),this.pendingDiffs.forEach(c=>{this.state=Na.syncDiff(this.state,c,o,i)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},a=>{const{onJoin:o,onLeave:i,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Na.syncDiff(this.state,a,o,i),l())}),this.onJoin((a,o,i)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:o,newPresences:i})}),this.onLeave((a,o,i)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:o,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,n,a){const o=this.cloneDeep(t),i=this.transformState(s),l={},c={};return this.map(o,(d,u)=>{i[d]||(c[d]=u)}),this.map(i,(d,u)=>{const h=o[d];if(h){const m=u.map(E=>E.presence_ref),x=h.map(E=>E.presence_ref),w=u.filter(E=>x.indexOf(E.presence_ref)<0),S=h.filter(E=>m.indexOf(E.presence_ref)<0);w.length>0&&(l[d]=w),S.length>0&&(c[d]=S)}else l[d]=u}),this.syncDiff(o,{joins:l,leaves:c},n,a)}static syncDiff(t,s,n,a){const{joins:o,leaves:i}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return n||(n=()=>{}),a||(a=()=>{}),this.map(o,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const h=t[l].map(x=>x.presence_ref),m=u.filter(x=>h.indexOf(x.presence_ref)<0);t[l].unshift(...m)}n(l,u,c)}),this.map(i,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),t[l]=d,a(l,d,c),d.length===0&&delete t[l]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(n=>s(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,n)=>{const a=t[n];return"metas"in a?s[n]=a.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):s[n]=a,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var am;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(am||(am={}));var ka;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(ka||(ka={}));var Ds;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Ds||(Ds={}));class Mu{constructor(t,s={config:{}},n){this.topic=t,this.params=s,this.socket=n,this.bindings={},this.state=dt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Ql(this,us.join,this.params,this.timeout),this.rejoinTimer=new Sg(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=dt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=dt.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=dt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(us.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new Na(this),this.broadcastEndpointURL=Cg(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var n,a,o;if(this.socket.isConnected()||this.socket.connect(),this.state==dt.closed){const{config:{broadcast:i,presence:l,private:c}}=this.params,d=(a=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(x=>x.filter))!==null&&a!==void 0?a:[],u=!!this.bindings[ka.PRESENCE]&&this.bindings[ka.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,h={},m={broadcast:i,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(x=>t==null?void 0:t(Ds.CHANNEL_ERROR,x)),this._onClose(()=>t==null?void 0:t(Ds.CLOSED)),this.updateJoinPayload(Object.assign({config:m},h)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:x})=>{var w;if(this.socket.setAuth(),x===void 0){t==null||t(Ds.SUBSCRIBED);return}else{const S=this.bindings.postgres_changes,E=(w=S==null?void 0:S.length)!==null&&w!==void 0?w:0,y=[];for(let f=0;f<E;f++){const g=S[f],{filter:{event:b,schema:$,table:A,filter:B}}=g,z=x&&x[f];if(z&&z.event===b&&z.schema===$&&z.table===A&&z.filter===B)y.push(Object.assign(Object.assign({},g),{id:z.id}));else{this.unsubscribe(),this.state=dt.errored,t==null||t(Ds.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(Ds.SUBSCRIBED);return}}).receive("error",x=>{this.state=dt.errored,t==null||t(Ds.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(x).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Ds.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,n){return this.state===dt.joined&&t===ka.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,s,n)}async send(t,s={}){var n,a;if(!this._canPush()&&t.type==="broadcast"){const{event:o,payload:i}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:i,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=s.timeout)!==null&&n!==void 0?n:this.timeout);return await((a=d.body)===null||a===void 0?void 0:a.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var i,l,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(i=this.params)===null||i===void 0?void 0:i.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&o("ok"),d.receive("ok",()=>o("ok")),d.receive("error",()=>o("error")),d.receive("timeout",()=>o("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=dt.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(us.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(a=>{n=new Ql(this,us.leave,{},t),n.receive("ok",()=>{s(),a("ok")}).receive("timeout",()=>{s(),a("timed out")}).receive("error",()=>{a("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=dt.closed,this.bindings={}}async _fetchWithTimeout(t,s,n){const a=new AbortController,o=setTimeout(()=>a.abort(),n),i=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:a.signal}));return clearTimeout(o),i}_push(t,s,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Ql(this,t,s,n);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>pb){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,n){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,n){var a,o;const i=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=us;if(n&&[l,c,d,u].indexOf(i)>=0&&n!==this._joinRef())return;let m=this._onMessage(i,s,n);if(s&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(x=>{var w,S,E;return((w=x.filter)===null||w===void 0?void 0:w.event)==="*"||((E=(S=x.filter)===null||S===void 0?void 0:S.event)===null||E===void 0?void 0:E.toLocaleLowerCase())===i}).map(x=>x.callback(m,n)):(o=this.bindings[i])===null||o===void 0||o.filter(x=>{var w,S,E,y,f,g;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in x){const b=x.id,$=(w=x.filter)===null||w===void 0?void 0:w.event;return b&&((S=s.ids)===null||S===void 0?void 0:S.includes(b))&&($==="*"||($==null?void 0:$.toLocaleLowerCase())===((E=s.data)===null||E===void 0?void 0:E.type.toLocaleLowerCase()))}else{const b=(f=(y=x==null?void 0:x.filter)===null||y===void 0?void 0:y.event)===null||f===void 0?void 0:f.toLocaleLowerCase();return b==="*"||b===((g=s==null?void 0:s.event)===null||g===void 0?void 0:g.toLocaleLowerCase())}else return x.type.toLocaleLowerCase()===i}).map(x=>{if(typeof m=="object"&&"ids"in m){const w=m.data,{schema:S,table:E,commit_timestamp:y,type:f,errors:g}=w;m=Object.assign(Object.assign({},{schema:S,table:E,commit_timestamp:y,eventType:f,new:{},old:{},errors:g}),this._getPayloadRecords(w))}x.callback(m,n)})}_isClosed(){return this.state===dt.closed}_isJoined(){return this.state===dt.joined}_isJoining(){return this.state===dt.joining}_isLeaving(){return this.state===dt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,n){const a=t.toLocaleLowerCase(),o={type:a,filter:s,callback:n};return this.bindings[a]?this.bindings[a].push(o):this.bindings[a]=[o],this}_off(t,s){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(a=>{var o;return!(((o=a.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&Mu.isEqual(a.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const n in t)if(t[n]!==s[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(us.close,{},t)}_onError(t){this._on(us.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=dt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=nm(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=nm(t.columns,t.old_record)),s}}const Yl=()=>{},Fo={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Nb=[1e3,2e3,5e3,1e4],kb=1e4,Sb=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _b{constructor(t,s){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=hd,this.transport=null,this.heartbeatIntervalMs=Fo.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Yl,this.ref=0,this.reconnectTimer=null,this.logger=Yl,this.conn=null,this.sendBuffer=[],this.serializer=new gb,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let o;return a?o=a:typeof fetch>"u"?o=(...i)=>no(async()=>{const{default:l}=await Promise.resolve().then(()=>qr);return{default:l}},void 0,import.meta.url).then(({default:l})=>l(...i)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...i)=>o(...i)},!(!((n=s==null?void 0:s.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${md.websocket}`,this.httpEndpoint=Cg(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s==null?void 0:s.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=db.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:mb}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},t?this.conn.close(t,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,n){this.logger(t,s,n)}connectionState(){switch(this.conn&&this.conn.readyState){case wa.connecting:return Pn.Connecting;case wa.open:return Pn.Open;case wa.closing:return Pn.Closing;default:return Pn.Closed}}isConnected(){return this.connectionState()===Pn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const n=`realtime:${t}`,a=this.getChannels().find(o=>o.topic===n);if(a)return a;{const o=new Mu(`realtime:${t}`,s,this);return this.channels.push(o),o}}push(t){const{topic:s,event:n,payload:a,ref:o}=t,i=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${n} (${o})`,a),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(s){this.log("error","error in heartbeat callback",s)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(s){this.log("error","error in heartbeat callback",s)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(fb,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},Fo.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(s){this.log("error","error in heartbeat callback",s)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{if(s.topic==="phoenix"&&s.event==="phx_reply")try{this.heartbeatCallback(s.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:a,payload:o,ref:i}=s,l=i?`(${i})`:"",c=o.status||"";this.log("receive",`${c} ${n} ${a} ${l}`.trim(),o),this.channels.filter(d=>d._isMember(n)).forEach(d=>d._trigger(a,o,i)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(us.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const n=t.match(/\?/)?"&":"?",a=new URLSearchParams(s);return`${t}${n}${a}`}_workerObjectUrl(t){let s;if(t)s=t;else{const n=new Blob([Sb],{type:"application/javascript"});s=URL.createObjectURL(n)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s;t?s=t:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(n=>{const a={access_token:s,version:hb};s&&n.updateJoinPayload(a),n.joinedOnce&&n._isJoined()&&n._push(us.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(s)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Sg(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Fo.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,n,a,o,i,l,c,d,u;if(this.transport=(s=t==null?void 0:t.transport)!==null&&s!==void 0?s:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:hd,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:Fo.HEARTBEAT_INTERVAL,this.worker=(o=t==null?void 0:t.worker)!==null&&o!==void 0?o:!1,this.accessToken=(i=t==null?void 0:t.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:Yl,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:h=>Nb[h-1]||kb,this.encode=(d=t==null?void 0:t.encode)!==null&&d!==void 0?d:(h,m)=>m(JSON.stringify(h)),this.decode=(u=t==null?void 0:t.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class Pu extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ut(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class Cb extends Pu{constructor(t,s,n){super(t),this.name="StorageApiError",this.status=s,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class pd extends Pu{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var Eb=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Eg=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>no(async()=>{const{default:n}=await Promise.resolve().then(()=>qr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},Tb=()=>Eb(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield no(()=>Promise.resolve().then(()=>qr),void 0,import.meta.url)).Response:Response}),gd=e=>{if(Array.isArray(e))return e.map(s=>gd(s));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([s,n])=>{const a=s.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));t[a]=gd(n)}),t},Mb=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)};var Qn=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Jl=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Pb=(e,t,s)=>Qn(void 0,void 0,void 0,function*(){const n=yield Tb();e instanceof n&&!(s!=null&&s.noResolveJson)?e.json().then(a=>{const o=e.status||500,i=(a==null?void 0:a.statusCode)||o+"";t(new Cb(Jl(a),o,i))}).catch(a=>{t(new pd(Jl(a),a))}):t(new pd(Jl(e),e))}),Db=(e,t,s,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?a:(Mb(n)?(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(n)):a.body=n,t!=null&&t.duplex&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s))};function mo(e,t,s,n,a,o){return Qn(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(s,Db(t,n,a,o)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>i(c)).catch(c=>Pb(c,l,n))})})}function Ri(e,t,s,n){return Qn(this,void 0,void 0,function*(){return mo(e,"GET",t,s,n)})}function Ns(e,t,s,n,a){return Qn(this,void 0,void 0,function*(){return mo(e,"POST",t,n,a,s)})}function xd(e,t,s,n,a){return Qn(this,void 0,void 0,function*(){return mo(e,"PUT",t,n,a,s)})}function Ob(e,t,s,n){return Qn(this,void 0,void 0,function*(){return mo(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),n)})}function Tg(e,t,s,n,a){return Qn(this,void 0,void 0,function*(){return mo(e,"DELETE",t,n,a,s)})}var Pt=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Ib={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},om={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ab{constructor(t,s={},n,a){this.url=t,this.headers=s,this.bucketId=n,this.fetch=Eg(a)}uploadOrUpdate(t,s,n,a){return Pt(this,void 0,void 0,function*(){try{let o;const i=Object.assign(Object.assign({},om),a);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(i.upsert)});const c=i.metadata;typeof Blob<"u"&&n instanceof Blob?(o=new FormData,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c)),o.append("",n)):typeof FormData<"u"&&n instanceof FormData?(o=n,o.append("cacheControl",i.cacheControl),c&&o.append("metadata",this.encodeMetadata(c))):(o=n,l["cache-control"]=`max-age=${i.cacheControl}`,l["content-type"]=i.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(l=Object.assign(Object.assign({},l),a.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),h=yield(t=="PUT"?xd:Ns)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},i!=null&&i.duplex?{duplex:i.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(o){if(ut(o))return{data:null,error:o};throw o}})}upload(t,s,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,n)})}uploadToSignedUrl(t,s,n,a){return Pt(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(t),i=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${i}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:om.upsert},a),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",d.cacheControl)):(c=n,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield xd(this.fetch,l.toString(),c,{headers:u});return{data:{path:o,fullPath:h.Key},error:null}}catch(c){if(ut(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return Pt(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const a=Object.assign({},this.headers);s!=null&&s.upsert&&(a["x-upsert"]="true");const o=yield Ns(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:a}),i=new URL(this.url+o.url),l=i.searchParams.get("token");if(!l)throw new Pu("No token returned by API");return{data:{signedUrl:i.toString(),path:t,token:l},error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}})}update(t,s,n){return Pt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,n)})}move(t,s,n){return Pt(this,void 0,void 0,function*(){try{return{data:yield Ns(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(ut(a))return{data:null,error:a};throw a}})}copy(t,s,n){return Pt(this,void 0,void 0,function*(){try{return{data:{path:(yield Ns(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(ut(a))return{data:null,error:a};throw a}})}createSignedUrl(t,s,n){return Pt(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),o=yield Ns(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:s},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const i=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${i}`)},{data:o,error:null}}catch(a){if(ut(a))return{data:null,error:a};throw a}})}createSignedUrls(t,s,n){return Pt(this,void 0,void 0,function*(){try{const a=yield Ns(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:a.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${o}`):null})),error:null}}catch(a){if(ut(a))return{data:null,error:a};throw a}})}download(t,s){return Pt(this,void 0,void 0,function*(){const a=typeof(s==null?void 0:s.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((s==null?void 0:s.transform)||{}),i=o?`?${o}`:"";try{const l=this._getFinalPath(t);return{data:yield(yield Ri(this.fetch,`${this.url}/${a}/${l}${i}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(ut(l))return{data:null,error:l};throw l}})}info(t){return Pt(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const n=yield Ri(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:gd(n),error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}})}exists(t){return Pt(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield Ob(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(ut(n)&&n instanceof pd){const a=n.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,s){const n=this._getFinalPath(t),a=[],o=s!=null&&s.download?`download=${s.download===!0?"":s.download}`:"";o!==""&&a.push(o);const l=typeof(s==null?void 0:s.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((s==null?void 0:s.transform)||{});c!==""&&a.push(c);let d=a.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${d}`)}}}remove(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield Tg(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(ut(s))return{data:null,error:s};throw s}})}list(t,s,n){return Pt(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},Ib),s),{prefix:t||""});return{data:yield Ns(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},n),error:null}}catch(a){if(ut(a))return{data:null,error:a};throw a}})}listV2(t,s){return Pt(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield Ns(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const $b="2.11.1",Rb={"X-Client-Info":`storage-js/${$b}`};var Xn=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Lb{constructor(t,s={},n,a){const o=new URL(t);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},Rb),s),this.fetch=Eg(n)}listBuckets(){return Xn(this,void 0,void 0,function*(){try{return{data:yield Ri(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(ut(t))return{data:null,error:t};throw t}})}getBucket(t){return Xn(this,void 0,void 0,function*(){try{return{data:yield Ri(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(ut(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return Xn(this,void 0,void 0,function*(){try{return{data:yield Ns(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}})}updateBucket(t,s){return Xn(this,void 0,void 0,function*(){try{return{data:yield xd(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(ut(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Xn(this,void 0,void 0,function*(){try{return{data:yield Ns(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(ut(s))return{data:null,error:s};throw s}})}deleteBucket(t){return Xn(this,void 0,void 0,function*(){try{return{data:yield Tg(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(ut(s))return{data:null,error:s};throw s}})}}class zb extends Lb{constructor(t,s={},n,a){super(t,s,n,a)}from(t){return new Ab(this.url,this.headers,t,this.fetch)}}const Fb="2.57.0";let ua="";typeof Deno<"u"?ua="deno":typeof document<"u"?ua="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ua="react-native":ua="node";const Ub={"X-Client-Info":`supabase-js-${ua}/${Fb}`},Bb={headers:Ub},Hb={schema:"public"},Wb={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},qb={};var Vb=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};const Gb=e=>{let t;return e?t=e:typeof fetch>"u"?t=fg:t=fetch,(...s)=>t(...s)},Kb=()=>typeof Headers>"u"?pg:Headers,Qb=(e,t,s)=>{const n=Gb(s),a=Kb();return(o,i)=>Vb(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:e;let d=new a(i==null?void 0:i.headers);return d.has("apikey")||d.set("apikey",e),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),n(o,Object.assign(Object.assign({},i),{headers:d}))})};var Yb=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};function Jb(e){return e.endsWith("/")?e:e+"/"}function Xb(e,t){var s,n;const{db:a,auth:o,realtime:i,global:l}=e,{db:c,auth:d,realtime:u,global:h}=t,m={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},d),o),realtime:Object.assign(Object.assign({},u),i),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(s=h==null?void 0:h.headers)!==null&&s!==void 0?s:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>Yb(this,void 0,void 0,function*(){return""})};return e.accessToken?m.accessToken=e.accessToken:delete m.accessToken,m}const Mg="2.71.1",ar=30*1e3,yd=3,Xl=yd*ar,Zb="http://localhost:9999",ej="supabase.auth.token",tj={"X-Client-Info":`gotrue-js/${Mg}`},vd="X-Supabase-Api-Version",Pg={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sj=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,nj=10*60*1e3;class Du extends Error{constructor(t,s,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=n}}function Te(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class rj extends Du{constructor(t,s,n){super(t,s,n),this.name="AuthApiError",this.status=s,this.code=n}}function aj(e){return Te(e)&&e.name==="AuthApiError"}class Dg extends Du{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class wn extends Du{constructor(t,s,n,a){super(t,n,a),this.name=s,this.status=n}}class Qs extends wn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function oj(e){return Te(e)&&e.name==="AuthSessionMissingError"}class Uo extends wn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bo extends wn{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Ho extends wn{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ij(e){return Te(e)&&e.name==="AuthImplicitGrantRedirectError"}class im extends wn{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class bd extends wn{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Zl(e){return Te(e)&&e.name==="AuthRetryableFetchError"}class lm extends wn{constructor(t,s,n){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=n}}class jd extends wn{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),cm=` 	
\r=`.split(""),lj=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<cm.length;t+=1)e[cm[t].charCodeAt(0)]=-2;for(let t=0;t<Li.length;t+=1)e[Li[t].charCodeAt(0)]=t;return e})();function dm(e,t,s){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Li[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;s(Li[n]),t.queuedBits-=6}}function Og(e,t,s){const n=lj[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function um(e){const t=[],s=i=>{t.push(String.fromCodePoint(i))},n={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},o=i=>{uj(i,n,s)};for(let i=0;i<e.length;i+=1)Og(e.charCodeAt(i),a,o);return t.join("")}function cj(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function dj(e,t){for(let s=0;s<e.length;s+=1){let n=e.charCodeAt(s);if(n>55295&&n<=56319){const a=(n-55296)*1024&65535;n=(e.charCodeAt(s+1)-56320&65535|a)+65536,s+=1}cj(n,t)}}function uj(e,t,s){if(t.utf8seq===0){if(e<=127){s(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function hj(e){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};for(let a=0;a<e.length;a+=1)Og(e.charCodeAt(a),s,n);return new Uint8Array(t)}function mj(e){const t=[];return dj(e,s=>t.push(s)),new Uint8Array(t)}function fj(e){const t=[],s={queue:0,queuedBits:0},n=a=>{t.push(a)};return e.forEach(a=>dm(a,s,n)),dm(null,s,n),t.join("")}function pj(e){return Math.round(Date.now()/1e3)+e}function gj(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const ls=()=>typeof window<"u"&&typeof document<"u",kn={tested:!1,writable:!1},Ig=()=>{if(!ls())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(kn.tested)return kn.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),kn.tested=!0,kn.writable=!0}catch{kn.tested=!0,kn.writable=!1}return kn.writable};function xj(e){const t={},s=new URL(e);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((a,o)=>{t[o]=a})}catch{}return s.searchParams.forEach((n,a)=>{t[a]=n}),t}const Ag=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...s)=>no(async()=>{const{default:n}=await Promise.resolve().then(()=>qr);return{default:n}},void 0,import.meta.url).then(({default:n})=>n(...s)):t=fetch,(...s)=>t(...s)},yj=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",or=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Sn=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Ks=async(e,t)=>{await e.removeItem(t)};class fl{constructor(){this.promise=new fl.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}fl.promiseConstructor=Promise;function ec(e){const t=e.split(".");if(t.length!==3)throw new jd("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!sj.test(t[n]))throw new jd("JWT not in base64url format");return{header:JSON.parse(um(t[0])),payload:JSON.parse(um(t[1])),signature:hj(t[2]),raw:{header:t[0],payload:t[1]}}}async function vj(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function bj(e,t){return new Promise((n,a)=>{(async()=>{for(let o=0;o<1/0;o++)try{const i=await e(o);if(!t(o,null,i)){n(i);return}}catch(i){if(!t(o,i)){a(i);return}}})()})}function jj(e){return("0"+e.toString(16)).substr(-2)}function wj(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=s.length;let a="";for(let o=0;o<56;o++)a+=s.charAt(Math.floor(Math.random()*n));return a}return crypto.getRandomValues(t),Array.from(t,jj).join("")}async function Nj(e){const s=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",s),a=new Uint8Array(n);return Array.from(a).map(o=>String.fromCharCode(o)).join("")}async function kj(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const s=await Nj(e);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Zn(e,t,s=!1){const n=wj();let a=n;s&&(a+="/PASSWORD_RECOVERY"),await or(e,`${t}-code-verifier`,a);const o=await kj(n);return[o,n===o?"plain":"s256"]}const Sj=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function _j(e){const t=e.headers.get(vd);if(!t||!t.match(Sj))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Cj(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Ej(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Tj=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function er(e){if(!Tj.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tc(){const e={};return new Proxy(e,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const n=s.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function hm(e){return JSON.parse(JSON.stringify(e))}var Mj=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};const Mn=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Pj=[502,503,504];async function mm(e){var t;if(!yj(e))throw new bd(Mn(e),0);if(Pj.includes(e.status))throw new bd(Mn(e),e.status);let s;try{s=await e.json()}catch(o){throw new Dg(Mn(o),o)}let n;const a=_j(e);if(a&&a.getTime()>=Pg["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?n=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(n=s.error_code),n){if(n==="weak_password")throw new lm(Mn(s),e.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Qs}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((o,i)=>o&&typeof i=="string",!0))throw new lm(Mn(s),e.status,s.weak_password.reasons);throw new rj(Mn(s),e.status||500,n)}const Dj=(e,t,s,n)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(n),Object.assign(Object.assign({},a),s))};async function De(e,t,s,n){var a;const o=Object.assign({},n==null?void 0:n.headers);o[vd]||(o[vd]=Pg["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const i=(a=n==null?void 0:n.query)!==null&&a!==void 0?a:{};n!=null&&n.redirectTo&&(i.redirect_to=n.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",c=await Oj(e,t,s+l,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function Oj(e,t,s,n,a,o){const i=Dj(t,n,a,o);let l;try{l=await e(s,Object.assign({},i))}catch(c){throw console.error(c),new bd(Mn(c),0)}if(l.ok||await mm(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(c){await mm(c)}}function Ts(e){var t;let s=null;Rj(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=pj(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:s,user:n},error:null}}function fm(e){const t=Ts(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((s,n)=>s&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function tn(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Ij(e){return{data:e,error:null}}function Aj(e){const{action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:o}=e,i=Mj(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:s,hashed_token:n,redirect_to:a,verification_type:o},c=Object.assign({},i);return{data:{properties:l,user:c},error:null}}function $j(e){return e}function Rj(e){return e.access_token&&e.refresh_token&&e.expires_in}const sc=["global","local","others"];var Lj=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]]);return s};class zj{constructor({url:t="",headers:s={},fetch:n}){this.url=t,this.headers=s,this.fetch=Ag(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=sc[0]){if(sc.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${sc.join(", ")}`);try{return await De(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,s={}){try{return await De(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:tn})}catch(n){if(Te(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:s}=t,n=Lj(t,["options"]),a=Object.assign(Object.assign({},n),s);return"newEmail"in n&&(a.new_email=n==null?void 0:n.newEmail,delete a.newEmail),await De(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Aj,redirectTo:s==null?void 0:s.redirectTo})}catch(s){if(Te(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await De(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:tn})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,n,a,o,i,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await De(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(s=t==null?void 0:t.page)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:"",per_page:(o=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&o!==void 0?o:""},xform:$j});if(u.error)throw u.error;const h=await u.json(),m=(i=u.headers.get("x-total-count"))!==null&&i!==void 0?i:0,x=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return x.length>0&&(x.forEach(w=>{const S=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),E=JSON.parse(w.split(";")[1].split("=")[1]);d[`${E}Page`]=S}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(Te(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){er(t);try{return await De(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:tn})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){er(t);try{return await De(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:tn})}catch(n){if(Te(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,s=!1){er(t);try{return await De(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:tn})}catch(n){if(Te(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){er(t.userId);try{const{data:s,error:n}=await De(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:s,error:n}}catch(s){if(Te(s))return{data:null,error:s};throw s}}async _deleteFactor(t){er(t.userId),er(t.id);try{return{data:await De(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(Te(s))return{data:null,error:s};throw s}}}function pm(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}function Fj(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const tr={debug:!!(globalThis&&Ig()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class $g extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Uj extends $g{}async function Bj(e,t,s){tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),tr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async a=>{if(a){tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await s()}finally{tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}else{if(t===0)throw tr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Uj(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(tr.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}Fj();const Hj={url:Zb,storageKey:ej,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:tj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function gm(e,t,s){return await s()}const sr={};class Ja{constructor(t){var s,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ja.nextInstanceID,Ja.nextInstanceID+=1,this.instanceID>0&&ls()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},Hj),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new zj({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=Ag(a.fetch),this.lock=a.lock||gm,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:ls()&&(!((s=globalThis==null?void 0:globalThis.navigator)===null||s===void 0)&&s.locks)?this.lock=Bj:this.lock=gm,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:Ig()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=pm(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=pm(this.memoryStorage)),ls()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var t,s;return(s=(t=sr[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){sr[this.storageKey]=Object.assign(Object.assign({},sr[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=sr[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){sr[this.storageKey]=Object.assign(Object.assign({},sr[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Mg}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=xj(window.location.href);let n="none";if(this._isImplicitGrantCallback(s)?n="implicit":await this._isPKCECallback(s)&&(n="pkce"),ls()&&this.detectSessionInUrl&&n!=="none"){const{data:a,error:o}=await this._getSessionFromURL(s,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),ij(o)){const c=(t=o.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:i,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",i,"redirect type",l),await this._saveSession(i),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Te(s)?{error:s}:{error:new Dg("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,n,a;try{const o=await De(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(s=t==null?void 0:t.options)===null||s===void 0?void 0:s.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:Ts}),{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Te(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(t){var s,n,a;try{let o;if("email"in t){const{email:u,password:h,options:m}=t;let x=null,w=null;this.flowType==="pkce"&&([x,w]=await Zn(this.storage,this.storageKey)),o=await De(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:u,password:h,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:x,code_challenge_method:w},xform:Ts})}else if("phone"in t){const{phone:u,password:h,options:m}=t;o=await De(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(n=m==null?void 0:m.data)!==null&&n!==void 0?n:{},channel:(a=m==null?void 0:m.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Ts})}else throw new Bo("You must provide either an email or phone number and a password");const{data:i,error:l}=o;if(l||!i)return{data:{user:null,session:null},error:l};const c=i.session,d=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(o){if(Te(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(t){try{let s;if("email"in t){const{email:o,password:i,options:l}=t;s=await De(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:fm})}else if("phone"in t){const{phone:o,password:i,options:l}=t;s=await De(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:i,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:fm})}else throw new Bo("You must provide either an email or phone number and a password");const{data:n,error:a}=s;return a?{data:{user:null,session:null},error:a}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Uo}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:a})}catch(s){if(Te(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,n,a,o;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(o=t.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;if(s==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(t){var s,n,a,o,i,l,c,d,u,h,m,x;let w,S;if("message"in t)w=t.message,S=t.signature;else{const{chain:E,wallet:y,statement:f,options:g}=t;let b;if(ls())if(typeof y=="object")b=y;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))b=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=y}const $=new URL((s=g==null?void 0:g.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in b&&b.signIn){const A=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},g==null?void 0:g.signInWithSolana),{version:"1",domain:$.host,uri:$.href}),f?{statement:f}:null));let B;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")B=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)B=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)w=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),S=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${$.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${$.href}`,`Issued At: ${(a=(n=g==null?void 0:g.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((o=g==null?void 0:g.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...!((i=g==null?void 0:g.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...!((l=g==null?void 0:g.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...!((c=g==null?void 0:g.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...!((d=g==null?void 0:g.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...!((h=(u=g==null?void 0:g.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...g.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const A=await b.signMessage(new TextEncoder().encode(w),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");S=A}}try{const{data:E,error:y}=await De(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:fj(S)},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(x=t.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:Ts});if(y)throw y;return!E||!E.session||!E.user?{data:{user:null,session:null},error:new Uo}:(E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",E.session)),{data:Object.assign({},E),error:y})}catch(E){if(Te(E))return{data:{user:null,session:null},error:E};throw E}}async _exchangeCodeForSession(t){const s=await Sn(this.storage,`${this.storageKey}-code-verifier`),[n,a]=(s??"").split("/");try{const{data:o,error:i}=await De(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Ts});if(await Ks(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new Uo}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:a??null}),error:i})}catch(o){if(Te(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(t){try{const{options:s,provider:n,token:a,access_token:o,nonce:i}=t,l=await De(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:a,access_token:o,nonce:i,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Ts}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Uo}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(Te(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,n,a,o,i;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Zn(this.storage,this.storageKey));const{error:h}=await De(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await De(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(o=c==null?void 0:c.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(i=c==null?void 0:c.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u}}throw new Bo("You must provide either an email or phone number.")}catch(l){if(Te(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var s,n;try{let a,o;"options"in t&&(a=(s=t.options)===null||s===void 0?void 0:s.redirectTo,o=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:i,error:l}=await De(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:o}}),redirectTo:a,xform:Ts});if(l)throw l;if(!i)throw new Error("An error occurred on token verification.");const c=i.session,d=i.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(Te(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var s,n,a;try{let o=null,i=null;return this.flowType==="pkce"&&([o,i]=await Zn(this.storage,this.storageKey)),await De(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&n!==void 0?n:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:i}),headers:this.headers,xform:Ij})}catch(o){if(Te(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:n}=t;if(n)throw n;if(!s)throw new Qs;const{error:a}=await De(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(Te(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:n,type:a,options:o}=t,{error:i}=await De(this.fetch,"POST",s,{headers:this.headers,body:{email:n,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in t){const{phone:n,type:a,options:o}=t,{data:i,error:l}=await De(this.fetch,"POST",s,{headers:this.headers,body:{phone:n,type:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:i==null?void 0:i.message_id},error:l}}throw new Bo("You must provide either an email or phone number and a type")}catch(s){if(Te(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await n,await s()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=s();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await Sn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<Xl:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const i=await Sn(this.userStorage,this.storageKey+"-user");i!=null&&i.user?t.user=i.user:t.user=tc()}if(this.storage.isServer&&t.user){let i=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!i&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:a,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{session:null},error:o}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await De(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:tn}):await this._useSession(async s=>{var n,a,o;const{data:i,error:l}=s;if(l)throw l;return!(!((n=i.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Qs}:await De(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(a=i.session)===null||a===void 0?void 0:a.access_token)!==null&&o!==void 0?o:void 0,xform:tn})})}catch(s){if(Te(s))return oj(s)&&(await this._removeSession(),await Ks(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async n=>{const{data:a,error:o}=n;if(o)throw o;if(!a.session)throw new Qs;const i=a.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Zn(this.storage,this.storageKey));const{data:d,error:u}=await De(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s==null?void 0:s.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:i.access_token,xform:tn});if(u)throw u;return i.user=d.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(n){if(Te(n))return{data:{user:null},error:n};throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Qs;const s=Date.now()/1e3;let n=s,a=!0,o=null;const{payload:i}=ec(t.access_token);if(i.exp&&(n=i.exp,a=n<=s),a){const{session:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;o={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:n-s,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(s){if(Te(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var n;if(!t){const{data:i,error:l}=s;if(l)throw l;t=(n=i.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Qs;const{session:a,error:o}=await this._callRefreshToken(t.refresh_token);return o?{data:{user:null,session:null},error:o}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(Te(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!ls())throw new Ho("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Ho(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new im("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ho("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new im("No code detected.");const{data:f,error:g}=await this._exchangeCodeForSession(t.code);if(g)throw g;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:f.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:a,access_token:o,refresh_token:i,expires_in:l,expires_at:c,token_type:d}=t;if(!o||!l||!i||!d)throw new Ho("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let m=u+h;c&&(m=parseInt(c));const x=m-u;x*1e3<=ar&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${x}s, should have been closer to ${h}s`);const w=m-h;u-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,m,u):u-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,m,u);const{data:S,error:E}=await this._getUser(o);if(E)throw E;const y={provider_token:n,provider_refresh_token:a,access_token:o,expires_in:h,expires_at:m,refresh_token:i,token_type:d,user:S.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:t.type},error:null}}catch(n){if(Te(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await Sn(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var n;const{data:a,error:o}=s;if(o)return{error:o};const i=(n=a.session)===null||n===void 0?void 0:n.access_token;if(i){const{error:l}=await this.admin.signOut(i,t);if(l&&!(aj(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await Ks(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=gj(),n={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async s=>{var n,a;try{const{data:{session:o},error:i}=s;if(i)throw i;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",t,"session",o)}catch(o){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",o),console.error(o)}})}async resetPasswordForEmail(t,s={}){let n=null,a=null;this.flowType==="pkce"&&([n,a]=await Zn(this.storage,this.storageKey,!0));try{return await De(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:a,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(o){if(Te(o))return{data:null,error:o};throw o}}async getUserIdentities(){var t;try{const{data:s,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(Te(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:n,error:a}=await this._useSession(async o=>{var i,l,c,d,u;const{data:h,error:m}=o;if(m)throw m;const x=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await De(this.fetch,"GET",x,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(a)throw a;return ls()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:t.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(Te(n))return{data:{provider:t.provider,url:null},error:n};throw n}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var n,a;const{data:o,error:i}=s;if(i)throw i;return await De(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0})})}catch(s){if(Te(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const n=Date.now();return await bj(async a=>(a>0&&await vj(200*Math.pow(2,a-1)),this._debug(s,"refreshing attempt",a),await De(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Ts})),(a,o)=>{const i=200*Math.pow(2,a);return o&&Zl(o)&&Date.now()+i-n<ar})}catch(n){if(this._debug(s,"error",n),Te(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",n),ls()&&!s.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,s;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const a=await Sn(this.storage,this.storageKey);if(a&&this.userStorage){let i=await Sn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:a.user},await or(this.userStorage,this.storageKey+"-user",i)),a.user=(t=i==null?void 0:i.user)!==null&&t!==void 0?t:tc()}else if(a&&!a.user&&!a.user){const i=await Sn(this.storage,this.storageKey+"-user");i&&(i!=null&&i.user)?(a.user=i.user,await Ks(this.storage,this.storageKey+"-user"),await or(this.storage,this.storageKey,a)):a.user=tc()}if(this._debug(n,"session from storage",a),!this._isValidSession(a)){this._debug(n,"session is not valid"),a!==null&&await this._removeSession();return}const o=((s=a.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Xl;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${Xl}s`),o){if(this.autoRefreshToken&&a.refresh_token){const{error:i}=await this._callRefreshToken(a.refresh_token);i&&(console.error(i),Zl(i)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:i,error:l}=await this._getUser(a.access_token);!l&&(i!=null&&i.user)?(a.user=i.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(n,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(n,"error",a),console.error(a);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var s,n;if(!t)throw new Qs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new fl;const{data:o,error:i}=await this._refreshAccessToken(t);if(i)throw i;if(!o.session)throw new Qs;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={session:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(a,"error",o),Te(o)){const i={session:null,error:o};return Zl(o)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(i),i}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,s,n=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",s,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:s});const o=[],i=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,s)}catch(c){o.push(c)}});if(await Promise.all(i),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const s=Object.assign({},t),n=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&s.user&&await or(this.userStorage,this.storageKey+"-user",{user:s.user});const a=Object.assign({},s);delete a.user;const o=hm(a);await or(this.storage,this.storageKey,o)}else{const a=hm(s);await or(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await Ks(this.storage,this.storageKey),await Ks(this.storage,this.storageKey+"-code-verifier"),await Ks(this.storage,this.storageKey+"-user"),this.userStorage&&await Ks(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ls()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),ar);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:n}}=s;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((n.expires_at*1e3-t)/ar);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${ar}ms, refresh threshold is ${yd} ticks`),a<=yd&&await this._callRefreshToken(n.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof $g)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ls()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,n){const a=[`provider=${encodeURIComponent(s)}`];if(n!=null&&n.redirectTo&&a.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&a.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,i]=await Zn(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(i)}`});a.push(l.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);a.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&a.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;return o?{data:null,error:o}:await De(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(Te(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var n,a;const{data:o,error:i}=s;if(i)return{data:null,error:i};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await De(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(Te(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;if(o)return{data:null,error:o};const{data:i,error:l}=await De(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:l})})}catch(s){if(Te(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var n;const{data:a,error:o}=s;return o?{data:null,error:o}:await De(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(n=a==null?void 0:a.session)===null||n===void 0?void 0:n.access_token})})}catch(s){if(Te(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:n}=await this._challenge({factorId:t.factorId});return n?{data:null,error:n}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const n=(t==null?void 0:t.factors)||[],a=n.filter(i=>i.factor_type==="totp"&&i.status==="verified"),o=n.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:n,totp:a,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,n;const{data:{session:a},error:o}=t;if(o)return{data:null,error:o};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=ec(a.access_token);let l=null;i.aal&&(l=i.aal);let c=l;((n=(s=a.user.factors)===null||s===void 0?void 0:s.filter(h=>h.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const u=i.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,s={keys:[]}){let n=s.keys.find(l=>l.kid===t);if(n)return n;const a=Date.now();if(n=this.jwks.keys.find(l=>l.kid===t),n&&this.jwks_cached_at+nj>a)return n;const{data:o,error:i}=await De(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=a,n=o.keys.find(l=>l.kid===t),!n)?null:n}async getClaims(t,s={}){try{let n=t;if(!n){const{data:x,error:w}=await this.getSession();if(w||!x.session)return{data:null,error:w};n=x.session.access_token}const{header:a,payload:o,signature:i,raw:{header:l,payload:c}}=ec(n);s!=null&&s.allowExpired||Cj(o.exp);const d=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,s!=null&&s.keys?{keys:s.keys}:s==null?void 0:s.jwks);if(!d){const{error:x}=await this.getUser(n);if(x)throw x;return{data:{claims:o,header:a,signature:i},error:null}}const u=Ej(a.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,i,mj(`${l}.${c}`)))throw new jd("Invalid JWT signature");return{data:{claims:o,header:a,signature:i},error:null}}catch(n){if(Te(n))return{data:null,error:n};throw n}}}Ja.nextInstanceID=0;const Wj=Ja;class qj extends Wj{constructor(t){super(t)}}var Vj=function(e,t,s,n){function a(o){return o instanceof s?o:new s(function(i){i(o)})}return new(s||(s=Promise))(function(o,i){function l(u){try{d(n.next(u))}catch(h){i(h)}}function c(u){try{d(n.throw(u))}catch(h){i(h)}}function d(u){u.done?o(u.value):a(u.value).then(l,c)}d((n=n.apply(e,t||[])).next())})};class Gj{constructor(t,s,n){var a,o,i;if(this.supabaseUrl=t,this.supabaseKey=s,!t)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=Jb(t),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:Hb,realtime:qb,auth:Object.assign(Object.assign({},Wb),{storageKey:d}),global:Bb},h=Xb(n??{},u);this.storageKey=(a=h.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,x)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(x)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=h.auth)!==null&&i!==void 0?i:{},this.headers,h.global.fetch),this.fetch=Qb(s,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new cb(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new zb(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Uv(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},n={}){return this.rest.rpc(t,s,n)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return Vj(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(s=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,userStorage:o,storageKey:i,flowType:l,lock:c,debug:d},u,h){const m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new qj({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),u),storageKey:i,autoRefreshToken:t,persistSession:s,detectSessionInUrl:n,storage:a,userStorage:o,flowType:l,lock:c,debug:d,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new _b(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,n)=>{this._handleTokenChanged(s,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,s,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Kj=(e,t,s)=>new Gj(e,t,s);function Qj(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Qj()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Yj="https://nrpzetdjwayaxzbcgeba.supabase.co",Jj="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ycHpldGRqd2F5YXh6YmNnZWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMDM5NjksImV4cCI6MjA3MjU3OTk2OX0.82VLG5HvSyVTcQdjtnPl2JTvaECvMcMIh0Evn00RAOY",Ne=Kj(Yj,Jj),Xj=.1,Fr="Descuento estudiante 10%",Zj=e=>(e??"").toLowerCase(),Rg=e=>{const t=Zj(e.categoria);return t.includes("sandwich")||t.includes("sanduch")},sn=e=>typeof e.precioUnitario=="number"?e.precioUnitario:e.item.precio,Xa=e=>{const t=sn(e);return e.studentDiscount?Math.round(t*(1-Xj)):t},Za=e=>Xa(e)*e.cantidad,wd=e=>{if(!Number.isFinite(e))return 0;const t=Math.round(e);return t%100===50?t+50:t},Ys=e=>{const t=e.reduce((s,n)=>s+Za(n),0);return wd(t)},Nd=e=>{if(!e)return{studentDiscount:!1,cleanedNotes:void 0};const t=e.split(`
`);let s=!1;const a=t.filter(o=>o.trim().toLowerCase()===Fr.toLowerCase()?(s=!0,!1):!0).join(`
`).trim();return{studentDiscount:s,cleanedNotes:a||void 0}},Lg=(e,t)=>{const{cleanedNotes:s}=Nd(e);return t?s?`${s}
${Fr}`:Fr:s},Ce=async()=>!0,ew=async()=>{if(!await Ce())return"local";try{const{error:e}=await Ne.from("orders").select("id",{head:!0}).limit(1);if(e)throw e;return"online"}catch(e){return console.warn("Supabase connection check failed, falling back to local mode:",e),"local"}},zg=["efectivo","tarjeta","nequi","provision_caja","credito_empleados"],qn="savia-employee-credit-updated",Fg="savia-horarios-base",Ug="savia-horarios-semanales",Bg="savia-provision-transfers",Hg="savia-caja-bolsillos",Wg="savia-employee-shifts",qg=()=>{typeof window<"u"&&typeof window.dispatchEvent=="function"&&window.dispatchEvent(new CustomEvent(qn))},Vg=e=>{if(!e||typeof e!="object")return null;const t=e,s={};let n=!1;return uo.forEach(a=>{const o=t[a];if(o&&typeof o=="object"){n=!0;const i=o,l=!!i.active,c=Number(i.hours),d=l&&Number.isFinite(c)?Math.max(0,c):0;s[a]={active:l,hours:d}}else s[a]={active:!1,hours:0}}),n?s:null},Vn=e=>{if(!e||typeof e!="object")return null;const t=e,s={};let n=!1;return uo.forEach(a=>{const o=t[a];o!=null&&(n=!0);const i=Number(o);s[a]=Number.isFinite(i)?Math.max(0,i):0}),n?s:null},Gg=e=>{const t={};return uo.forEach(s=>{const n=e[s],a=!!(n!=null&&n.active),o=Number(n==null?void 0:n.hours);t[s]={active:a,hours:a&&Number.isFinite(o)?Math.max(0,o):0}}),t},Kg=e=>{const t={};return uo.forEach(s=>{const n=Number(e==null?void 0:e[s]);t[s]=Number.isFinite(n)?Math.max(0,n):0}),t},Qg=()=>{const e=Ye(Fg,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a=Vg(n);a&&(t[s]=a)}),t},tw=(e,t)=>{const s=Qg();s[e]=Gg(t),rt(Fg,s)},pl=()=>{const e=Ye(Ug,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a={};Object.entries(n||{}).forEach(([o,i])=>{const l=Vn(i);l&&(a[o]=l)}),Object.keys(a).length>0&&(t[s]=a)}),t},sw=(e,t,s)=>{const n=pl(),a={...n[e]||{},[t]:Kg(s)};n[e]=a,rt(Ug,n)},Wo=e=>{if(e==null||typeof e!="string")return null;const t=e.trim();if(!t)return null;const s=t.match(/^(\d{1,2}):(\d{2})(?::(\d{2}))?$/);if(!s)return null;const n=Number(s[1]),a=Number(s[2]),o=s[3]?Number(s[3]):0;if(Number.isNaN(n)||Number.isNaN(a)||Number.isNaN(o)||n<0||n>23||a<0||a>59||o<0||o>59)return null;const i=n.toString().padStart(2,"0"),l=a.toString().padStart(2,"0"),c=o.toString().padStart(2,"0");return`${i}:${l}:${c}`},eo=e=>{if(e instanceof Date&&!Number.isNaN(e.getTime())){const t=new Date(e.getTime());return t.setHours(0,0,0,0),Be(t)}if(typeof e=="string"){const t=e.trim();if(!t)return null;if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const s=new Date(t);if(!Number.isNaN(s.getTime()))return s.setHours(0,0,0,0),Be(s)}return null},fo=e=>{if(!e||typeof e!="object")return null;const t=e,s=typeof t.id=="string"&&t.id?t.id:void 0,n=typeof t.empleado_id=="string"?t.empleado_id:typeof t.empleadoId=="string"?t.empleadoId:void 0,a=eo(t.fecha??t.dia??t.date),o=Wo(t.hora_llegada??t.horaLlegada??t.entrada);if(!s||!n||!a||!o)return null;const i=Wo(t.hora_salida??t.horaSalida??t.salida),l=!!t.novedad,c=Wo(t.novedad_inicio??t.novedadInicio),d=Wo(t.novedad_fin??t.novedadFin),u=Number(t.horas_trabajadas??t.horasTrabajadas),h=typeof t.created_at=="string"?t.created_at:typeof t.createdAt=="string"?t.createdAt:void 0,m=typeof t.updated_at=="string"?t.updated_at:typeof t.updatedAt=="string"?t.updatedAt:void 0,x=Number.isFinite(u)?u:void 0;return{id:s,empleadoId:n,fecha:a,horaLlegada:o,horaSalida:i,novedad:l,novedadInicio:c,novedadFin:d,horasTrabajadas:x,createdAt:h,updatedAt:m}},gl=()=>{const e=Ye(Wg,{}),t={};return Object.entries(e||{}).forEach(([s,n])=>{const a=fo({...n,id:s});a&&(t[s]=a)}),t},Yg=e=>{const t={};Object.entries(e).forEach(([s,n])=>{t[s]={...n}}),rt(Wg,t)},xl=e=>{const t=Array.isArray(e)?e:[e];if(t.length===0)return;const s=gl();let n=!1;t.forEach(a=>{if(!a||!a.id)return;const o=s[a.id];if(!o){s[a.id]={...a},n=!0;return}(o.horaLlegada!==a.horaLlegada||o.horaSalida!==a.horaSalida||o.novedad!==a.novedad||o.novedadInicio!==a.novedadInicio||o.novedadFin!==a.novedadFin||o.horasTrabajadas!==a.horasTrabajadas||o.updatedAt!==a.updatedAt)&&(s[a.id]={...a},n=!0)}),n&&Yg(s)},nw=(e,t)=>{const s=gl(),n=s[e];if(!n)return null;const a={...n,...t.empleadoId?{empleadoId:t.empleadoId}:{},...t.fecha?{fecha:t.fecha}:{},...t.horaLlegada!==void 0?{horaLlegada:t.horaLlegada}:{},horaSalida:"horaSalida"in t?t.horaSalida??null:n.horaSalida??null,novedad:"novedad"in t?!!t.novedad:n.novedad,novedadInicio:"novedadInicio"in t?t.novedadInicio??null:n.novedadInicio??null,novedadFin:"novedadFin"in t?t.novedadFin??null:n.novedadFin??null,horasTrabajadas:"horasTrabajadas"in t?t.horasTrabajadas:n.horasTrabajadas,updatedAt:new Date().toISOString()};return s[e]=a,Yg(s),a},rw=(e,t,s={})=>{const n=e,a=t,o=s.empleadoId,i=gl();return Object.values(i).filter(l=>!(l.fecha<n||l.fecha>a||o&&l.empleadoId!==o)).sort((l,c)=>{const d=l.fecha.localeCompare(c.fecha);if(d!==0)return d;const u=l.horaLlegada??"",h=c.horaLlegada??"";return u.localeCompare(h)})},aw=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`shift-${Math.random().toString(36).slice(2,12)}`,yl=e=>{const t=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),n=e.getSeconds().toString().padStart(2,"0");return`${t}:${s}:${n}`},ow=e=>{const t={};return"empleadoId"in e&&(t.empleado_id=e.empleadoId),"fecha"in e&&(t.fecha=e.fecha),"horaLlegada"in e&&(t.hora_llegada=e.horaLlegada),"horaSalida"in e&&(t.hora_salida=e.horaSalida??null),"novedad"in e&&(t.novedad=e.novedad),"novedadInicio"in e&&(t.novedad_inicio=e.novedadInicio??null),"novedadFin"in e&&(t.novedad_fin=e.novedadFin??null),"horasTrabajadas"in e&&(t.horas_trabajadas=e.horasTrabajadas??null),Object.keys(t).length>0&&(t.updated_at=new Date().toISOString()),t},iw=e=>{var u,h,m;if(!e||typeof e!="object")return null;const t=typeof e.id=="string"?e.id:(h=(u=e.id)==null?void 0:u.toString)==null?void 0:h.call(u),s=typeof e.empleado_id=="string"?e.empleado_id:typeof e.empleadoId=="string"?e.empleadoId:void 0;if(!t||!s)return null;const n=e.timestamp??e.created_at??new Date().toISOString(),a=new Date(n).toISOString(),o=Math.max(0,Math.round(Number(e.monto)||0)),i=e.tipo==="abono"?"abono":"cargo",l=((m=e==null?void 0:e.empleado)==null?void 0:m.nombre)??(e==null?void 0:e.empleado_nombre)??(e==null?void 0:e.empleadoNombre)??void 0,c=typeof e.order_id=="string"?e.order_id:e.orderId,d=typeof e.order_numero=="number"?e.order_numero:typeof e.orderNumero=="number"?e.orderNumero:void 0;return{id:t,empleadoId:s,empleadoNombre:l,orderId:typeof c=="string"?c:void 0,orderNumero:d,monto:o,tipo:i,timestamp:a}},lw=async()=>{if(!await Ce())return[];const{data:e,error:t}=await Ne.from("employee_credit_history").select(`
      id,
      empleado_id,
      order_id,
      order_numero,
      monto,
      tipo,
      timestamp,
      empleado:empleados ( id, nombre )
    `).order("timestamp",{ascending:!0});if(t)throw console.error("[dataService] No se pudo obtener el historial de crédito de empleados.",t),t;const s=new Map;for(const n of e??[]){const a=iw(n);if(!a)continue;const o=a.empleadoId;let i=s.get(o);i||(i={empleadoId:o,empleadoNombre:a.empleadoNombre,saldo:0,history:[]},s.set(o,i)),i.saldo+=a.tipo==="cargo"?a.monto:-a.monto;const l=i.saldo;i.history.push({...a,balanceAfter:l}),!i.empleadoNombre&&a.empleadoNombre&&(i.empleadoNombre=a.empleadoNombre)}return Array.from(s.values()).map(n=>({empleadoId:n.empleadoId,empleadoNombre:n.empleadoNombre,total:Math.round(n.saldo),history:n.history.slice().sort((a,o)=>new Date(o.timestamp).getTime()-new Date(a.timestamp).getTime())})).sort((n,a)=>a.total-n.total)},Jg=async({empleadoId:e,monto:t,orderId:s,orderNumero:n})=>{const a=Math.max(0,Math.round(Number(t)||0));if(!e||a<=0)return;if(!await Ce())throw new Error("No se pudo registrar el crédito de empleado porque la base de datos no está disponible.");const o={empleado_id:e,order_id:s??null,order_numero:n??null,monto:a,tipo:"cargo"},{error:i}=await Ne.from("employee_credit_history").insert(o);if(i)throw console.error("[dataService] Error registrando crédito de empleado.",i),i;qg()},cw=async({empleadoId:e,monto:t,orderId:s,orderNumero:n})=>{const a=Math.max(0,Math.round(Number(t)||0));if(!e||a<=0)return;if(!await Ce())throw new Error("No se pudo registrar el abono del crédito porque la base de datos no está disponible.");const o={empleado_id:e,order_id:s??null,order_numero:n??null,monto:a,tipo:"abono"},{error:i}=await Ne.from("employee_credit_history").insert(o);if(i)throw console.error("[dataService] Error registrando abono de crédito de empleado.",i),i;qg()},Ou=e=>{if(typeof e!="string")return null;const t=e.trim();if(!t)return null;const s=t.toLowerCase();return s==="transferencia"?"nequi":s},po=e=>{const t=Ou(e);if(t&&zg.includes(t))return t},vl=(e,t="efectivo")=>po(e)??t,Xg=e=>!e||typeof e!="object"?null:typeof e.metodoPago=="string"?e.metodoPago:typeof e.metodopago=="string"?e.metodopago:null,Zg="metodopago",kd=["efectivo","nequi","tarjeta"],Sa={efectivo:"pago_efectivo",nequi:"pago_nequi",tarjeta:"pago_tarjeta"},dw=e=>{const t=Number(e??0);return!Number.isFinite(t)||t<=0?0:Math.round(t)},uw=e=>{if(!e||typeof e!="object")return[];const t=[];for(const s of kd){const n=Sa[s],a=dw(e[n]);a>0&&t.push({metodo:s,monto:a})}return t},Iu=e=>{const t={efectivo:0,nequi:0,tarjeta:0};return e.forEach(s=>{if(kd.includes(s.metodo)){const n=s.metodo;t[n]+=Math.round(s.monto)}}),Object.fromEntries(kd.map(s=>[Sa[s],t[s]]))},ex="savia-order-metadata",Au=()=>Ye(ex,{}),tx=e=>{rt(ex,e)},hw=e=>Au()[e],to=(e,t)=>{const s=Au(),a={...s[e]??{}};t.paymentStatus?a.paymentStatus=t.paymentStatus:"paymentStatus"in t&&t.paymentStatus===void 0&&delete a.paymentStatus,"paymentAllocations"in t&&(a.paymentAllocations=fn(t.paymentAllocations??[])),typeof t.paymentRegisteredAt=="string"?a.paymentRegisteredAt=t.paymentRegisteredAt:"paymentRegisteredAt"in t&&t.paymentRegisteredAt===void 0&&delete a.paymentRegisteredAt,"credit"in t&&(t.credit?a.credit=t.credit:delete a.credit);const o=!!a.paymentStatus||a.paymentAllocations&&a.paymentAllocations.length>0||!!a.paymentRegisteredAt,i=!!a.credit;return!o&&!i?delete s[e]:s[e]=a,tx(s),a},mw=e=>{const t=Au();t[e]&&(delete t[e],tx(t))},$u=e=>{const t={paymentStatus:e.paymentStatus,paymentAllocations:e.paymentAllocations??[],paymentRegisteredAt:e.paymentRegisteredAt?e.paymentRegisteredAt.toISOString():void 0};e.creditInfo?t.credit={type:e.creditInfo.type,amount:Math.round(e.creditInfo.amount),assignedAt:e.creditInfo.assignedAt.toISOString(),employeeId:e.creditInfo.employeeId,employeeName:e.creditInfo.employeeName}:t.credit=null,to(e.id,t)},li=e=>{const t=e instanceof Date?e:new Date(e);if(Number.isNaN(t.getTime()))return"";const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${s}-${n}-${a}`},fw=(e,t)=>{if(e.codigo&&e.codigo.trim())return e.codigo.trim();const s="",n=e.nombre?Cr(e.nombre):"",a=e.id?Cr(e.id):"";return[s,n].filter(Boolean).join("-")||a||"item"},go=e=>{var l;const t=((l=e.codigo)==null?void 0:l.trim())||dg(e.nombre,e.categoria),s=typeof e.precio=="number"?e.precio:Number(e.precio??0),n=typeof e.stock=="number"?e.stock:Number(e.stock??0),a=e.inventarioCategoria==="Inventariables"?"Inventariables":"No inventariables",o=a==="Inventariables"?e.inventarioTipo:void 0,i=a==="Inventariables"&&o==="gramos"?e.unidadMedida:void 0;return{...e,codigo:t,precio:Number.isFinite(s)?s:0,stock:Number.isFinite(n)?n:0,inventarioCategoria:a,inventarioTipo:o,unidadMedida:i}},sx=e=>{const t=go(e);return{id:t.id,codigo:t.codigo,nombre:t.nombre,precio:t.precio,descripcion:t.descripcion??null,keywords:t.keywords??null,categoria:t.categoria,stock:t.stock,inventariocategoria:t.inventarioCategoria,inventariotipo:t.inventarioTipo??null,unidadmedida:t.unidadMedida??null}},pw=e=>e==="kg"||e==="g"||e==="mg"||e==="ml"?e:void 0,Ws=e=>{const t=typeof(e==null?void 0:e.id)=="string"&&e.id?e.id:typeof(e==null?void 0:e.codigo)=="string"&&e.codigo?e.codigo:`menu-${Math.random().toString(36).slice(2,10)}`,n=((e==null?void 0:e.inventarioCategoria)??(e==null?void 0:e.inventariocategoria))==="Inventariables"?"Inventariables":"No inventariables",a=(e==null?void 0:e.inventarioTipo)??(e==null?void 0:e.inventariotipo),o=n==="Inventariables"?a==="gramos"?"gramos":a==="cantidad"?"cantidad":void 0:void 0,i=(e==null?void 0:e.unidadMedida)??(e==null?void 0:e.unidadmedida),l=o==="gramos"?pw(i):void 0,c={id:t,codigo:fw({...e,id:t}),nombre:typeof(e==null?void 0:e.nombre)=="string"?e.nombre:"",precio:typeof(e==null?void 0:e.precio)=="number"?e.precio:Number((e==null?void 0:e.precio)??0),descripcion:(e==null?void 0:e.descripcion)??void 0,keywords:(e==null?void 0:e.keywords)??void 0,categoria:typeof(e==null?void 0:e.categoria)=="string"?e.categoria:"",stock:typeof(e==null?void 0:e.stock)=="number"?e.stock:Number((e==null?void 0:e.stock)??0),inventarioCategoria:n,inventarioTipo:o,unidadMedida:l};return go(c)},gw=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const s=Number(e);if(Number.isFinite(s))return s}return t},xw=e=>Array.isArray(e==null?void 0:e.order_items)?e.order_items.map(t=>{const s=(t==null?void 0:t.menu_item)??(t==null?void 0:t.menu_items)??(t==null?void 0:t.item);if(!s)return null;const n=Ws(s),a=typeof(t==null?void 0:t.cantidad)=="number"?t.cantidad:Number((t==null?void 0:t.cantidad)??0),o=Number.isFinite(a)?Math.max(0,a):0,i=gw((t==null?void 0:t.precio_unitario)??(t==null?void 0:t.precioUnitario)??(t==null?void 0:t.unitPrice)??(t==null?void 0:t.unit_price),n.precio),l=typeof(t==null?void 0:t.notas)=="string"?t.notas:void 0,{studentDiscount:c,cleanedNotes:d}=Nd(l);return{item:n,cantidad:o,notas:d,precioUnitario:i,studentDiscount:c}}).filter(t=>t!==null):Array.isArray(e==null?void 0:e.items)?e.items.map(t=>{const s=(t==null?void 0:t.item)??(t==null?void 0:t.menu_item)??(t==null?void 0:t.menuItem)??t;if(!s)return null;const n=Ws(s),a=typeof(t==null?void 0:t.notas)=="string"?t.notas:void 0,{studentDiscount:o,cleanedNotes:i}=Nd(a);return{item:n,cantidad:typeof(t==null?void 0:t.cantidad)=="number"?t.cantidad:Number((t==null?void 0:t.cantidad)??0),notas:i,precioUnitario:typeof(t==null?void 0:t.precioUnitario)=="number"?t.precioUnitario:void 0,studentDiscount:typeof(t==null?void 0:t.studentDiscount)=="boolean"?t.studentDiscount:o}}).filter(t=>t!==null):[],xo=e=>{var Y;const t=xw(e),s=e!=null&&e.timestamp?new Date(e.timestamp):new Date,n=typeof(e==null?void 0:e.id)=="string"&&e.id?e.id:typeof(e==null?void 0:e.order_id)=="string"&&e.order_id?e.order_id:`order-${Math.random().toString(36).slice(2,10)}`,a=po(Xg(e)),o=Ya(fn(uw(e))),i=t.reduce((K,pe)=>K+Za(pe),0),l=wd(i),c=Number((e==null?void 0:e.total)??0),d=Number.isFinite(c)&&c>0,u=i>0?l:d?wd(c):0,h={id:n,numero:typeof(e==null?void 0:e.numero)=="number"?e.numero:Number((e==null?void 0:e.numero)??0),items:t,total:u,estado:(e==null?void 0:e.estado)??"pendiente",timestamp:s,cliente_id:(e==null?void 0:e.cliente_id)??(e==null?void 0:e.clienteId)??void 0,cliente:((Y=e==null?void 0:e.customer)==null?void 0:Y.nombre)??(e==null?void 0:e.cliente)??void 0,metodoPago:a},m=hw(h.id),x=fn(e==null?void 0:e.paymentAllocations),w=o,S=w.length>0,E=m!=null&&m.paymentAllocations?fn(m.paymentAllocations):void 0,y=m?Array.isArray(m.paymentAllocations)&&m.paymentAllocations.length===0:!1;let f=w;S||(E&&E.length>0?f=E:x.length>0?f=x:y&&(f=[])),f.length===0&&a&&(f=[{metodo:a,monto:Math.round(h.total)}]);const g=f.length>0?Ya(f):f,b=cl(g)??a,$=(()=>{const K=(e==null?void 0:e.paymentStatus)??(e==null?void 0:e.payment_status);if(K==="pagado"||K==="pendiente")return K;if(S){const pe=Ls(w),ye=Math.round(h.total);return Math.abs(pe-ye)<=1?"pagado":"pendiente"}})(),A=Math.abs(Ls(g)-Math.round(h.total))<=1?"pagado":"pendiente",B=$??(m==null?void 0:m.paymentStatus)??A;let z;const de=(typeof(e==null?void 0:e.paymentRegisteredAt)=="string"?e.paymentRegisteredAt:void 0)??(typeof(e==null?void 0:e.paid_at)=="string"?e.paid_at:void 0);if(de){const K=new Date(de);Number.isNaN(K.getTime())||(z=K)}else if(m!=null&&m.paymentRegisteredAt){const K=new Date(m.paymentRegisteredAt);Number.isNaN(K.getTime())||(z=K)}!z&&B==="pagado"&&(z=new Date(s));let P;const D=m==null?void 0:m.credit;if(D&&D.type==="empleados"){const K=D.assignedAt?new Date(D.assignedAt):new Date(s),pe=Number.isNaN(K.getTime())?new Date(s):K;P={type:"empleados",amount:Math.round(typeof D.amount=="number"?D.amount:Math.round(h.total)),assignedAt:pe,employeeId:D.employeeId,employeeName:D.employeeName}}return{...h,paymentAllocations:g,paymentStatus:B,creditInfo:P,metodoPago:b,paymentRegisteredAt:z}},Sd=`
  id,
  numero,
  total,
  estado,
  timestamp,
  cliente_id,
  ${Sa.efectivo},
  ${Sa.nequi},
  ${Sa.tarjeta},
  customer:customers ( id, nombre ),
  order_items (
    id,
    cantidad,
    notas,
    menu_item:menu_items (
      id,
      codigo,
      nombre,
      precio,
      descripcion,
      keywords,
      categoria,
      stock,
      inventariocategoria,
      inventariotipo,
      unidadmedida
    )
  )
`,yo=()=>Ye("savia-orders",[]).map(xo),vo=e=>{e.forEach($u),rt("savia-orders",e)},bo=e=>{const t=yo(),s=t.findIndex(n=>n.id===e.id);s>=0?t[s]=e:t.push(e),vo(t)},zs=e=>({id:typeof(e==null?void 0:e.id)=="string"?e.id:`gasto-${Math.random().toString(36).slice(2,10)}`,descripcion:(e==null?void 0:e.descripcion)??"",monto:typeof(e==null?void 0:e.monto)=="number"?e.monto:Number((e==null?void 0:e.monto)??0),categoria:(e==null?void 0:e.categoria)??"",fecha:wt(e==null?void 0:e.fecha),created_at:e!=null&&e.created_at?new Date(e.created_at):void 0,metodoPago:(()=>{const t=vl(Xg(e));return t==="provision_caja"?"efectivo":t})()}),nx=e=>{if(!e)return null;const t=typeof e.codigo=="string"&&e.codigo.trim()?e.codigo.trim():null;if(!t)return null;const s=typeof e.nombre=="string"&&e.nombre.trim()?e.nombre.trim():t,n=typeof e.descripcion=="string"&&e.descripcion.trim()?e.descripcion.trim():void 0,a=vl(e.metodoPago??e.metodo_pago??e.metodo),o=!!(e.esPrincipal??e.es_principal),i=e.created_at??e.createdAt,l=i?new Date(i):void 0;return{codigo:t,nombre:s,descripcion:n,metodoPago:a,esPrincipal:o,created_at:l}},xm={caja_principal:"Caja principal",provision_caja:"Provisión de caja"},yw=e=>({codigo:e.codigo,nombre:e.nombre,descripcion:e.descripcion??null,metodoPago:e.metodoPago,esPrincipal:e.esPrincipal,created_at:e.created_at?e.created_at.toISOString():null}),rx=(e,t)=>e.esPrincipal&&!t.esPrincipal?-1:!e.esPrincipal&&t.esPrincipal?1:e.nombre.localeCompare(t.nombre,"es"),ax=()=>(Ye(Hg,[])??[]).map(nx).filter(t=>t!==null).sort(rx),vw=e=>{const t=e.map(yw);rt(Hg,t)},bw=e=>nx({codigo:e==null?void 0:e.codigo,nombre:e==null?void 0:e.nombre,descripcion:e==null?void 0:e.descripcion,metodoPago:e==null?void 0:e.metodo_pago,esPrincipal:e==null?void 0:e.es_principal,created_at:e==null?void 0:e.created_at}),ox=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("caja_bolsillos").select("codigo, nombre, descripcion, metodo_pago, es_principal, created_at").order("es_principal",{ascending:!1}).order("nombre",{ascending:!0});if(t)throw t;const s=(e??[]).map(bw).filter(n=>n!==null).sort(rx);return vw(s),s}catch(e){console.warn("[dataService] No se pudieron obtener los bolsillos de caja desde Supabase.",e)}return ax()},qe=e=>typeof e=="string"&&e.trim()?e.trim():void 0,bl=["efectivo","nequi","tarjeta"],ix=e=>{if(!e)return null;const t=Math.max(0,Math.round(Number(e.monto)||0));if(t<=0)return null;const s=wt(e.fecha);if(!(s instanceof Date)||Number.isNaN(s.getTime()))return null;const n=qe(e.id)??`transfer-${Math.random().toString(36).slice(2,10)}`,a=qe(e.descripcion),o=Ou(qe(e.origen)??qe(e.origenMetodo)??qe(e.metodo_origen)??qe(e.metodo)),i=o&&bl.includes(o)?o:"efectivo",l=qe(e.bolsilloOrigen)??qe(e.bolsillo_origen),c=qe(e.bolsilloDestino)??qe(e.bolsillo_destino),d=qe(e.origenNombre)??qe(e.origen_nombre),u=qe(e.destinoNombre)??qe(e.destino_nombre),h=qe(e.destinoMetodo)??qe(e.destino_metodo)??qe(e.destinoMetodoPago)??qe(e.destino_metodo_pago),m=po(h)??void 0,x=e.created_at??e.createdAt,w=x?new Date(x):void 0;return{id:n,monto:t,descripcion:a,fecha:s,origen:i,created_at:w,bolsilloOrigen:l,bolsilloDestino:c,origenNombre:d,destinoNombre:u,destinoMetodo:m}},jw=e=>({id:e.id,monto:e.monto,descripcion:e.descripcion??null,fecha:Be(e.fecha instanceof Date?e.fecha:new Date(e.fecha)),origen:e.origen,bolsilloOrigen:e.bolsilloOrigen??null,bolsilloDestino:e.bolsilloDestino??null,origenNombre:e.origenNombre??null,destinoNombre:e.destinoNombre??null,destinoMetodo:e.destinoMetodo??null,created_at:e.created_at?e.created_at.toISOString():new Date().toISOString()}),so=()=>(Ye(Bg,[])??[]).map(ix).filter(s=>s!==null).sort(Fi),zi=e=>{const t=e.map(jw);rt(Bg,t)},Fi=(e,t)=>{var s,n;return t.fecha.getTime()-e.fecha.getTime()||(((s=t.created_at)==null?void 0:s.getTime())??0)-(((n=e.created_at)==null?void 0:n.getTime())??0)},lx=`
  id,
  fecha,
  monto,
  descripcion,
  bolsillo_origen,
  bolsillo_destino,
  created_at,
  origen_bolsillo:caja_bolsillos!caja_transferencias_bolsillo_origen_fkey (codigo, nombre, metodo_pago),
  destino_bolsillo:caja_bolsillos!caja_transferencias_bolsillo_destino_fkey (codigo, nombre, metodo_pago)
`,cx=e=>{var n,a,o,i,l,c,d,u,h;if(!e)return null;const t=ix({id:e.id,monto:e.monto,descripcion:e.descripcion,fecha:e.fecha,origen:((n=e.origen_bolsillo)==null?void 0:n.metodo_pago)??e.origen??e.metodo_pago??"efectivo",created_at:e.created_at,bolsillo_origen:e.bolsillo_origen,bolsillo_destino:e.bolsillo_destino,origen_nombre:(a=e.origen_bolsillo)==null?void 0:a.nombre,destino_nombre:(o=e.destino_bolsillo)==null?void 0:o.nombre,destino_metodo:(i=e.destino_bolsillo)==null?void 0:i.metodo_pago});if(!t)return null;const s=bl.includes(t.origen)?t.origen:"efectivo";return{...t,origen:s,bolsilloOrigen:t.bolsilloOrigen??qe((l=e.origen_bolsillo)==null?void 0:l.codigo)??qe(e.bolsillo_origen),bolsilloDestino:t.bolsilloDestino??qe((c=e.destino_bolsillo)==null?void 0:c.codigo)??qe(e.bolsillo_destino),origenNombre:t.origenNombre??qe((d=e.origen_bolsillo)==null?void 0:d.nombre),destinoNombre:t.destinoNombre??qe((u=e.destino_bolsillo)==null?void 0:u.nombre),destinoMetodo:t.destinoMetodo??po((h=e.destino_bolsillo)==null?void 0:h.metodo_pago)??void 0}},nc=()=>({efectivo:0,tarjeta:0,nequi:0,provision_caja:0,credito_empleados:0}),ww=e=>{const t=new Map;e.forEach(n=>{var l,c;const a=typeof n.order_id=="string"?n.order_id:void 0;if(!a)return;const o=Math.max(0,Math.round(Number(n.monto)||0));if(o<=0)return;let i=t.get(a);if(i||(i={amount:0},t.set(a,i)),n.tipo==="cargo"){i.amount+=o;const d=typeof n.timestamp=="string"?n.timestamp:void 0;if(d){const m=i.assignedAt?new Date(i.assignedAt).getTime():Number.NEGATIVE_INFINITY,x=new Date(d).getTime();!Number.isNaN(x)&&x>=m&&(i.assignedAt=d)}const u=typeof n.empleado_id=="string"?n.empleado_id:((l=n.empleado)==null?void 0:l.id)??void 0;u&&(i.employeeId=u);const h=((c=n.empleado)==null?void 0:c.nombre)??n.empleado_nombre??void 0;h&&(i.employeeName=h)}else n.tipo==="abono"&&(i.amount-=o,i.amount<0&&(i.amount=0))});const s=new Map;return t.forEach((n,a)=>{n.amount>0&&s.set(a,n)}),s},Nw=async e=>{if(e.length===0)return e;const t=e.map(s=>s.id).filter(s=>typeof s=="string"&&s.length>0);if(t.length===0)return e;try{const{data:s,error:n}=await Ne.from("employee_credit_history").select(`
        order_id,
        order_numero,
        monto,
        tipo,
        timestamp,
        empleado_id,
        empleado:empleados ( id, nombre )
      `).in("order_id",t).order("timestamp",{ascending:!0});if(n)throw n;const a=ww(s??[]);return e.map(o=>{var d;const i=a.get(o.id);if(!i)return o.creditInfo&&o.metodoPago==="credito_empleados"?{...o,creditInfo:void 0,metodoPago:o.metodoPago==="credito_empleados"&&((d=o.paymentAllocations)!=null&&d.length)?cl(o.paymentAllocations)??o.metodoPago:o.metodoPago}:o;const l=i.assignedAt?new Date(i.assignedAt):o.timestamp,c=Number.isNaN(l.getTime())?o.timestamp:l;return{...o,metodoPago:"credito_empleados",paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,creditInfo:{type:"empleados",amount:i.amount,assignedAt:c,employeeId:i.employeeId,employeeName:i.employeeName}}})}catch(s){return console.warn("[dataService] No se pudo obtener el estado de créditos de empleados.",s),e}},kw=(e,t,s)=>{const n=new Map,a=d=>{let u=n.get(d);return u||(u={ingresosTotales:0,egresosTotales:0,ingresosPorMetodo:nc(),egresosPorMetodo:nc()},n.set(d,u)),u};e.forEach(d=>{if(mg(d)!=="pagado")return;const u=$i(d);if(Number.isNaN(u.getTime()))return;const h=li(u);if(!h)return;const m=a(h),x=jn(d);if(x.length===0)return;const w=Ls(x);m.ingresosTotales+=w,x.forEach(({metodo:S,monto:E})=>{m.ingresosPorMetodo[S]+=E})}),t.forEach(d=>{const u=new Date(d.fecha);if(Number.isNaN(u.getTime()))return;const h=li(u);if(!h)return;const m=a(h),x=vl(d.metodoPago);m.egresosTotales+=d.monto,m.egresosPorMetodo[x]+=d.monto}),s.forEach(d=>{if(!(d.fecha instanceof Date))return;const u=li(d.fecha);if(!u)return;const h=a(u),m=bl.includes(d.origen)?d.origen:"efectivo",x=d.destinoMetodo&&zg.includes(d.destinoMetodo)?d.destinoMetodo:void 0;if(d.bolsilloDestino==="provision_caja"){h.ingresosPorMetodo.provision_caja+=d.monto,h.egresosPorMetodo[m]!==void 0&&(h.egresosPorMetodo[m]+=d.monto);return}if(d.bolsilloOrigen==="provision_caja"){h.egresosPorMetodo.provision_caja+=d.monto,x&&h.ingresosPorMetodo[x]!==void 0&&(h.ingresosPorMetodo[x]+=d.monto);return}h.egresosPorMetodo[m]!==void 0&&(h.egresosPorMetodo[m]+=d.monto),x&&h.ingresosPorMetodo[x]!==void 0&&(h.ingresosPorMetodo[x]+=d.monto)});const o=Array.from(n.keys()).sort();if(o.length===0)return[];const i=[];let l=0,c=nc();return o.forEach(d=>{const u=n.get(d),h=u.ingresosPorMetodo.efectivo-u.egresosPorMetodo.efectivo,m=u.ingresosPorMetodo.nequi-u.egresosPorMetodo.nequi,x=u.ingresosPorMetodo.tarjeta-u.egresosPorMetodo.tarjeta,w=u.ingresosPorMetodo.provision_caja-u.egresosPorMetodo.provision_caja,S=u.ingresosPorMetodo.credito_empleados-u.egresosPorMetodo.credito_empleados,E=u.ingresosTotales-u.egresosTotales;l+=E,c={efectivo:c.efectivo+h,tarjeta:c.tarjeta+x,nequi:c.nequi+m,provision_caja:c.provision_caja+w,credito_empleados:c.credito_empleados+S},i.push({fecha:d,ingresosTotales:u.ingresosTotales,egresosTotales:u.egresosTotales,balanceDiario:E,ingresosEfectivo:u.ingresosPorMetodo.efectivo,egresosEfectivo:u.egresosPorMetodo.efectivo,ingresosNequi:u.ingresosPorMetodo.nequi,egresosNequi:u.egresosPorMetodo.nequi,ingresosTarjeta:u.ingresosPorMetodo.tarjeta,egresosTarjeta:u.egresosPorMetodo.tarjeta,ingresosProvisionCaja:u.ingresosPorMetodo.provision_caja,egresosProvisionCaja:u.egresosPorMetodo.provision_caja,saldoEfectivoDia:h,saldoNequiDia:m,saldoTarjetaDia:x,saldoProvisionCajaDia:w,saldoTotalAcumulado:l,saldoEfectivoAcumulado:c.efectivo,saldoNequiAcumulado:c.nequi,saldoTarjetaAcumulado:c.tarjeta,saldoProvisionCajaAcumulado:c.provision_caja})}),i.sort((d,u)=>d.fecha<u.fecha?1:d.fecha>u.fecha?-1:0)},Sw=e=>({fecha:li(e==null?void 0:e.fecha)||String((e==null?void 0:e.fecha)??""),ingresosTotales:Number(e.ingresos_totales??0),egresosTotales:Number(e.egresos_totales??0),balanceDiario:Number(e.balance_diario??0),ingresosEfectivo:Number(e.ingresos_efectivo??0),egresosEfectivo:Number(e.egresos_efectivo??0),ingresosNequi:Number(e.ingresos_nequi??0),egresosNequi:Number(e.egresos_nequi??0),ingresosTarjeta:Number(e.ingresos_tarjeta??0),egresosTarjeta:Number(e.egresos_tarjeta??0),ingresosProvisionCaja:Number(e.ingresos_provision_caja??e.ingresos_provision??0),egresosProvisionCaja:Number(e.egresos_provision_caja??e.egresos_provision??0),saldoEfectivoDia:Number(e.saldo_efectivo_dia??0),saldoNequiDia:Number(e.saldo_nequi_dia??0),saldoTarjetaDia:Number(e.saldo_tarjeta_dia??0),saldoProvisionCajaDia:Number(e.saldo_provision_caja_dia??0),saldoTotalAcumulado:Number(e.saldo_total_acumulado??0),saldoEfectivoAcumulado:Number(e.saldo_efectivo_acumulado??0),saldoNequiAcumulado:Number(e.saldo_nequi_acumulado??0),saldoTarjetaAcumulado:Number(e.saldo_tarjeta_acumulado??0),saldoProvisionCajaAcumulado:Number(e.saldo_provision_caja_acumulado??0)}),rc=e=>{e&&console.warn(`[dataService] Usando datos locales porque: ${e}.`);const s=Ye("savia-menuItems",[]).map(Ws);return console.info(`[dataService] Loaded ${s.length} menu items from local cache.`),s.length===0&&console.warn("[dataService] Local cache does not contain any menu items."),s},_w=async()=>{if(console.info("[dataService] Fetching menu items…"),await Ce())try{const{data:e,error:t}=await Ne.from("menu_items").select("*").order("nombre");if(t)throw t;const s=(e||[]).map(Ws);return s.length>0?(console.info(`[dataService] Supabase returned ${s.length} menu items.`),rt("savia-menuItems",s),s):(console.warn("[dataService] Supabase returned 0 menu items. Falling back to local cache."),rc("Supabase devolvió una lista vacía"))}catch(e){return console.error("[dataService] Supabase menu fetch failed. Falling back to local cache.",e),rc("hubo un error consultando Supabase")}return console.warn("[dataService] Supabase no está disponible. Usando datos locales."),rc()},Cw=async e=>{const t=go(e);if(await Ce())try{const{data:a,error:o}=await Ne.from("menu_items").insert([sx(t)]).select("*").single();if(o)throw o;return Ws(a)}catch(a){console.warn("Supabase not available, using local data:",a)}const n=[...Ye("savia-menuItems",[]).map(Ws),t];return rt("savia-menuItems",n),t},Ew=async e=>{const t=go(e);if(await Ce())try{const{data:a,error:o}=await Ne.from("menu_items").update(sx(t)).eq("id",t.id).select("*").single();if(o)throw o;return Ws(a)}catch(a){console.warn("Supabase not available, using local data:",a)}const n=Ye("savia-menuItems",[]).map(Ws).map(a=>a.id===t.id?t:a);return rt("savia-menuItems",n),t},Tw=async e=>{if(await Ce())try{const{error:n}=await Ne.from("menu_items").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-menuItems",[]).map(Ws).filter(n=>n.id!==e);rt("savia-menuItems",s)},Mw=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("orders").select(Sd).order("timestamp",{ascending:!1});if(t)throw t;let s=(e||[]).map(xo);return s=await Nw(s),vo(s),s}catch(e){console.warn("Supabase not available, using local data:",e)}return yo()},Pw=async(e={})=>{if(!await Ce())return()=>{};const{onChange:t,debounceMs:s=250}=e;if(!t)return()=>{};let n;const a=()=>{n&&clearTimeout(n),n=setTimeout(()=>{t()},s)},o=Ne.channel("orders-sync").on("postgres_changes",{event:"*",schema:"public",table:"orders"},a).on("postgres_changes",{event:"*",schema:"public",table:"order_items"},a);let i;try{i=await o.subscribe()}catch(l){return console.warn("No se pudo suscribir a cambios de comandas en Supabase:",l),n&&clearTimeout(n),()=>{}}return()=>{n&&clearTimeout(n),i==null||i.unsubscribe()}},Dw=async e=>{const t=e.items.map(u=>({...u,item:go(u.item),precioUnitario:typeof u.precioUnitario=="number"?u.precioUnitario:u.item.precio})),s=fn(e.paymentAllocations??[]),n=e.paymentStatus??(Math.abs(Ls(s)-Math.round(e.total))<=1?"pagado":"pendiente"),a=s.length>0?s[0].metodo:void 0,o=vl(e.metodoPago??a),i={...e,items:t,metodoPago:o,paymentAllocations:s,paymentStatus:n};$u(i);const l=Iu(s);if(await Ce())try{const{data:u,error:h}=await Ne.from("orders").insert([{id:i.id,numero:i.numero,total:i.total,estado:i.estado,timestamp:i.timestamp.toISOString(),cliente_id:i.cliente_id??null,...l}]).select("*").single();if(h)throw h;if(i.items.length>0){const x=i.items.map(S=>({order_id:u.id,menu_item_id:S.item.id,cantidad:S.cantidad,notas:Lg(S.notas,S.studentDiscount??!1)??null})),{error:w}=await Ne.from("order_items").insert(x);if(w)throw await Ne.from("orders").delete().eq("id",u.id),w}const m={...i,id:u.id,timestamp:new Date(u.timestamp),cliente_id:u.cliente_id??void 0,metodoPago:cl(s)??i.metodoPago};return bo(m),m}catch(u){console.warn("Supabase not available, using local data:",u)}const d=[...yo(),i];return vo(d),i},Ow=async(e,t)=>{const s=Ya(fn(t));if(s.length===0)throw new Error("Debe seleccionar al menos un método de pago.");const n=Ls(s),a=Math.round(e.total),o=Math.abs(n-a)<=1?"pagado":"pendiente",i=cl(s)??e.metodoPago??"efectivo",l=s.filter(h=>h.metodo==="credito_empleados"&&h.empleadoId);for(const h of l)await Jg({empleadoId:h.empleadoId,monto:h.monto,orderId:e.id,orderNumero:e.numero});if(await Ce())try{const h=Iu(s),{error:m}=await Ne.from("orders").update(h).eq("id",e.id);if(m)throw m}catch(h){console.warn("Supabase not available, using local data:",h)}const d=o==="pagado"?new Date:e.paymentRegisteredAt,u={...e,metodoPago:i,paymentAllocations:s,paymentStatus:o,paymentRegisteredAt:d,creditInfo:o==="pagado"?void 0:e.creditInfo};return $u(u),bo(u),u},Iw=async(e,t)=>{var u,h;const s=Math.max(0,Math.round((t==null?void 0:t.amount)??e.total)),n=new Date,a=(u=t==null?void 0:t.employeeId)==null?void 0:u.trim(),o=a||void 0,i=(h=t==null?void 0:t.employeeName)==null?void 0:h.trim(),l=i||void 0;o&&s>0&&await Jg({empleadoId:o,monto:s,orderId:e.id,orderNumero:e.numero});const c={type:"empleados",amount:s,assignedAt:n.toISOString(),employeeId:o,employeeName:l};if(e.estado!=="entregado"&&await Ce())try{const{error:m}=await Ne.from("orders").update({estado:"entregado"}).eq("id",e.id);if(m)throw m}catch(m){console.warn("Supabase not available al marcar crédito, se usará caché local:",m)}to(e.id,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,credit:c});const d={...e,estado:"entregado",metodoPago:"credito_empleados",paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0,creditInfo:{type:"empleados",amount:s,assignedAt:n,employeeId:o,employeeName:l}};return bo(d),d},Aw=e=>["nequi","tarjeta"].includes(e)?e:"efectivo",$w=async(e,t)=>{if(!e.creditInfo)throw new Error("La orden no tiene un crédito de empleados pendiente.");const s=Math.max(0,Math.round(e.creditInfo.amount??e.total)),n=e.creditInfo.employeeId,a=Aw(t.metodo);n&&s>0&&await cw({empleadoId:n,monto:s,orderId:e.id,orderNumero:e.numero});const o=s>0?[{metodo:a,monto:s}]:[],i=new Date;if(await Ce())try{const c={estado:"entregado",...Iu(o)},{error:d}=await Ne.from("orders").update(c).eq("id",e.id);if(d)throw d}catch(c){console.warn("Supabase no disponible al registrar el pago del crédito, se usará caché local:",c)}to(e.id,{paymentStatus:"pagado",paymentAllocations:o,paymentRegisteredAt:i.toISOString(),credit:null});const l={...e,estado:"entregado",metodoPago:a,paymentStatus:"pagado",paymentAllocations:o,paymentRegisteredAt:i,creditInfo:void 0};return bo(l),l},Rw=async(e,t)=>{const s=yo();if(await Ce())try{const{data:o,error:i}=await Ne.from("orders").update({estado:t}).eq("id",e.id).select(Sd).maybeSingle();if(i)throw i;let l=o;if(!l&&typeof e.numero=="number"){const{data:c,error:d}=await Ne.from("orders").update({estado:t}).eq("numero",e.numero).select(Sd).maybeSingle();if(d)throw d;l=c??void 0}if(l){const c=xo(l);return bo(c),c}console.warn(`[dataService] No se encontró la orden ${e.id} en Supabase. Se usará la caché local.`)}catch(o){console.warn("Supabase not available, using local data:",o)}const n=s.findIndex(o=>o.id===e.id);if(n===-1)throw new Error(`No se encontró la orden con id ${e.id} para actualizar su estado.`);const a={...s[n],estado:t};return s[n]=a,vo(s),a},Lw=async(e,t)=>{if(await Ce())try{if(t.total!==void 0){const{error:a}=await Ne.from("orders").update({total:t.total}).eq("id",e);if(a)throw a}if(t.items){const{error:a}=await Ne.from("order_items").delete().eq("order_id",e);if(a)throw a;if(t.items.length>0){const o=t.items.map(l=>({order_id:e,menu_item_id:l.item.id,cantidad:l.cantidad,notas:Lg(l.notas,l.studentDiscount??!1)??null})),{error:i}=await Ne.from("order_items").insert(o);if(i)throw i}}to(e,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0});return}catch(a){console.warn("Supabase not available, using local data:",a)}const n=Ye("savia-orders",[]).map(xo).map(a=>a.id===e?{...a,...t.items&&{items:t.items},...t.total!==void 0&&{total:t.total}}:a);rt("savia-orders",n),to(e,{paymentStatus:"pendiente",paymentAllocations:[],paymentRegisteredAt:void 0})},zw=async e=>{if(await Ce())try{const{error:s}=await Ne.from("order_items").delete().eq("order_id",e);if(s)throw s;const{error:n}=await Ne.from("orders").delete().eq("id",e);if(n)throw n}catch(s){console.warn("Supabase not available, using local data:",s)}mw(e);const t=yo().filter(s=>s.id!==e);vo(t)},Fw=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("customers").select("*");if(t)throw t;return e||[]}catch(e){console.warn("Supabase not available, using local data:",e)}return Ye("savia-customers",[])},Uw=async e=>{if(await Ce())try{const{data:n,error:a}=await Ne.from("customers").insert([e]).select().single();if(a)throw a;return n}catch(n){console.warn("Supabase not available, using local data:",n)}const s=[...Ye("savia-customers",[]),e];return rt("savia-customers",s),e},Bw=async e=>{if(await Ce())try{const{error:n}=await Ne.from("customers").update(e).eq("id",e.id);if(n)throw n;return e}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-customers",[]).map(n=>n.id===e.id?e:n);return rt("savia-customers",s),e},Hw=async e=>{if(await Ce())try{const{error:n}=await Ne.from("customers").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-customers",[]).filter(n=>n.id!==e);rt("savia-customers",s)},Ww=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("empleados").select("*").order("nombre");if(t)throw t;return e||[]}catch(e){console.warn("Supabase not available, using local data:",e)}return Ye("savia-empleados",[])},qw=async e=>{if(await Ce())try{const{data:n,error:a}=await Ne.from("empleados").insert([e]).select().single();if(a)throw a;return n}catch(n){console.warn("Supabase not available, using local data:",n)}const s=[...Ye("savia-empleados",[]),e];return rt("savia-empleados",s),e},Vw=async e=>{if(await Ce())try{const{error:n}=await Ne.from("empleados").update(e).eq("id",e.id);if(n)throw n;return e}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-empleados",[]).map(n=>n.id===e.id?e:n);return rt("savia-empleados",s),e},Gw=async e=>{if(await Ce())try{const{error:n}=await Ne.from("empleados").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-empleados",[]).filter(n=>n.id!==e);rt("savia-empleados",s)},Kw=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("empleados").select("id, horario_base");if(t)throw t;const s={};for(const n of e??[]){const a=typeof(n==null?void 0:n.id)=="string"?n.id:void 0;if(!a)continue;const o=Vg(n==null?void 0:n.horario_base);o&&(s[a]=o)}if(Object.keys(s).length>0)return s}catch(e){console.warn("Supabase not available, using local data:",e)}return Qg()},Qw=async(e,t)=>{const s=Gg(t);let n=null;if(await Ce())try{const{error:a}=await Ne.from("empleados").update({horario_base:s}).eq("id",e);if(a)throw a}catch(a){console.error("Error updating employee base schedule in Supabase:",a),n=a}if(tw(e,s),n)throw n},Yw=async e=>{if(await Ce())try{const{data:n,error:a}=await Ne.from("employee_weekly_hours").select("empleado_id, week_key, horas").eq("week_key",e);if(a)throw a;const o={};for(const i of n??[]){const l=typeof(i==null?void 0:i.empleado_id)=="string"?i.empleado_id:void 0,c=typeof(i==null?void 0:i.week_key)=="string"?i.week_key:void 0;if(!l||c!==e)continue;const d=Vn(i==null?void 0:i.horas);d&&(o[l]=d)}if(Object.keys(o).length>0)return o}catch(n){console.warn("Supabase not available, using local data:",n)}const t=pl(),s={};return Object.entries(t).forEach(([n,a])=>{const o=Vn(a==null?void 0:a[e]);o&&(s[n]=o)}),s},Jw=async(e,t)=>{var n;if(await Ce())try{const{data:a,error:o}=await Ne.from("employee_weekly_hours").select("horas").eq("empleado_id",e).eq("week_key",t).maybeSingle();if(o)throw o;const i=Vn(a==null?void 0:a.horas);if(i)return i}catch(a){console.warn("Supabase not available, using local data:",a)}const s=pl();return Vn((n=s==null?void 0:s[e])==null?void 0:n[t])},Xw=async e=>{if(await Ce())try{const{data:a,error:o}=await Ne.from("employee_weekly_hours").select("week_key, horas").eq("empleado_id",e).order("week_key",{ascending:!1});if(o)throw o;const i={};for(const l of a??[]){const c=typeof(l==null?void 0:l.week_key)=="string"?l.week_key:void 0;if(!c)continue;const d=Vn(l==null?void 0:l.horas);d&&(i[c]=d)}if(Object.keys(i).length>0)return i}catch(a){console.warn("Supabase not available, using local data:",a)}const t=pl(),s=t==null?void 0:t[e];if(!s)return{};const n={};return Object.entries(s).forEach(([a,o])=>{const i=Vn(o);i&&(n[a]=i)}),n},Zw=async(e,t,s)=>{const n=Kg(s);let a=null;if(await Ce())try{const{error:o}=await Ne.from("employee_weekly_hours").upsert({empleado_id:e,week_key:t,horas:n},{onConflict:"empleado_id,week_key"});if(o)throw o}catch(o){console.error("Error saving weekly hours in Supabase:",o),a=o}if(sw(e,t,n),a)throw a},_d=e=>[...e].sort((t,s)=>{const n=t.fecha.localeCompare(s.fecha);if(n!==0)return n;const a=t.horaLlegada??"",o=s.horaLlegada??"";return a.localeCompare(o)}),dx=async(e,t,s={})=>{var i;const n=eo(e),a=eo(t);if(!n||!a)return[];const o=((i=s.empleadoId)==null?void 0:i.trim())||void 0;if(await Ce())try{let l=Ne.from("employee_shifts").select("*").gte("fecha",n).lte("fecha",a).order("fecha",{ascending:!0}).order("hora_llegada",{ascending:!0});o&&(l=l.eq("empleado_id",o));const{data:c,error:d}=await l;if(d)throw d;const u=(c??[]).map(fo).filter(h=>!!h);return u.length>0&&xl(u),_d(u)}catch(l){console.warn("Supabase no disponible al obtener turnos, usando caché local:",l)}return rw(n,a,{empleadoId:o})},e1=async(e,t={})=>{const s=eo(e);return s?dx(s,s,t):[]},t1=async(e={})=>{var a;const t=e.date?eo(e.date):null,s=((a=e.empleadoId)==null?void 0:a.trim())||void 0;if(await Ce())try{let o=Ne.from("employee_shifts").select("*").is("hora_salida",null).order("fecha",{ascending:!0}).order("hora_llegada",{ascending:!0});t&&(o=o.eq("fecha",t)),s&&(o=o.eq("empleado_id",s));const{data:i,error:l}=await o;if(l)throw l;const c=(i??[]).map(fo).filter(d=>!!d);return c.length>0&&xl(c),_d(c)}catch(o){console.warn("Supabase no disponible al obtener turnos activos, usando caché local:",o)}const n=gl();return _d(Object.values(n).filter(o=>!(o.horaSalida||t&&o.fecha!==t||s&&o.empleadoId!==s)))},s1=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n=new Date(s.getTime());n.setHours(0,0,0,0);const a=Be(n),o=yl(s);let i=null;if(await Ce())try{const{data:l,error:c}=await Ne.from("employee_shifts").insert([{empleado_id:e,fecha:a,hora_llegada:o}]).select("*").single();if(c)throw c;i=fo(l)}catch(l){console.warn("Supabase no disponible al crear turno, usando caché local:",l)}if(!i){const l=new Date().toISOString();i={id:aw(),empleadoId:e,fecha:a,horaLlegada:o,horaSalida:null,novedad:!1,novedadInicio:null,novedadFin:null,horasTrabajadas:0,createdAt:l,updatedAt:l}}return xl(i),i},jl=async(e,t,s)=>{let n=null;if(await Ce())try{const a=ow(t),{data:o,error:i}=await Ne.from("employee_shifts").update(a).eq("id",e).select("*").single();if(i)throw i;n=fo(o)}catch(a){console.warn(s,a)}return n||(n=nw(e,t)),n&&xl(n),n},n1=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={horaSalida:yl(s)};return jl(e,n,"Supabase no disponible al cerrar turno, usando caché local:")},r1=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={novedad:!0,novedadInicio:yl(s),novedadFin:null};return jl(e,n,"Supabase no disponible al iniciar novedad, usando caché local:")},a1=async(e,t={})=>{const s=t.timestamp?new Date(t.timestamp.getTime()):new Date,n={novedad:!0,novedadFin:yl(s)};return jl(e,n,"Supabase no disponible al finalizar novedad, usando caché local:")},o1=async e=>jl(e,{novedad:!1,novedadInicio:null,novedadFin:null},"Supabase no disponible al limpiar novedad, usando caché local:"),i1=async(e={})=>{if(!await Ce())return()=>{};const{onChange:t,empleadoId:s,debounceMs:n=250}=e;if(!t)return()=>{};let a;const o=()=>{a&&clearTimeout(a),a=setTimeout(()=>{t()},n)},i={event:"*",schema:"public",table:"employee_shifts"};s&&(i.filter=`empleado_id=eq.${s}`);const l=Ne.channel(`employee-shifts-${s??"all"}`).on("postgres_changes",i,o);let c;try{c=await l.subscribe()}catch(d){return console.warn("No se pudo suscribir a cambios de turnos en Supabase:",d),a&&clearTimeout(a),()=>{}}return()=>{a&&clearTimeout(a),c==null||c.unsubscribe()}},l1=async()=>{if(await Ce())try{const{data:t,error:s}=await Ne.from("gastos").select("*").order("fecha",{ascending:!1});if(s)throw s;return(t||[]).map(zs)}catch(t){console.warn("Supabase not available, using local data:",t)}return Ye("savia-gastos",[]).map(zs)},c1=async e=>{const s={...zs(e)};if(await Ce())try{const o=Be(s.fecha instanceof Date?s.fecha:new Date(s.fecha)),{data:i,error:l}=await Ne.from("gastos").insert([{id:s.id,descripcion:s.descripcion,monto:s.monto,categoria:s.categoria,fecha:o,created_at:s.created_at instanceof Date?s.created_at.toISOString():s.created_at??new Date().toISOString(),[Zg]:s.metodoPago}]).select("*").single();if(l)throw l;return zs(i)}catch(o){console.warn("Supabase not available, using local data:",o)}const a=[...Ye("savia-gastos",[]).map(zs),s];return rt("savia-gastos",a),s},d1=async e=>{const s={...zs(e)};if(await Ce())try{const o=Be(s.fecha instanceof Date?s.fecha:new Date(s.fecha)),{error:i}=await Ne.from("gastos").update({descripcion:s.descripcion,monto:s.monto,categoria:s.categoria,fecha:o,[Zg]:s.metodoPago}).eq("id",s.id);if(i)throw i;return s}catch(o){console.warn("Supabase not available, using local data:",o)}const a=Ye("savia-gastos",[]).map(zs).map(o=>o.id===s.id?s:o);return rt("savia-gastos",a),s},u1=async e=>{if(await Ce())try{const{error:n}=await Ne.from("gastos").delete().eq("id",e);if(n)throw n;return}catch(n){console.warn("Supabase not available, using local data:",n)}const s=Ye("savia-gastos",[]).map(zs).filter(n=>n.id!==e);rt("savia-gastos",s)},h1=async()=>{if(await Ce())try{const{data:e,error:t}=await Ne.from("caja_transferencias").select(lx).order("fecha",{ascending:!1}).order("created_at",{ascending:!1});if(t)throw t;const s=(e??[]).map(cx).filter(n=>n!==null).filter(n=>!n.bolsilloOrigen&&!n.bolsilloDestino?!0:n.bolsilloDestino==="provision_caja"||n.bolsilloOrigen==="provision_caja").sort(Fi);return zi(s),s}catch(e){console.warn("[dataService] No se pudo obtener las provisiones desde Supabase.",e)}return so().filter(e=>!e.bolsilloOrigen&&!e.bolsilloDestino?!0:e.bolsilloDestino==="provision_caja"||e.bolsilloOrigen==="provision_caja")},m1=async e=>{var g;const t=Math.max(0,Math.round(Number(e.monto)||0));if(t<=0)throw new Error("El monto de la provisión debe ser mayor a cero.");const s=e.fecha instanceof Date?new Date(e.fecha.getTime()):new Date(e.fecha);if(Number.isNaN(s.getTime()))throw new Error("La fecha del movimiento de provisión no es válida.");s.setHours(0,0,0,0);const n=((g=e.descripcion)==null?void 0:g.trim())||void 0,a=await Ce(),o=qe(e.bolsilloOrigen)??"caja_principal",i=qe(e.bolsilloDestino)??"provision_caja";if(o===i)throw new Error("Selecciona bolsillos diferentes para origen y destino.");let l=ax(),c=l.find(b=>b.codigo===o),d=l.find(b=>b.codigo===i);if((!c||!d)&&a)try{l=await ox(),c=l.find(b=>b.codigo===o)??c,d=l.find(b=>b.codigo===i)??d}catch(b){console.warn("[dataService] No se pudieron refrescar los bolsillos antes de crear la transferencia.",b)}const u=Ou(e.origenMetodo??e.origen??(c==null?void 0:c.metodoPago)),h=u&&bl.includes(u)?u:"efectivo",m=po(e.destinoMetodo??(d==null?void 0:d.metodoPago)??void 0)??void 0,x=qe(e.origenNombre)??(c==null?void 0:c.nombre)??xm[o]??o,w=qe(e.destinoNombre)??(d==null?void 0:d.nombre)??xm[i]??i;if(a)try{const{data:b,error:$}=await Ne.from("caja_transferencias").insert({fecha:Be(s),monto:t,descripcion:n??null,bolsillo_origen:o,bolsillo_destino:i}).select(lx).single();if($)throw $;const A=cx(b);if(A){const B=so().filter(z=>z.id!==A.id);return zi([A,...B].sort(Fi)),A}}catch(b){console.warn("[dataService] No se pudo registrar la provisión en Supabase. Usando modo local.",b)}const E={id:e.id&&e.id.trim()?e.id.trim():typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`transfer-${Math.random().toString(36).slice(2,10)}`,monto:t,descripcion:n,fecha:s,origen:h,created_at:new Date,bolsilloOrigen:o,bolsilloDestino:i,origenNombre:x,destinoNombre:w,destinoMetodo:m},y=so(),f=[E,...y].sort(Fi);return zi(f),E},f1=async e=>{if(!e)return;if(await Ce()){const{error:n}=await Ne.from("caja_transferencias").delete().eq("id",e);if(n)throw n}const s=so().filter(n=>n.id!==e);zi(s)},p1=async()=>{if(await Ce())try{const{data:n,error:a}=await Ne.from("balance_caja").select("*").order("fecha",{ascending:!1});if(a)throw a;return(n||[]).map(Sw)}catch(n){console.warn("Supabase not available, using local data:",n)}const e=Ye("savia-orders",[]).map(xo),t=Ye("savia-gastos",[]).map(zs),s=so();return kw(e,t,s)},xe={fetchMenuItems:_w,createMenuItem:Cw,updateMenuItem:Ew,deleteMenuItem:Tw,fetchOrders:Mw,subscribeToOrders:Pw,createOrder:Dw,recordOrderPayment:Ow,assignOrderCredit:Iw,settleOrderEmployeeCredit:$w,updateOrder:Lw,deleteOrder:zw,updateOrderStatus:Rw,fetchCustomers:Fw,createCustomer:Uw,updateCustomer:Bw,deleteCustomer:Hw,fetchEmpleados:Ww,createEmpleado:qw,updateEmpleado:Vw,deleteEmpleado:Gw,fetchEmployeeBaseSchedules:Kw,saveEmployeeBaseSchedule:Qw,fetchEmployeeWeeklyHours:Jw,fetchEmployeeWeeklyHoursForWeek:Yw,fetchEmployeeWeeklyHoursHistory:Xw,saveEmployeeWeeklyHours:Zw,fetchEmployeeShiftsBetween:dx,fetchEmployeeShiftsForDate:e1,fetchActiveEmployeeShifts:t1,startEmployeeShift:s1,completeEmployeeShift:n1,startEmployeeShiftNovelty:r1,finishEmployeeShiftNovelty:a1,clearEmployeeShiftNovelty:o1,subscribeToEmployeeShifts:i1,fetchEmployeeCredits:lw,fetchGastos:l1,createGasto:c1,updateGasto:d1,deleteGasto:u1,fetchCajaBolsillos:ox,fetchProvisionTransfers:h1,createProvisionTransfer:m1,deleteProvisionTransfer:f1,fetchBalanceResumen:p1,checkDatabaseConnection:ew},ym={efectivo:"Efectivo",nequi:"Nequi",tarjeta:"Tarjeta",provision_caja:"Provisión caja",credito_empleados:"Crédito empleados"},g1=["efectivo","provision_caja","nequi","tarjeta","credito_empleados"],ra=e=>e>=0?"text-green-600":"text-red-600",x1=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t},vm=e=>e?e==="caja_principal"?"Caja principal":e==="provision_caja"?"Provisión de caja":e.replace(/_/g," "):"—",ac=e=>new Date(e).toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}),y1=()=>({efectivo:{ingresos:0,egresos:0},nequi:{ingresos:0,egresos:0},tarjeta:{ingresos:0,egresos:0},provision_caja:{ingresos:0,egresos:0},credito_empleados:{ingresos:0,egresos:0}}),bm=(e,t,s)=>{const n=y1();return e.forEach(a=>{if(!vs(a))return;jn(a).forEach(({metodo:i,monto:l})=>{n[i].ingresos+=l})}),t.forEach(a=>{const o=a.metodoPago??"efectivo";n[o].egresos+=a.monto}),s.forEach(a=>{if(a.bolsilloDestino==="provision_caja"){n.provision_caja.ingresos+=a.monto,n[a.origen].egresos+=a.monto;return}if(a.bolsilloOrigen==="provision_caja"){n.provision_caja.egresos+=a.monto,a.destinoMetodo&&(n[a.destinoMetodo].ingresos+=a.monto);return}n[a.origen].egresos+=a.monto,a.destinoMetodo&&(n[a.destinoMetodo].ingresos+=a.monto)}),n},v1=e=>{const t=new Date(e);return t.setHours(23,59,59,999),t},oc=e=>{const t=e.getFullYear(),s=`${e.getMonth()+1}`.padStart(2,"0"),n=`${e.getDate()}`.padStart(2,"0");return`${t}-${s}-${n}`},Ui=e=>{if(!e)return null;const[t,s,n]=e.split("-").map(Number);return!t||!s||!n?null:new Date(t,s-1,n)},ic=(e,t,s,n)=>{const a=[...e].sort((d,u)=>n(u).getTime()-n(d).getTime()),o=Ui(t),i=Ui(s);if(!o&&!i)return a;const l=o?x1(o).getTime():null,c=i?v1(i).getTime():null;return a.filter(d=>{const u=n(d).getTime();return!(l!==null&&u<l||c!==null&&u>c)})};function b1(){const[e,t]=p.useState([]),[s,n]=p.useState([]),[a,o]=p.useState([]),i=p.useMemo(()=>{const _=new Date;return _.setHours(0,0,0,0),_},[]),[l,c]=p.useState(()=>oc(i)),[d,u]=p.useState(()=>oc(i)),[h,m]=p.useState(!0);p.useEffect(()=>{let _=!0;return(async()=>{m(!0);try{const[O,se,R]=await Promise.all([xe.fetchOrders(),xe.fetchGastos(),xe.fetchProvisionTransfers()]);if(!_)return;t(O),n(se),o(R)}finally{_&&m(!1)}})(),()=>{_=!1}},[]);const x=p.useMemo(()=>ic(e,l,d,_=>$i(_)),[e,l,d]),w=p.useMemo(()=>ic(s,l,d,_=>_.fecha),[s,l,d]),S=p.useMemo(()=>ic(a,l,d,_=>_.fecha),[a,l,d]),E=p.useMemo(()=>{const ie=x.filter(vs).reduce((se,R)=>se+R.total,0),O=w.reduce((se,R)=>se+R.monto,0);return{ventas:ie,gastos:O,balance:ie-O}},[x,w]),y=p.useMemo(()=>{const ie=e.filter(vs).reduce((se,R)=>se+R.total,0),O=s.reduce((se,R)=>se+R.monto,0);return{ventas:ie,gastos:O,balance:ie-O}},[e,s]),f=e.length>0||s.length>0,g=x.length>0||w.length>0,b=p.useMemo(()=>{var O,se;const _=(O=x[0])==null?void 0:O.timestamp,ie=(se=w[0])==null?void 0:se.fecha;return _&&ie?new Date(Math.max(_.getTime(),ie.getTime())):_||ie||null},[x,w]),$=p.useMemo(()=>new Intl.DateTimeFormat("es-CO",{dateStyle:"medium"}),[]),A=p.useMemo(()=>{const _=Ui(l),ie=Ui(d);return _&&ie?`${$.format(_)} - ${$.format(ie)}`:_?`Desde ${$.format(_)}`:ie?`Hasta ${$.format(ie)}`:"Todo el histórico"},[$,l,d]),B=g?`Movimientos en el período (${A}): ${x.length+w.length}`:`No hay movimientos en el período seleccionado (${A}).`,z=b?`Último movimiento: ${ac(b)}`:f?`No hay movimientos en el rango (${A}).`:"Sin registros disponibles.",de=p.useMemo(()=>bm(x,w,S),[w,x,S]),P=p.useMemo(()=>bm(e,s,a),[s,e,a]),D=p.useMemo(()=>S.filter(_=>_.bolsilloDestino==="provision_caja").reduce((_,ie)=>_+ie.monto,0),[S]),Y=p.useMemo(()=>a.filter(_=>_.bolsilloDestino==="provision_caja").reduce((_,ie)=>_+ie.monto,0),[a]),K=p.useMemo(()=>S.filter(_=>_.bolsilloOrigen==="provision_caja").reduce((_,ie)=>_+ie.monto,0),[S]),pe=p.useMemo(()=>a.filter(_=>_.bolsilloOrigen==="provision_caja").reduce((_,ie)=>_+ie.monto,0),[a]),ye=D-K,ue=Y-pe,Z=ra(ye),re=ra(ue),ae=p.useMemo(()=>g1.map(_=>({id:_,label:ym[_],ventas:de[_].ingresos,gastos:de[_].egresos,balance:de[_].ingresos-de[_].egresos,balanceHistorico:P[_].ingresos-P[_].egresos})),[P,de]);return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"ui-card ui-card-pad flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold",style:{color:v.dark},children:"Balance de Caja"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Ventas, gastos y saldo final por método de pago"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Qa,{className:"text-gray-500",size:18}),r.jsx("span",{className:"text-sm text-gray-600",children:"Filtrar por fecha"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3",children:[r.jsxs("label",{className:"flex flex-col text-xs text-gray-500 uppercase tracking-wide",children:["Desde",r.jsx("input",{type:"date",value:l,max:d,onChange:_=>{const ie=_.target.value;c(ie),ie&&d&&ie>d&&u(ie)},className:"mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("label",{className:"flex flex-col text-xs text-gray-500 uppercase tracking-wide",children:["Hasta",r.jsx("input",{type:"date",value:d,min:l,onChange:_=>{const ie=_.target.value;u(ie),ie&&l&&ie<l&&c(ie)},className:"mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent}})]}),r.jsx("button",{type:"button",onClick:()=>{const _=oc(i);c(_),u(_)},className:"px-3 py-2 text-sm font-medium text-white rounded-lg",style:{backgroundColor:v.accent},children:"Hoy"})]})]})]}),h&&r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500 text-sm",children:"Cargando balance..."}),!h&&!f&&r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500 text-sm",children:"Aún no hay movimientos registrados en la caja."}),!h&&f&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4",children:[r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Ventas"}),r.jsx(lg,{className:"text-green-600",size:20})]}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold",style:{color:v.dark},children:W(E.ventas)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Gastos"}),r.jsx(ig,{className:"text-red-600",size:20})]}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold text-red-600",children:W(E.gastos)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Balance"}),r.jsx(_u,{className:ra(E.balance),size:20})]}),r.jsx("p",{className:`text-sm sm:text-lg lg:text-2xl font-bold ${ra(E.balance)}`,children:W(E.balance)})]}),r.jsxs("div",{className:"ui-card p-3 sm:p-4 lg:p-5 col-span-2 lg:col-span-1",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("p",{className:"text-xs lg:text-sm font-medium text-gray-600",children:"Histórico"}),r.jsx(Ai,{className:"text-indigo-600",size:20})]}),r.jsx("p",{className:"text-xs text-gray-500 mb-1 hidden sm:block",children:B}),r.jsx("p",{className:"text-xs text-gray-500 mb-1 hidden sm:block",children:z}),r.jsx("p",{className:"text-sm sm:text-lg lg:text-2xl font-bold",style:{color:v.dark},children:W(y.balance)})]})]}),ae.length>0&&r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:ae.map(_=>r.jsxs("div",{className:"ui-card p-4 lg:p-5",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:_.label}),r.jsx("p",{className:"text-xs text-gray-500",children:"Ventas en el período"}),r.jsx("p",{className:"text-base lg:text-xl font-semibold",style:{color:v.dark},children:W(_.ventas)}),r.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Gastos en el período"}),r.jsx("p",{className:"text-sm lg:text-lg font-semibold text-red-600",children:W(_.gastos)}),r.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Balance del período"}),r.jsx("p",{className:`text-sm lg:text-lg font-semibold ${ra(_.balance)}`,children:W(_.balance)}),r.jsxs("p",{className:"text-xs text-gray-500 mt-3",children:["Balance histórico: ",W(_.balanceHistorico)]})]},_.id))}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ai,{size:18,style:{color:v.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Movimientos de provisión de caja"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Depósitos desde caja y gastos realizados usando la provisión en el período filtrado."})]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs uppercase text-gray-500 font-medium",children:"Saldo histórico"}),r.jsx("p",{className:`text-sm font-semibold ${re}`,children:W(ue)})]})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Depósitos en el período"}),r.jsx("p",{className:"text-sm font-semibold",style:{color:v.dark},children:W(D)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Retiros en el período"}),r.jsx("p",{className:"text-sm font-semibold text-red-600",children:W(K)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-[11px] uppercase text-gray-500 font-medium",children:"Saldo del período"}),r.jsx("p",{className:`text-sm font-semibold ${Z}`,children:W(ye)})]})]}),r.jsx("div",{className:"ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Desde"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Hacia"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[S.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-3 lg:px-6 py-6 text-center text-xs lg:text-sm text-gray-500",children:"No hay movimientos de provisión en el rango seleccionado."})}),S.map(_=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 whitespace-nowrap text-xs text-gray-900",children:$.format(_.fecha)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:_.descripcion??"—"}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden sm:table-cell",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:v.dark},children:vm(_.bolsilloOrigen)}),r.jsx("span",{className:"text-[10px] text-gray-500",children:gs[_.origen]??_.origen})]})}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden sm:table-cell",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:v.dark},children:vm(_.bolsilloDestino)}),r.jsx("span",{className:"text-[10px] text-gray-500",children:_.destinoMetodo?gs[_.destinoMetodo]??_.destinoMetodo:"—"})]})}),r.jsxs("td",{className:"px-3 lg:px-6 py-3 whitespace-nowrap text-xs font-semibold",style:{color:_.bolsilloDestino==="provision_caja"?"#15803d":"#dc2626"},children:[_.bolsilloDestino==="provision_caja"?"+":"-",W(_.monto)]})]},_.id))]})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4 lg:gap-6",children:[r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Ventas por comanda"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Detalle de cada comanda registrada en el período seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comanda"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Cliente"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Método de pago"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[x.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay ventas registradas en el rango seleccionado."})}),x.map(_=>{const ie=jn(_),O=co(ie,W),se=vs(_);return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-900",children:ac($i(_))}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-medium",style:{color:v.dark},children:_.numero?`#${_.numero}`:_.id}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden sm:table-cell",children:_.cliente??"—"}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden lg:table-cell",children:r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("span",{children:O}),r.jsx("span",{className:`w-max px-2 py-0.5 rounded-full text-[11px] font-medium ${se?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:se?"Pago registrado":"Pago pendiente"})]})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-semibold text-green-600",children:W(_.total)})]},_.id)})]})]})})]}),r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-4 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Gastos del período"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Desglose de cada gasto registrado en el período seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Categoría"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Método de pago"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[w.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay gastos registrados en el rango seleccionado."})}),w.map(_=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-900",children:ac(_.fecha)}),r.jsx("td",{className:"px-3 lg:px-6 py-4 text-xs text-gray-600",children:_.descripcion||"—"}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden sm:table-cell",children:_.categoria||"—"}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs text-gray-600 hidden lg:table-cell",children:ym[_.metodoPago??"efectivo"]}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs font-semibold text-red-600",children:W(_.monto)})]},_.id))]})]})})]})]})]})]})}const j1="bowlssalados-0",ux=["Arroz","Pasta","Quinua"],hx=["Maíz tierno","Champiñones","Pico de gallo","Guacamole","Tocineta","Chips de arracacha","Queso feta","Zanahoria","Pepino"],mx=["Pechuga de pollo","Jamón de cerdo","Carne desmechada","Champiñones","Carne Molida"],_a=1,ms=2,Ca=2,fs=4,fx=e=>e.id===j1||e.nombre.toLowerCase()==="bowl salado",lc=()=>({efectivo:!1,tarjeta:!1,nequi:!1,provision_caja:!1,credito_empleados:!1}),cc=()=>({efectivo:"",tarjeta:"",nequi:"",provision_caja:"",credito_empleados:""}),ir=e=>{const t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.round(t)},w1=(e,t)=>ii.reduce((s,n)=>e[n]?s+ir(t[n]):s,0),N1=e=>{const t=[];if(e.bowlCustomization){const{bases:s,toppings:n,proteina:a}=e.bowlCustomization;s&&s.length>0&&t.push(`Bases: ${s.join(", ")}`),a&&t.push(`Proteína: ${a}`),n&&n.length>0&&t.push(`Toppings: ${n.join(", ")}`)}return e.notas&&t.push(`Notas: ${e.notas}`),e.studentDiscount&&t.push("Incluye descuento estudiante"),t},jm=(e,t,s,n,a)=>{const o=a[s];if(!o)return e;const i=Number.isFinite(n)?Math.floor(n):0,l=e.reduce((u,h)=>h.id===t?u:u+(h.itemQuantities[s]??0),0),c=Math.max(0,o.quantity-l),d=Math.max(0,Math.min(i,c));return e.map(u=>{if(u.id!==t)return u;const h={...u.itemQuantities};return d<=0?delete h[s]:h[s]=d,{...u,itemQuantities:h}})};function px({order:e,onClose:t,onSubmit:s,isSubmitting:n=!1,title:a,onAssignCredit:o}){var X;const i=p.useMemo(()=>Math.round(e.total),[e.total]),l=p.useMemo(()=>e.items.map((j,U)=>{const ee=Math.max(0,Math.round(j.cantidad)),ne=Math.round(Xa(j));return{key:`${U}-${j.item.id}-${j.customKey??"default"}`,label:j.item.nombre,quantity:ee,unitPrice:ne,subtotal:ne*ee,details:N1(j)}}),[e.items]),c=p.useMemo(()=>l.reduce((j,U)=>(j[U.key]=U,j),{}),[l]),[d,u]=p.useState([]),[h,m]=p.useState({}),[x,w]=p.useState(""),S=p.useMemo(()=>d.filter(j=>j.activo),[d]),E=S.length>0,y=p.useCallback(j=>{if(!j)return"";const U=S.find(ee=>ee.id===j);return U?U.nombre:""},[S]),f=p.useCallback(j=>{const U=h[j.id]??0;return U>0?`${j.nombre} · ${W(U)} pendientes`:j.nombre},[h]),g=p.useRef(1),b=p.useCallback(j=>{const U=g.current++;return{id:`persona-${U}`,name:(j==null?void 0:j.name)??`Persona ${U}`,method:(j==null?void 0:j.method)??"efectivo",itemQuantities:(j==null?void 0:j.itemQuantities)??{},employeeId:j==null?void 0:j.employeeId}},[]),$=p.useMemo(()=>jn(e),[e]);p.useEffect(()=>{let j=!0;const U=async()=>{try{const[ne,he]=await Promise.all([xe.fetchEmpleados(),xe.fetchEmployeeCredits().catch(()=>[])]);if(!j)return;u(ne);const Ae=(he??[]).reduce((Ve,Wt)=>(Ve[Wt.empleadoId]=Math.max(0,Math.round(Wt.total)),Ve),{});m(Ae)}catch(ne){console.error("No se pudieron cargar los empleados o créditos.",ne)}};U();const ee=()=>{U()};return typeof window<"u"&&window.addEventListener(qn,ee),()=>{j=!1,typeof window<"u"&&window.removeEventListener(qn,ee)}},[]);const[A,B]=p.useState("single"),[z,de]=p.useState(()=>lc()),[P,D]=p.useState(()=>cc()),[Y,K]=p.useState(null),[pe,ye]=p.useState(null),[ue,Z]=p.useState(null),[re,ae]=p.useState(""),_=p.useRef(!1),ie=p.useCallback(()=>{g.current=1;const j=$[0],U=$[1],ee=(j==null?void 0:j.metodo)??"efectivo",ne=(U==null?void 0:U.metodo)??ee,he=(j==null?void 0:j.metodo)==="credito_empleados"?j.empleadoId:void 0,Ae=(U==null?void 0:U.metodo)==="credito_empleados"?U.empleadoId:void 0;return[b({name:"Persona 1",method:ee,itemQuantities:{},employeeId:he}),b({name:"Persona 2",method:ne,itemQuantities:{},employeeId:Ae})]},[b,$]),[O,se]=p.useState(ie);p.useEffect(()=>{se(ie())},[ie]),p.useEffect(()=>{if($.length===0){const ne=lc();ne.efectivo=!0;const he=cc();he.efectivo=i>0?String(i):"",de(ne),D(he),w(""),K(null);return}const j=lc(),U=cc();let ee;$.forEach(ne=>{j[ne.metodo]=!0,U[ne.metodo]=String(Math.round(ne.monto)),ne.metodo==="credito_empleados"&&ne.empleadoId&&(ee=ne.empleadoId)}),de(j),D(U),w(ee??""),K(null)},[$,i]),p.useEffect(()=>{var U;if(!z.credito_empleados){x&&w("");return}if(!E){x&&w("");return}if(x&&S.some(ee=>ee.id===x))return;const j=((U=S[0])==null?void 0:U.id)??"";w(j)},[z,x,S,E]),p.useEffect(()=>{se(j=>{let U=!1;const ee=j.map(ne=>{var he;return ne.method!=="credito_empleados"?ne.employeeId!==void 0?(U=!0,{...ne,employeeId:void 0}):ne:E?ne.employeeId&&S.some(Ae=>Ae.id===ne.employeeId)?ne:(U=!0,{...ne,employeeId:(he=S[0])==null?void 0:he.id}):ne.employeeId!==void 0?(U=!0,{...ne,employeeId:void 0}):ne});return U?ee:j})},[S,E]);const R=p.useRef(e.id);p.useEffect(()=>{R.current!==e.id&&(R.current=e.id,B("single"),K(null))},[e.id]);const C=j=>{B(j),K(null)},H=p.useMemo(()=>ii.filter(j=>z[j]),[z]),Q=p.useMemo(()=>H.map(j=>{const U={metodo:j,monto:ir(P[j])};if(j==="credito_empleados"&&x){U.empleadoId=x;const ee=y(x);ee&&(U.empleadoNombre=ee)}return U}),[P,H,x,y]),L=p.useMemo(()=>Ls(Q),[Q]),G=i-L,fe=Q.some(j=>j.monto<=0),Se=H.length>0,ze=Math.abs(G)<=1,Fe=H.some(j=>j==="credito_empleados"&&!x),Ie=Se&&!fe&&ze&&i>0&&!Fe,F=p.useMemo(()=>l.reduce((j,U)=>{const ee=O.reduce((ne,he)=>ne+(he.itemQuantities[U.key]??0),0);return j[U.key]={assigned:ee,remaining:U.quantity-ee},j},{}),[l,O]),le=p.useMemo(()=>O.reduce((j,U)=>{const ee=l.reduce((ne,he)=>{const Ae=U.itemQuantities[he.key]??0;return ne+Ae*he.unitPrice},0);return j[U.id]=Math.round(ee),j},{}),[l,O]),ge=p.useMemo(()=>O.map(j=>{const U=le[j.id]??0;if(U<=0)return null;const ee={metodo:j.method,monto:U};if(j.method==="credito_empleados"&&j.employeeId){ee.empleadoId=j.employeeId;const ne=y(j.employeeId);ne&&(ee.empleadoNombre=ne)}return ee}).filter(j=>j!==null),[O,le,y]),ke=p.useMemo(()=>Ls(ge),[ge]),Me=p.useMemo(()=>l.every(j=>{var U;return(((U=F[j.key])==null?void 0:U.assigned)??0)===j.quantity}),[l,F]),We=ge.length>0,Ge=Math.abs(ke-i)<=1,Ze=p.useMemo(()=>O.some(j=>j.method==="credito_empleados"&&!j.employeeId),[O]),St=A==="split"?ke:L,it=i-St,_t=z.efectivo,xt=ir(P.efectivo),Ht=re.trim()===""?xt:ir(re),T=Math.max(0,Ht-xt),J=Math.max(0,xt-Ht);p.useEffect(()=>{if(!_t){_.current=!1,ae("");return}_.current||ae(P.efectivo??"")},[_t,P.efectivo]);const ce=p.useMemo(()=>co(A==="split"?ge:Q,W),[A,Q,ge]),je=!!e.creditInfo,M=((X=e.creditInfo)==null?void 0:X.amount)??i,te=p.useMemo(()=>e.creditInfo?e.creditInfo.assignedAt.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}):"",[e.creditInfo]),be=j=>{de(U=>{var he;const ee=!!U[j];if(!ee&&j==="credito_empleados"&&!E)return K("No hay empleados activos para registrar créditos."),U;if(U.credito_empleados&&j!=="credito_empleados"&&!ee)return K("No puedes combinar el crédito de empleados con otros métodos."),U;if(j==="credito_empleados")return ee?(D(Ae=>({...Ae,credito_empleados:""})),w(""),K(null),{...U,credito_empleados:!1}):(D(()=>({efectivo:"",tarjeta:"",nequi:"",credito_empleados:i>0?String(i):""})),(!x||!S.some(Ae=>Ae.id===x))&&w(((he=S[0])==null?void 0:he.id)??""),K(null),{efectivo:!1,tarjeta:!1,nequi:!1,credito_empleados:!0});const ne={...U,[j]:!ee};return D(Ae=>{const Ve={...Ae};if(ee)Ve[j]="",j==="efectivo"&&(_.current=!1,ae(""));else{const Wt=w1(U,Ae),Xt=Math.max(0,i-Wt);Ve[j]=Xt>0?String(Xt):"",j==="efectivo"&&(_.current=!1)}return Ve}),K(null),ne})},Pe=(j,U)=>{/^[0-9]*$/.test(U)&&(D(ee=>({...ee,[j]:U})),K(null))},_e=j=>{/^[0-9]*$/.test(j)&&(_.current=!0,ae(j))},os=j=>{const U=H.filter(ne=>ne!==j).reduce((ne,he)=>ne+ir(P[he]),0),ee=Math.max(0,i-U);de(ne=>({...ne,[j]:!0})),D(ne=>({...ne,[j]:ee>0?String(ee):""})),j==="efectivo"&&(_.current=!1),K(null)},k=()=>{se(j=>[...j,b()]),K(null)},N=j=>{se(U=>U.length<=1?U:U.filter(ee=>ee.id!==j)),K(null)},q=(j,U)=>{se(ee=>ee.map(ne=>ne.id===j?{...ne,name:U}:ne)),K(null)},V=(j,U)=>{if(U==="credito_empleados"&&!E){K("No hay empleados activos para registrar créditos.");return}se(ee=>ee.map(ne=>{var he;if(ne.id!==j)return ne;if(U==="credito_empleados"){const Ae=ne.employeeId&&S.some(Ve=>Ve.id===ne.employeeId)?ne.employeeId:(he=S[0])==null?void 0:he.id;return{...ne,method:U,employeeId:Ae}}return ne.employeeId!==void 0?{...ne,method:U,employeeId:void 0}:{...ne,method:U}})),K(null)},me=(j,U)=>{se(ee=>ee.map(ne=>ne.id!==j?ne:{...ne,employeeId:U||void 0})),K(null)},Ee=(j,U,ee)=>{se(ne=>{var Ae;const he=((Ae=ne.find(Ve=>Ve.id===j))==null?void 0:Ae.itemQuantities[U])??0;return jm(ne,j,U,he+ee,c)}),K(null)},$e=(j,U)=>{ye({personId:j,personName:U})},Re=()=>{ye(null),Z(null)},ct=(j,U)=>{if(j.preventDefault(),!pe)return;const ee=F[U];((ee==null?void 0:ee.remaining)??0)>0&&Z(U)},yt=()=>{Z(null)},Jt=(j,U)=>{if(j.preventDefault(),!pe)return;const ee=c[U];if(!ee){ye(null),Z(null);return}const ne=F[U];if(((ne==null?void 0:ne.remaining)??0)<=0){K(`No hay unidades pendientes de ${ee.label} para asignar.`),ye(null),Z(null);return}se(Ae=>{const Ve=Ae.find(Nn=>Nn.id===pe.personId);if(!Ve)return Ae;const Xt=(Ve.itemQuantities[U]??0)+1;return jm(Ae,pe.personId,U,Xt,c)}),ye(null),Z(null),K(null)},Es=async j=>{!o||n||(K(null),await o(j))},I=async()=>{if(A==="single"&&H.length===1&&H[0]==="credito_empleados"&&o&&!je){if(Fe){K("Selecciona el empleado al registrar un crédito.");return}const he=x,Ae=Math.max(0,ir(P.credito_empleados)||i);if(!he){K("Selecciona el empleado al registrar un crédito.");return}if(Ae<=0){K("El monto a crédito debe ser mayor a cero.");return}await Es({employeeId:he,amount:Ae,employeeName:y(he)||void 0});return}if(A==="split"){if(!We){K("Asigna al menos un producto y método de pago para continuar.");return}if(!Me){K("Distribuye todos los productos entre las personas antes de confirmar.");return}if(!Ge){K("Los montos asignados no coinciden con el total del pedido.");return}if(Ze){K("Selecciona el empleado correspondiente para cada pago por crédito.");return}}else if(!Ie){K(Fe?"Selecciona el empleado al registrar un crédito.":"Asegúrate de seleccionar al menos un método y que los montos sumen el total.");return}const ee=Ya(fn(A==="split"?ge:Q)),ne=Ls(ee);if(Math.abs(ne-i)>1){K("Los montos registrados no coinciden con el total del pedido.");return}K(null),await s(ee)};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:a??"Registrar pago"}),r.jsxs("p",{className:"text-sm text-gray-500",children:["Pedido #",e.numero," · Total ",W(i)]})]}),r.jsx("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:r.jsx(Lr,{size:20})})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{children:r.jsxs("div",{className:"grid grid-cols-2 bg-gray-100 rounded-lg p-1",children:[r.jsx("button",{type:"button",onClick:()=>C("single"),className:`py-2 px-3 rounded-md text-sm font-medium transition-colors ${A==="single"?"bg-white shadow text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"Pago completo"}),r.jsx("button",{type:"button",onClick:()=>C("split"),className:`py-2 px-3 rounded-md text-sm font-medium transition-colors ${A==="split"?"bg-white shadow text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:"Dividir cuenta"})]})}),A==="single"?r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold mb-2",style:{color:v.dark},children:"Selecciona los métodos de pago"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2",children:ii.map(j=>{const U=z[j],ee=gs[j],ne=z.credito_empleados&&j!=="credito_empleados"||n;return r.jsx("button",{type:"button",onClick:()=>be(j),disabled:ne,className:`py-2 px-3 rounded-lg border text-sm font-medium transition-colors disabled:opacity-60 disabled:cursor-not-allowed ${U?"border-transparent text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:U?v.dark:"transparent"},children:ee},j)})})]}),H.length>0&&r.jsx("div",{className:"space-y-3",children:H.map(j=>{const U=gs[j];return r.jsxs("div",{className:"flex flex-col gap-2 p-3 border border-gray-200 rounded-lg",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-sm font-medium",style:{color:v.dark},children:U}),r.jsx("button",{type:"button",onClick:()=>os(j),className:"text-xs text-gray-600 hover:text-gray-900",children:"Usar restante"})]}),r.jsx("input",{type:"number",min:"0",step:"100",value:P[j],onChange:ee=>Pe(j,ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent},placeholder:"Monto"}),j==="efectivo"&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-600",htmlFor:`cash-received-${e.id}`,children:"Monto recibido"}),r.jsx("input",{id:`cash-received-${e.id}`,type:"number",min:"0",step:"100",value:re,onChange:ee=>_e(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent},placeholder:"¿Con cuánto paga la persona?"}),xt>0&&r.jsx("p",{className:`text-xs font-semibold ${J>0?"text-red-600":T>0?"text-green-600":"text-gray-600"}`,children:J>0?`Faltan ${W(J)} por recibir`:T>0?`Cambio ${W(T)}`:"Sin cambio"})]}),j==="credito_empleados"&&r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-600",htmlFor:`credit-employee-${j}`,children:"Empleado"}),E?r.jsxs("select",{id:`credit-employee-${j}`,value:x,onChange:ee=>w(ee.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"",children:"Selecciona un empleado"}),S.map(ee=>r.jsx("option",{value:ee.id,children:f(ee)},ee.id))]}):r.jsx("p",{className:"text-xs text-red-600",children:"No hay empleados activos disponibles para crédito."})]})]},j)})})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Personas"}),r.jsx("button",{type:"button",onClick:k,className:"text-xs font-medium text-gray-600 hover:text-gray-900",children:"Agregar persona"})]}),r.jsx("div",{className:"space-y-3",children:O.map((j,U)=>{const ee=j.name.trim()?j.name:`Persona ${U+1}`,ne=le[j.id]??0;return r.jsxs("div",{draggable:!0,onDragStart:()=>$e(j.id,ee),onDragEnd:Re,className:"border border-gray-200 rounded-lg bg-gray-50 p-3 space-y-3 cursor-grab active:cursor-grabbing hover:shadow-md transition-all",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[r.jsx("input",{type:"text",value:j.name,onChange:he=>q(j.id,he.target.value),placeholder:`Persona ${U+1}`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}}),O.length>1&&r.jsx("button",{type:"button",onClick:()=>N(j.id),className:"text-xs text-red-600 hover:text-red-700",children:"Eliminar"})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3 gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-semibold uppercase text-gray-500",children:"Pago con"}),r.jsx("select",{value:j.method,onChange:he=>V(j.id,he.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:ii.map(he=>r.jsx("option",{value:he,children:gs[he]},he))})]}),j.method==="credito_empleados"&&(E?r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-xs font-semibold uppercase text-gray-500",children:"Empleado"}),r.jsxs("select",{value:j.employeeId??"",onChange:he=>me(j.id,he.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"",children:"Selecciona un empleado"}),S.map(he=>r.jsx("option",{value:he.id,children:f(he)},he.id))]})]}):r.jsx("span",{className:"text-xs text-red-600",children:"No hay empleados activos"}))]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:["Total asignado:"," ",r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:W(ne)})]})]},j.id)})})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold mb-2",style:{color:v.dark},children:"Asignar productos"}),r.jsx("div",{className:"space-y-4",children:l.map(j=>{const U=F[j.key],ee=(U==null?void 0:U.assigned)??0,ne=(U==null?void 0:U.remaining)??0,he=ne>0,Ae=ue===j.key;return r.jsxs("div",{onDragOver:Ve=>ct(Ve,j.key),onDragLeave:yt,onDrop:Ve=>Jt(Ve,j.key),className:`border rounded-lg p-3 space-y-3 transition-all ${Ae&&he?"border-2 border-green-500 bg-green-50 shadow-lg":"border-gray-200"}`,children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("p",{className:"text-sm font-medium",style:{color:v.dark},children:j.label}),he&&r.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded",children:"Suelta persona aquí"}),Ae&&pe&&r.jsxs("span",{className:"text-xs bg-green-500 text-white px-2 py-1 rounded font-medium animate-pulse",children:["Asignar a ",pe.personName]})]}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Cantidad: ",j.quantity," · Precio unidad: ",W(j.unitPrice)," · Subtotal:"," ",W(j.subtotal)]}),j.details.map((Ve,Wt)=>r.jsx("p",{className:"text-xs text-gray-500",children:Ve},Wt))]}),r.jsxs("div",{className:"text-xs font-medium text-gray-600",children:["Asignado: ",ee,"/",j.quantity,ne>0&&r.jsxs("span",{className:"text-red-600",children:[" · Pendiente: ",ne]})]})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[O.map((Ve,Wt)=>{const Xt=Ve.itemQuantities[j.key]??0;if(Xt===0)return null;const Nn=Xt*j.unitPrice,wl=Ve.name.trim()?Ve.name:`Persona ${Wt+1}`;return r.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-full",children:[r.jsx("span",{className:"text-sm font-medium text-blue-900",children:wl}),r.jsxs("span",{className:"text-xs text-blue-700",children:["×",Xt]}),r.jsxs("span",{className:"text-xs text-blue-600",children:["(",W(Nn),")"]}),r.jsx("button",{type:"button",onClick:()=>Ee(Ve.id,j.key,-Xt),className:"ml-1 text-blue-600 hover:text-blue-800 focus:outline-none",title:"Quitar asignación",children:"×"})]},Ve.id)}),ee===0&&r.jsx("span",{className:"text-xs text-gray-400 italic py-1.5",children:"Sin asignar - arrastra una persona aquí"})]})]},j.key)})}),!Me&&r.jsx("p",{className:"text-xs text-red-600",children:"Aún hay productos sin asignar."})]})]}),r.jsxs("div",{className:"border-t pt-4 space-y-2 text-sm",children:[r.jsxs("div",{className:"flex justify-between font-medium",children:[r.jsx("span",{children:"Total registrado"}),r.jsx("span",{children:W(St)})]}),r.jsxs("div",{className:"flex justify-between font-medium",children:[r.jsx("span",{children:"Restante"}),r.jsx("span",{className:it===0?"text-green-600":"text-red-600",children:W(Math.abs(it))})]}),r.jsx("p",{className:"text-xs text-gray-500",children:ce}),Y&&r.jsx("p",{className:"text-xs text-red-600",children:Y})]}),je?r.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs text-blue-800",children:[r.jsx("p",{className:"font-semibold mb-1",children:"Pedido asignado como crédito de empleados."}),r.jsxs("p",{children:["Monto pendiente: ",W(Math.round(M))]}),r.jsxs("p",{children:["Asignado el: ",te]}),r.jsx("p",{className:"mt-1",children:"Registra el pago cuando el crédito sea cancelado para reflejarlo en el balance."})]}):o&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-xs text-yellow-800",children:[r.jsx("p",{className:"font-semibold mb-1",children:"Crédito de empleados disponible."}),r.jsx("p",{children:'Usa la opción "Crédito empleados" en los métodos de pago para enviar este pedido a crédito.'}),r.jsx("p",{className:"mt-1",children:"El monto no se sumará al balance hasta registrar el pago."})]}),r.jsxs("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm",disabled:n,children:"Cancelar"}),r.jsx("button",{type:"button",onClick:I,className:"flex-1 py-2 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-sm disabled:opacity-60 disabled:cursor-not-allowed",style:{backgroundColor:v.dark},disabled:n,children:"Confirmar pago"})]})]})]})})}const Cd=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},k1=e=>{if(!e)return new Date;const[t,s,n]=e.split("-"),a=Number(t),o=Number(s),i=Number(n);if([a,o,i].some(d=>Number.isNaN(d)||d<=0))return new Date;const l=new Date,c=new Date(l);return c.setFullYear(a,o-1,i),c},S1=(e,t)=>t?Cd(e)===t:!1,_1=e=>{const[t,s,n]=e.split("-"),a=Number(t),o=Number(s),i=Number(n);return[a,o,i].some(c=>Number.isNaN(c)||c<=0)?e:new Date(a,o-1,i).toLocaleDateString("es-CO",{year:"numeric",month:"long",day:"numeric"})};function C1({orders:e,onModuleChange:t,onCreateOrder:s,onRecordOrderPayment:n,onAssignOrderCredit:a}){const[o,i]=p.useState([]),[l,c]=p.useState([]),[d,u]=p.useState([]),[h,m]=p.useState(""),[x,w]=p.useState(""),[S,E]=p.useState(()=>Cd(new Date)),[y,f]=p.useState(!1),[g,b]=p.useState(null),[$,A]=p.useState(!1),[B,z]=p.useState(""),[de,P]=p.useState(null),[D,Y]=p.useState(null),[K,pe]=p.useState([]),[ye,ue]=p.useState([]),[Z,re]=p.useState(null),[ae,_]=p.useState(!1),ie=()=>{pe([]),ue([]),re(null)},O=M=>{if(fx(M)){ie(),Y(M);return}F(M)},se=(M,te,be,Pe)=>{be(_e=>_e.includes(M)?_e.filter(os=>os!==M):_e.length>=Pe?_e:[..._e,M])},R=()=>{if(!D||!Z||K.length<_a||K.length>ms||ye.length<Ca||ye.length>fs)return;const M=[`Bases: ${K.join(", ")}`,`Toppings: ${ye.join(", ")}`,`Proteína: ${Z}`].join(`
`),te=[D.id,[...K].sort().join("-"),[...ye].sort().join("-"),Z].join("|");F(D,{notas:M,customKey:te,bowlCustomization:{bases:K,toppings:ye,proteina:Z}}),Y(null),ie()},C=()=>{Y(null),ie()},H=M=>{const te=M.target.value;E(te||Cd(new Date))},Q=M=>{re(te=>te===M?null:M)};p.useEffect(()=>{L(),G()},[]);const L=async()=>{const M=await xe.fetchMenuItems();i(M)},G=async()=>{const M=await xe.fetchCustomers();c(M)},fe=o.filter(M=>M.inventarioCategoria!=="Inventariables").map(M=>M.categoria),Se=Array.from(new Set(fe)),ze=Wn(h),Fe=o.filter(M=>{const te=!ze||Wn(M.nombre).includes(ze),be=!x||M.categoria===x,Pe=M.inventarioCategoria!=="Inventariables";return te&&be&&Pe}),Ie=M=>d.filter(({item:te})=>te.id===M).reduce((te,be)=>te+be.cantidad,0),F=(M,te)=>{u(be=>be.find(_e=>_e.item.id===M.id&&_e.customKey===(te==null?void 0:te.customKey))?be.map(_e=>_e.item.id===M.id&&_e.customKey===(te==null?void 0:te.customKey)?{..._e,cantidad:_e.cantidad+1}:_e):[...be,{item:M,cantidad:1,notas:te==null?void 0:te.notas,customKey:te==null?void 0:te.customKey,bowlCustomization:te==null?void 0:te.bowlCustomization,precioUnitario:M.precio,studentDiscount:!1}])},le=(M,te,be)=>{be<=0?u(Pe=>Pe.filter(_e=>!(_e.item.id===M&&_e.customKey===te))):u(Pe=>Pe.map(_e=>_e.item.id===M&&_e.customKey===te?{..._e,cantidad:be}:_e))},ge=(M,te)=>{u(be=>be.filter(Pe=>!(Pe.item.id===M&&Pe.customKey===te)))},ke=(M,te)=>{u(be=>be.map(Pe=>Pe.item.id===M&&Pe.customKey===te?{...Pe,studentDiscount:!Pe.studentDiscount}:Pe))},Me=K.length>=ms,We=ye.length>=fs,Ge=K.length>=_a&&K.length<=ms&&ye.length>=Ca&&ye.length<=fs&&!!Z,Ze=Ys(d),St=p.useMemo(()=>e.filter(M=>S1(M.timestamp,S)),[e,S]),it=p.useMemo(()=>_1(S),[S]),_t=[...St].filter(M=>M.estado==="entregado"&&!vs(M)&&M.metodoPago!=="credito_empleados").sort((M,te)=>te.timestamp.getTime()-M.timestamp.getTime()),xt=_t.length,Ht=async()=>{if(d.length===0||ae)return;let M=de,te;const be=B.trim();_(!0);try{if(!M&&be){const os=l.find(k=>k.nombre.toLowerCase()===be.toLowerCase());if(os)M=os,te=os.id;else{const k=window.prompt("Ingrese teléfono del cliente");if(!k){alert("Debe ingresar un teléfono para continuar");return}const N={id:crypto.randomUUID(),nombre:be,telefono:k.trim()},q=await xe.createCustomer(N);M=q,te=q.id,c(V=>[...V,q])}}else M&&(te=M.id);const Pe=(M==null?void 0:M.nombre)??(be||void 0),_e={id:crypto.randomUUID(),numero:Pv(),items:d,total:Ze,estado:"pendiente",timestamp:k1(S),cliente_id:te,cliente:Pe,paymentStatus:"pendiente",paymentAllocations:[]};await s(_e),u([]),f(!1),z(""),P(null),t("comandas")}catch(Pe){console.error("Error al crear el pedido:",Pe),alert("No se pudo crear el pedido. Inténtalo nuevamente.")}finally{_(!1)}},T=M=>{vs(M)||b(M)},J=()=>{$||b(null)},ce=async M=>{if(g)try{A(!0),await n(g,M),b(null)}catch(te){console.error("Error al registrar el pago:",te),alert("No se pudo registrar el pago. Inténtalo nuevamente.")}finally{A(!1)}},je=async M=>{if(g)try{A(!0),await a(g,M),b(null)}catch(te){console.error("Error al asignar el pedido a crédito de empleados:",te),alert("No se pudo asignar el crédito. Inténtalo nuevamente.")}finally{A(!1)}};return r.jsxs("section",{className:"space-y-6",children:[r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[r.jsxs("div",{className:"order-2 lg:order-1 lg:col-span-2 space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-4",children:[r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Punto de Venta"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-3",children:[r.jsx("label",{htmlFor:"caja-date",className:"text-sm font-medium text-gray-600",children:"Fecha del registro"}),r.jsx("input",{id:"caja-date",type:"date",value:S,onChange:H,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx(rg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:h,onChange:M=>m(M.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("select",{value:x,onChange:M=>w(M.target.value),className:"px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-base sm:text-sm w-full lg:w-auto",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"",children:"Todas las categorías"}),Se.map(M=>r.jsx("option",{value:M,children:M},M))]})]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 lg:gap-4",children:Fe.map(M=>{const te=Ie(M.id),be=te>0;return r.jsxs("div",{className:`relative ui-card ui-card-pad hover:shadow-md transition-all duration-200 border ${be?"bg-yellow-50 border-yellow-200":"bg-white border-gray-100"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsx("h3",{className:"font-semibold text-sm lg:text-base",style:{color:v.dark},children:M.nombre}),r.jsx("span",{className:"font-bold text-sm lg:text-base",style:{color:v.accent},children:W(M.precio)})]}),r.jsx("p",{className:"text-sm text-gray-600 mb-1",children:M.categoria}),M.descripcion&&r.jsx("p",{className:"text-sm text-gray-500 mb-3 line-clamp-2",children:M.descripcion}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("span",{className:"text-sm text-gray-500",children:["Stock: ",M.stock]}),r.jsxs("div",{className:"flex items-center gap-2",children:[be&&r.jsx("span",{className:"inline-flex h-6 min-w-[1.5rem] items-center justify-center rounded-full px-2 text-xs font-semibold text-white shadow-sm",style:{backgroundColor:v.accent},children:te}),r.jsx("button",{onClick:()=>O(M),disabled:M.inventarioCategoria==="Inventariables"&&M.stock===0,className:"px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed text-sm",style:{backgroundColor:v.dark},children:r.jsx(xn,{size:16})})]})]})]},M.id)})})]}),r.jsx("div",{className:"order-1 lg:order-2 space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad lg:sticky lg:top-24",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(og,{size:24,style:{color:v.dark}}),r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:"Carrito"})]}),d.length===0?r.jsx("p",{className:"text-gray-500 text-center py-6 lg:py-8 text-sm",children:"Carrito vacío"}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"space-y-3 mb-4 lg:mb-6 max-h-80 lg:max-h-96 overflow-y-auto",children:d.map(M=>r.jsx("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[r.jsxs("div",{className:"flex-1 space-y-1",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsx("h4",{className:"font-medium text-sm",children:M.item.nombre}),r.jsxs("span",{className:"text-xs font-semibold text-gray-700",children:["Subtotal: ",W(Za(M))]})]}),r.jsxs("div",{className:"text-xs text-gray-600",children:["Precio unidad:"," ",M.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-2",children:W(sn(M))}),r.jsx("span",{className:"font-semibold text-green-600",children:W(Xa(M))})]}):r.jsx("span",{children:W(sn(M))})]}),M.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full",children:Fr}),M.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:M.notas}),Rg(M.item)&&r.jsx("button",{onClick:()=>ke(M.item.id,M.customKey),className:`mt-1 inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium transition-colors ${M.studentDiscount?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:M.studentDiscount?"Quitar descuento":"Aplicar descuento estudiante"})]}),r.jsxs("div",{className:"flex items-center gap-2 self-start",children:[r.jsx("button",{onClick:()=>le(M.item.id,M.customKey,M.cantidad-1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(Su,{size:12})}),r.jsx("span",{className:"w-8 text-center font-medium",children:M.cantidad}),r.jsx("button",{onClick:()=>le(M.item.id,M.customKey,M.cantidad+1),className:"w-6 h-6 rounded-full flex items-center justify-center text-white hover:opacity-90",style:{backgroundColor:v.dark},children:r.jsx(xn,{size:12})}),r.jsx("button",{onClick:()=>ge(M.item.id,M.customKey),className:"w-6 h-6 rounded-full bg-red-100 text-red-600 flex items-center justify-center hover:bg-red-200",children:r.jsx(Hn,{size:12})})]})]})},`${M.item.id}-${M.customKey??"default"}`))}),r.jsxs("div",{className:"border-t pt-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("span",{className:"text-lg font-bold",children:"Total:"}),r.jsx("span",{className:"text-xl lg:text-2xl font-bold",style:{color:v.accent},children:W(Ze)})]}),r.jsx("button",{onClick:()=>f(!0),className:"w-full py-3 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-base",style:{backgroundColor:v.dark},children:"Enviar a comanda"})]})]})]})}),_t.length>0&&r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:"Pagos de pedidos entregados"}),r.jsx("p",{className:"text-sm text-gray-500",children:xt===1?"1 pago pendiente por registrar":`${xt} pagos pendientes por registrar`}),r.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Fecha seleccionada: ",it]})]})}),r.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:_t.map(M=>{const te=jn(M),be=co(te,W);return r.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsxs("p",{className:"text-sm font-semibold",style:{color:v.dark},children:["Pedido #",M.numero]}),M.cliente&&r.jsxs("p",{className:"text-xs text-gray-500",children:["Cliente: ",M.cliente]})]}),r.jsx("span",{className:"text-sm font-bold",style:{color:v.accent},children:W(M.total)})]}),r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsx("span",{className:"inline-flex items-center gap-2 px-2 py-1 rounded-full font-medium bg-yellow-100 text-yellow-800",children:"Pago pendiente"}),r.jsx("span",{className:"text-gray-500 text-right flex-1 ml-3 line-clamp-2",children:be})]}),r.jsx("button",{type:"button",onClick:()=>T(M),className:"w-full py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50",children:"Registrar pago"})]},M.id)})})]})]}),D&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:"Personaliza tu Bowl Salado"}),r.jsxs("p",{className:"text-sm text-gray-600",children:["Selecciona entre ",_a," y ",ms," bases, entre ",Ca," y ",fs," toppings y 1 proteína."]})]}),r.jsx("button",{onClick:C,className:"text-sm text-gray-500 hover:text-gray-700",children:"Cerrar"})]}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tu base"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[K.length,"/",ms]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:ux.map(M=>{const te=K.includes(M),be=!te&&Me;return r.jsxs("button",{type:"button",onClick:()=>se(M,K,pe,ms),disabled:be,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${te?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${be?"opacity-50 cursor-not-allowed":""}`,style:te?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:M}),te&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},M)})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tus toppings"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[ye.length,"/",fs]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:hx.map(M=>{const te=ye.includes(M),be=!te&&We;return r.jsxs("button",{type:"button",onClick:()=>se(M,ye,ue,fs),disabled:be,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${te?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${be?"opacity-50 cursor-not-allowed":""}`,style:te?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:M}),te&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},M)})})]}),r.jsxs("div",{children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tu proteína"})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:mx.map(M=>{const te=Z===M;return r.jsxs("button",{type:"button",onClick:()=>Q(M),className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${te?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"}`,style:te?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:M}),te&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},M)})})]})]}),r.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 sm:justify-end border-t pt-4",children:[r.jsx("button",{onClick:C,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{onClick:R,disabled:!Ge,className:"px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:v.dark},children:"Agregar al carrito"})]})]})}),y&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:v.dark},children:"Confirmar pedido"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx("label",{className:"block text-sm font-medium mb-2",children:"Cliente (opcional)"}),r.jsx("input",{type:"text",value:B,onChange:M=>{z(M.target.value),P(null)},placeholder:"Nombre del cliente",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent pr-10 text-sm",readOnly:!!de}),de&&r.jsx("button",{type:"button",onClick:()=>P(null),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:r.jsx(pv,{size:16})}),B&&!de&&r.jsx("div",{className:"absolute z-10 bg-white border border-gray-200 rounded-lg mt-1 w-full max-h-32 sm:max-h-40 overflow-y-auto",children:l.filter(M=>M.nombre.toLowerCase().includes(B.toLowerCase())).map(M=>r.jsx("button",{onClick:()=>{z(M.nombre),P(M)},className:"w-full text-left px-3 py-2 hover:bg-gray-100 text-sm",children:M.nombre},M.id))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm text-gray-600",children:[r.jsx("span",{className:"font-medium text-gray-700",children:"Fecha del pedido:"})," ",it]}),r.jsxs("div",{className:"pt-4 border-t",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("span",{className:"text-lg font-bold",children:"Total a pagar:"}),r.jsx("span",{className:"text-xl lg:text-2xl font-bold",style:{color:v.accent},children:W(Ze)})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>f(!1),disabled:ae,className:"flex-1 py-3 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),r.jsx("button",{onClick:Ht,disabled:ae,className:"flex-1 py-3 rounded-lg text-white font-semibold transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:v.dark},children:ae?"Procesando...":"Confirmar pedido"})]})]})]})]})}),g&&r.jsx(px,{order:g,onClose:J,onSubmit:ce,isSubmitting:$,title:"Gestionar pago",onAssignCredit:je})]})}const _n=30,Cn=e=>{const t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${n}`},E1=e=>{const[t,s,n]=e.split("-").map(Number);return new Date(t,(s??1)-1,n??1)};function T1({orders:e,onUpdateOrderStatus:t,onSaveOrderChanges:s,onRecordOrderPayment:n,onDeleteOrder:a,isAdmin:o,onAssignOrderCredit:i,focusRequest:l,isLoading:c,isSyncing:d=!1}){const[u,h]=p.useState([]),[m,x]=p.useState(null),[w,S]=p.useState(null),[E,y]=p.useState(!1),[f,g]=p.useState(""),[b,$]=p.useState(null),[A,B]=p.useState([]),[z,de]=p.useState([]),[P,D]=p.useState(null),[Y,K]=p.useState(()=>Cn(new Date)),[pe,ye]=p.useState(1),[ue,Z]=p.useState(null),[re,ae]=p.useState(!1),[_,ie]=p.useState(!1),[O,se]=p.useState(null),[R,C]=p.useState({}),H=async(I,X)=>{if(!R[I.id]){C(j=>({...j,[I.id]:!0}));try{await t(I,X)}finally{C(j=>{const{[I.id]:U,...ee}=j;return ee})}}};p.useEffect(()=>{if(!l)return;const{dateKey:I,orderId:X}=l;if(X){const j=e.find(U=>U.id===X);if(j){const U=Cn(j.timestamp);K(U);const ne=e.filter(he=>Cn(he.timestamp)===U).sort((he,Ae)=>Ae.timestamp.getTime()-he.timestamp.getTime()).findIndex(he=>he.id===X);if(ne>=0){const he=Math.floor(ne/_n)+1;ye(he)}else ye(1);S(X),x(null),y(!1);return}}I&&(K(I),ye(1),X&&S(X))},[l,e]),p.useEffect(()=>{if(!l){K(Cn(new Date)),ye(1),S(null);return}},[l==null?void 0:l.requestId]);const Q=p.useMemo(()=>[...e].sort((I,X)=>X.timestamp.getTime()-I.timestamp.getTime()),[e]),L=p.useMemo(()=>Q.reduce((I,X)=>{const j=Cn(X.timestamp);return I[j]||(I[j]=[]),I[j].push(X),I},{}),[Q]),G=p.useMemo(()=>{if(!Y)return null;const I=E1(Y);return Number.isNaN(I.getTime())?null:I},[Y]),fe=G?L[Y]??[]:Q,Se=Math.max(1,Math.ceil(fe.length/_n)),ze=p.useMemo(()=>{const I=(pe-1)*_n;return fe.slice(I,I+_n)},[fe,pe]),Fe=fe.length===0?0:(pe-1)*_n+1,Ie=Math.min(pe*_n,fe.length),F=fe.length>_n,le=G?hg(G):"Todas las comandas",ge=()=>{B([]),de([]),D(null)},ke=(I,X,j,U)=>{j(ee=>ee.includes(I)?ee.filter(ne=>ne!==I):ee.length>=U?ee:[...ee,I])},Me=I=>{D(X=>X===I?null:I)};p.useEffect(()=>{We()},[]),p.useEffect(()=>{pe>Se&&ye(Se)},[pe,Se]);const We=async()=>{const I=await xe.fetchMenuItems();h(I)},Ge=(I,X)=>{x(j=>{if(!j)return j;const U=j.items.findIndex(he=>he.item.id===I.id&&he.customKey===(X==null?void 0:X.customKey));let ee;U>=0?ee=j.items.map((he,Ae)=>Ae===U?{...he,cantidad:he.cantidad+1,precioUnitario:typeof he.precioUnitario=="number"?he.precioUnitario:I.precio}:he):ee=[...j.items,{item:I,cantidad:1,notas:X==null?void 0:X.notas,customKey:X==null?void 0:X.customKey,bowlCustomization:X==null?void 0:X.bowlCustomization,precioUnitario:I.precio,studentDiscount:!1}];const ne=Ys(ee);return{...j,items:ee,total:ne}}),y(!1),g("")},Ze=I=>{switch(I){case"pendiente":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"preparando":return"bg-blue-100 text-blue-800 border-blue-200";case"listo":return"bg-green-100 text-green-800 border-green-200";case"entregado":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},St=I=>{switch(I){case"pendiente":return r.jsx(ps,{size:16});case"preparando":return r.jsx(ps,{size:16,className:"animate-pulse"});case"listo":return r.jsx(Ii,{size:16});case"entregado":return r.jsx(Ii,{size:16});default:return r.jsx(ps,{size:16})}},it=I=>{S(null),x({orderId:I.id,items:I.items.map(X=>({...X,precioUnitario:typeof X.precioUnitario=="number"?X.precioUnitario:X.item.precio,studentDiscount:!!X.studentDiscount})),total:Ys(I.items)})},_t=(I,X)=>{if(!m)return;const j=[...m.items];j[I]={...j[I],item:{...j[I].item,precio:X},precioUnitario:X};const U=Ys(j);x({...m,items:j,total:U})},xt=(I,X)=>{if(!m)return;if(X<=0){Ht(I);return}const j=[...m.items];j[I]={...j[I],cantidad:X};const U=Ys(j);x({...m,items:j,total:U})},Ht=I=>{if(!m)return;const X=m.items.filter((U,ee)=>ee!==I),j=Ys(X);x({...m,items:X,total:j})},T=I=>{if(!m)return;const X=[...m.items];X[I]={...X[I],studentDiscount:!X[I].studentDiscount};const j=Ys(X);x({...m,items:X,total:j})},J=I=>{if(m){if(fx(I)){ge(),$(I),y(!1),g("");return}Ge(I)}},ce=()=>{if(!b||!P||A.length<_a||A.length>ms||z.length<Ca||z.length>fs)return;const I=[`Bases: ${A.join(", ")}`,`Toppings: ${z.join(", ")}`,`Proteína: ${P}`].join(`
`),X=[b.id,[...A].sort().join("-"),[...z].sort().join("-"),P].join("|");Ge(b,{notas:I,customKey:X,bowlCustomization:{bases:A,toppings:z,proteina:P}}),$(null),ge()},je=()=>{$(null),ge()},M=A.length>=ms,te=z.length>=fs,be=A.length>=_a&&A.length<=ms&&z.length>=Ca&&z.length<=fs&&!!P,Pe=async()=>{if(!(!m||_))try{ie(!0),await s(m.orderId,{items:m.items,total:m.total}),x(null),y(!1),g("")}catch(I){console.error("Error updating order:",I),alert("Error al actualizar la orden")}finally{ie(!1)}},_e=()=>{x(null),y(!1),g(""),ie(!1)},os=async I=>{if(!(O===I.id||!window.confirm(`¿Eliminar la comanda #${I.numero}? Esta acción no se puede deshacer.`)))try{se(I.id),await a(I.id),(m==null?void 0:m.orderId)===I.id&&_e()}catch(j){console.error("Error al eliminar la comanda:",j),alert("No se pudo eliminar la comanda. Inténtalo nuevamente.")}finally{se(null)}},k=(I,X)=>{if(!((X==null?void 0:X.force)??!1)&&vs(I))return;const U=X!=null&&X.overrideItems?{...I,items:X.overrideItems,total:X.overrideTotal??Ys(X.overrideItems)}:I;S(null),Z(U)},N=()=>{re||Z(null)},q=async I=>{if(ue)try{ae(!0),await n(ue,I),Z(null)}catch(X){console.error("Error al registrar el pago:",X),alert("No se pudo registrar el pago. Inténtalo nuevamente.")}finally{ae(!1)}},V=async I=>{if(ue)try{ae(!0),await i(ue,I),Z(null)}catch(X){console.error("Error al asignar la comanda a crédito de empleados:",X),alert("No se pudo asignar el crédito. Inténtalo nuevamente.")}finally{ae(!1)}},me=I=>{const X=I.target.value;K(X||Cn(new Date)),ye(1)},Ee=()=>{ye(I=>Math.max(1,I-1))},$e=()=>{ye(I=>Math.min(Se,I+1))},Re=I=>{ye(I)},ct=I=>{S(X=>X===I?null:I)},yt=Wn(f),Jt=u.filter(I=>{const X=!yt||Wn(I.nombre).includes(yt),j=I.inventarioCategoria!=="Inventariables";return X&&j}),Es=I=>{var Fu,Uu,Bu,Hu,Wu;const X=jn(I),j=((Fu=I.creditInfo)==null?void 0:Fu.type)==="empleados";let U="";if(j){const Ue=(Bu=(Uu=I.creditInfo)==null?void 0:Uu.employeeName)==null?void 0:Bu.trim();Ue?U=` · ${Ue}`:(Hu=I.creditInfo)!=null&&Hu.employeeId&&(U=` · Empleado ${I.creditInfo.employeeId}`)}const ee=j?Math.max(0,Math.round(((Wu=I.creditInfo)==null?void 0:Wu.amount)??I.total)):0,ne=j?`Crédito empleados${U} · ${W(ee||I.total)}`:co(X,W),he=vs(I),Ae=$v(I),Ve=Ae?he?"Pago registrado":"Pago gestionado":"Pago pendiente",Wt=I.estado!=="pendiente",Xt=o&&Wt&&(he||!j),Nn=Wt&&(he||!j||o),wl=o&&I.estado==="entregado"&&(he||j),Lu=he&&o,zu=O===I.id,jo=w===I.id,Yn=!!R[I.id];return r.jsxs("div",{className:"ui-card ui-card-pad hover:shadow-md transition-shadow duration-200",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between lg:items-start mb-4 space-y-2 lg:space-y-0",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("h3",{className:"text-lg lg:text-xl font-bold mb-1",style:{color:v.dark},children:["#",I.numero]}),r.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:Cu(I.timestamp)})]}),r.jsxs("div",{className:"flex items-center gap-2 self-start",children:[r.jsxs("span",{className:`px-2 lg:px-3 py-1 rounded-full text-xs lg:text-sm font-medium border flex items-center gap-1 ${Ze(I.estado)}`,children:[St(I.estado),r.jsx("span",{className:"hidden lg:inline",children:I.estado})]}),I.estado==="entregado"&&wl&&(m==null?void 0:m.orderId)!==I.id&&r.jsxs("button",{type:"button",onClick:()=>ct(I.id),className:`flex items-center gap-1 px-2.5 py-1.5 rounded-full text-xs lg:text-sm font-medium border transition-colors shadow-sm ${jo?"bg-blue-600 border-blue-600 text-white hover:bg-blue-700":"text-blue-600 border-blue-200 hover:border-blue-600 hover:bg-blue-600 hover:text-white"}`,title:jo?"Ocultar acciones":"Editar comanda","aria-pressed":jo,children:[r.jsx($r,{size:14}),r.jsx("span",{className:"hidden sm:inline",children:"Editar"})]}),o&&r.jsx("button",{type:"button",onClick:()=>os(I),disabled:zu,className:"p-1.5 rounded-full border border-transparent text-gray-400 hover:text-red-600 hover:bg-red-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Eliminar comanda","aria-label":"Eliminar comanda",children:zu?r.jsx(ft,{size:16,className:"animate-spin text-red-600"}):r.jsx(Hn,{size:16})})]})]}),I.cliente&&r.jsxs("div",{className:"flex items-center gap-2 mb-3 text-xs lg:text-sm text-gray-600",children:[r.jsx(cg,{size:14}),r.jsx("span",{children:I.cliente})]}),r.jsx("div",{className:"flex flex-col gap-2 mb-4",children:r.jsxs("div",{className:"flex items-center justify-between text-xs lg:text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Ps,{size:14}),r.jsx("span",{className:"text-left",children:ne})]}),r.jsx("span",{className:`px-2 py-1 rounded-full font-medium ${Ae?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-800"}`,children:Ve})]})}),(m==null?void 0:m.orderId)===I.id?r.jsxs("div",{className:"space-y-3 mb-4",children:[r.jsx("h4",{className:"font-semibold text-sm",children:"Editando pedido:"}),m.items.map((Ue,Vs)=>r.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:r.jsxs("div",{className:"flex flex-col space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsx("span",{className:"font-medium text-sm",children:Ue.item.nombre}),r.jsx("button",{onClick:()=>Ht(Vs),className:"text-red-600 hover:text-red-800 p-1",children:r.jsx(Hn,{size:14})})]}),Ue.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full w-fit",children:Fr}),r.jsxs("div",{className:"text-xs text-gray-600",children:["Precio unidad:"," ",Ue.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-2",children:W(sn(Ue))}),r.jsx("span",{className:"font-semibold text-green-600",children:W(Xa(Ue))})]}):r.jsx("span",{children:W(sn(Ue))})]}),Ue.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:Ue.notas}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Cant:"}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("button",{onClick:()=>xt(Vs,Ue.cantidad-1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(Su,{size:12})}),r.jsx("span",{className:"w-8 text-center text-sm",children:Ue.cantidad}),r.jsx("button",{onClick:()=>xt(Vs,Ue.cantidad+1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300",children:r.jsx(xn,{size:12})})]})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Precio:"}),r.jsx("input",{type:"number",value:sn(Ue),onChange:vx=>_t(Vs,Number(vx.target.value)),className:"w-20 px-2 py-1 text-xs border border-gray-300 rounded"})]})]}),Rg(Ue.item)&&r.jsx("button",{onClick:()=>T(Vs),className:`self-start inline-flex items-center gap-1 rounded-full px-3 py-1 text-[11px] font-medium transition-colors ${Ue.studentDiscount?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"}`,children:Ue.studentDiscount?"Quitar descuento":"Aplicar descuento estudiante"}),r.jsx("div",{className:"text-right",children:r.jsxs("span",{className:"text-sm font-medium",children:["Subtotal: ",W(Za(Ue))]})})]})},Vs)),r.jsx("div",{className:"flex flex-col lg:flex-row gap-2",children:r.jsxs("button",{onClick:()=>y(!0),disabled:_,className:"flex-1 py-2 px-3 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(xn,{size:14}),"Agregar producto"]})}),r.jsxs("div",{className:"border-t pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("span",{className:"font-bold",children:"Nuevo Total:"}),r.jsx("span",{className:"font-bold text-lg",style:{color:v.accent},children:W(m.total)})]}),r.jsxs("div",{className:"flex flex-col gap-2",children:[Nn&&r.jsxs("button",{onClick:()=>k(I,{force:he,overrideItems:m.items,overrideTotal:m.total}),disabled:_||he&&!o,className:"w-full py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Ps,{size:14}),he?"Modificar pago":"Registrar pago"]}),Nn&&Lu&&r.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:"Al guardar se restablecerá el estado del pago actual."}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:Pe,disabled:_,className:"flex-1 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:_?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:14,className:"animate-spin"}),"Guardando..."]}):r.jsxs(r.Fragment,{children:[r.jsx(ng,{size:14}),"Guardar"]})}),r.jsxs("button",{onClick:_e,disabled:_,className:"flex-1 py-2 bg-gray-400 text-white rounded-lg text-sm font-medium hover:bg-gray-500 flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Lr,{size:14}),"Cancelar"]})]})]})]})]}):r.jsx("div",{className:"space-y-2 mb-4",children:I.items.map((Ue,Vs)=>r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between items-center text-xs lg:text-sm",children:[r.jsxs("span",{children:[Ue.cantidad,"x ",Ue.item.nombre]}),r.jsx("span",{className:"font-medium",children:W(Za(Ue))})]}),r.jsxs("div",{className:"text-[11px] lg:text-xs text-gray-600",children:["Precio unidad:"," ",Ue.studentDiscount?r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"line-through text-gray-400 mr-1",children:W(sn(Ue))}),r.jsx("span",{className:"font-semibold text-green-600",children:W(Xa(Ue))})]}):r.jsx("span",{children:W(sn(Ue))})]}),Ue.studentDiscount&&r.jsx("span",{className:"inline-flex items-center text-[11px] font-medium text-green-700 bg-green-100 px-2 py-0.5 rounded-full",children:Fr}),Ue.notas&&r.jsx("p",{className:"text-xs text-gray-500 whitespace-pre-line",children:Ue.notas})]},Vs))}),(m==null?void 0:m.orderId)!==I.id&&r.jsxs(Ku.Fragment,{children:[r.jsx("div",{className:"border-t pt-3 mb-4",children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("span",{className:"font-bold",children:"Total:"}),r.jsx("span",{className:"font-bold text-lg",style:{color:v.accent},children:W(I.total)})]})}),r.jsx("div",{className:"space-y-2",children:I.estado==="entregado"?r.jsx("div",{className:"space-y-2",children:he?jo&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("button",{onClick:()=>it(I),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),r.jsxs("button",{onClick:()=>k(I,{force:he}),disabled:!o,className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:[r.jsx(Ps,{size:14}),"Modificar pago"]}),Lu&&r.jsx("p",{className:"text-[11px] text-gray-500 text-center",children:"Al guardar los cambios se restablecerá el estado del pago."})]}):j?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg text-xs text-yellow-800",children:[r.jsxs("p",{className:"font-semibold",children:["Crédito de empleados en seguimiento",U]}),r.jsx("p",{className:"mt-1 text-[11px] text-yellow-700",children:"Gestiona el cobro desde el módulo Crédito empleados cuando el colaborador realice el pago."})]}),o&&r.jsxs("button",{onClick:()=>k(I),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Ps,{size:14}),"Gestionar crédito"]})]}):r.jsxs("div",{className:"space-y-2",children:[Xt&&r.jsx("button",{onClick:()=>it(I),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),r.jsxs("button",{onClick:()=>k(I),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Ps,{size:14}),"Registrar pago"]})]})}):r.jsxs(Ku.Fragment,{children:[I.estado==="pendiente"&&r.jsx("button",{onClick:()=>H(I,"preparando"),disabled:Yn,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:v.dark},children:Yn?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:16,className:"animate-spin"}),"Procesando..."]}):"Iniciar preparación"}),I.estado==="preparando"&&r.jsx("button",{onClick:()=>H(I,"listo"),disabled:Yn,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:v.accent,color:v.dark},children:Yn?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:16,className:"animate-spin"}),"Procesando..."]}):"Marcar como listo"}),I.estado==="listo"&&r.jsx("button",{onClick:()=>H(I,"entregado"),disabled:Yn,className:"w-full py-2 bg-green-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:Yn?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:16,className:"animate-spin"}),"Procesando..."]}):"Entregar pedido"}),Wt&&r.jsxs("div",{className:"space-y-2 mt-2",children:[Xt&&r.jsx("button",{onClick:()=>it(I),className:"w-full py-2 bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm",children:"Modificar pedido"}),j?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg text-xs text-yellow-800",children:[r.jsxs("p",{className:"font-semibold",children:["Crédito de empleados en seguimiento",U]}),r.jsx("p",{className:"mt-1 text-[11px] text-yellow-700",children:"Gestiona el cobro desde el módulo Crédito empleados cuando el colaborador realice el pago."})]}),o&&r.jsxs("button",{onClick:()=>k(I),className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1",children:[r.jsx(Ps,{size:14}),"Gestionar crédito"]})]}):Nn&&r.jsxs("button",{onClick:()=>k(I,he?{force:!0}:void 0),disabled:he&&!o,className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm flex items-center justify-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Ps,{size:14}),he?"Modificar pago":"Registrar pago"]})]})]})})]})]},I.id)};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:v.dark},children:"Gestión de Comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Control de pedidos y estado de preparación"})]}),d&&!c&&r.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-500",children:[r.jsx(ft,{size:16,className:"animate-spin"}),r.jsx("span",{children:"Sincronizando cambios…"})]}),c?r.jsxs("div",{className:"ui-card ui-card-pad text-center",children:[r.jsx(ft,{size:40,className:"mx-auto text-gray-400 mb-4 animate-spin"}),r.jsx("h3",{className:"text-lg lg:text-xl font-semibold text-gray-600 mb-2",children:"Cargando comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Estamos obteniendo la información más reciente."})]}):e.length===0?r.jsxs("div",{className:"ui-card ui-card-pad text-center",children:[r.jsx(ps,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg lg:text-xl font-semibold text-gray-600 mb-2",children:"No hay comandas"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Los pedidos aparecerán aquí cuando se procesen desde caja"})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:G?`Comandas del ${le}`:le}),r.jsxs("p",{className:"text-sm text-gray-500",children:[fe.length===1?"1 comanda registrada":`${fe.length} comandas registradas`,fe.length>0&&F&&r.jsx("span",{children:` · Mostrando ${Fe}-${Ie}`})]})]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:[r.jsx("label",{htmlFor:"comandas-date-picker",className:"text-sm font-medium text-gray-600",children:"Selecciona el día"}),r.jsx("input",{id:"comandas-date-picker",type:"date",value:Y,onChange:me,max:Cn(new Date),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-yellow-400"})]})]}),fe.length===0?r.jsx("div",{className:"ui-card ui-card-pad text-center text-gray-500",children:"No hay comandas registradas para esta fecha."}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6",children:ze.map(Es)}),F&&r.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[r.jsx("button",{type:"button",onClick:Ee,className:"px-3 py-1.5 rounded-full border text-sm font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",disabled:pe===1,children:"Anterior"}),r.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Se},(I,X)=>X+1).map(I=>{const X=I===pe;return r.jsx("button",{type:"button",onClick:()=>Re(I),className:`w-9 h-9 rounded-full border text-sm font-medium transition-colors ${X?"shadow-sm":"hover:border-gray-300"}`,style:X?{backgroundColor:v.accent,color:v.dark,borderColor:v.accent}:void 0,"aria-current":X?"page":void 0,children:I},I)})}),r.jsx("button",{type:"button",onClick:$e,className:"px-3 py-1.5 rounded-full border text-sm font-medium text-gray-600 hover:text-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",disabled:pe===Se,children:"Siguiente"})]})]})]}),ue&&r.jsx(px,{order:ue,onClose:N,onSubmit:q,isSubmitting:re,title:"Gestionar pago",onAssignCredit:V}),E&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[80vh] overflow-hidden flex flex-col",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:v.dark},children:"Agregar Producto"}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:f,onChange:I=>g(I.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent mb-4 text-sm",style:{"--tw-ring-color":v.accent}}),r.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 mb-4",children:Jt.slice(0,10).map(I=>r.jsx("button",{onClick:()=>J(I),className:"w-full text-left p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:r.jsxs("div",{className:"flex justify-between items-start",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-medium text-sm",children:I.nombre}),r.jsx("p",{className:"text-xs text-gray-600",children:I.categoria})]}),r.jsx("span",{className:"font-bold text-sm",style:{color:v.accent},children:W(I.precio)})]})},I.id))}),r.jsx("button",{onClick:()=>{y(!1),g("")},className:"w-full py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 text-sm",children:"Cancelar"})]})}),b&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-lg lg:text-xl font-bold mb-4",style:{color:v.dark},children:"Personaliza tu Bowl Salado"}),r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tus bases"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[A.length,"/",ms]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:ux.map(I=>{const X=A.includes(I),j=!X&&M;return r.jsxs("button",{type:"button",onClick:()=>ke(I,A,B,ms),disabled:j,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${X?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${j?"opacity-50 cursor-not-allowed":""}`,style:X?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:I}),X&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},I)})})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tus toppings"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[z.length,"/",fs]})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:hx.map(I=>{const X=z.includes(I),j=!X&&te;return r.jsxs("button",{type:"button",onClick:()=>ke(I,z,de,fs),disabled:j,className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${X?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"} ${j?"opacity-50 cursor-not-allowed":""}`,style:X?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:I}),X&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},I)})})]}),r.jsxs("div",{children:[r.jsx("div",{className:"flex items-center justify-between mb-2",children:r.jsx("h4",{className:"text-sm font-semibold",style:{color:v.dark},children:"Elige tu proteína"})}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:mx.map(I=>{const X=P===I;return r.jsxs("button",{type:"button",onClick:()=>Me(I),className:`flex items-center justify-between rounded-lg border px-4 py-3 text-sm font-medium transition-colors ${X?"border-transparent shadow-sm":"border-gray-200 hover:border-gray-300"}`,style:X?{backgroundColor:v.beige,color:v.dark,borderColor:v.accent}:void 0,children:[r.jsx("span",{children:I}),X&&r.jsx("span",{className:"ml-3 inline-flex h-6 w-6 items-center justify-center rounded-full text-white",style:{backgroundColor:v.accent,color:v.dark},children:r.jsx(_r,{size:16})})]},I)})})]})]}),r.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 sm:justify-end border-t pt-4",children:[r.jsx("button",{onClick:je,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{onClick:ce,disabled:!be,className:"px-4 py-2 rounded-lg text-white font-semibold text-sm transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:v.dark},children:"Agregar al pedido"})]})]})})]})}function M1({menuItems:e,onUpdateMenuItem:t,onCreateMenuItem:s,onDeleteMenuItem:n}){const[a,o]=p.useState(""),[i,l]=p.useState(""),[c,d]=p.useState("all"),[u,h]=p.useState(null),[m,x]=p.useState(null),w=p.useMemo(()=>Array.from(new Set(e.filter(P=>P.inventarioCategoria==="Inventariables").map(P=>P.categoria))),[e]),S=p.useMemo(()=>Array.from(new Set(e.filter(P=>P.inventarioCategoria!=="Inventariables").map(P=>P.categoria))),[e]);p.useEffect(()=>{i&&!S.includes(i)&&l("")},[S,i]);const E=Wn(a),y=e.filter(P=>{const D=!E||Wn(P.nombre).includes(E),Y=!i||P.categoria===i,K=c==="all"||c==="inventariables"&&P.inventarioCategoria==="Inventariables"||c==="no-inventariables"&&P.inventarioCategoria==="No inventariables";return D&&Y&&K}),f=y.filter(P=>P.inventarioCategoria==="Inventariables"),g=y.filter(P=>P.inventarioCategoria!=="Inventariables"),b=y.filter(P=>(P.stock??0)<10),$=y.filter(P=>(P.stock??0)===0),A=(P,D)=>{const Y=e.find(K=>K.id===P);if(Y){const K=Math.max(0,(Y.stock??0)+D);t({...Y,stock:K})}},B=()=>{u&&(t(u),h(null))},z=()=>{if(m){const P=dg(m.nombre,m.categoria);s({id:crypto.randomUUID(),codigo:P,nombre:m.nombre,precio:m.precio??0,categoria:m.categoria,stock:m.stock??0,descripcion:m.descripcion,inventarioCategoria:m.inventarioCategoria,inventarioTipo:m.inventarioCategoria==="Inventariables"?m.inventarioTipo:void 0,unidadMedida:m.inventarioCategoria==="Inventariables"&&m.inventarioTipo==="gramos"?m.unidadMedida:void 0}),x(null)}},de=P=>r.jsx("div",{className:`ui-card ui-card-pad transition-all duration-200 hover:shadow-md border ${P.stock===0?"border-red-200":P.stock<10?"border-yellow-200":"border-gray-100"}`,children:(u==null?void 0:u.id)===P.id?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{className:"border border-gray-300 rounded px-3 py-2",placeholder:"Nombre",value:u.nombre,onChange:D=>h({...u,nombre:D.target.value})}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:"Precio (ej. 8500)",value:u.precio===0?"":u.precio,onChange:D=>{const Y=parseInt(D.target.value,10);h({...u,precio:isNaN(Y)?0:Y})}}),r.jsx("input",{list:u.inventarioCategoria==="Inventariables"?"inventariable-category-options":"non-inventariable-category-options",className:"border border-gray-300 rounded px-3 py-2",placeholder:"Categoría (selecciona o crea)",value:u.categoria,onChange:D=>h({...u,categoria:D.target.value})}),r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:u.inventarioCategoria,onChange:D=>h({...u,inventarioCategoria:D.target.value}),children:[r.jsx("option",{value:"Inventariables",children:"Inventariables"}),r.jsx("option",{value:"No inventariables",children:"No inventariables"})]}),u.inventarioCategoria==="Inventariables"&&r.jsxs(r.Fragment,{children:[r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:u.inventarioTipo??"cantidad",onChange:D=>h({...u,inventarioTipo:D.target.value}),children:[r.jsx("option",{value:"cantidad",children:"Cantidad"}),r.jsx("option",{value:"gramos",children:"Gramos"})]}),u.inventarioTipo==="gramos"&&r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:u.unidadMedida??"kg",onChange:D=>h({...u,unidadMedida:D.target.value}),children:[r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"mg",children:"mg"}),r.jsx("option",{value:"ml",children:"ml"})]}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:u.inventarioTipo==="gramos"?"Peso (ej. 10)":"Cantidad (ej. 10)",value:u.stock===0?"":u.stock,onChange:D=>{const Y=parseInt(D.target.value,10);h({...u,stock:isNaN(Y)?0:Y})}})]}),r.jsx("textarea",{className:"border border-gray-300 rounded px-3 py-2 md:col-span-2",placeholder:"Descripción (opcional)",value:u.descripcion||"",onChange:D=>h({...u,descripcion:D.target.value})})]}),r.jsxs("div",{className:"mt-4 flex gap-2",children:[r.jsx("button",{onClick:B,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Guardar"}),r.jsx("button",{onClick:()=>h(null),className:"px-3 py-1 bg-gray-400 text-white rounded text-sm hover:bg-gray-500",children:"Cancelar"})]})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-lg mb-1",style:{color:v.dark},children:P.nombre}),r.jsxs("p",{className:"text-sm text-gray-600 mb-1",children:[P.categoria," • ",P.inventarioCategoria??"No inventariables"]}),r.jsx("p",{className:"text-sm font-medium",style:{color:v.accent},children:W(P.precio)})]}),r.jsx("div",{className:"text-right",children:r.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${P.stock===0?"bg-red-100 text-red-800":P.stock<10?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,title:"Stock disponible",children:[r.jsx(cd,{size:12}),r.jsxs("span",{children:["Stock: ",P.stock??0,P.inventarioTipo==="gramos"&&P.unidadMedida?` ${P.unidadMedida}`:""]})]})})]}),P.descripcion&&r.jsx("p",{className:"text-sm text-gray-500 mb-4 line-clamp-2",children:P.descripcion}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>A(P.id,-1),disabled:(P.stock??0)===0,className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 disabled:opacity-50",children:r.jsx(Su,{size:14})}),r.jsx("button",{onClick:()=>A(P.id,1),className:"w-8 h-8 rounded-full flex items-center justify-center text-white hover:opacity-90",style:{backgroundColor:v.dark},children:r.jsx(xn,{size:14})})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:()=>h(P),className:"flex items-center gap-1 px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:[r.jsx($r,{size:14})," Editar"]}),r.jsxs("button",{onClick:()=>n(P.id),className:"flex items-center gap-1 px-3 py-1 text-sm text-red-600 hover:text-red-800",children:[r.jsx(yv,{size:14})," Eliminar"]})]})]})]})},P.id);return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsx("datalist",{id:"inventariable-category-options",children:w.map(P=>r.jsx("option",{value:P},`inventariable-${P}`))}),r.jsx("datalist",{id:"non-inventariable-category-options",children:S.map(P=>r.jsx("option",{value:P},`non-inventariable-${P}`))}),r.jsxs("div",{className:"text-center px-2 sm:px-0",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:v.dark},children:"Control de Inventario"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Gestión de stock y alertas de productos"})]}),(b.length>0||$.length>0)&&r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[$.length>0&&r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg lg:rounded-xl p-3 lg:p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Ar,{size:20,className:"text-red-600"}),r.jsxs("h3",{className:"font-semibold text-red-800 text-sm lg:text-base",children:["Sin stock (",$.length,")"]})]}),r.jsxs("div",{className:"space-y-1",children:[$.slice(0,3).map(P=>r.jsx("p",{className:"text-sm text-red-700",children:P.nombre},P.id)),$.length>3&&r.jsxs("p",{className:"text-sm text-red-600",children:["y ",$.length-3," más..."]})]})]}),b.length>0&&r.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg lg:rounded-xl p-3 lg:p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx(Ar,{size:20,className:"text-yellow-600"}),r.jsxs("h3",{className:"font-semibold text-yellow-800 text-sm lg:text-base",children:["Stock bajo (",b.length,")"]})]}),r.jsxs("div",{className:"space-y-1",children:[b.slice(0,3).map(P=>r.jsxs("p",{className:"text-sm text-yellow-700",children:[P.nombre," (",P.stock,P.inventarioTipo==="gramos"&&P.unidadMedida?` ${P.unidadMedida}`:"",")"]},P.id)),b.length>3&&r.jsxs("p",{className:"text-sm text-yellow-600",children:["y ",b.length-3," más..."]})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"relative",children:[r.jsx(rg,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),r.jsx("input",{type:"text",placeholder:"Buscar productos...",value:a,onChange:P=>o(P.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:flex-wrap sm:items-center",children:[r.jsxs("div",{className:"inline-flex items-center gap-2 text-sm font-medium text-gray-600",children:[r.jsx(tg,{size:16,className:"text-gray-500"}),r.jsx("span",{children:"Tipo:"})]}),r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4 w-full sm:w-auto",children:[r.jsxs("select",{value:c,onChange:P=>d(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full sm:w-auto",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"all",children:"Todos"}),r.jsx("option",{value:"inventariables",children:"Inventariables"}),r.jsx("option",{value:"no-inventariables",children:"No inventariables"})]}),r.jsxs("select",{value:i,onChange:P=>l(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full sm:w-auto",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"",children:"Todas las categorías"}),S.map(P=>r.jsx("option",{value:P,children:P},P))]})]}),r.jsx("div",{className:"sm:ml-auto w-full sm:w-auto",children:r.jsxs("button",{onClick:()=>x({nombre:"",precio:null,categoria:"",inventarioCategoria:"No inventariables",inventarioTipo:"cantidad",unidadMedida:"kg",stock:null,descripcion:""}),className:"flex w-full sm:w-auto items-center justify-center gap-2 px-4 py-2 rounded-lg text-white text-sm font-medium shadow-sm",style:{backgroundColor:v.accent},children:[r.jsx(xn,{size:16})," Agregar producto"]})})]})]}),m&&r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{className:"border border-gray-300 rounded px-3 py-2",placeholder:"Nombre",value:m.nombre,onChange:P=>x({...m,nombre:P.target.value})}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:"Precio (ej. 8500)",value:m.precio??"",onChange:P=>{const D=parseInt(P.target.value,10);x({...m,precio:isNaN(D)?null:D})}}),r.jsx("input",{list:m.inventarioCategoria==="Inventariables"?"inventariable-category-options":"non-inventariable-category-options",className:"border border-gray-300 rounded px-3 py-2",placeholder:"Categoría (selecciona o crea)",value:m.categoria,onChange:P=>x({...m,categoria:P.target.value})}),r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.inventarioCategoria,onChange:P=>x({...m,inventarioCategoria:P.target.value}),children:[r.jsx("option",{value:"Inventariables",children:"Inventariables"}),r.jsx("option",{value:"No inventariables",children:"No inventariables"})]}),m.inventarioCategoria==="Inventariables"&&r.jsxs(r.Fragment,{children:[r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.inventarioTipo,onChange:P=>x({...m,inventarioTipo:P.target.value}),children:[r.jsx("option",{value:"cantidad",children:"Cantidad"}),r.jsx("option",{value:"gramos",children:"Gramos"})]}),m.inventarioTipo==="gramos"&&r.jsxs("select",{className:"border border-gray-300 rounded px-3 py-2",value:m.unidadMedida,onChange:P=>x({...m,unidadMedida:P.target.value}),children:[r.jsx("option",{value:"kg",children:"kg"}),r.jsx("option",{value:"g",children:"g"}),r.jsx("option",{value:"mg",children:"mg"}),r.jsx("option",{value:"ml",children:"ml"})]}),r.jsx("input",{type:"number",min:0,className:"border border-gray-300 rounded px-3 py-2",placeholder:m.inventarioTipo==="gramos"?"Peso (ej. 10)":"Cantidad (ej. 10)",value:m.stock??"",onChange:P=>{const D=parseInt(P.target.value,10);x({...m,stock:isNaN(D)?null:D})}})]}),r.jsx("textarea",{className:"border border-gray-300 rounded px-3 py-2 lg:col-span-2",placeholder:"Descripción (opcional)",value:m.descripcion||"",onChange:P=>x({...m,descripcion:P.target.value})})]}),r.jsxs("div",{className:"mt-4 flex gap-2",children:[r.jsx("button",{onClick:z,className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Guardar"}),r.jsx("button",{onClick:()=>x(null),className:"px-3 py-1 bg-gray-400 text-white rounded text-sm hover:bg-gray-500",children:"Cancelar"})]})]}),r.jsxs("div",{className:"space-y-8",children:[f.length>0&&(c==="all"||c==="inventariables")&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-xl font-semibold mb-4",style:{color:v.dark},children:["Inventariables (",f.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(de)})]}),g.length>0&&(c==="all"||c==="no-inventariables")&&r.jsxs("div",{children:[r.jsxs("h3",{className:"text-xl font-semibold mb-4",style:{color:v.dark},children:["No inventariables (",g.length,")"]}),Array.from(new Set(g.map(P=>P.categoria))).map(P=>{const D=g.filter(Y=>Y.categoria===P);return r.jsxs("div",{className:"mb-8",children:[r.jsxs("h4",{className:"text-lg font-medium mb-3 text-gray-700 border-b border-gray-200 pb-2",children:[P," (",D.length,")"]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:D.map(de)})]},P)})]}),y.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(cd,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No se encontraron productos"}),r.jsx("p",{className:"text-gray-500",children:"Intenta ajustar los filtros de búsqueda"})]})]})]})}function P1({orders:e,onUpdateOrderStatus:t}){const[s,n]=p.useState({}),a=async(d,u)=>{if(!s[d.id]){n(h=>({...h,[d.id]:!0}));try{await t(d,u)}finally{n(h=>{const{[d.id]:m,...x}=h;return x})}}},o=e.filter(d=>d.estado==="pendiente"||d.estado==="preparando").sort((d,u)=>d.timestamp.getTime()-u.timestamp.getTime()),i=e.filter(d=>d.estado==="listo").sort((d,u)=>u.timestamp.getTime()-d.timestamp.getTime()),l=d=>{const u=Math.floor((Date.now()-d.getTime())/6e4);return u<1?"Recién llegado":u===1?"1 minuto":`${u} minutos`},c=d=>{const u=Math.floor((Date.now()-d.getTime())/6e4);return u>15?"urgent":u>10?"warning":"normal"};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:v.dark},children:"Módulo de Cocina"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"Vista de preparación y seguimiento de pedidos"})]}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[r.jsx("div",{className:"xl:col-span-2 space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(od,{size:24,style:{color:v.dark}}),r.jsxs("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:["En preparación (",o.length,")"]})]}),o.length===0?r.jsxs("div",{className:"text-center py-8 lg:py-12",children:[r.jsx(od,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h4",{className:"text-base lg:text-lg font-semibold text-gray-600 mb-2",children:"No hay pedidos pendientes"}),r.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"Los nuevos pedidos aparecerán aquí"})]}):r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:o.map(d=>{const u=!!s[d.id],h=c(d.timestamp);return r.jsxs("div",{className:`border rounded-xl p-3 sm:p-4 transition-all duration-200 ${h==="urgent"?"border-red-300 bg-red-50":h==="warning"?"border-yellow-300 bg-yellow-50":"border-gray-200 bg-white"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{children:[r.jsxs("h4",{className:"text-base lg:text-lg font-bold",style:{color:v.dark},children:["#",d.numero]}),r.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[r.jsx(ps,{size:14}),r.jsx("span",{children:l(d.timestamp)})]})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[h==="urgent"&&r.jsx(Y0,{size:16,className:"text-red-600"}),h==="warning"&&r.jsx(ps,{size:16,className:"text-yellow-600"}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${d.estado==="preparando"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:d.estado})]})]}),d.cliente&&r.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:["Cliente: ",d.cliente]}),r.jsx("div",{className:"space-y-2 mb-4",children:d.items.map((m,x)=>r.jsx("div",{className:"flex justify-between items-center text-sm",children:r.jsxs("span",{className:"font-medium",children:[m.cantidad,"x ",m.item.nombre]})},x))}),r.jsxs("div",{className:"space-y-2",children:[d.estado==="pendiente"&&r.jsx("button",{onClick:()=>a(d,"preparando"),disabled:u,className:"w-full py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:v.dark},children:u?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:16,className:"animate-spin"}),"Procesando..."]}):"Iniciar preparación"}),d.estado==="preparando"&&r.jsx("button",{onClick:()=>a(d,"listo"),disabled:u,className:"w-full py-2 rounded-lg font-medium transition-all duration-200 hover:scale-105 text-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:v.accent,color:v.dark},children:u?r.jsxs(r.Fragment,{children:[r.jsx(ft,{size:16,className:"animate-spin"}),"Procesando..."]}):"Marcar como listo"})]})]},d.id)})})]})}),r.jsx("div",{className:"space-y-6",children:r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[r.jsx(Ii,{size:24,className:"text-green-600"}),r.jsxs("h3",{className:"text-lg lg:text-xl font-bold",style:{color:v.dark},children:["Listos (",i.length,")"]})]}),i.length===0?r.jsx("p",{className:"text-gray-500 text-center py-6 lg:py-8 text-sm",children:"No hay pedidos listos"}):r.jsx("div",{className:"space-y-3",children:i.map(d=>r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 lg:p-4",children:[r.jsxs("div",{className:"flex justify-between items-start mb-2",children:[r.jsxs("h4",{className:"font-bold text-green-800 text-sm lg:text-base",children:["#",d.numero]}),r.jsx("span",{className:"text-xs text-green-600",children:Cu(d.timestamp)})]}),d.cliente&&r.jsx("p",{className:"text-sm text-green-700 mb-2",children:d.cliente}),r.jsxs("div",{className:"text-sm text-green-700",children:[d.items.length," ",d.items.length===1?"producto":"productos"]})]},d.id))})]})})]})]})}function D1({customers:e,onAddCustomer:t,onUpdateCustomer:s,onDeleteCustomer:n}){const[a,o]=p.useState(""),[i,l]=p.useState(""),[c,d]=p.useState(null),u=()=>{if(!a.trim()||!i.trim())return;const x=a.trim(),w=i.trim();c?s({id:c,nombre:x,telefono:w}):t({id:crypto.randomUUID(),nombre:x,telefono:w}),o(""),l(""),d(null)},h=x=>{d(x.id),o(x.nombre),l(x.telefono)},m=()=>{d(null),o(""),l("")};return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Rr,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Clientes"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-stretch",children:[r.jsx("div",{className:"flex-1",children:r.jsx("input",{type:"text",placeholder:"Nombre",value:a,onChange:x=>o(x.target.value),className:"w-full px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent}})}),r.jsx("div",{className:"flex-1",children:r.jsx("input",{type:"tel",placeholder:"Teléfono",value:i,onChange:x=>l(x.target.value),className:"w-full px-3 lg:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm",style:{"--tw-ring-color":v.accent}})}),r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full lg:w-auto",children:[r.jsx("button",{onClick:u,className:"px-3 lg:px-4 py-2 rounded-lg text-white font-medium text-sm w-full",style:{backgroundColor:v.dark},children:c?"Actualizar":"Agregar"}),c&&r.jsx("button",{onClick:m,className:"px-3 lg:px-4 py-2 rounded-lg border border-gray-300 text-sm w-full",children:"Cancelar"})]})]}),r.jsx("div",{className:"ui-card",children:r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table border border-gray-200 rounded-lg",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-50",children:[r.jsx("th",{className:"px-3 lg:px-4 py-2 text-left text-sm font-semibold text-gray-700",children:"Nombre"}),r.jsx("th",{className:"px-3 lg:px-4 py-2 text-left text-sm font-semibold text-gray-700",children:"Teléfono"}),r.jsx("th",{className:"px-3 lg:px-4 py-2"})]})}),r.jsxs("tbody",{children:[e.map(x=>r.jsxs("tr",{className:"border-t",children:[r.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm",children:x.nombre}),r.jsx("td",{className:"px-3 lg:px-4 py-2 text-sm",children:x.telefono}),r.jsxs("td",{className:"px-3 lg:px-4 py-2 flex gap-2",children:[r.jsx("button",{onClick:()=>h(x),className:"p-1 rounded hover:bg-gray-100",children:r.jsx($r,{size:16})}),r.jsx("button",{onClick:()=>n(x.id),className:"p-1 rounded hover:bg-gray-100 text-red-600",children:r.jsx(Hn,{size:16})})]})]},x.id)),e.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:3,className:"px-3 lg:px-4 py-4 text-center text-gray-500 text-sm",children:"No hay clientes registrados"})})]})]})})})]})}const pt=[...uo],Ed={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes",saturday:"Sábado",sunday:"Domingo"},Ru=e=>{const t=new Date(e.getTime());t.setHours(0,0,0,0);const s=t.getDay()||7;t.setDate(t.getDate()+4-s);const n=new Date(t.getFullYear(),0,1),a=Math.ceil(((t.getTime()-n.getTime())/864e5+1)/7);return`${t.getFullYear()}-W${a.toString().padStart(2,"0")}`},$s=()=>Ru(new Date),Ur=e=>{const[t,s]=e.split("-W"),n=Number(t),a=Number(s),o=new Date(n,0,4),i=o.getDay()||7,l=new Date(o);return l.setDate(o.getDate()+(a-1)*7-(i-1)),l.setHours(0,0,0,0),l},O1=e=>{const t=new Date(e);return t.setDate(t.getDate()+6),t},Ea=e=>{try{const t=Ur(e),s=O1(t),n=new Intl.DateTimeFormat("es-ES",{day:"numeric",month:"short"});return`${n.format(t)} - ${n.format(s)}`}catch(t){return console.warn("No se pudo formatear la semana seleccionada",t),e}},wm=(e,t)=>pt.every(s=>{var n,a,o,i;return((n=e[s])==null?void 0:n.active)===((a=t[s])==null?void 0:a.active)&&Number(((o=e[s])==null?void 0:o.hours)??0)===Number(((i=t[s])==null?void 0:i.hours)??0)}),gx=e=>{const t={};return pt.forEach((s,n)=>{const a=n<e.dias_semana;t[s]={active:a,hours:a?e.horas_dia:0}}),t},Ta=(e,t)=>{const s=gx(e);if(!t)return s;const n={};return pt.forEach(a=>{const o=t[a];o?n[a]={active:!!o.active,hours:o.active?Math.max(0,Number(o.hours)||0):0}:n[a]=s[a]}),n},Rn=e=>{const t={};return pt.forEach(s=>{t[s]=e[s].active?e[s].hours:0}),t},Ss=e=>pt.reduce((t,s)=>t+(Number(e[s])||0),0),ht=e=>{const t=Number.isNaN(e)?0:e;return Math.abs(t%1)<.01?`${Math.round(t)}`:t.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:2})},Ma=e=>{if(Math.abs(e)<.01)return"Sin variación";const t=ht(Math.abs(e));return`${e>0?"+":"-"}${t} h vs base`},I1=(e,t)=>pt.every(s=>Math.abs((e[s]??0)-(t[s]??0))<.01),dc=e=>{const t={};return pt.forEach(s=>{t[s]=Number(e[s])||0}),t},A1=1423500,$1=220,Nm=44,R1=2e5,xx=A1/$1,L1=xx*1.25,z1=R1/30,uc=e=>Number.isFinite(e)?Math.round(e):0,km=e=>{const t=e.trim().toLowerCase();if(!t)return null;const s=t.match(/\b(am|pm)\b/),n=s?s[1]:null,o=t.replace(/\b(am|pm)\b/g,"").trim().match(/^(\d{1,2})(?::(\d{1,2}))?$/);if(!o)return null;let i=Number(o[1]);const l=Number(o[2]??"0");if(Number.isNaN(i)||Number.isNaN(l)||l>=60)return null;if(n)i===12?i=n==="am"?0:12:n==="pm"&&(i+=12);else if(i>23)return null;return i+l/60},F1=e=>{if(!e)return null;const s=e.replace(/[–—]/g,"-").replace(/\s+/g," ").trim().split(/\s*-\s*/);if(s.length!==2)return null;const[n,a]=s,o=/\b(am|pm)\b/i.test(n)&&/\b(am|pm)\b/i.test(a),i=km(n),l=km(a);if(i===null||l===null)return null;let c=l-i;if(c<0)if(o)c+=24;else return null;return c<=0||c>24?null:Math.round(c*100)/100},Sm=e=>{const t=e.trim();if(!t)return null;const s=F1(t);if(s!==null)return s;const n=Number(t.replace(",","."));return!Number.isFinite(n)||Number.isNaN(n)?null:Math.round(Math.max(0,n)*100)/100},_m=e=>{const t=Ss(e),s=Math.min(t,Nm),n=Math.max(0,t-Nm),a=uc(s*xx),o=uc(n*L1),i=pt.reduce((d,u)=>Number(e[u]??0)>0?d+1:d,0),l=uc(i*z1),c=a+o+l;return{totalHours:t,regularHours:s,overtimeHours:n,basePay:a,overtimePay:o,transport:l,totalPay:c,daysWorked:i}};function U1(){const[e,t]=p.useState([]),[s,n]=p.useState({}),[a,o]=p.useState({}),[i,l]=p.useState({}),[c,d]=p.useState($s()),[u,h]=p.useState({}),[m,x]=p.useState({}),[w,S]=p.useState(!0),[E,y]=p.useState(!1),[f,g]=p.useState(null),[b,$]=p.useState({}),A=p.useRef({}),B=p.useRef(!0);p.useEffect(()=>()=>{B.current=!1},[]);const z=p.useCallback(O=>{const se=A.current[O];se&&(window.clearTimeout(se),delete A.current[O])},[]);p.useEffect(()=>{let O=!0;return(async()=>{try{S(!0);const[R,C]=await Promise.all([xe.fetchEmpleados(),xe.fetchEmployeeBaseSchedules()]);if(!O)return;t(R);const H={};R.forEach(Q=>{const L=C==null?void 0:C[Q.id];L&&(H[Q.id]=L)}),n(H)}catch(R){console.error("No se pudieron cargar los empleados o los horarios base:",R),O&&g("No se pudo cargar la información inicial de empleados.")}finally{O&&S(!1)}})(),()=>{O=!1,Object.values(A.current).forEach(R=>window.clearTimeout(R)),A.current={}}},[z]),p.useEffect(()=>{e.length===0&&(o({}),h({}),x({}),$({}),l({}))},[e]);const de=p.useCallback(O=>{if(!O)return"Sin turno registrado";const se=$t(O.horaLlegada),R=O.horaSalida?$t(O.horaSalida):"pendiente";let C=`Entrada ${se} · Salida ${R}`;return O.novedad&&O.novedadInicio&&(C+=O.novedadFin?` · Novedad ${$t(O.novedadInicio)}-${$t(O.novedadFin)}`:` · Novedad ${$t(O.novedadInicio)} (en curso)`),C},[]),P=p.useCallback(O=>{if(!O)return"Sin turno registrado";const se=[`Entrada: ${$t(O.horaLlegada)}`,`Salida: ${O.horaSalida?$t(O.horaSalida):"pendiente"}`];if(O.novedad&&O.novedadInicio){const R=O.novedadFin?`${$t(O.novedadInicio)} – ${$t(O.novedadFin)}`:`${$t(O.novedadInicio)} (en curso)`;se.push(`Novedad: ${R}`)}return typeof O.horasTrabajadas=="number"&&se.push(`Horas: ${ht(O.horasTrabajadas)} h`),se.join(`
`)},[]),D=p.useCallback(async O=>{if(!O)return{};try{const se=Ur(O),R=new Date(se.getTime());R.setDate(R.getDate()+6);const C=Be(new Date(se.getTime())),H=Be(R),Q=await xe.fetchEmployeeShiftsBetween(C,H),L={};return Q.forEach(G=>{const[fe,Se,ze]=G.fecha.split("-"),Fe=Number(fe),Ie=Number(Se)-1,F=Number(ze);if([Fe,Ie,F].some(_t=>Number.isNaN(_t)))return;const le=new Date(Fe,Ie,F);le.setHours(0,0,0,0);const ge=Math.floor((le.getTime()-se.getTime())/864e5);if(ge<0||ge>=pt.length)return;const ke=pt[ge],Me=L[G.empleadoId]??(L[G.empleadoId]={}),We=Me[ke];if(!We){Me[ke]=G;return}const Ge=!!We.horaSalida,Ze=!!G.horaSalida,St=We.horaLlegada??"",it=G.horaLlegada??"";if(!Ge&&Ze){Me[ke]=G;return}it>=St&&(Me[ke]=G)}),L}catch(se){return console.error("No se pudieron cargar los turnos de la semana:",se),{}}},[]),Y=p.useCallback(async(O,se={})=>{if(!O||!B.current)return;const{preserveEdits:R=!1}=se;R||(y(!0),g(null));try{const[C,H]=await Promise.all([xe.fetchEmployeeWeeklyHoursForWeek(O),D(O)]);if(!B.current)return;o(C),l(H),R||(h({}),x({}),$({}))}catch(C){console.error("No se pudieron cargar las horas de la semana seleccionada:",C),!R&&B.current&&(g("No se pudo cargar la información de la semana."),o({}),l({}))}finally{!R&&B.current&&y(!1)}},[D]);p.useEffect(()=>{Y(c)},[c,Y]),p.useEffect(()=>{let O;return(async()=>{O=await xe.subscribeToEmployeeShifts({onChange:()=>{Y(c,{preserveEdits:!0})},debounceMs:400})})(),()=>{O==null||O()}},[Y,c]);const K=O=>{d(O||$s())},pe=(O,se,R,C)=>{const H=Number.isNaN(R)?0:Math.max(0,R);h(Q=>{const L=Q[O]?{...Q[O]}:dc(C);return L[se]=H,{...Q,[O]:L}}),$(Q=>({...Q,[O]:{status:"idle"}})),z(O)},ye=(O,se,R)=>{x(C=>{const H={...C},Q={...H[O]??{}};return Q[se]=R,H[O]=Q,H}),$(C=>({...C,[O]:{status:"idle"}})),z(O)},ue=(O,se,R,C,H)=>{const Q=R.trim();if(x(G=>{const fe={...G},Se={...fe[O]??{}};return Q?(Se[se]=Q,fe[O]=Se):(delete Se[se],Object.keys(Se).length>0?fe[O]=Se:delete fe[O]),fe}),!Q){pe(O,se,H[se]??0,C);return}const L=Sm(Q);L!==null&&pe(O,se,L,C)},Z=(O,se)=>{h(R=>({...R,[O]:dc(se)})),x(R=>{const C={...R};return delete C[O],C}),$(R=>({...R,[O]:{status:"idle"}})),z(O)},re=O=>{h(se=>{if(!se[O])return se;const R={...se};return delete R[O],R}),x(se=>{const R={...se};return delete R[O],R}),$(se=>({...se,[O]:{status:"idle"}})),z(O)},ae=async(O,se)=>{const R=dc(se);pt.forEach(C=>{R[C]=Math.max(0,Number(R[C])||0)}),$(C=>({...C,[O]:{status:"saving"}}));try{await xe.saveEmployeeWeeklyHours(O,c,R),o(C=>({...C,[O]:R})),h(C=>{const H={...C};return delete H[O],H}),x(C=>{const H={...C};return delete H[O],H}),$(C=>({...C,[O]:{status:"success",message:"Cambios guardados"}})),z(O),A.current[O]=window.setTimeout(()=>{$(C=>({...C,[O]:{status:"idle"}})),delete A.current[O]},3500)}catch(C){console.error("No se pudieron guardar las horas del empleado:",C),$(H=>({...H,[O]:{status:"error",message:"Error guardando los cambios"}}))}},_=p.useMemo(()=>{if(e.length===0)return{totalBase:0,totalWorked:0,diff:0,totalPay:0};let O=0,se=0,R=0;return e.forEach(C=>{const H=Ta(C,s[C.id]),Q=Rn(H),L=a[C.id]??Q,fe=u[C.id]??L;O+=Ss(Q),se+=Ss(fe),R+=_m(fe).totalPay}),{totalBase:O,totalWorked:se,diff:se-O,totalPay:R}},[e,s,a,u]),ie=e.length>0;return w?r.jsx("div",{className:"flex min-h-[60vh] items-center justify-center",children:r.jsxs("div",{className:"flex flex-col items-center gap-3 text-gray-500",children:[r.jsx(da,{className:"animate-spin",size:32}),r.jsx("span",{children:"Cargando empleados…"})]})}):r.jsxs("div",{className:"p-6 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Histórico semanal de empleados"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Consulta y ajusta las horas registradas por semana para todo el equipo."})]}),r.jsxs("div",{className:"flex flex-col items-start gap-2 sm:flex-row sm:items-center",children:[r.jsx("label",{className:"text-sm font-medium text-gray-600",htmlFor:"week-picker",children:"Semana seleccionada"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{id:"week-picker",type:"week",value:c,onChange:O=>K(O.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2",style:{"--tw-ring-color":v.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:Ea(c)})]})]})]}),f&&r.jsx("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ar,{size:18}),r.jsx("span",{children:f})]})}),r.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-5",children:[r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[r.jsx("span",{children:"Total empleados"}),r.jsx(B1,{count:e.length})]}),r.jsx("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:e.length})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(Qa,{size:18}),r.jsx("span",{children:"Horas base estimadas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:[ht(_.totalBase)," h"]})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(ps,{size:18}),r.jsx("span",{children:"Horas registradas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:[ht(_.totalWorked)," h"]})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(da,{size:18}),r.jsx("span",{children:"Variación vs base"})]}),r.jsx("p",{className:`mt-2 text-2xl font-bold ${Math.abs(_.diff)<.01?"text-gray-600":_.diff>0?"text-green-600":"text-orange-500"}`,children:Ma(_.diff)})]}),r.jsxs("div",{className:"rounded-2xl border border-gray-100 bg-white/70 p-4 shadow-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(_u,{size:18}),r.jsx("span",{children:"Pago semanal estimado"})]}),r.jsx("p",{className:"mt-2 text-2xl font-bold text-gray-800",children:W(_.totalPay)})]})]}),E&&r.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-blue-100 bg-blue-50 px-4 py-2 text-sm text-blue-700",children:[r.jsx(da,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Cargando información de la semana seleccionada…"})]}),!ie&&r.jsx("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-12 text-center text-gray-500",children:"No hay empleados registrados todavía."}),ie&&r.jsx("div",{className:"overflow-x-auto rounded-2xl border border-gray-100 bg-white shadow-sm",children:r.jsxs("table",{className:"min-w-[900px] w-full text-sm",children:[r.jsx("thead",{className:"bg-gray-50 text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-semibold",children:"Empleado"}),pt.map(O=>r.jsx("th",{className:"px-3 py-3 text-center font-semibold",children:Ed[O]},O)),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Total base"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Registrado"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Variación"}),r.jsx("th",{className:"px-4 py-3 text-center font-semibold",children:"Pago semanal"}),r.jsx("th",{className:"px-4 py-3"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:e.map(O=>{var ge,ke;const se=Ta(O,s[O.id]),R=Rn(se),C=a[O.id]??R,H=u[O.id],Q=H??C,L=Ss(R),G=Ss(Q),fe=G-L,Se=H?!I1(H,C):!1,ze=((ge=b[O.id])==null?void 0:ge.status)??"idle",Fe=(ke=b[O.id])==null?void 0:ke.message,Ie=_m(Q),F=Ie.overtimeHours>.01,le=Se&&ze!=="saving";return r.jsxs("tr",{className:"hover:bg-gray-50/60",children:[r.jsx("td",{className:"px-4 py-4 align-top",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-semibold text-gray-800",children:O.nombre}),r.jsxs("span",{className:"text-xs text-gray-500",children:["Jornada base: ",O.dias_semana," días • ",O.horas_dia," h/día"]})]})}),pt.map(Me=>{var ce,je;const We=H??C,Ge=((ce=m[O.id])==null?void 0:ce[Me])??"",Ze=Ge.trim(),St=Ze?Sm(Ze):null,it=!!Ze&&St===null,_t=it?"#F87171":v.accent,xt=(je=i[O.id])==null?void 0:je[Me],Ht=de(xt),T=P(xt),J=!!xt;return r.jsx("td",{className:"px-3 py-3 text-center align-top",children:r.jsxs("div",{className:"flex flex-col items-center gap-1.5",title:T,children:[r.jsx("input",{type:"text",value:Ge,placeholder:"ej. 10:00 am - 7:30 pm",onChange:M=>ye(O.id,Me,M.target.value),onBlur:M=>ue(O.id,Me,M.target.value,We,C),onKeyDown:M=>{M.key==="Enter"&&M.currentTarget.blur()},autoComplete:"off",className:`w-40 rounded-lg border px-2 py-1 text-sm focus:border-transparent focus:ring-2 ${it?"border-red-300 text-red-700 placeholder:text-red-300":"border-gray-300"}`,style:{"--tw-ring-color":_t}}),r.jsx("span",{className:`text-[11px] ${J?"text-gray-500":"text-gray-400"}`,children:Ht}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Calculadas: ",ht(Q[Me]??0)," h"]}),r.jsxs("span",{className:"text-[11px] text-gray-400",children:["Base: ",ht(R[Me]??0)," h"]}),it&&r.jsx("span",{className:"text-[11px] text-red-500",children:'Usa formato "10:00 am - 7:30 pm"'})]})},Me)}),r.jsxs("td",{className:"px-4 py-4 text-center font-medium text-gray-600",children:[ht(L)," h"]}),r.jsxs("td",{className:"px-4 py-4 text-center font-semibold text-gray-800",children:[ht(G)," h"]}),r.jsx("td",{className:"px-4 py-4 text-center font-medium",children:r.jsx("span",{className:Math.abs(fe)<.01?"text-gray-500":fe>0?"text-green-600":"text-orange-500",children:Ma(fe)})}),r.jsx("td",{className:"px-4 py-4 text-center align-top text-gray-700",children:r.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[r.jsx("span",{className:"text-base font-semibold text-gray-800",children:W(Ie.totalPay)}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Base: ",W(Ie.basePay),F&&` · Extras: ${W(Ie.overtimePay)}`]}),r.jsxs("span",{className:"text-[11px] text-gray-500",children:["Aux. transporte: ",W(Ie.transport)]}),r.jsxs("span",{className:"text-[11px] text-gray-400",children:[ht(Ie.regularHours)," h base",F&&` · ${ht(Ie.overtimeHours)} h extra`," · ",Ie.daysWorked," día",Ie.daysWorked===1?"":"s"]})]})}),r.jsx("td",{className:"px-4 py-4",children:r.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>Z(O.id,R),className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx(xv,{size:14}),"Base"]}),r.jsx("button",{type:"button",onClick:()=>re(O.id),className:"inline-flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 transition hover:bg-gray-100",disabled:!H,children:"Limpiar"}),r.jsxs("button",{type:"button",onClick:()=>ae(O.id,Q),disabled:!le,className:`inline-flex items-center gap-2 rounded-lg px-3 py-1.5 text-xs font-semibold text-white transition ${le?"hover:scale-105":"cursor-not-allowed opacity-70"}`,style:{backgroundColor:le?v.dark:"#CBD5F5"},children:[ze==="saving"?r.jsx(da,{className:"h-4 w-4 animate-spin"}):r.jsx(ng,{size:14}),"Guardar"]})]}),ze==="success"&&Fe&&r.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[r.jsx(nv,{size:14}),r.jsx("span",{children:Fe})]}),ze==="error"&&Fe&&r.jsxs("div",{className:"flex items-center gap-1 text-xs text-red-600",children:[r.jsx(Ar,{size:14}),r.jsx("span",{children:Fe})]})]})})]},O.id)})})]})})]})}function B1({count:e}){return r.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600",children:[r.jsx(Rr,{size:14}),e]})}const hc=()=>({expanded:!1,loading:!1,loaded:!1,error:null}),H1=(e,t)=>Ur(t).getTime()-Ur(e).getTime();function W1(){const[e,t]=p.useState([]),[s,n]=p.useState(null),[a,o]=p.useState(!1),[i,l]=p.useState({nombre:"",telefono:"",email:"",horas_dia:8,dias_semana:5,salario_hora:0,activo:!0}),[c,d]=p.useState({}),[u,h]=p.useState({}),[m,x]=p.useState(null),[w,S]=p.useState($s()),[E,y]=p.useState(null),[f,g]=p.useState(null),[b,$]=p.useState({}),[A,B]=p.useState({}),z=p.useRef(new Set),[de,P]=p.useState(!1),[D,Y]=p.useState({}),[K,pe]=p.useState(!1),[ye,ue]=p.useState({}),Z=p.useMemo(()=>hg(new Date),[]),re=p.useCallback(async()=>{try{const N=(await xe.fetchEmployeeCredits()).reduce((q,V)=>(q[V.empleadoId]=Math.max(0,Math.round(V.total)),q),{});$(N)}catch(k){console.error("Error cargando créditos de empleados:",k)}},[]);p.useEffect(()=>{fe()},[]),p.useEffect(()=>{re();const k=()=>{re()};return typeof window<"u"&&window.addEventListener(qn,k),()=>{typeof window<"u"&&window.removeEventListener(qn,k)}},[re]);const ae=p.useCallback(async(k={})=>{const{silent:N}=k;N||pe(!0);try{const q=Be(new Date),V=await xe.fetchEmployeeShiftsForDate(q),me={};V.forEach(Ee=>{me[Ee.empleadoId]=Ee}),Y(me)}catch(q){console.error("Error cargando los turnos del día:",q)}finally{N||pe(!1)}},[]),_=p.useCallback((k,N)=>{ue(q=>({...q,[k]:N}))},[]);p.useEffect(()=>{ae()},[ae]),p.useEffect(()=>{let k;return(async()=>{k=await xe.subscribeToEmployeeShifts({onChange:()=>{ae({silent:!0})}})})(),()=>{k==null||k()}},[ae]);const ie=p.useMemo(()=>{const k=new Map;return e.forEach(N=>{N.activo&&k.set(N.id,N)}),Object.keys(D).forEach(N=>{if(!k.has(N)){const q=e.find(V=>V.id===N);q&&k.set(q.id,q)}}),Array.from(k.values()).sort((N,q)=>N.nombre.localeCompare(q.nombre))},[e,D]),O=p.useCallback(async k=>{const N=k.id;_(N,"clockIn");try{const q=await xe.startEmployeeShift(N);Y(V=>({...V,[N]:q}))}catch(q){console.error(`No se pudo registrar la llegada de ${k.nombre}:`,q)}finally{_(N,null),ae({silent:!0})}},[ae,_]),se=p.useCallback(async(k,N)=>{if(!(N!=null&&N.id))return;const q=k.id;_(q,"clockOut");try{const V=await xe.completeEmployeeShift(N.id);V&&Y(me=>({...me,[q]:V}))}catch(V){console.error(`No se pudo registrar la salida de ${k.nombre}:`,V)}finally{_(q,null),ae({silent:!0})}},[ae,_]),R=p.useCallback(async(k,N)=>{if(!(N!=null&&N.id))return;const q=k.id;_(q,"startNovelty");try{const V=await xe.startEmployeeShiftNovelty(N.id);V&&Y(me=>({...me,[q]:V}))}catch(V){console.error(`No se pudo marcar la novedad de ${k.nombre}:`,V)}finally{_(q,null),ae({silent:!0})}},[ae,_]),C=p.useCallback(async(k,N)=>{if(!(N!=null&&N.id))return;const q=k.id;_(q,"finishNovelty");try{const V=await xe.finishEmployeeShiftNovelty(N.id);V&&Y(me=>({...me,[q]:V}))}catch(V){console.error(`No se pudo finalizar la novedad de ${k.nombre}:`,V)}finally{_(q,null),ae({silent:!0})}},[ae,_]),H=p.useCallback(async(k,N)=>{if(!(N!=null&&N.id))return;const q=k.id;_(q,"clearNovelty");try{const V=await xe.clearEmployeeShiftNovelty(N.id);V&&Y(me=>({...me,[q]:V}))}catch(V){console.error(`No se pudo limpiar la novedad de ${k.nombre}:`,V)}finally{_(q,null),ae({silent:!0})}},[ae,_]),Q=p.useCallback(async k=>{try{const N=await xe.fetchEmployeeBaseSchedules();d(q=>{const V={...q},me=new Set(k.map($e=>$e.id));let Ee=!1;return Object.keys(V).forEach($e=>{me.has($e)||(delete V[$e],Ee=!0)}),k.forEach($e=>{const Re=N[$e.id];Re?(!V[$e.id]||!wm(V[$e.id],Re))&&(V[$e.id]=Re,Ee=!0):V[$e.id]&&(delete V[$e.id],Ee=!0)}),Ee?V:q})}catch(N){console.error("Error cargando horarios base de empleados:",N)}},[]),L=p.useCallback(async k=>{if(!k)return{};if(z.current.has(k)){const N={};return Object.entries(u).forEach(([q,V])=>{const me=V==null?void 0:V[k];me&&(N[q]=me)}),N}try{const N=await xe.fetchEmployeeWeeklyHoursForWeek(k);return z.current.add(k),h(q=>{const V={...q};return Object.entries(N).forEach(([me,Ee])=>{V[me]={...V[me]||{},[k]:Ee}}),V}),N}catch(N){return console.error("Error cargando horas semanales:",N),{}}},[u]),G=p.useCallback(async(k,N)=>{var me,Ee;const q=(me=u[k])==null?void 0:me[N];return q||((await L(N))[k]??((Ee=u[k])==null?void 0:Ee[N]))},[u,L]);p.useEffect(()=>{e.length!==0&&(Q(e),L($s()))},[e,Q,L]),p.useEffect(()=>{e.length!==0&&d(k=>{const N={...k},q=new Set(e.map(me=>me.id));let V=!1;return Object.keys(N).forEach(me=>{q.has(me)||(delete N[me],V=!0)}),e.forEach(me=>{const Ee=Ta(me,N[me.id]);N[me.id]&&wm(N[me.id],Ee)||(N[me.id]=Ee,V=!0)}),V?N:k})},[e]),p.useEffect(()=>{h(k=>{const N={...k},q=new Set(e.map(me=>me.id));let V=!1;return Object.keys(N).forEach(me=>{q.has(me)||(delete N[me],V=!0)}),V?N:k})},[e]),p.useEffect(()=>{B(k=>{const N={...k},q=new Set(e.map(me=>me.id));let V=!1;return Object.keys(N).forEach(me=>{q.has(me)||(delete N[me],V=!0)}),V?N:k})},[e]);const fe=async()=>{const k=await xe.fetchEmpleados();t(k)},Se=async k=>{if(k.preventDefault(),s)await xe.updateEmpleado({...i,id:s}),fe(),Ie();else{const N={...i,id:crypto.randomUUID()};await xe.createEmpleado(N),fe(),Ie()}},ze=k=>{l({nombre:k.nombre,telefono:k.telefono||"",email:k.email||"",horas_dia:k.horas_dia,dias_semana:k.dias_semana,salario_hora:k.salario_hora,activo:k.activo}),n(k.id),o(!0)},Fe=async k=>{confirm("¿Estás seguro de eliminar este empleado?")&&(await xe.deleteEmpleado(k),fe())},Ie=()=>{l({nombre:"",telefono:"",email:"",horas_dia:8,dias_semana:5,salario_hora:0,activo:!0}),n(null),o(!1)},F=k=>Ta(k,c[k.id]),le=(k,N,q,V)=>{const me=Rn(q),Ee=u[k],$e=V??(Ee==null?void 0:Ee[N]);return $e&&pt.forEach(Re=>{const ct=$e[Re];typeof ct=="number"&&!Number.isNaN(ct)&&(me[Re]=ct)}),me},ge=p.useCallback((k,N)=>{B(q=>{const V=q[k]??hc();return{...q,[k]:N(V)}})},[]),ke=async(k,N)=>{const q=Ta(k,c[k.id]),V=N||$s();x(k),S(V),y(q);const me=await G(k.id,V);g(le(k.id,V,q,me))},Me=()=>{x(null),y(null),g(null)},We=async k=>{if(!k||(S(k),!m||!E))return;const N=m.id,q=E,V=await G(N,k);!m||m.id!==N||!E||g(le(N,k,q,V))},Ge=(k,N)=>{g(q=>{if(!q)return q;const V={...q};return V[k]=Math.max(0,N(q[k]??0)),V})},Ze=k=>{!E||!m||y(N=>{if(!N)return N;const q=N[k],V=!q.active,me=q.hours||m.horas_dia,Ee={active:V,hours:V?me:0},$e={...N,[k]:Ee};return g(Re=>{if(!Re)return Re;const ct=Re[k]??0,yt=!q.active||Math.abs(ct-q.hours)<.01,Jt=V?yt?Ee.hours:ct:0;return{...Re,[k]:Math.max(0,Jt)}}),$e})},St=(k,N)=>{if(!E)return;const q=Number.isNaN(N)?0:Math.max(0,N);y(V=>{if(!V)return V;const me=V[k],Ee={active:me.active,hours:me.active?q:0},$e={...V,[k]:Ee};return g(Re=>{if(!Re)return Re;const ct=Re[k]??0;return me.active&&Math.abs(ct-me.hours)<.01?{...Re,[k]:q}:Re}),$e})},it=(k,N)=>{const q=Number.isNaN(N)?0:Math.max(0,N);g(V=>V&&{...V,[k]:q})},_t=k=>Ge(k,()=>0),xt=k=>{var q;if(!E)return;const N=((q=E[k])==null?void 0:q.hours)??0;Ge(k,()=>N)},Ht=()=>{E&&g(Rn(E))},T=async()=>{if(!m||!E)return;const k=m.id,N={};pt.forEach(q=>{const V=E[q];N[q]={active:!!V.active,hours:V.active?Math.max(0,Number(V.hours)||0):0}});try{await xe.saveEmployeeBaseSchedule(k,N)}catch(q){console.error("No se pudo guardar el horario base del empleado:",q)}d(q=>({...q,[k]:N})),y(q=>q&&N)},J=async()=>{if(!m||!f)return;const k=m.id,N=w,q={};pt.forEach(V=>{q[V]=Math.max(0,Number(f[V])||0)});try{await xe.saveEmployeeWeeklyHours(k,N,q),z.current.add(N)}catch(V){console.error("No se pudieron guardar las horas semanales del empleado:",V)}h(V=>{const me={...V[k]||{}};return me[N]=q,{...V,[k]:me}}),g(q),Me()},ce=p.useCallback(async k=>{const N=k.id,q=A[N]??hc();if(!!q.expanded){ge(N,me=>({...me,expanded:!1}));return}if(ge(N,me=>({...me,expanded:!0,error:null})),!q.loaded){ge(N,me=>({...me,loading:!0,expanded:!0,error:null}));try{const me=await xe.fetchEmployeeWeeklyHoursHistory(N);h(Ee=>{const $e={...Ee},Re={...$e[N]||{}};return Object.entries(me).forEach(([ct,yt])=>{Re[ct]=yt,z.current.add(ct)}),$e[N]=Re,$e}),ge(N,Ee=>({...Ee,loading:!1,loaded:!0,expanded:!0,error:null}))}catch(me){console.error("Error cargando histórico de horas del empleado:",me),ge(N,Ee=>({...Ee,loading:!1,expanded:!0,error:"No se pudo cargar el histórico"}))}}},[A,ge]),je=k=>Ss(Rn(k)),M=k=>je(k)*4.33,te=(k,N)=>M(k)*N,be=E?je(E):0,Pe=f?Ss(f):0,_e=Pe-be,os=Math.abs(_e)<.01?"text-gray-600":_e>0?"text-green-600":"text-orange-500";return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Rr,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Gestión de Empleados"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{type:"button",onClick:()=>P(k=>!k),className:`flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg border text-sm font-medium transition-all duration-200 ${de?"text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,style:{backgroundColor:de?v.dark:"transparent",borderColor:de?v.dark:"#E5E7EB"},children:[r.jsx(ld,{size:16}),r.jsx("span",{className:"hidden md:inline",children:de?"Ocultar histórico":"Histórico semanal"}),r.jsx("span",{className:"md:hidden",children:de?"Ocultar":"Histórico"})]}),r.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm",style:{backgroundColor:v.dark},children:[r.jsx(xn,{size:16}),r.jsx("span",{className:"hidden lg:inline",children:"Agregar Empleado"}),r.jsx("span",{className:"lg:hidden",children:"Agregar"})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Registro diario de turnos"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Registra llegadas, salidas y novedades para mantener sincronizado el control de horas."})]}),r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(ps,{size:16}),r.jsx("span",{children:Z})]})]}),K?r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(ft,{className:"h-4 w-4 animate-spin"}),r.jsx("span",{children:"Cargando turnos del día…"})]}):ie.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay empleados activos para registrar turnos hoy."}):r.jsx("div",{className:"grid gap-3 md:grid-cols-2 xl:grid-cols-3",children:ie.map(k=>{const N=D[k.id]??null,q=ye[k.id],V=!!q,me=!!N,Ee=!!(N&&!N.horaSalida),$e=k.activo&&(!N||!!N.horaSalida),Re=!!(Ee&&(N!=null&&N.novedad)&&(N!=null&&N.novedadInicio)&&!(N!=null&&N.novedadFin)),ct=!!(Ee&&(!(N!=null&&N.novedad)||N!=null&&N.novedadFin)),yt=!!(N!=null&&N.novedad&&(N!=null&&N.novedadInicio)&&(N!=null&&N.novedadFin)),Jt=!!(N!=null&&N.novedad&&(N!=null&&N.novedadInicio)),Es=$t(N==null?void 0:N.horaLlegada),I=N!=null&&N.horaSalida?$t(N.horaSalida):"pendiente",X=N!=null&&N.novedadInicio?$t(N.novedadInicio):"—",j=N!=null&&N.novedadFin?$t(N.novedadFin):"—",U=typeof(N==null?void 0:N.horasTrabajadas)=="number"?N.horasTrabajadas:void 0;let ee="Sin turno registrado",ne="bg-gray-100 text-gray-600";return Ee?(ee=Re?"Novedad en curso":"Turno activo",ne=Re?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700"):yt?(ee="Novedad registrada",ne="bg-amber-100 text-amber-700"):me&&(ee="Turno registrado",ne="bg-blue-100 text-blue-700"),r.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white/70 p-4 shadow-sm space-y-3",children:[r.jsxs("div",{className:"flex items-start justify-between gap-2",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-base font-semibold text-gray-800",children:k.nombre}),r.jsx("p",{className:"text-xs text-gray-500",children:k.activo?"Empleado activo":"Empleado inactivo"})]}),r.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${ne}`,children:ee})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-600",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Entrada"}),r.jsx("p",{className:"font-medium text-gray-800",children:Es})]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Salida"}),r.jsx("p",{className:"font-medium text-gray-800",children:I})]}),r.jsxs("div",{className:"col-span-2",children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Novedad"}),r.jsx("p",{className:"font-medium text-gray-800",children:Jt?Re?`Inició a las ${X}`:`${X} – ${j}`:"Sin novedad"})]}),typeof U=="number"&&(N==null?void 0:N.horaSalida)&&r.jsxs("div",{className:"col-span-2",children:[r.jsx("span",{className:"text-xs uppercase text-gray-400",children:"Horas registradas"}),r.jsxs("p",{className:"font-medium text-gray-800",children:[ht(U)," h"]})]})]}),Jt&&r.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-amber-100 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:[r.jsx(cv,{size:14}),r.jsx("span",{children:Re?`Novedad en curso desde las ${X}`:`Se descontará el tiempo entre ${X} y ${j}`})]}),me&&(N==null?void 0:N.horaSalida)&&r.jsxs("div",{className:"rounded-lg border border-blue-100 bg-blue-50 px-3 py-2 text-xs text-blue-700",children:["Turno cerrado a las ",I,". Revisa el histórico si necesitas editar los valores."]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[$e&&r.jsxs("button",{type:"button",onClick:()=>O(k),disabled:!k.activo||V||!$e,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 hover:scale-105",style:{backgroundColor:v.dark},children:[q==="clockIn"?r.jsx(ft,{className:"h-4 w-4 animate-spin"}):r.jsx(hv,{size:16}),"Registrar llegada"]}),Ee&&r.jsxs("button",{type:"button",onClick:()=>se(k,N),disabled:V,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-emerald-600 hover:bg-emerald-700",children:[q==="clockOut"?r.jsx(ft,{className:"h-4 w-4 animate-spin"}):r.jsx(oi,{size:16}),"Registrar salida"]}),ct&&N&&r.jsxs("button",{type:"button",onClick:()=>R(k,N),disabled:V,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-amber-500 hover:bg-amber-600",children:[q==="startNovelty"?r.jsx(ft,{className:"h-4 w-4 animate-spin"}):r.jsx(fv,{size:16}),"Marcar novedad"]}),Re&&N&&r.jsxs("button",{type:"button",onClick:()=>C(k,N),disabled:V,className:"inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-semibold text-white transition disabled:cursor-not-allowed disabled:opacity-70 bg-indigo-600 hover:bg-indigo-700",children:[q==="finishNovelty"?r.jsx(ft,{className:"h-4 w-4 animate-spin"}):r.jsx(gv,{size:16}),"Finalizar novedad"]}),Ee&&Jt&&!Re&&N&&r.jsxs("button",{type:"button",onClick:()=>H(k,N),disabled:V,className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 transition disabled:cursor-not-allowed disabled:opacity-70 hover:bg-gray-100",children:[q==="clearNovelty"?r.jsx(ft,{className:"h-4 w-4 animate-spin"}):r.jsx(ov,{size:16}),"Limpiar novedad"]})]})]},k.id)})})]}),de&&r.jsx("div",{className:"ui-card ui-card-pad",children:r.jsx(U1,{})}),a&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:v.dark},children:s?"Editar Empleado":"Nuevo Empleado"}),r.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nombre *"}),r.jsx("input",{type:"text",required:!0,value:i.nombre,onChange:k=>l({...i,nombre:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Teléfono"}),r.jsx("input",{type:"tel",value:i.telefono,onChange:k=>l({...i,telefono:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),r.jsx("input",{type:"email",value:i.email,onChange:k=>l({...i,email:k.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Horas por día"}),r.jsx("input",{type:"number",min:"1",max:"12",value:i.horas_dia,onChange:k=>l({...i,horas_dia:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Días por semana"}),r.jsx("input",{type:"number",min:"1",max:"7",value:i.dias_semana,onChange:k=>l({...i,dias_semana:parseInt(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Salario por hora"}),r.jsx("input",{type:"number",min:"0",step:"100",value:i.salario_hora,onChange:k=>l({...i,salario_hora:parseFloat(k.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"activo",checked:i.activo,onChange:k=>l({...i,activo:k.target.checked}),className:"rounded"}),r.jsx("label",{htmlFor:"activo",className:"text-sm font-medium",children:"Empleado activo"})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:Ie,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"submit",className:"flex-1 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105",style:{backgroundColor:v.dark},children:s?"Actualizar":"Guardar"})]})]})]})}),m&&E&&f&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:r.jsxs("div",{className:"relative w-full max-w-4xl overflow-hidden rounded-2xl bg-white shadow-xl",children:[r.jsxs("div",{className:"flex items-start justify-between border-b px-6 py-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Gestión semanal de horarios"}),r.jsxs("p",{className:"text-sm text-gray-500",children:[m.nombre," • Semana ",Ea(w)]})]}),r.jsxs("button",{onClick:Me,className:"rounded-full p-2 text-gray-500 transition hover:bg-gray-100",children:[r.jsx("span",{className:"sr-only",children:"Cerrar"}),r.jsx(Lr,{size:18})]})]}),r.jsxs("div",{className:"max-h-[80vh] overflow-y-auto px-6 py-5 space-y-6",children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Selecciona la semana que deseas ajustar"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Puedes modificar horas específicas si hubo ausencias o cambios."})]}),r.jsx("input",{type:"week",value:w,onChange:k=>void We(k.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-transparent focus:ring-2 sm:w-auto",style:{"--tw-ring-color":v.accent}})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full min-w-[600px] text-sm",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-50 text-left text-xs uppercase tracking-wide text-gray-500",children:[r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Día"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Horario base"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Horas trabajadas"}),r.jsx("th",{className:"px-4 py-3 font-semibold",children:"Acciones"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:pt.map(k=>{const N=E[k],q=f[k]??0;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:Ed[k]}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-gray-600",children:[r.jsx("input",{type:"checkbox",checked:N.active,onChange:()=>Ze(k),className:"rounded"}),"Activo"]}),r.jsx("input",{type:"number",min:"0",step:"0.5",value:N.active?N.hours:0,onChange:V=>St(k,parseFloat(V.target.value)),disabled:!N.active,className:"w-24 rounded-lg border border-gray-300 px-2 py-1 text-sm focus:border-transparent focus:ring-2 disabled:bg-gray-100",style:{"--tw-ring-color":v.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:"horas"})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("input",{type:"number",min:"0",step:"0.5",value:q,onChange:V=>it(k,parseFloat(V.target.value)),className:"w-24 rounded-lg border border-gray-300 px-2 py-1 text-sm focus:border-transparent focus:ring-2",style:{"--tw-ring-color":v.accent}}),r.jsx("span",{className:"text-xs text-gray-500",children:"horas"})]})}),r.jsx("td",{className:"px-4 py-3",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsx("button",{type:"button",onClick:()=>xt(k),className:"rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:"Usar base"}),r.jsx("button",{type:"button",onClick:()=>_t(k),className:"rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:bg-gray-100",children:"Ausencia"})]})})]},k)})})]})}),r.jsxs("div",{className:"grid gap-3 rounded-xl bg-gray-50 p-4 text-sm sm:grid-cols-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Horas base de la semana"}),r.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:[ht(be)," h"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Horas registradas"}),r.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:[ht(Pe)," h"]})]}),r.jsxs("div",{children:[r.jsx("p",{className:"text-gray-500",children:"Diferencia semanal"}),r.jsx("p",{className:`text-lg font-semibold ${os}`,children:Ma(_e)})]})]}),r.jsxs("div",{className:"flex flex-wrap justify-end gap-3",children:[r.jsxs("button",{type:"button",onClick:Ht,className:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx(da,{size:16}),"Restablecer semana"]}),r.jsx("button",{type:"button",onClick:()=>void T(),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-100",children:"Guardar horario base"}),r.jsx("button",{type:"button",onClick:()=>void J(),className:"rounded-lg px-3 py-2 text-sm font-semibold text-white transition hover:opacity-90",style:{backgroundColor:v.dark},children:"Guardar horas de la semana"})]})]})]})}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(k=>{const N=F(k),q=je(N),V=$s(),me=le(k.id,V,N),Ee=Ss(me),$e=Ee-q,Re=Math.abs($e)<.01?"text-gray-500":$e>0?"text-green-600":"text-orange-500",ct=Ea(V),yt=A[k.id]??hc(),Jt=u[k.id]||{},Es={...Jt};Es[V]||(Es[V]=me);const I=Object.entries(Es).sort((j,U)=>H1(j[0],U[0])),X=Object.keys(Jt).length>0;return r.jsxs("div",{className:`bg-white rounded-xl p-6 shadow-sm border transition-all duration-200 hover:shadow-md ${k.activo?"border-gray-100":"border-gray-300 bg-gray-50"}`,children:[r.jsxs("div",{className:"flex justify-between items-start mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:k.nombre}),r.jsx("div",{className:"flex items-center gap-1 mt-1",children:r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k.activo?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:k.activo?"Activo":"Inactivo"})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>ze(k),className:"p-1 rounded hover:bg-gray-100",children:r.jsx($r,{size:16})}),r.jsx("button",{onClick:()=>Fe(k.id),className:"p-1 rounded hover:bg-gray-100 text-red-600",children:r.jsx(Hn,{size:16})})]})]}),(k.telefono||k.email)&&r.jsxs("div",{className:"space-y-1 mb-4 text-sm text-gray-600",children:[k.telefono&&r.jsxs("p",{children:["📞 ",k.telefono]}),k.email&&r.jsxs("p",{children:["✉️ ",k.email]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Qa,{size:18,className:"text-gray-500"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold text-gray-800",children:"Horario base semanal"}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Horas estimadas:"," ",r.jsxs("span",{className:"font-semibold text-gray-700",children:[ht(q)," h"]})]})]})]}),r.jsxs("button",{onClick:()=>void ke(k),className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-100",children:[r.jsx(ps,{size:16}),r.jsx("span",{children:"Gestionar semana"})]})]}),r.jsx("div",{className:"mt-3 grid grid-cols-2 gap-2 text-xs sm:text-sm",children:pt.map(j=>{const U=N[j];return r.jsxs("div",{className:`flex items-center justify-between rounded-md px-2 py-1 ${U.active?"bg-white text-gray-700 shadow-sm":"text-gray-400"}`,children:[r.jsx("span",{className:"font-medium",children:Ed[j]}),r.jsx("span",{children:U.active?`${ht(U.hours)} h`:"Descanso"})]},j)})})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm sm:grid-cols-2",children:[r.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(ps,{size:16}),r.jsx("span",{children:"Horas programadas"})]}),r.jsxs("p",{className:"mt-2 text-2xl font-semibold",style:{color:v.dark},children:[ht(q)," h"]})]}),r.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Qa,{size:16}),r.jsxs("span",{children:["Semana actual (",ct,")"]})]}),r.jsxs("p",{className:"mt-2 text-2xl font-semibold",style:{color:v.dark},children:[ht(Ee)," h"]}),r.jsx("p",{className:`mt-1 text-xs font-medium ${Re}`,children:Ma($e)})]})]}),r.jsxs("div",{className:"pt-4 border-t",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(eg,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-sm",children:"Salario/hora"})]}),r.jsx("span",{className:"text-sm font-medium",children:W(k.salario_hora)})]}),r.jsxs("div",{className:"text-center p-2 rounded",style:{backgroundColor:`${v.accent}20`},children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Salario mensual estimado"}),r.jsx("p",{className:"font-bold",style:{color:v.dark},children:W(te(N,k.salario_hora))})]})]}),r.jsxs("div",{className:"mt-4 rounded-lg bg-gray-50 p-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[r.jsx(Ps,{size:16}),r.jsx("span",{children:"Crédito acumulado"})]}),r.jsx("span",{className:"text-sm font-semibold",style:{color:v.dark},children:W(b[k.id]??0)})]}),r.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Registra abonos desde la caja con el método "Crédito empleados".'})]}),r.jsxs("div",{className:"mt-4 rounded-lg border border-gray-100 bg-white/60 p-4",children:[r.jsxs("button",{type:"button",onClick:()=>void ce(k),className:"flex w-full items-center justify-between text-left text-sm font-medium text-gray-700",children:[r.jsxs("span",{className:"flex items-center gap-2",children:[r.jsx(ld,{size:16,className:"text-gray-500"}),"Histórico de horas trabajadas"]}),r.jsx("span",{className:"text-xs font-semibold text-gray-500",children:yt.expanded?"Ocultar":"Ver historial"})]}),yt.expanded&&r.jsxs("div",{className:"mt-3 space-y-3",children:[yt.error&&r.jsx("div",{className:"rounded-lg border border-red-100 bg-red-50 px-3 py-2 text-xs text-red-600",children:yt.error}),yt.loading?r.jsx("p",{className:"text-xs text-gray-500",children:"Cargando histórico..."}):r.jsx("div",{className:"overflow-x-auto",children:I.length===0?r.jsx("p",{className:"text-xs text-gray-500",children:"Aún no hay semanas registradas."}):r.jsxs("table",{className:"w-full min-w-[400px] text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-[11px] uppercase tracking-wide text-gray-500",children:[r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Semana"}),r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Horas trabajadas"}),r.jsx("th",{className:"px-3 py-2 font-semibold",children:"Variación"}),r.jsx("th",{className:"px-3 py-2 font-semibold text-right",children:"Acciones"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:I.map(([j,U])=>{const ee=Ss(U),ne=ee-q,he=j===V;return r.jsxs("tr",{className:he?"bg-gray-50":void 0,children:[r.jsx("td",{className:"px-3 py-2",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-semibold text-gray-700",children:Ea(j)}),he&&r.jsx("span",{className:"text-[11px] text-gray-500",children:"Semana actual"})]})}),r.jsx("td",{className:"px-3 py-2",children:r.jsxs("span",{className:"font-medium text-gray-700",children:[ht(ee)," h"]})}),r.jsx("td",{className:`px-3 py-2 font-medium text-[11px] ${Math.abs(ne)<.01?"text-gray-500":ne>0?"text-green-600":"text-orange-500"}`,children:Ma(ne)}),r.jsx("td",{className:"px-3 py-2 text-right",children:r.jsxs("button",{type:"button",onClick:()=>void ke(k,j),className:"inline-flex items-center gap-1 rounded-lg border border-gray-200 px-2 py-1 text-[11px] font-medium text-gray-600 transition hover:bg-gray-100",children:[r.jsx($r,{size:14}),"Ajustar"]})})]},j)})})]})}),!yt.loading&&!X&&r.jsx("p",{className:"text-[11px] text-gray-500",children:'Los registros guardados aparecerán aquí. Usa "Gestionar semana" para almacenar ajustes.'})]})]})]})]},k.id)})}),e.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Rr,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No hay empleados registrados"}),r.jsx("p",{className:"text-gray-500",children:"Agrega tu primer empleado para comenzar"})]})]})}function q1({focusRequest:e}){const[t,s]=p.useState([]),[n,a]=p.useState(null),[o,i]=p.useState(!1),[l,c]=p.useState("diario"),[d,u]=p.useState(ja()),[h,m]=p.useState("desc"),[x,w]=p.useState({descripcion:"",monto:0,categoria:"",fecha:ja(),metodoPago:"efectivo"}),S=Av,E=gs,y=["Productos Limpieza","Carnes","Frutas/Verduras","Lacteos","Servicios públicos","Arriendo","Salarios","Papelería","Marketing","Transporte","Otros"];p.useEffect(()=>{f()},[]),p.useEffect(()=>{if(!e)return;const{dateKey:D}=e;D&&(c("diario"),u(D))},[e]);const f=async()=>{const Y=(await xe.fetchGastos()).map(K=>({...K,fecha:wt(K.fecha),created_at:K.created_at?K.created_at instanceof Date?new Date(K.created_at.getTime()):new Date(K.created_at):void 0,metodoPago:K.metodoPago??"efectivo"}));s(Y)},g=async D=>{D.preventDefault();const Y={...x,monto:parseFloat(x.monto.toString())},K=wt(Y.fecha);if(n)await xe.updateGasto({...Y,id:n,fecha:K}),f(),A();else{const pe={...Y,id:crypto.randomUUID(),fecha:K,created_at:new Date};await xe.createGasto(pe),f(),A()}},b=D=>{w({descripcion:D.descripcion,monto:D.monto,categoria:D.categoria,fecha:Be(D.fecha instanceof Date?D.fecha:new Date(D.fecha)),metodoPago:D.metodoPago??"efectivo"}),a(D.id),i(!0)},$=async D=>{confirm("¿Estás seguro de eliminar este gasto?")&&(await xe.deleteGasto(D),f())},A=()=>{w({descripcion:"",monto:0,categoria:"",fecha:ja(),metodoPago:"efectivo"}),a(null),i(!1)},z=(()=>{const D=wt(d),Y=pe=>{const ye=pe.created_at instanceof Date?pe.created_at.getTime():NaN;if(!Number.isNaN(ye))return ye;const ue=pe.fecha instanceof Date?pe.fecha:wt(pe.fecha);return Number.isNaN(ue.getTime())?0:ue.getTime()};return t.filter(pe=>{const ye=wt(pe.fecha);switch(l){case"diario":return ye.toDateString()===D.toDateString();case"semanal":const ue=new Date(D);ue.setDate(D.getDate()-D.getDay());const Z=new Date(ue);return Z.setDate(ue.getDate()+6),ye>=ue&&ye<=Z;case"mensual":return ye.getMonth()===D.getMonth()&&ye.getFullYear()===D.getFullYear();default:return!0}}).sort((pe,ye)=>{const ue=Y(pe)-Y(ye);return h==="asc"?ue:-ue})})(),de=z.reduce((D,Y)=>D+Y.monto,0),P=z.reduce((D,Y)=>(D[Y.categoria]=(D[Y.categoria]||0)+Y.monto,D),{});return r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(dd,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Control de Gastos"})]}),r.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-1 lg:gap-2 px-3 lg:px-4 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 text-sm",style:{backgroundColor:v.dark},children:[r.jsx(xn,{size:16}),r.jsx("span",{className:"hidden lg:inline",children:"Agregar Gasto"}),r.jsx("span",{className:"lg:hidden",children:"Agregar"})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(tg,{size:16,className:"text-gray-500"}),r.jsx("span",{className:"text-sm font-medium",children:"Vista:"})]}),r.jsx("div",{className:"flex rounded-lg border border-gray-300 overflow-hidden",children:["diario","semanal","mensual"].map(D=>r.jsx("button",{onClick:()=>c(D),className:`px-3 lg:px-4 py-2 text-sm font-medium transition-colors ${l===D?"text-white":"text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:l===D?v.dark:"transparent"},children:D.charAt(0).toUpperCase()+D.slice(1)},D))})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Zp,{size:16,className:"text-gray-500"}),r.jsx("input",{type:"date",value:d,onChange:D=>u(D.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent text-sm w-full lg:w-auto",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ig,{size:20,style:{color:v.accent}}),r.jsxs("span",{className:"text-base lg:text-lg font-semibold",children:["Total ",l,":"]})]}),r.jsx("span",{className:"text-lg lg:text-2xl font-bold",style:{color:v.accent},children:W(de)})]})]}),o&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white rounded-lg lg:rounded-xl p-4 lg:p-6 w-full max-w-md max-h-[90vh] overflow-y-auto",children:[r.jsx("h3",{className:"text-xl font-bold mb-4",style:{color:v.dark},children:n?"Editar Gasto":"Nuevo Gasto"}),r.jsxs("form",{onSubmit:g,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Descripción *"}),r.jsx("input",{type:"text",required:!0,value:x.descripcion,onChange:D=>w({...x,descripcion:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Monto *"}),r.jsx("input",{type:"number",required:!0,min:"0",step:"100",value:x.monto,onChange:D=>w({...x,monto:parseFloat(D.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Fecha *"}),r.jsx("input",{type:"date",required:!0,value:x.fecha,onChange:D=>w({...x,fecha:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Categoría *"}),r.jsxs("select",{required:!0,value:x.categoria,onChange:D=>w({...x,categoria:D.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"",children:"Seleccionar categoría"}),y.map(D=>r.jsx("option",{value:D,children:D},D))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium mb-1",children:"Método de pago *"}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:S.map(D=>r.jsx("button",{type:"button",onClick:()=>w({...x,metodoPago:D}),className:`py-2 px-3 rounded-lg border text-sm font-medium transition-colors ${x.metodoPago===D?"border-transparent text-white":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,style:{backgroundColor:x.metodoPago===D?v.dark:"transparent"},children:E[D]},D))})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:A,className:"flex-1 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"submit",className:"flex-1 py-2 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105",style:{backgroundColor:v.dark},children:n?"Actualizar":"Guardar"})]})]})]})}),Object.keys(P).length>0&&r.jsxs("div",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:v.dark},children:"Gastos por categoría"}),r.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:Object.entries(P).sort(([D],[Y])=>D.localeCompare(Y,"es",{sensitivity:"base"})).map(([D,Y])=>r.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[r.jsx("span",{className:"text-sm font-medium",children:D}),r.jsx("span",{className:"font-bold",style:{color:v.accent},children:W(Y)})]},D))})]}),r.jsxs("div",{className:"ui-card",children:[r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:r.jsxs("button",{type:"button",onClick:()=>m(D=>D==="desc"?"asc":"desc"),className:"flex items-center gap-1",children:["Fecha",h==="desc"?r.jsx(J0,{size:14}):r.jsx(X0,{size:14})]})}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Categoría"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell",children:"Método"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:z.map(D=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs lg:text-sm text-gray-900",children:(()=>{const Y=D.created_at instanceof Date&&!Number.isNaN(D.created_at.getTime())?D.created_at:D.fecha instanceof Date?D.fecha:wt(D.fecha);return Cu(Y)})()}),r.jsx("td",{className:"px-3 lg:px-6 py-4 text-xs lg:text-sm text-gray-900",children:D.descripcion}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap hidden lg:table-cell",children:r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:D.categoria})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap hidden sm:table-cell",children:r.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-800 rounded-full",children:E[D.metodoPago??"efectivo"]})}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-xs lg:text-sm font-medium",style:{color:v.accent},children:W(D.monto)}),r.jsx("td",{className:"px-3 lg:px-6 py-4 whitespace-nowrap text-sm font-medium",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:()=>b(D),className:"text-indigo-600 hover:text-indigo-900",children:r.jsx($r,{size:16})}),r.jsx("button",{onClick:()=>$(D.id),className:"text-red-600 hover:text-red-900",children:r.jsx(Hn,{size:16})})]})})]},D.id))})]})}),z.length===0&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(dd,{size:48,className:"mx-auto text-gray-400 mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No hay gastos para el período seleccionado"}),r.jsx("p",{className:"text-gray-500",children:"Los gastos aparecerán aquí cuando los registres"})]})]})]})}const nr=["efectivo","nequi","tarjeta","provision_caja"],Cm={efectivo:"Efectivo",nequi:"Nequi",tarjeta:"Tarjeta",provision_caja:"Provisión caja"},Em=(e,t)=>{var a,o;const s=t.fecha.getTime()-e.fecha.getTime();if(s!==0)return s;const n=(((a=t.created_at)==null?void 0:a.getTime())??0)-(((o=e.created_at)==null?void 0:o.getTime())??0);return n!==0?n:t.id.localeCompare(e.id)},V1=new Intl.DateTimeFormat("es-CO",{month:"long",year:"numeric"}),G1=new Intl.DateTimeFormat("es-CO",{dateStyle:"medium"}),K1=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`,Q1=e=>{const[t,s]=e.split("-").map(Number);return!t||!s?e:V1.format(new Date(t,s-1,1))},Y1=e=>{const t=[],s=new Set,n=$s(),a=Ur(n);for(let o=0;o<e;o+=1){const i=new Date(a);i.setDate(a.getDate()-o*7);const l=Ru(i);s.has(l)||(t.push({key:l,label:Ea(l)}),s.add(l))}return t};function J1(){var Ie;const[e,t]=p.useState(!0),[s,n]=p.useState(null),[a,o]=p.useState([]),[i,l]=p.useState([]),[c,d]=p.useState({}),[u,h]=p.useState([]),m=p.useMemo(()=>Y1(16),[]),x=((Ie=m[0])==null?void 0:Ie.key)??$s(),[w,S]=p.useState(x),[E,y]=p.useState({}),[f,g]=p.useState(!1),[b,$]=p.useState([]),[A,B]=p.useState(!1),[z,de]=p.useState(!1),[P,D]=p.useState(null),[Y,K]=p.useState({monto:"",fecha:ja(),descripcion:"",origen:"caja_principal",destino:"provision_caja"}),pe=p.useMemo(()=>{const F=new Map;return u.forEach(le=>{F.set(le.codigo,le)}),F},[u]),ye=p.useMemo(()=>u.length>0?u:[{codigo:"caja_principal",nombre:"Caja principal",metodoPago:"efectivo",esPrincipal:!0},{codigo:"provision_caja",nombre:"Provisión de caja",metodoPago:"efectivo",esPrincipal:!1}],[u]),ue=p.useCallback(F=>{if(!F)return"—";const le=pe.get(F);return le?le.nombre:F==="caja_principal"?"Caja principal":F==="provision_caja"?"Provisión de caja":F},[pe]);p.useEffect(()=>{var F;S(((F=m[0])==null?void 0:F.key)??$s())},[m]),p.useEffect(()=>{let F=!0;return(async()=>{t(!0),n(null);try{const[ge,ke,Me,We,Ge]=await Promise.all([xe.fetchGastos(),xe.fetchEmpleados(),xe.fetchEmployeeBaseSchedules(),xe.fetchProvisionTransfers(),xe.fetchCajaBolsillos()]);if(!F)return;o(ge),l(ke),d(Me),$(We),h(Ge)}catch(ge){console.error("Error cargando la información de contabilidad:",ge),F&&n("No se pudo cargar la información. Intenta nuevamente.")}finally{F&&t(!1)}})(),()=>{F=!1}},[]),p.useEffect(()=>{if(!w||E[w])return;let F=!1;return g(!0),(async()=>{try{const ge=await xe.fetchEmployeeWeeklyHoursForWeek(w);if(F)return;y(ke=>({...ke,[w]:ge}))}catch(ge){console.error("Error cargando horas semanales de empleados:",ge)}finally{F||g(!1)}})(),()=>{F=!0,g(!1)}},[w,E]);const Z=p.useMemo(()=>{const F={efectivo:0,nequi:0,tarjeta:0,provision_caja:0};return a.forEach(le=>{const ge=le.metodoPago??"efectivo";if(!nr.includes(ge))return;const ke=ge;F[ke]+=le.monto}),F},[a]),re=p.useMemo(()=>nr.reduce((F,le)=>F+(Z[le]??0),0),[Z]),ae=p.useMemo(()=>{const F=new Map;return a.forEach(le=>{const ge=le.fecha instanceof Date?le.fecha:new Date(le.fecha),ke=le.metodoPago??"efectivo";if(!nr.includes(ke))return;const Me=K1(ge),We=F.get(Me)??{efectivo:0,nequi:0,tarjeta:0,provision_caja:0,total:0},Ge=ke;We[Ge]+=le.monto,We.total+=le.monto,F.set(Me,We)}),Array.from(F.entries()).map(([le,ge])=>({key:le,label:Q1(le),...ge})).sort((le,ge)=>le.key>ge.key?-1:1)},[a]),_=p.useMemo(()=>{const F=new Map;return a.forEach(le=>{var ke;const ge=((ke=le.categoria)==null?void 0:ke.trim())||"Sin categoría";F.set(ge,(F.get(ge)??0)+le.monto)}),Array.from(F.entries()).sort((le,ge)=>ge[1]-le[1])},[a]),ie=p.useMemo(()=>b.slice().sort(Em),[b]),O=p.useMemo(()=>b.filter(F=>F.bolsilloDestino==="provision_caja").reduce((F,le)=>F+le.monto,0),[b]),se=p.useMemo(()=>b.filter(F=>F.bolsilloOrigen==="provision_caja").reduce((F,le)=>F+le.monto,0),[b]),R=O-se,C=E[w]||{},H=p.useMemo(()=>i.length?i.map(F=>{let ge=C[F.id]??null,ke="registro";if(!ge){const Ge=c[F.id];Ge?(ge=Rn(Ge),ke="base"):(ge=Rn(gx(F)),ke="estimado")}const Me=Ss(ge),We=Me*(Number(F.salario_hora)||0);return{empleado:F,horas:Me,salario:We,origen:ke}}).sort((F,le)=>le.salario-F.salario):[],[i,C,c]),Q=p.useMemo(()=>H.reduce((F,le)=>F+le.salario,0),[H]),L=F=>{S(F.target.value)},G=F=>le=>{const ge=le.target.value;K(ke=>({...ke,[F]:ge}))},fe=F=>le=>{const ge=le.target.value;K(ke=>({...ke,[F]:ge}))},Se=async F=>{F.preventDefault(),D(null);const le=Math.max(0,Math.round(Number(Y.monto)||0));if(le<=0){D("Ingresa un monto mayor a cero.");return}if(!Y.fecha){D("Selecciona la fecha del movimiento.");return}const ge=wt(Y.fecha);if(!(ge instanceof Date)||Number.isNaN(ge.getTime())){D("La fecha no es válida.");return}if(!Y.origen||!Y.destino){D("Selecciona los bolsillos de origen y destino.");return}if(Y.origen===Y.destino){D("Elige bolsillos diferentes para origen y destino.");return}const ke=pe.get(Y.origen),Me=pe.get(Y.destino),We=ke==null?void 0:ke.metodoPago,Ge=We==="nequi"||We==="tarjeta"?We:"efectivo";de(!0);try{const Ze=await xe.createProvisionTransfer({monto:le,fecha:ge,descripcion:Y.descripcion,origenMetodo:Ge,destinoMetodo:Me==null?void 0:Me.metodoPago,bolsilloOrigen:Y.origen,bolsilloDestino:Y.destino,origenNombre:ke==null?void 0:ke.nombre,destinoNombre:Me==null?void 0:Me.nombre});$(St=>[Ze,...St].sort(Em)),K({monto:"",fecha:ja(),descripcion:"",origen:Y.origen,destino:Y.destino}),B(!1)}catch(Ze){console.error("Error registrando movimiento de provisión:",Ze),D(Ze instanceof Error&&Ze.message||"No se pudo registrar el movimiento.")}finally{de(!1)}},ze=async F=>{if(F&&window.confirm("¿Eliminar este movimiento de provisión?"))try{await xe.deleteProvisionTransfer(F),$(le=>le.filter(ge=>ge.id!==F))}catch(le){console.error("Error eliminando movimiento de provisión:",le),D(le instanceof Error&&le.message||"No se pudo eliminar el movimiento.")}},Fe=R>=0?"text-green-600":"text-red-600";return e?r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ai,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Contabilidad"})]}),r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-gray-600",children:[r.jsx(ft,{className:"animate-spin",size:18}),r.jsx("span",{children:"Cargando información…"})]})]}):s?r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ai,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Contabilidad"})]}),r.jsxs("div",{className:"ui-card ui-card-pad flex items-center gap-3 text-red-600",children:[r.jsx(Ar,{size:18}),r.jsx("span",{children:s})]})]}):r.jsxs("section",{className:"space-y-4 sm:space-y-6",children:[r.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ai,{size:24,style:{color:v.dark}}),r.jsx("h2",{className:"text-xl lg:text-2xl font-bold",style:{color:v.dark},children:"Contabilidad"})]})}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Z0,{size:18,style:{color:v.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Provisión de caja"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Registra lo que mueves desde la caja y controla el saldo disponible para gastos futuros."})]})]}),r.jsx("button",{type:"button",onClick:()=>{B(F=>!F),D(null)},className:"px-3 py-2 text-sm font-medium text-white rounded-lg",style:{backgroundColor:v.accent},children:A?"Cancelar registro":"Registrar movimiento"})]}),r.jsxs("div",{className:"grid gap-3 sm:grid-cols-3",children:[r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Transferido a provisión"}),r.jsx("p",{className:"text-lg font-semibold",style:{color:v.dark},children:W(O)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Retirado de provisión"}),r.jsx("p",{className:"text-lg font-semibold text-red-600",children:W(se)})]}),r.jsxs("div",{className:"bg-gray-50 rounded-lg px-3 py-3",children:[r.jsx("p",{className:"text-xs font-medium uppercase text-gray-500",children:"Saldo disponible"}),r.jsx("p",{className:`text-lg font-semibold ${Fe}`,children:W(R)})]})]}),A&&r.jsxs("form",{className:"grid gap-3 sm:grid-cols-6",onSubmit:Se,children:[r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Monto",r.jsx("input",{type:"number",min:"1",step:"1",value:Y.monto,onChange:G("monto"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":v.accent},placeholder:"0",required:!0})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Fecha",r.jsx("input",{type:"date",value:Y.fecha,onChange:G("fecha"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":v.accent},required:!0})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Desde",r.jsx("select",{value:Y.origen,onChange:fe("origen"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":v.accent},children:ye.map(F=>{const le=gs[F.metodoPago]??F.metodoPago;return r.jsx("option",{value:F.codigo,disabled:F.codigo===Y.destino,children:`${F.nombre} · ${le}`},F.codigo)})})]}),r.jsxs("label",{className:"flex flex-col gap-1 text-xs font-medium text-gray-600 sm:col-span-2",children:["Hacia",r.jsx("select",{value:Y.destino,onChange:fe("destino"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":v.accent},children:ye.map(F=>{const le=gs[F.metodoPago]??F.metodoPago;return r.jsx("option",{value:F.codigo,disabled:F.codigo===Y.origen,children:`${F.nombre} · ${le}`},F.codigo)})})]}),r.jsxs("label",{className:"flex flex-col gap-1 sm:col-span-6 text-xs font-medium text-gray-600",children:["Descripción (opcional)",r.jsx("input",{type:"text",value:Y.descripcion,onChange:G("descripcion"),className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:outline-none",style:{"--tw-ring-color":v.accent},placeholder:"Ej. Arqueo semanal"})]}),r.jsx("div",{className:"sm:col-span-6 flex justify-end gap-2",children:r.jsx("button",{type:"submit",disabled:z,className:"px-3 py-2 text-sm font-semibold text-white rounded-lg disabled:opacity-60",style:{backgroundColor:v.dark},children:z?"Guardando…":"Guardar movimiento"})})]}),P&&r.jsx("p",{className:"text-sm text-red-600",children:P}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Fecha"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Descripción"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Desde"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Hacia"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Monto"}),r.jsx("th",{className:"py-2 pr-4 font-medium text-right",children:"Acciones"})]})}),r.jsx("tbody",{children:ie.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"py-4 pr-4 text-center text-gray-500",children:"Aún no registras movimientos de provisión."})}):ie.map(F=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:G1.format(F.fecha)}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:F.descripcion??"—"}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:v.dark},children:ue(F.bolsilloOrigen)}),r.jsx("span",{className:"text-xs text-gray-500",children:gs[F.origen]??F.origen})]})}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"font-medium",style:{color:v.dark},children:ue(F.bolsilloDestino)}),r.jsx("span",{className:"text-xs text-gray-500",children:F.destinoMetodo?gs[F.destinoMetodo]??F.destinoMetodo:"—"})]})}),r.jsx("td",{className:"py-2 pr-4 text-green-600 font-semibold",children:W(F.monto)}),r.jsx("td",{className:"py-2 pr-4 text-right",children:r.jsx("button",{type:"button",onClick:()=>ze(F.id),className:"inline-flex items-center justify-center rounded-md border border-transparent px-2 py-1 text-xs font-medium text-gray-500 hover:text-red-600 hover:bg-red-50",children:r.jsx(Hn,{size:16})})})]},F.id))})]})})]}),r.jsx("div",{className:"grid gap-4 md:gap-6 lg:grid-cols-3",children:nr.map(F=>{const le=Z[F]??0,ge=re>0?le/re*100:0;return r.jsxs("div",{className:"ui-card ui-card-pad space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(_u,{size:18,style:{color:v.dark}}),r.jsx("span",{className:"text-sm font-semibold uppercase tracking-wide text-gray-600",children:Cm[F]})]}),r.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Histórico"})]}),r.jsx("p",{className:"text-2xl font-bold",style:{color:v.dark},children:W(le)}),r.jsxs("p",{className:"text-sm text-gray-500",children:[ge.toFixed(1),"% de los gastos registrados"]})]},F)})}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(sg,{size:18,style:{color:v.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Histórico por método de pago"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Gastos mensuales separados por método en los últimos registros"})]})]}),ae.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay gastos registrados."}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Mes"}),nr.map(F=>r.jsx("th",{className:"py-2 pr-4 font-medium",children:Cm[F]},F)),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Total"})]})}),r.jsx("tbody",{children:ae.map(F=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:F.label}),nr.map(le=>r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:W(F[le])},le)),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-semibold",children:W(F.total)})]},F.key))})]})})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ku,{size:18,style:{color:v.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Nómina semanal estimada"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Calculada según las horas registradas o la programación base"})]})]}),r.jsx("select",{value:w,onChange:L,className:"border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2",style:{"--tw-ring-color":v.accent},children:m.map(F=>r.jsx("option",{value:F.key,children:F.label},F.key))})]}),i.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay empleados registrados."}):r.jsxs("div",{className:"space-y-3",children:[f&&r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[r.jsx(ft,{size:16,className:"animate-spin"}),r.jsx("span",{children:"Cargando horas de la semana seleccionada…"})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Empleado"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Horas"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Valor hora"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"A pagar"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Fuente"})]})}),r.jsx("tbody",{children:H.map(F=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:F.empleado.nombre}),r.jsxs("td",{className:"py-2 pr-4 text-gray-600",children:[ht(F.horas)," h"]}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:W(F.empleado.salario_hora)}),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-semibold",children:W(F.salario)}),r.jsxs("td",{className:"py-2 pr-4 text-gray-500 capitalize",children:[F.origen==="registro"&&"Registro",F.origen==="base"&&"Horario base",F.origen==="estimado"&&"Estimado"]})]},F.empleado.id))}),r.jsx("tfoot",{children:r.jsxs("tr",{className:"border-t border-gray-200",children:[r.jsx("td",{className:"py-2 pr-4 text-sm font-semibold text-gray-600",colSpan:3,children:"Total semanal"}),r.jsx("td",{className:"py-2 pr-4 text-gray-900 font-bold",children:W(Q)}),r.jsx("td",{})]})})]})})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(Ai,{size:18,style:{color:v.dark}}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Gastos por categoría"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Distribución acumulada según las categorías registradas"})]})]}),_.length===0?r.jsx("p",{className:"text-sm text-gray-500",children:"No hay gastos registrados."}):r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{className:"text-xs uppercase tracking-wide text-gray-500",children:r.jsxs("tr",{className:"text-left",children:[r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Categoría"}),r.jsx("th",{className:"py-2 pr-4 font-medium",children:"Total"})]})}),r.jsx("tbody",{children:_.map(([F,le])=>r.jsxs("tr",{className:"border-t border-gray-100",children:[r.jsx("td",{className:"py-2 pr-4 text-gray-700 font-medium whitespace-nowrap",children:F}),r.jsx("td",{className:"py-2 pr-4 text-gray-600",children:W(le)})]},F))})]})})]})]})}const X1=[{username:"admin",password:"299381Be@",role:"admin"},{username:"javier",password:"123450",role:"admin"},{username:"briyith",password:"123450",role:"admin"},{username:"employee",password:"Savia123",role:"employee"},{username:"miguel",password:"1081058106",role:"employee"},{username:"daniel",password:"1193131563",role:"employee"}];function Z1(e,t){const s=X1.find(n=>n.username===e&&n.password===t);return s?{username:s.username,role:s.role}:null}function eN({onLogin:e}){const[t,s]=p.useState(""),[n,a]=p.useState(""),[o,i]=p.useState(""),[l,c]=p.useState(!1),d=u=>{u.preventDefault();const h=Z1(t,n);h?e(h):i("Credenciales inválidas")};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:r.jsxs("div",{className:"bg-white p-8 rounded shadow-md w-96",children:[r.jsx("h1",{className:"text-xl font-bold text-center text-gray-800",children:"Controlador Savia"}),r.jsx("p",{className:"text-center text-sm text-gray-600 mb-6",children:"Sistema de Gestión de Inventario"}),r.jsxs("form",{onSubmit:d,children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"username",children:"Usuario"}),r.jsxs("div",{className:"relative mb-4",children:[r.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",value:t,onChange:u=>s(u.target.value),placeholder:"Ingresa tu usuario",className:"w-full pl-10 p-2 border rounded"}),r.jsx(cg,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18})]}),r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"password",children:"Contraseña"}),r.jsxs("div",{className:"relative mb-4",children:[r.jsx("input",{id:"password",name:"password",type:l?"text":"password",autoComplete:"current-password",value:n,onChange:u=>a(u.target.value),placeholder:"Ingresa tu contraseña",className:"w-full pl-10 pr-10 p-2 border rounded"}),r.jsx(uv,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),r.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400",children:l?r.jsx(iv,{size:18}):r.jsx(lv,{size:18})})]}),o&&r.jsx("div",{className:"text-red-500 text-sm mb-3",children:o}),r.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",children:"Iniciar Sesión"})]}),r.jsx("p",{className:"text-center text-xs text-gray-500 mt-6",children:"La sesión se mantendrá activa por 4 horas"}),r.jsx("p",{className:"text-center text-xs text-gray-400 mt-2",children:"© 2025 Controlador Roskuki - Sistema Seguro"})]})})}const Tm=[{id:"dashboard",label:"Dashboard",icon:dv},{id:"balance",label:"Balance",icon:Ai},{id:"caja",label:"Caja",icon:og},{id:"comandas",label:"Comandas",icon:id},{id:"inventario",label:"Inventario",icon:cd},{id:"cocina",label:"Cocina",icon:od},{id:"clientes",label:"Clientes",icon:Rr},{id:"empleados",label:"Empleados",icon:bv},{id:"gastos",label:"Gastos",icon:dd},{id:"contabilidad",label:"Contabilidad",icon:ai},{id:"novedades",label:"Novedades",icon:Qa},{id:"creditoEmpleados",label:"Crédito empleados",icon:Ps},{id:"analitica",label:"Analítica",icon:ev}];function tN({activeModule:e,onModuleChange:t,user:s,onLogout:n,connectionStatus:a}){const[o,i]=p.useState(!1),[l,c]=p.useState(!1),d=s.role==="admin"?Tm:Tm.filter(E=>["caja","comandas","cocina","clientes","gastos","inventario"].includes(E.id)),h={checking:{label:"Verificando conexión…",dotClass:"bg-yellow-400 animate-pulse",textClass:"text-yellow-700"},online:{label:"Conectado a Base de Datos",dotClass:"bg-green-500",textClass:"text-green-700"},local:{label:"Modo sin conexión (local)",dotClass:"bg-red-500",textClass:"text-red-600"}}[a],m=E=>{t(E),i(!1)},x=()=>{n(),i(!1)},w=l?26:20,S=l?"w-10 h-10 text-lg":"w-8 h-8 text-base";return r.jsxs(r.Fragment,{children:[r.jsx("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm",children:r.jsxs("div",{className:`ui-page transition-all duration-300 ease-out ${l?"mx-0 px-6":""}`,style:l?{maxWidth:"100%"}:void 0,children:[r.jsx("div",{className:"hidden lg:block",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:l?r.jsxs("div",{className:"flex items-center justify-between gap-6 py-4",children:[r.jsx("div",{className:"flex items-center gap-3 flex-shrink-0",children:r.jsx("div",{className:`${S} rounded-lg flex items-center justify-center text-white font-bold transition-all duration-300`,style:{backgroundColor:v.accent},children:"S"})}),r.jsxs("div",{className:"flex flex-1 flex-wrap items-end justify-center gap-3 min-w-0",children:[d.map(({id:E,label:y,icon:f})=>r.jsxs("button",{onClick:()=>m(E),className:`
                        group flex flex-col items-center gap-1 rounded-xl px-3 py-2 transition-all duration-200
                        ${e===E?"text-white shadow-md":"text-gray-700 hover:text-gray-900 hover:bg-gray-100"}
                      `,style:{backgroundColor:e===E?v.dark:"transparent"},children:[r.jsx(f,{size:w,className:`transition-transform duration-200 ${e===E?"":"group-hover:scale-110"}`}),r.jsx("span",{className:"text-[11px] font-medium uppercase tracking-wide",children:y})]},E)),r.jsxs("button",{onClick:x,className:"group flex flex-col items-center gap-1 rounded-xl px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-all duration-200",children:[r.jsx(oi,{size:w,className:"transition-transform duration-200 group-hover:scale-110"}),r.jsx("span",{className:"text-[11px] font-medium uppercase tracking-wide",children:"Salir"})]})]}),r.jsxs("div",{className:`flex items-center gap-2 text-sm font-medium flex-shrink-0 ${h.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${h.dotClass}`}),r.jsx("span",{children:h.label})]})]}):r.jsxs("div",{className:"flex items-center justify-between gap-3 py-4",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[r.jsx("div",{className:`${S} rounded-lg flex items-center justify-center text-white font-bold transition-all duration-300`,style:{backgroundColor:v.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold hidden sm:block",style:{color:v.dark},children:"SAVIA Gestión"})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs("div",{className:`flex items-center gap-2 text-sm font-medium ${h.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${h.dotClass}`}),r.jsx("span",{children:h.label})]}),r.jsxs("div",{className:"flex items-center gap-2 flex-nowrap",children:[d.map(({id:E,label:y,icon:f})=>r.jsxs("button",{onClick:()=>m(E),className:`
                          group relative flex items-center justify-center rounded-lg p-2.5 transition-all duration-200
                          ${e===E?"text-white shadow-md transform scale-105":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}
                        `,style:{backgroundColor:e===E?v.dark:"transparent"},title:y,"aria-label":y,children:[r.jsx(f,{size:w,className:"flex-shrink-0"}),r.jsx("span",{className:"sr-only",children:y}),r.jsx("span",{className:"pointer-events-none absolute left-1/2 top-full z-10 mt-2 -translate-x-1/2 translate-y-0 whitespace-nowrap rounded-md bg-gray-900 px-2 py-1 text-xs font-medium text-white opacity-0 shadow-lg transition-all duration-150 hidden lg:block group-hover:translate-y-1 group-hover:opacity-100 group-focus:translate-y-1 group-focus:opacity-100",children:y})]},E)),r.jsxs("button",{onClick:x,className:"group relative flex items-center justify-center rounded-lg p-2.5 text-gray-600 hover:text-gray-900 hover:bg-gray-100",title:"Salir","aria-label":"Salir",children:[r.jsx(oi,{size:w,className:"flex-shrink-0"}),r.jsx("span",{className:"sr-only",children:"Salir"}),r.jsx("span",{className:"pointer-events-none absolute left-1/2 top-full z-10 mt-2 -translate-x-1/2 translate-y-0 whitespace-nowrap rounded-md bg-gray-900 px-2 py-1 text-xs font-medium text-white opacity-0 shadow-lg transition-all duration-150 hidden lg:block group-hover:translate-y-1 group-hover:opacity-100 group-focus:translate-y-1 group-focus:opacity-100",children:"Salir"})]})]})]})]})}),r.jsxs("div",{className:"flex items-center justify-between gap-3 py-3 lg:hidden",children:[r.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-base",style:{backgroundColor:v.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold",style:{color:v.dark},children:"SAVIA Gestión"})]}),r.jsx("button",{onClick:()=>i(!o),className:"p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":o?"Cerrar menú":"Abrir menú",children:o?r.jsx(Lr,{size:24}):r.jsx(mv,{size:24})})]})]})}),o&&r.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-black bg-opacity-50",onClick:()=>i(!1),children:r.jsxs("div",{className:"fixed inset-y-0 left-0 w-full max-w-xs sm:max-w-sm bg-white shadow-xl flex flex-col h-full",onClick:E=>E.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-base",style:{backgroundColor:v.accent},children:"S"}),r.jsx("h1",{className:"text-xl font-bold",style:{color:v.dark},children:"SAVIA Gestión"})]}),r.jsx("button",{onClick:()=>i(!1),className:"p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100",children:r.jsx(Lr,{size:20})})]}),r.jsxs("div",{className:"py-4 flex-1 overflow-y-auto",children:[r.jsxs("div",{className:`px-4 pb-4 text-sm font-medium flex items-center gap-2 ${h.textClass}`,children:[r.jsx("span",{className:`inline-flex h-2.5 w-2.5 rounded-full ${h.dotClass}`}),r.jsx("span",{children:h.label})]}),d.map(({id:E,label:y,icon:f})=>r.jsxs("button",{onClick:()=>m(E),className:`
                    w-full flex items-center gap-3 px-4 py-3 text-left transition-colors
                    ${e===E?"text-white":"text-gray-700 hover:bg-gray-100"}
                  `,style:{backgroundColor:e===E?v.dark:"transparent"},children:[r.jsx(f,{size:20}),r.jsx("span",{className:"font-medium",children:y})]},E)),r.jsx("div",{className:"border-t border-gray-200 mt-4 pt-4",children:r.jsxs("button",{onClick:x,className:"w-full flex items-center gap-3 px-4 py-3 text-left text-gray-700 hover:bg-gray-100 transition-colors",children:[r.jsx(oi,{size:20}),r.jsx("span",{className:"font-medium",children:"Salir"})]})})]})]})})]})}const Mm=.4,sN=new Intl.NumberFormat("es-CO",{style:"percent",maximumFractionDigits:1}),nN=new Intl.NumberFormat("es-CO",{minimumFractionDigits:1,maximumFractionDigits:1}),rN=new Intl.DateTimeFormat("es-CO",{day:"2-digit",month:"short"});function Bi(e){if(!e.length)return{days:0,sales:0,expenses:0,balance:0,avgSales:0,avgExpenses:0,netMarginPct:null};let t=0,s=0,n=0,a,o,i,l=0,c=0,d=Number.POSITIVE_INFINITY;const u=[];e.forEach(f=>{t+=f.sales,s+=f.expenses,n+=f.balance,u.push(f.sales),f.sales>l&&(l=f.sales,a={date:f.date,value:f.sales}),f.expenses>c&&(c=f.expenses,o={date:f.date,value:f.expenses}),f.balance<d&&(d=f.balance,i={date:f.date,value:f.balance})});const h=e.length,m=h>0?t/h:0,x=h>0?s/h:0,w=t>0?n/t*100:null;let S,E;if(u.length>=2){const f=m,g=u.reduce((b,$)=>b+($-f)**2,0)/u.length;S=Math.sqrt(g),f>0&&S>0&&(E=S/f)}const y=t>0&&l>0?l/t:void 0;return{days:h,sales:t,expenses:s,balance:n,avgSales:m,avgExpenses:x,netMarginPct:w,bestSalesDay:a,highestExpenseDay:o,worstBalanceDay:i,stdSales:S,cvSales:E,shareTopDay:y}}function aN(e,t){if(!t.length||!e.length)return null;const s=t.length,n=t[0].date.getTime(),a=e.findIndex(l=>l.date.getTime()===n);if(a===-1)return null;const o=a-s;if(o<0)return null;const i=e.slice(o,a);return i.length===s?i:null}function ci(e,t){return t===0||t===null||Number.isNaN(t)?null:(e-t)/t*100}function Pm(e){return e.toLocaleDateString("es-CO",{day:"2-digit",month:"short"})}function oN(e){return e===null||Number.isNaN(e)?"—":(e>=0?`+${e.toFixed(1)}%`:`${e.toFixed(1)}%`).replace(".",",")}function iN(e,t){if(!e.length)return[];const s=[],n=Bi(e),a=t!=null&&t.length?Bi(t):null;if(e.length>1){let i=0;for(let c=1;c<e.length;c+=1)e[c].historicalBalance>=e[c-1].historicalBalance&&(i+=1);if(i/(e.length-1)>=.7){const c=e[e.length-1];s.push(`El balance acumulado presenta tendencia ascendente sostenida en ${i} de los últimos ${e.length-1} días, alcanzando ${W(Math.round(c.historicalBalance))}.`)}}n.bestSalesDay&&s.push(`El mejor día de ventas fue ${Pm(n.bestSalesDay.date)} con ${W(Math.round(n.bestSalesDay.value))}.`),n.worstBalanceDay&&s.push(`El día con peor balance fue ${Pm(n.worstBalanceDay.date)} con ${W(Math.round(n.worstBalanceDay.value))}.`);const o=e.filter(i=>i.sales<=0?!1:i.expenses/i.sales>=Mm);if(o.length>=2&&s.push(`Los gastos superaron el ${sN.format(Mm)} de las ventas en ${o.length} días, sugiere revisar insumos críticos.`),a){const i=ci(n.sales,a.sales),l=n.netMarginPct!==null&&a.netMarginPct!==null?n.netMarginPct-a.netMarginPct:null,c=oN(i),d=l===null?"—":`${l>=0?"+":""}${l.toFixed(1).replace(".",",")} pp`;(i!==null||l!==null)&&s.push(`Frente al periodo anterior, las ventas ${i===null?"se mantuvieron":i>=0?"crecieron":"cayeron"} ${c} y el margen neto ${l===null?"no tuvo variación relevante":l>=0?`mejoró ${d}`:`retrocedió ${d}`}.`)}if(e.length>=5){const i=e[e.length-1].date,l=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),c=n.avgSales*l;s.push(`Con el ritmo actual, las ventas proyectadas al cierre de mes serían ${W(Math.round(c))} (estimación lineal).`)}return n.shareTopDay&&n.shareTopDay>.35?s.push("Diversifica promociones para reducir la dependencia del día pico de ventas."):s.push("Mantén acciones comerciales enfocadas en replicar los días más rentables."),s.slice(0,5)}function lN(e){if(!e.length)return!1;const t=new Date,s=t.getMonth(),n=t.getFullYear();return e.every(a=>{const o=a.date;return o.getMonth()===s&&o.getFullYear()===n})}function cN(e,t){const s=t>0?e.sales/t:0,n=[`${rN.format(e.date)} → Ventas ${W(Math.round(e.sales))}`,`Gastos ${W(Math.round(e.expenses))}`,`Balance diario ${W(Math.round(e.balance))}`,`Balance histórico ${W(Math.round(e.historicalBalance))}`];return s>0&&n.push(`Aporta ${nN.format(s*100)}% del periodo`),n}const Dm={efectivo:"Efectivo",tarjeta:"Tarjeta",nequi:"Nequi",provision_caja:"Provisión caja",credito_empleados:"Crédito empleados",sin_registro:"Sin registro"},Hi="#e5e7eb",Wi="#16a34a",Pa="#ef4444",qi="#2563eb",Td="#000000",dN=new Intl.NumberFormat("es-CO",{notation:"compact",compactDisplay:"short",maximumFractionDigits:1}),uN=[{id:"7",label:"Semana"},{id:"30",label:"Mes"},{id:"90",label:"3 meses"},{id:"all",label:"Todo"}],hN=(e,t)=>{if(!e.length)return null;const s=[...e].sort((l,c)=>l-c),n=(s.length-1)*t,a=Math.floor(n),o=Math.ceil(n);if(a===o)return s[a];const i=n-a;return s[a]+(s[o]-s[a])*i},qo=e=>e.toLocaleDateString("es-CO",{day:"2-digit",month:"short"}),mN=e=>{for(let t=2;t<e.length;t+=1){const s=e[t-1].historicalBalance,n=e[t-2].historicalBalance,a=e[t].historicalBalance;if(s<n&&a<s)return!0}return!1},fN=e=>{for(let t=1;t<e.length;t+=1){const s=e[t-1].historicalBalance,n=e[t].historicalBalance;if(s<=0&&n>=0||s>=0&&n<=0)return t}return null},pN=({data:e,maxOrders:t})=>{if(e.length===0)return null;const s=720,n=260,a={top:16,right:24,bottom:48,left:64},o=s-a.left-a.right,i=n-a.top-a.bottom,l=Math.max(t,1),c=e.length>1?o/(e.length-1):o,d=e.map((E,y)=>{const f=a.left+y*c,g=a.top+i-E.orders/l*i;return{x:f,y:g,entry:E,index:y}}),u=d.map((E,y)=>`${y===0?"M":"L"}${E.x},${E.y}`).join(" "),h=d.map((E,y)=>`${y===0?"M":"L"}${E.x},${E.y}`).join(" ")+` L ${a.left+o},${a.top+i} L ${a.left},${a.top+i} Z`,m=4,x=Array.from({length:m+1},(E,y)=>Math.round(l/m*y)),w=Math.max(1,Math.ceil(e.length/8)),S=d.filter(E=>E.index%w===0||E.index===d.length-1);return r.jsxs("svg",{viewBox:`0 0 ${s} ${n}`,className:"w-full h-64",children:[r.jsx("defs",{children:r.jsxs("linearGradient",{id:"hourlyArea",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"0%",stopColor:v.accent,stopOpacity:.3}),r.jsx("stop",{offset:"100%",stopColor:v.accent,stopOpacity:.05})]})}),r.jsx("rect",{x:a.left,y:a.top,width:o,height:i,fill:"url(#hourlyArea)",opacity:.1}),x.map((E,y)=>{const f=a.top+i-E/l*i;return r.jsxs("g",{children:[r.jsx("line",{x1:a.left,x2:a.left+o,y1:f,y2:f,stroke:Hi,strokeDasharray:"4 4"}),r.jsx("text",{x:a.left-12,y:f+4,textAnchor:"end",className:"text-xs fill-gray-500",children:E})]},`y-grid-${E}`)}),S.map(E=>r.jsx("line",{x1:E.x,x2:E.x,y1:a.top,y2:a.top+i,stroke:Hi,strokeDasharray:"4 4"},`x-grid-${E.index}`)),r.jsx("path",{d:h,fill:"url(#hourlyArea)"}),r.jsx("path",{d:u,fill:"none",stroke:v.accent,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),d.map(E=>r.jsx("circle",{cx:E.x,cy:E.y,r:4,fill:"#fff",stroke:v.accent,strokeWidth:2},`point-${E.index}`)),r.jsx("line",{x1:a.left,x2:a.left+o,y1:a.top+i,y2:a.top+i,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("line",{x1:a.left,x2:a.left,y1:a.top,y2:a.top+i,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("text",{x:a.left/2,y:a.top+i/2,transform:`rotate(-90 ${a.left/2} ${a.top+i/2})`,className:"text-xs font-medium fill-gray-600",children:"Pedidos"}),r.jsx("text",{x:a.left+o/2,y:n-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-600",children:"Hora del día"}),S.map(E=>r.jsx("text",{x:E.x,y:a.top+i+20,textAnchor:"middle",className:"text-xs fill-gray-500",children:E.entry.label},`x-label-${E.index}`))]})},gN=({data:e,totalSales:t,annotations:s=[],targetLineValue:n,targetLineLabel:a})=>{const[o,i]=p.useState(null);if(e.length===0)return r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos suficientes para mostrar la gráfica."});const l=720,c=320,d={top:24,right:32,bottom:56,left:80},u=l-d.left-d.right,h=c-d.top-d.bottom,m=n!=null?[n]:[],x=e.flatMap(R=>[R.sales,R.expenses,R.balance,R.historicalBalance]).concat(m),w=Math.max(...x,0),S=Math.min(...x,0),E=w-S||1,y=e.length>1?u/(e.length-1):u,f=R=>d.left+R*y,g=R=>{const C=(R-S)/E,H=d.top+h-C*h;return Math.min(d.top+h,Math.max(d.top,H))},b=R=>e.map((C,H)=>{const Q=R(C);return{x:f(H),y:g(Q),value:Q,index:H,label:C.label}}),$=R=>R.map((C,H)=>`${H===0?"M":"L"}${C.x},${C.y}`).join(" "),A=b(R=>R.sales),B=b(R=>R.expenses),z=b(R=>R.balance),de=b(R=>R.historicalBalance),P=5,D=Array.from({length:P},(R,C)=>S+E/(P-1)*C),Y=Math.max(1,Math.ceil(e.length/6)),K=A.filter(R=>R.index%Y===0||R.index===A.length-1),pe=g(0),ye=o!==null?e[o]:null,ue=o!==null?A[o]:null,Z=ye?cN(ye,t):[],re=(R,C)=>{switch(R){case"sales":return A[C];case"expenses":return B[C];case"balance":return z[C];case"historical":return de[C];default:return}},ae=A.map((R,C)=>{const H=C===0?d.left:(A[C-1].x+R.x)/2,Q=C===A.length-1?d.left+u:(R.x+A[C+1].x)/2,L=Math.max(8,Q-H);return r.jsx("rect",{x:H,y:d.top,width:L,height:h,fill:"transparent",onMouseEnter:()=>i(C),onFocus:()=>i(C),onMouseLeave:()=>i(null),onTouchStart:()=>i(C),role:"presentation"},`zone-${R.index}`)}),_=200,ie=24+Z.length*16,O=ue?Math.min(Math.max(ue.x-_/2,d.left+8),d.left+u-_-8):0,se=ue?Math.max(ue.y-ie-16,d.top+8):0;return r.jsxs("svg",{viewBox:`0 0 ${l} ${c}`,className:"w-full h-80",onMouseLeave:()=>i(null),children:[D.map((R,C)=>{const H=g(R);return r.jsxs("g",{children:[r.jsx("line",{x1:d.left,x2:d.left+u,y1:H,y2:H,stroke:Hi,strokeDasharray:"4 4"}),r.jsx("text",{x:d.left-12,y:H+4,textAnchor:"end",className:"text-xs fill-gray-500",children:dN.format(Math.round(R))})]},`y-financial-${C}`)}),r.jsx("line",{x1:d.left,x2:d.left+u,y1:pe,y2:pe,stroke:"#9ca3af",strokeWidth:1.5}),K.map(R=>r.jsx("line",{x1:R.x,x2:R.x,y1:d.top,y2:d.top+h,stroke:Hi,strokeDasharray:"4 4"},`x-financial-${R.index}`)),n!=null&&r.jsxs("g",{children:[r.jsx("line",{x1:d.left,x2:d.left+u,y1:g(n),y2:g(n),stroke:"#4b5563",strokeDasharray:"4 4",strokeWidth:1.5}),a&&r.jsx("text",{x:d.left+u-4,y:g(n)-6,textAnchor:"end",className:"text-xs font-medium fill-gray-600",children:a})]}),r.jsx("path",{d:$(B),fill:"none",stroke:Pa,strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:$(A),fill:"none",stroke:Wi,strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:$(z),fill:"none",stroke:qi,strokeWidth:2.5,strokeDasharray:"6 4",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:$(de),fill:"none",stroke:Td,strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"}),A.map(R=>r.jsx("circle",{cx:R.x,cy:R.y,r:o===R.index?5:4,fill:"#fff",stroke:Wi,strokeWidth:2},`sales-${R.index}`)),B.map(R=>r.jsx("circle",{cx:R.x,cy:R.y,r:4,fill:"#fff",stroke:Pa,strokeWidth:2},`expenses-${R.index}`)),z.map(R=>r.jsx("circle",{cx:R.x,cy:R.y,r:4,fill:"#fff",stroke:qi,strokeWidth:2},`balance-${R.index}`)),de.map(R=>r.jsx("circle",{cx:R.x,cy:R.y,r:4,fill:"#fff",stroke:Td,strokeWidth:2},`historical-balance-${R.index}`)),s.map(R=>{const C=re(R.anchor,R.index);return C?r.jsxs("g",{children:[R.variant==="outline"&&r.jsx("circle",{cx:C.x,cy:C.y,r:7,fill:"white",stroke:R.color??Pa,strokeWidth:2.5}),R.icon&&r.jsx("text",{x:C.x,y:C.y-12,textAnchor:"middle",className:"text-sm",children:R.icon}),r.jsx("text",{x:C.x,y:R.icon?C.y-26:C.y-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-700",children:R.label})]},`${R.anchor}-${R.index}`):null}),ue&&r.jsxs("g",{children:[r.jsx("line",{x1:ue.x,x2:ue.x,y1:d.top,y2:d.top+h,stroke:"#d1d5db",strokeDasharray:"4 4"}),r.jsx("rect",{x:O,y:se,width:_,height:ie,rx:8,ry:8,fill:"white",stroke:"#e5e7eb",strokeWidth:1}),r.jsx("text",{x:O+12,y:se+18,className:"text-xs fill-gray-700",children:Z.map((R,C)=>r.jsx("tspan",{x:O+12,dy:C===0?0:16,children:R},R))})]}),ae,r.jsx("line",{x1:d.left,x2:d.left+u,y1:d.top+h,y2:d.top+h,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("line",{x1:d.left,x2:d.left,y1:d.top,y2:d.top+h,stroke:"#9ca3af",strokeWidth:1.5}),r.jsx("text",{x:d.left/2,y:d.top+h/2,transform:`rotate(-90 ${d.left/2} ${d.top+h/2})`,className:"text-xs font-medium fill-gray-600",children:"Valor (COP)"}),r.jsx("text",{x:d.left+u/2,y:c-12,textAnchor:"middle",className:"text-xs font-medium fill-gray-600",children:"Días analizados"}),K.map(R=>r.jsx("text",{x:R.x,y:d.top+h+20,textAnchor:"middle",className:"text-xs fill-gray-500",children:R.label},`label-${R.index}`))]})},Om=(e,t)=>{const s=e.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"}),n=t.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric"});return s===n?e.toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}):`${s} – ${n}`},xN=(e,t)=>{const s=wt(e),n=wt(t),a=s.getTime(),o=n.getTime(),i=Math.min(a,o),l=Math.max(a,o),c=new Date(i);c.setHours(0,0,0,0);const d=new Date(l);return d.setHours(23,59,59,999),{start:c,end:d}};function yN({orders:e,targetVentasMensual:t}){const s=p.useMemo(()=>Be(new Date),[]),n=p.useMemo(()=>{const T=new Date;return T.setDate(T.getDate()-6),Be(T)},[]),[a,o]=p.useState("range"),[i,l]=p.useState(n),[c,d]=p.useState(s),[u,h]=p.useState(s),[m,x]=p.useState([]),[w,S]=p.useState("30");p.useEffect(()=>{let T=!0;return(async()=>{try{const ce=await xe.fetchGastos();T&&x(ce)}catch(ce){console.error("[Analitica] Error cargando gastos:",ce)}})(),()=>{T=!1}},[]);const E=p.useMemo(()=>e.reduce((T,J)=>T+J.total,0),[e]),y=p.useMemo(()=>xN(i,c),[i,c]),f=y.start,g=y.end,b=p.useMemo(()=>{if(e.length===0)return[];if(a==="single"){const T=u;return e.filter(J=>Be(J.timestamp)===T)}return e.filter(T=>{const J=T.timestamp.getTime();return J>=f.getTime()&&J<=g.getTime()})},[e,a,f,g,u]),$=p.useMemo(()=>{if(m.length===0)return[];if(a==="single"){const T=u;return m.filter(J=>Be(J.fecha)===T)}return m.filter(T=>{const ce=(T.fecha instanceof Date?T.fecha:new Date(T.fecha)).getTime();return ce>=f.getTime()&&ce<=g.getTime()})},[m,a,u,f,g]),A=p.useMemo(()=>[...b].sort((T,J)=>J.timestamp.getTime()-T.timestamp.getTime()),[b]),B=p.useMemo(()=>b.reduce((T,J)=>T+J.total,0),[b]),z=b.length,de=z>0?B/z:0,P=b.reduce((T,J)=>J.total>T?J.total:T,0),D=p.useMemo(()=>{const T=new Map;b.forEach(te=>{const be=te.timestamp.getHours(),Pe=T.get(be)??{orders:0,total:0};Pe.orders+=1,Pe.total+=te.total,T.set(be,Pe)});const J=Array.from({length:24},(te,be)=>{const Pe=`${be.toString().padStart(2,"0")}:00`,_e=T.get(be);return{hour:be,label:Pe,orders:(_e==null?void 0:_e.orders)??0,total:(_e==null?void 0:_e.total)??0}}),ce=J.filter(te=>te.orders>0).sort((te,be)=>be.orders===te.orders?be.total-te.total:be.orders-te.orders).slice(0,3),je=J.reduce((te,be)=>be.orders>te?be.orders:te,0),M=J.reduce((te,be)=>be.total>te?be.total:te,0);return{dataset:J,busiest:ce,maxOrders:je,maxTotal:M}},[b]),Y=p.useMemo(()=>D.dataset.filter(T=>T.orders>0||T.total>0),[D]),K=p.useMemo(()=>Y.length>0?z/Y.length:0,[Y,z]),pe=p.useMemo(()=>{if(Y.length!==0)return Y.reduce((T,J)=>!T||J.total>T.total?J:T,void 0)},[Y]),ye=p.useMemo(()=>{if(b.length===0&&$.length===0)return[];const T=new Map;b.forEach(je=>{const M=Be(je.timestamp),te=T.get(M)??{sales:0,expenses:0};te.sales+=je.total,T.set(M,te)}),$.forEach(je=>{const M=je.fecha instanceof Date?je.fecha:new Date(je.fecha),te=Be(M),be=T.get(te)??{sales:0,expenses:0};be.expenses+=je.monto,T.set(te,be)});const J=Array.from(T.entries()).map(([je,{sales:M,expenses:te}])=>{const be=wt(je),Pe=be.toLocaleDateString("es-CO",{day:"2-digit",month:"short"});return{date:be,label:Pe,sales:M,expenses:te,balance:M-te}}).sort((je,M)=>je.date.getTime()-M.date.getTime());let ce=0;return J.map(je=>(ce+=je.balance,{...je,historicalBalance:ce}))},[b,$]),ue=p.useMemo(()=>{if(w==="all")return ye;const T=Number(w);return ye.slice(-T)},[ye,w]),Z=p.useMemo(()=>Bi(ue),[ue]),re=p.useMemo(()=>aN(ye,ue),[ye,ue]),ae=p.useMemo(()=>re?Bi(re):null,[re]),_=p.useMemo(()=>{const T=new Map;return b.forEach(J=>{const ce=Be(J.timestamp),je=T.get(ce)??{total:0,count:0};je.total+=J.total,je.count+=1,T.set(ce,je)}),T},[b]),ie=p.useMemo(()=>{if(ue.length===0)return{total:0,count:0};let T=0,J=0;return ue.forEach(ce=>{const je=Be(ce.date),M=_.get(je);M&&(T+=M.total,J+=M.count)}),{total:T,count:J}},[_,ue]),O=p.useMemo(()=>{if(!re)return null;let T=0,J=0;return re.forEach(ce=>{const je=Be(ce.date),M=_.get(je);M&&(T+=M.total,J+=M.count)}),{total:T,count:J}},[_,re]),se=ie.count>0?ie.total/ie.count:0,R=O&&O.count>0?O.total/O.count:null,C=p.useMemo(()=>{if(!ae)return null;const T=ci(Z.sales,ae.sales),J=ci(Z.expenses,ae.expenses),ce=Z.netMarginPct!==null&&ae.netMarginPct!==null?Z.netMarginPct-ae.netMarginPct:null,je=R!==null?ci(se,R):null;return{salesChange:T,expensesChange:J,marginChange:ce,ticketChange:je,prevMargin:ae.netMarginPct,prevAvgTicket:R}},[Z,ae,R,se]),H=p.useMemo(()=>{const T=ue.map(J=>J.expenses).filter(J=>J>0);return T.length===0?null:hN(T,.9)},[ue]),Q=p.useMemo(()=>H===null?[]:ue.map((T,J)=>({point:T,index:J})).filter(({point:T})=>T.expenses>H),[H,ue]),L=p.useMemo(()=>fN(ue),[ue]),G=p.useMemo(()=>{const T=[];if(Z.bestSalesDay){const J=ue.findIndex(ce=>{var je;return ce.date.getTime()===((je=Z.bestSalesDay)==null?void 0:je.date.getTime())});J>=0&&T.push({index:J,anchor:"sales",icon:"⭐",label:"Mejor venta",color:Wi})}return Q.forEach(({index:J})=>{T.push({index:J,anchor:"expenses",icon:"⚠️",label:"Gasto atípico",color:Pa,variant:"outline"})}),L!==null&&T.push({index:L,anchor:"historical",icon:"◎",label:"Balance = 0",color:qi}),T},[Q,Z.bestSalesDay,L,ue]),fe=p.useMemo(()=>{const J=[...iN(ue,re??void 0)];if(pe&&pe.total>0){const ce=`Refuerza surtido en la franja ${pe.label}, la más rentable con ${W(Math.round(pe.total))}.`;J.push(ce)}return J.slice(0,5)},[re,pe,ue]),Se=p.useMemo(()=>{const T=[];if(ue.length>=3&&mN(ue)&&T.push({id:"flow",message:"Dos días de deterioro consecutivo en el balance acumulado."}),Z.shareTopDay&&Z.shareTopDay>.35&&Z.bestSalesDay&&T.push({id:"concentration",message:`Un solo día (${qo(Z.bestSalesDay.date)}) aporta ${Math.round(Z.shareTopDay*100)}% de las ventas. Riesgo de concentración.`}),Q.length>0){const J=Q.length,ce=Q[0];T.push({id:"outlier",message:`${J===1?"Un":`${J}`} día${J>1?"s":""} con gasto atípico, comenzó el ${qo(ce.point.date)}.`})}return T},[Q,Z.bestSalesDay,Z.shareTopDay,ue]),ze=p.useMemo(()=>lN(ue),[ue]),Fe=p.useMemo(()=>{const T=new Date;return new Date(T.getFullYear(),T.getMonth()+1,0).getDate()},[]),Ie=typeof t=="number"&&t>0&&ze,F=p.useMemo(()=>!Ie||!t?null:Z.sales/t*100,[Z.sales,Ie,t]),le=Ie&&w==="30"&&t?t/Fe:null,ge=p.useMemo(()=>{if(!ze||Z.days<5)return null;const T=Z.avgSales*Fe,ce=(Z.days>0?Z.balance/Z.days:0)*Fe;return{projectedSales:T,projectedBalance:ce}},[Fe,ze,Z.avgSales,Z.balance,Z.days]),ke=p.useMemo(()=>{if(Z.days===0)return[];const T=[{id:"avg-sales",label:"Promedio ventas diarias",value:W(Math.round(Z.avgSales)),hint:`${Z.days} día${Z.days>1?"s":""} analizado${Z.days>1?"s":""}`},{id:"avg-expenses",label:"Promedio gastos diarios",value:W(Math.round(Z.avgExpenses)),hint:"Gasto promedio en el rango visible"},{id:"net-margin",label:"Margen neto del periodo",value:Z.netMarginPct===null?"—":`${Z.netMarginPct>=0?"+":""}${Z.netMarginPct.toFixed(1).replace(".",",")}%`,hint:Z.netMarginPct===null?"Se requiere al menos una venta.":"Balance acumulado sobre ventas."},{id:"best-day",label:"Día con mayor venta",value:Z.bestSalesDay?W(Math.round(Z.bestSalesDay.value)):"—",hint:Z.bestSalesDay?`Fecha ${qo(Z.bestSalesDay.date)}`:"Sin datos disponibles."},{id:"max-expense",label:"Día con mayor gasto",value:Z.highestExpenseDay?W(Math.round(Z.highestExpenseDay.value)):"—",hint:Z.highestExpenseDay?`Fecha ${qo(Z.highestExpenseDay.date)}`:"Sin datos disponibles."}];return Z.stdSales!==void 0&&Z.days>=3&&T.push({id:"volatility",label:"Volatilidad de ventas",value:W(Math.round(Z.stdSales)),hint:"Desviación estándar del ingreso diario."}),Z.cvSales!==void 0&&Z.days>=3&&T.push({id:"cv-sales",label:"Coeficiente de variación",value:`${(Z.cvSales*100).toFixed(1).replace(".",",")}%`,hint:"Relación entre volatilidad y promedio."}),T},[Z]),Me=p.useMemo(()=>{if(ue.length===0)return"";const T=ue[0].date,J=ue[ue.length-1].date;return Om(T,J)},[ue]),We=p.useMemo(()=>{const T={};return b.forEach(J=>{const ce=J.paymentAllocations&&J.paymentAllocations.length>0?J.paymentAllocations:J.metodoPago?[{metodo:J.metodoPago,monto:Math.round(J.total)}]:[];if(ce.length===0){T.sin_registro=(T.sin_registro??0)+J.total;return}ce.forEach(({metodo:je,monto:M})=>{T[je]=(T[je]??0)+M})}),Object.entries(T).map(([J,ce])=>({method:J,label:Dm[J]??J,amount:ce,percentage:B>0?ce/B*100:0})).sort((J,ce)=>ce.amount-J.amount)},[b,B]),Ge=p.useMemo(()=>{const T=new Map;return b.forEach(J=>{const ce=Be(J.timestamp),je=T.get(ce)??{total:0,orders:0};je.total+=J.total,je.orders+=1,T.set(ce,je)}),Array.from(T.entries()).map(([J,{total:ce,orders:je}])=>{const M=wt(J).toLocaleDateString("es-CO",{weekday:"short",day:"2-digit",month:"short",year:"numeric"});return{dateKey:J,displayDate:M,total:ce,orders:je}}).sort((J,ce)=>J.dateKey<ce.dateKey?1:-1)},[b]),Ze=p.useMemo(()=>{const T=new Map;return b.forEach(J=>{J.items.forEach(({item:ce,cantidad:je,precioUnitario:M})=>{const te=ce.id||ce.nombre,be=typeof M=="number"?M:ce.precio,Pe=je*be,_e=T.get(te)??{name:ce.nombre,quantity:0,amount:0};_e.name=ce.nombre,_e.quantity+=je,_e.amount+=Pe,T.set(te,_e)})}),Array.from(T.values()).sort((J,ce)=>ce.amount-J.amount).slice(0,5)},[b]),St=p.useMemo(()=>a==="single"?wt(u).toLocaleDateString("es-CO",{day:"2-digit",month:"long",year:"numeric",weekday:"long"}):Om(f,g),[a,u,f,g]),it=T=>{const J=new Date,ce=new Date;ce.setDate(ce.getDate()-(T-1)),o("range"),l(Be(ce)),d(Be(J))},_t=()=>{const T=new Date,J=new Date(T.getFullYear(),T.getMonth(),1);o("range"),l(Be(J)),d(Be(T))},xt=()=>{const T=Be(new Date);o("single"),h(T)},Ht=[{label:"Ventas en el periodo",value:W(B),description:"Total facturado en el intervalo seleccionado",icon:lg},{label:"Pedidos registrados",value:z.toString(),description:"Cantidad de pedidos capturados",icon:ag},{label:"Ticket promedio",value:z>0?W(Math.round(de)):"Sin datos",description:"Promedio por pedido",icon:tv},{label:"Venta más alta",value:z>0?W(P):"Sin datos",description:"Pedido de mayor valor en el periodo",icon:vv}];return r.jsxs("section",{className:"space-y-6 sm:space-y-8",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",style:{color:v.dark},children:"Analítica de Ventas"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Analiza el desempeño histórico y descubre tendencias por rangos personalizados o fechas específicas."})]}),r.jsxs("div",{className:"ui-card p-3 text-right",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Total histórico registrado"}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:v.dark},children:W(E)})]})]}),r.jsxs("section",{className:"ui-card ui-card-pad space-y-4",children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[r.jsxs("div",{className:"inline-flex bg-gray-100 rounded-lg p-1",children:[r.jsxs("button",{type:"button",onClick:()=>o("range"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors ${a==="range"?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(ku,{size:18}),"Rango de fechas"]}),r.jsxs("button",{type:"button",onClick:()=>o("single"),className:`flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-colors ${a==="single"?"bg-white shadow-sm text-gray-900":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(sv,{size:18}),"Fecha exacta"]})]}),r.jsxs("div",{className:"text-sm text-gray-600",children:[r.jsx("span",{className:"font-semibold text-gray-700",children:"Periodo analizado:"})," ",St]})]}),a==="range"?r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsxs("label",{className:"flex flex-col text-sm text-gray-700",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Fecha inicial"}),r.jsx("input",{type:"date",value:i,onChange:T=>l(T.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("label",{className:"flex flex-col text-sm text-gray-700",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Fecha final"}),r.jsx("input",{type:"date",value:c,onChange:T=>d(T.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("div",{className:"sm:col-span-2 flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Atajos rápidos:"}),r.jsx("button",{type:"button",onClick:()=>it(7),className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"Últimos 7 días"}),r.jsx("button",{type:"button",onClick:()=>it(30),className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"Últimos 30 días"}),r.jsx("button",{type:"button",onClick:_t,className:"px-3 py-2 text-xs font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300",children:"Este mes"})]})]})}):r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-4",children:[r.jsxs("label",{className:"flex flex-col text-sm text-gray-700 w-full sm:w-auto",children:[r.jsx("span",{className:"mb-2 font-medium",children:"Selecciona la fecha"}),r.jsx("input",{type:"date",value:u,onChange:T=>h(T.target.value),className:"border border-gray-200 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsx("button",{type:"button",onClick:xt,className:"px-4 py-2 text-sm font-medium rounded-md border border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300 self-start",children:"Ir a hoy"})]})]}),r.jsx("section",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:Ht.map(({label:T,value:J,description:ce,icon:je})=>r.jsxs("div",{className:"ui-card p-4 lg:p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:T}),r.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center",style:{backgroundColor:`${v.accent}15`},children:r.jsx(je,{size:18,style:{color:v.dark}})})]}),r.jsx("div",{className:"text-xl font-semibold",style:{color:v.dark},children:J}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:ce})]},T))}),r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[r.jsxs("section",{className:"xl:col-span-2 ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:v.dark},children:"Desempeño diario"}),Ge.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-4 py-3 text-left font-medium text-gray-600",children:"Fecha"}),r.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-600",children:"Pedidos"}),r.jsx("th",{className:"px-4 py-3 text-right font-medium text-gray-600",children:"Ventas"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:Ge.map(T=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-4 py-3 font-medium text-gray-700",children:T.displayDate}),r.jsx("td",{className:"px-4 py-3 text-right text-gray-600",children:T.orders}),r.jsx("td",{className:"px-4 py-3 text-right font-semibold",style:{color:v.dark},children:W(T.total)})]},T.dateKey))})]})}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos en el periodo seleccionado."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",style:{color:v.dark},children:[r.jsx(sg,{size:18})," Distribución por método de pago"]}),We.length>0?r.jsx("div",{className:"space-y-4",children:We.map(T=>r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between text-sm font-medium text-gray-700",children:[r.jsx("span",{children:T.label}),r.jsx("span",{children:W(T.amount)})]}),r.jsx("div",{className:"mt-2 h-2 bg-gray-100 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-2 rounded-full",style:{width:`${T.percentage}%`,backgroundColor:v.accent}})}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[T.percentage.toFixed(1),"% del periodo"]})]},T.method))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay información de métodos de pago para este periodo."})]})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Evolución financiera por día"}),r.jsx("p",{className:"text-sm text-gray-500",children:"Visualiza cómo se comportan las ventas, los gastos y el balance en el período seleccionado."})]}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("span",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Zoom:"}),uN.map(T=>r.jsx("button",{type:"button",onClick:()=>S(T.id),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-colors ${w===T.id?"bg-gray-900 text-white border-gray-900":"border-gray-200 text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:T.label},T.id))]})]}),ue.length>0?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx(gN,{data:ue,totalSales:Z.sales,annotations:G,targetLineValue:le??void 0,targetLineLabel:le?"Meta diaria":void 0}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Wi}})," Ventas"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Pa}})," Gastos"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2 border-dashed",style:{borderColor:qi}})," Balance diario"]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2",style:{borderColor:Td}})," Balance histórico"]}),le&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-5 border-t-2 border-dashed",style:{borderColor:"#4b5563"}})," Meta diaria"]}),Me&&r.jsx("div",{className:"ml-auto text-xs text-gray-500",children:Me})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Ventas acumuladas"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:W(Math.round(Z.sales))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Gastos acumulados"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:W(Math.round(Z.expenses))})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Balance"}),r.jsx("p",{className:`text-lg font-semibold ${Z.balance>=0?"text-green-600":"text-red-600"}`,children:W(Math.round(Z.balance))})]})]}),ke.length>0&&r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:ke.map(T=>r.jsxs("div",{className:"ui-card p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:T.label}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:v.dark},children:T.value}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:T.hint})]},T.id))}),Ie&&F!==null&&r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Meta mensual"}),r.jsxs("p",{className:"text-sm text-gray-700",children:["Objetivo: ",W(Math.round(t??0))]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Cumplimiento"}),r.jsxs("p",{className:`text-lg font-semibold ${F>=100?"text-green-600":"text-gray-800"}`,children:[F.toFixed(1).replace(".",","),"%"]})]})]}),C&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Comparativo periodo anterior"}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{id:"sales",label:"Ventas",value:W(Math.round(Z.sales)),change:C.salesChange},{id:"expenses",label:"Gastos",value:W(Math.round(Z.expenses)),change:C.expensesChange},{id:"margin",label:"Margen neto",value:Z.netMarginPct===null?"—":`${Z.netMarginPct>=0?"+":""}${Z.netMarginPct.toFixed(1).replace(".",",")}%`,margin:!0,change:C.marginChange},{id:"ticket",label:"Ticket promedio",value:se>0?W(Math.round(se)):"—",change:C.ticketChange}].map(T=>{const J=!!T.margin,ce=T.change,je=ce===null||Number.isNaN(ce)?"—":J?`${ce>=0?"+":""}${ce.toFixed(1).replace(".",",")} pp`:`${ce>=0?"+":""}${ce.toFixed(1).replace(".",",")}%`,M=ce===null||Number.isNaN(ce)?"text-gray-500":ce>=0?"text-green-600":"text-red-600",te=ce===null||Number.isNaN(ce)?"–":ce>=0?"▲":"▼";return r.jsxs("div",{className:"ui-card p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:T.label}),r.jsx("p",{className:"text-lg font-semibold mt-1",style:{color:v.dark},children:T.value}),r.jsxs("p",{className:`text-xs font-medium mt-1 ${M}`,children:[te!=="–"&&r.jsx("span",{className:"mr-1",children:te}),je]})]},T.id)})})]}),Se.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Alertas"}),Se.map(T=>r.jsxs("div",{className:"flex items-start gap-2 bg-yellow-50 border border-yellow-100 rounded-md px-3 py-2 text-xs text-yellow-800",children:[r.jsx("span",{className:"text-base leading-none pt-0.5",children:"⚠️"}),r.jsx("span",{children:T.message})]},T.id))]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Insights del periodo"}),fe.length>0?r.jsx("ul",{className:"space-y-1 text-sm text-gray-700",children:fe.map((T,J)=>{const ce=T.toLowerCase(),je=ce.includes("riesgo")||ce.includes("gasto")||ce.includes("caída")||ce.includes("retrocedió");return r.jsxs("li",{className:"flex items-start gap-2",children:[r.jsx("span",{className:`${je?"text-yellow-600":"text-green-600"} leading-none pt-0.5`,children:je?"⚠️":"✓"}),r.jsx("span",{children:T})]},`${T}-${J}`)})}):r.jsx("p",{className:"text-sm text-gray-500",children:"Sin insights destacados para este rango."})]}),ge&&r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-4",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Proyección cierre"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-2 text-sm text-gray-700",children:[r.jsxs("span",{children:["Ventas proyectadas:"," ",r.jsx("strong",{className:"text-gray-800",children:W(Math.round(ge.projectedSales))})]}),r.jsxs("span",{children:["Balance proyectado:"," ",r.jsx("strong",{className:`text-gray-800 ${ge.projectedBalance>=0?"text-green-600":"text-red-600"}`,children:W(Math.round(ge.projectedBalance))})]})]}),r.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Estimación lineal, no considera estacionalidad."})]})]}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos suficientes para visualizar ventas y gastos."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Comportamiento por hora"}),r.jsxs("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:["Total pedidos en el periodo:"," ",r.jsx("span",{className:"font-semibold text-gray-700",children:z})]})]}),D.dataset.some(T=>T.orders>0)?r.jsxs("div",{className:"space-y-8",children:[r.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsx(pN,{data:D.dataset,maxOrders:D.maxOrders}),r.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Eje Y: cantidad de pedidos · Eje X: hora del día."})]}),r.jsxs("div",{className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Resumen"}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Horas con actividad"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:Y.length})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Promedio por hora"}),r.jsx("p",{className:"text-lg font-semibold text-gray-800",children:K.toFixed(1)})]}),r.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-lg p-3 sm:col-span-2",children:[r.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Hora más rentable"}),r.jsx("p",{className:"text-sm font-semibold text-gray-800",children:pe?`${pe.label} · ${W(pe.total)}`:"—"})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Horas con mayor actividad"}),D.busiest.length>0?r.jsx("ul",{className:"space-y-2 text-sm",children:D.busiest.map(T=>r.jsxs("li",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"font-medium text-gray-700",children:T.label}),r.jsxs("div",{className:"text-right text-xs text-gray-500",children:[r.jsxs("div",{className:"font-semibold text-gray-700",children:[T.orders," pedidos"]}),r.jsxs("div",{children:["Ventas ",W(T.total)]})]})]},T.hour))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay suficientes datos para identificar las horas pico."})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Detalle por hora"}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-xs",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-600",children:"Hora"}),r.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-600",children:"Pedidos"}),r.jsx("th",{className:"px-3 py-2 text-right font-medium text-gray-600",children:"Ventas"})]})}),r.jsx("tbody",{className:"divide-y divide-gray-100",children:Y.map(T=>r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 py-2 font-medium text-gray-700",children:T.label}),r.jsx("td",{className:"px-3 py-2 text-right text-gray-600",children:T.orders}),r.jsx("td",{className:"px-3 py-2 text-right font-semibold text-gray-700",children:T.total>0?W(T.total):"-"})]},T.hour))})]})})]})]}):r.jsx("p",{className:"text-sm text-gray-500",children:"No se registran pedidos en el periodo seleccionado."})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:v.dark},children:"Productos más vendidos"}),Ze.length>0?r.jsx("ul",{className:"space-y-3 text-sm",children:Ze.map(T=>r.jsxs("li",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-700",children:T.name}),r.jsxs("p",{className:"text-xs text-gray-500",children:[T.quantity," unidades"]})]}),r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:W(T.amount)})]},T.name))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay ventas registradas para calcular este ranking."})]}),r.jsxs("section",{className:"ui-card ui-card-pad",children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:v.dark},children:"Pedidos del periodo"}),A.length>0?r.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:A.map(T=>r.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 text-sm hover:border-gray-200 transition-colors",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"font-semibold text-gray-700",children:["Pedido #",T.numero]}),r.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 capitalize",children:T.estado})]}),r.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[r.jsx("span",{children:T.timestamp.toLocaleDateString("es-CO",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}),r.jsx("span",{children:T.metodoPago?Dm[T.metodoPago]??T.metodoPago:"Sin método"})]}),r.jsx("div",{className:"text-right font-semibold mt-2",style:{color:v.dark},children:W(T.total)})]},T.id))}):r.jsx("p",{className:"text-sm text-gray-500",children:"No hay pedidos en el periodo seleccionado."})]})]})]})}const mc="__sin_empleado__",yx=[{value:"efectivo",label:"Efectivo",description:"Pago recibido en caja."},{value:"nequi",label:"Nequi",description:"Transferencia recibida a Nequi."},{value:"tarjeta",label:"Tarjeta",description:"Pago con datafono o tarjeta."}],Im=e=>{const t=new Date(e);return t.setHours(0,0,0,0),t},Am=e=>{const t=new Date(e);return t.setHours(23,59,59,999),t},vN=e=>e.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"}),bN=e=>{const t=new Date(e);return Number.isNaN(t.getTime())?"Fecha desconocida":t.toLocaleString("es-CO",{dateStyle:"medium",timeStyle:"short"})},Vo=(e,t)=>t&&t.trim().length>0?t.trim():`Empleado ${e.slice(0,6)}`,jN=e=>yx.some(t=>t.value===e)?e:"efectivo";function wN({orders:e,onSettleCredit:t,onViewOrder:s}){const[n,a]=p.useState([]),[o,i]=p.useState(!0),[l,c]=p.useState(null),d=p.useMemo(()=>{const L=new Date;return L.setDate(1),Be(L)},[]),u=p.useMemo(()=>Be(new Date),[]),[h,m]=p.useState(d),[x,w]=p.useState(u),[S,E]=p.useState(""),[y,f]=p.useState("todos"),[g,b]=p.useState("todos"),[$,A]=p.useState(null),[B,z]=p.useState(null),[de,P]=p.useState("efectivo"),[D,Y]=p.useState(null);p.useEffect(()=>{let L=!0;const G=async()=>{i(!0),c(null);try{const Se=await xe.fetchEmployeeCredits();if(!L)return;a(Se)}catch(Se){if(console.error("Error cargando el historial de crédito de empleados:",Se),!L)return;c("No se pudo cargar el historial de créditos de empleados.")}finally{L&&i(!1)}};G();const fe=()=>{G()};return typeof window<"u"&&window.addEventListener(qn,fe),()=>{L=!1,typeof window<"u"&&window.removeEventListener(qn,fe)}},[]);const K=p.useMemo(()=>e.filter(L=>{const G=L.creditInfo;return!G||G.type!=="empleados"?!1:!vs(L)}).map(L=>{var F;const G=L.creditInfo,fe=G.assignedAt??L.timestamp,Se=Math.max(0,Math.round(G.amount??L.total)),ze=(F=G.employeeName)==null?void 0:F.trim(),Fe=G.employeeId??void 0,Ie=ze&&ze.length>0?ze:Fe?`Empleado ${Fe}`:"Empleado sin asignar";return{order:L,assignedAt:fe,amount:Se,employeeLabel:Ie,employeeId:Fe}}).sort((L,G)=>G.assignedAt.getTime()-L.assignedAt.getTime()),[e]),pe=p.useMemo(()=>{const L=Im(wt(h)),G=Am(wt(x));if(S){const fe=wt(S),Se=Im(fe),ze=Am(fe);return{start:Se.getTime(),end:ze.getTime(),isExact:!0}}return{start:L.getTime(),end:G.getTime(),isExact:!1}},[h,x,S]),ye=p.useMemo(()=>{const L=new Map;return n.forEach(G=>{const fe=Vo(G.empleadoId,G.empleadoNombre);L.set(G.empleadoId,fe)}),K.forEach(({employeeId:G,employeeLabel:fe})=>{G&&(L.has(G)||L.set(G,fe))}),K.some(G=>!G.employeeId)&&L.set(mc,"Créditos sin empleado asignado"),Array.from(L.entries()).map(([G,fe])=>({key:G,label:fe})).sort((G,fe)=>G.label.localeCompare(fe.label,"es"))},[n,K]);p.useEffect(()=>{if(y==="todos")return;ye.findIndex(G=>G.key===y)!==-1||y===mc&&K.some(G=>!G.employeeId)||f("todos")},[ye,K,y]);const ue=p.useMemo(()=>{const L=pe.start,G=pe.end;return K.filter(({assignedAt:fe,employeeId:Se})=>{const ze=fe.getTime();return ze<L||ze>G?!1:y==="todos"?!0:y===mc?!Se:Se===y})},[K,pe,y]),Z=p.useMemo(()=>ue.reduce((L,G)=>L+G.amount,0),[ue]),re=p.useMemo(()=>n.reduce((L,G)=>L+Math.round(G.total),0),[n]),ae=p.useMemo(()=>n.flatMap(L=>L.history.map(G=>({...G,empleadoId:L.empleadoId,empleadoNombre:G.empleadoNombre??L.empleadoNombre??Vo(L.empleadoId)}))).sort((L,G)=>new Date(G.timestamp).getTime()-new Date(L.timestamp).getTime()),[n]),_=p.useMemo(()=>{const L=pe.start,G=pe.end;return ae.filter(fe=>{const Se=new Date(fe.timestamp).getTime();return!(Number.isNaN(Se)||Se<L||Se>G||y!=="todos"&&fe.empleadoId!==y||g!=="todos"&&fe.tipo!==g)})},[pe,ae,y,g]),ie=p.useMemo(()=>_.filter(L=>L.tipo==="cargo").reduce((L,G)=>L+G.monto,0),[_]),O=p.useMemo(()=>_.filter(L=>L.tipo==="abono").reduce((L,G)=>L+G.monto,0),[_]),se=p.useMemo(()=>ie-O,[ie,O]),R=p.useMemo(()=>n.map(L=>({key:L.empleadoId,label:Vo(L.empleadoId,L.empleadoNombre),total:Math.round(L.total)})).sort((L,G)=>G.total-L.total),[n]),C=L=>{z(L),P("efectivo"),Y(null)},H=()=>{$||(z(null),Y(null))},Q=async()=>{if(!B)return;const L=jN(de);try{Y(null),A(B.order.id),await t(B.order,{metodo:L}),z(null)}catch(G){console.error("Error registrando el pago del crédito del empleado:",G),Y("No se pudo registrar el pago. Inténtalo nuevamente.")}finally{A(null)}};return r.jsxs("section",{className:"space-y-6",children:[r.jsxs("header",{className:"space-y-2",children:[r.jsx("h2",{className:"text-2xl font-bold",style:{color:v.dark},children:"Crédito empleados"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Consulta los créditos asignados a colaboradores, revisa el historial de movimientos y liquida los pendientes directamente desde la plataforma."}),l&&r.jsx("div",{className:"mt-2 px-3 py-2 rounded-md bg-red-50 border border-red-200 text-sm text-red-600",children:l})]}),r.jsxs("section",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(ku,{size:18}),r.jsx("span",{children:"Rango de fechas"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Desde",r.jsx("input",{type:"date",value:h,max:x,onChange:L=>m(L.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Hasta",r.jsx("input",{type:"date",value:x,min:h,onChange:L=>w(L.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]})]}),r.jsxs("label",{className:"flex flex-col text-xs font-medium text-gray-600 gap-1",children:["Fecha exacta (opcional)",r.jsx("input",{type:"date",value:S,max:u,onChange:L=>E(L.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent}})]}),S&&r.jsx("p",{className:"text-[11px] text-gray-500",children:"Al seleccionar una fecha exacta se ignora el rango indicado arriba."})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(Rr,{size:18}),r.jsx("span",{children:"Filtrar resultados"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("select",{value:y,onChange:L=>f(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"todos",children:"Todos los empleados"}),ye.map(({key:L,label:G})=>r.jsx("option",{value:L,children:G},L))]}),r.jsxs("select",{value:g,onChange:L=>b(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:border-transparent",style:{"--tw-ring-color":v.accent},children:[r.jsx("option",{value:"todos",children:"Todos los movimientos"}),r.jsx("option",{value:"cargo",children:"Solo cargos (créditos otorgados)"}),r.jsx("option",{value:"abono",children:"Solo abonos (pagos)"})]})]})]}),r.jsxs("div",{className:"ui-card ui-card-pad space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 font-medium",children:[r.jsx(id,{size:18}),r.jsx("span",{children:"Resumen del período"})]}),r.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[r.jsxs("p",{children:["Total pendiente (global):"," ",r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:W(re)})]}),r.jsxs("p",{children:["Créditos pendientes filtrados:"," ",r.jsx("span",{className:"font-semibold",style:{color:v.accent},children:W(Z)})]}),r.jsxs("p",{children:["Cargos filtrados:"," ",r.jsx("span",{className:"font-semibold text-rose-600",children:W(ie)})]}),r.jsxs("p",{children:["Abonos filtrados:"," ",r.jsx("span",{className:"font-semibold text-green-600",children:W(O)})]}),r.jsxs("p",{children:["Neto del período:"," ",r.jsx("span",{className:"font-semibold",style:{color:se>=0?v.dark:"#047857"},children:W(se)})]}),r.jsxs("p",{children:["Movimientos filtrados:"," ",r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:_.length})]})]})]})]}),r.jsxs("section",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"xl:col-span-2 ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Créditos pendientes por pedido"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Pedidos asignados como crédito de empleados dentro del filtro seleccionado."})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha asignación"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empleado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Pedido"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Estado actual"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor pendiente"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-100",children:[ue.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay créditos de empleados para el filtro seleccionado."})}),ue.map(L=>{const{order:G,assignedAt:fe,amount:Se,employeeLabel:ze}=L,Fe=G.creditInfo?"Crédito empleados en seguimiento":co(jn(G),W),Ie=$===G.id;return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:vN(fe)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:ze}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden md:table-cell",children:G.numero?`#${G.numero}`:G.id}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-500 hidden lg:table-cell",children:Fe}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs font-semibold",style:{color:v.accent},children:W(Se)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:[s&&r.jsxs("button",{type:"button",onClick:()=>s(G),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full border border-blue-200 text-blue-600 hover:border-blue-600 hover:bg-blue-600 hover:text-white transition-colors",children:[r.jsx(id,{size:14}),"Ver comanda"]}),r.jsxs("button",{type:"button",onClick:()=>C(L),disabled:Ie,className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full bg-green-600 text-white font-semibold hover:bg-green-700 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:[Ie?r.jsx(ft,{size:14,className:"animate-spin"}):r.jsx(Ii,{size:14}),Ie?"Procesando...":"Registrar pago"]})]})})]},G.id)})]})]})})]}),r.jsxs("div",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Saldo por empleado"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Total de créditos pendientes acumulados por colaborador."})]}),r.jsxs("div",{className:"divide-y divide-gray-100",children:[R.length===0&&r.jsx("p",{className:"px-4 py-6 text-xs lg:text-sm text-gray-500 text-center",children:"No hay créditos pendientes registrados."}),R.map(({key:L,label:G,total:fe})=>r.jsxs("div",{className:"px-4 py-3 flex items-center justify-between text-sm",children:[r.jsx("span",{className:"font-medium text-gray-600",children:G}),r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:W(fe)})]},L))]})]})]}),r.jsxs("section",{className:"ui-card",children:[r.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Historial de movimientos"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Registros de cargos (créditos asignados) y abonos (pagos) según los filtros seleccionados."})]}),r.jsx(ld,{size:18,className:"text-gray-400"})]}),r.jsx("div",{className:"ui-card-pad ui-table-wrapper",children:r.jsxs("table",{className:"ui-table",children:[r.jsx("thead",{className:"bg-gray-50",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Empleado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Movimiento"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell",children:"Pedido relacionado"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),r.jsx("th",{className:"px-3 lg:px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell",children:"Saldo acumulado"})]})}),r.jsxs("tbody",{className:"bg-white divide-y divide-gray-100",children:[o&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"Cargando historial de movimientos..."})}),!o&&_.length===0&&r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-3 lg:px-6 py-8 text-center text-xs lg:text-sm text-gray-500",children:"No hay movimientos registrados para los filtros seleccionados."})}),!o&&_.map(L=>{const G=L.tipo==="cargo"?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700";return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:bN(L.timestamp)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600",children:L.empleadoNombre??Vo(L.empleadoId)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs",children:r.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-[11px] font-semibold ${G}`,children:L.tipo==="cargo"?"Cargo":"Abono"})}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-gray-600 hidden md:table-cell",children:typeof L.orderNumero=="number"?`#${L.orderNumero}`:L.orderId?L.orderId.slice(0,8):"—"}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-right font-semibold",style:{color:L.tipo==="cargo"?v.accent:"#047857"},children:W(L.monto)}),r.jsx("td",{className:"px-3 lg:px-6 py-3 text-xs text-right text-gray-600 hidden lg:table-cell",children:typeof L.balanceAfter=="number"?W(L.balanceAfter):"—"})]},L.id)})]})]})})]}),B&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"ui-card ui-card-pad w-full max-w-lg shadow-xl",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",style:{color:v.dark},children:"Registrar pago del crédito"}),r.jsx("p",{className:"text-xs text-gray-500",children:"Selecciona el método con el que el colaborador liquida el crédito pendiente."})]}),r.jsx("button",{type:"button",onClick:H,className:"text-gray-400 hover:text-gray-600","aria-label":"Cerrar",children:r.jsx(Lr,{size:18})})]}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[r.jsxs("p",{children:["Pedido:"," ",r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:B.order.numero?`#${B.order.numero}`:B.order.id})]}),r.jsxs("p",{children:["Empleado:"," ",r.jsx("span",{className:"font-semibold",style:{color:v.dark},children:B.employeeLabel})]}),r.jsxs("p",{children:["Monto pendiente:"," ",r.jsx("span",{className:"font-semibold text-green-600",children:W(B.amount)})]})]}),r.jsxs("div",{className:"mt-4 space-y-2",children:[r.jsx("p",{className:"text-xs font-semibold text-gray-600",children:"Método de pago recibido"}),r.jsx("div",{className:"space-y-2",children:yx.map(L=>{const G=de===L.value;return r.jsxs("label",{className:`flex items-start gap-3 border rounded-lg p-3 cursor-pointer transition-colors ${G?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-200"}`,children:[r.jsx("input",{type:"radio",className:"mt-1",checked:G,onChange:()=>P(L.value)}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-semibold text-gray-700",children:L.label}),r.jsx("p",{className:"text-xs text-gray-500",children:L.description})]})]},L.value)})})]}),D&&r.jsx("p",{className:"mt-3 text-sm text-red-600",children:D}),r.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[r.jsx("button",{type:"button",onClick:H,className:"px-4 py-2 rounded-lg border border-gray-300 text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancelar"}),r.jsx("button",{type:"button",onClick:Q,disabled:$===B.order.id,className:"px-4 py-2 rounded-lg bg-green-600 text-white text-sm font-semibold hover:bg-green-700 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",children:$===B.order.id?r.jsxs("span",{className:"inline-flex items-center gap-2",children:[r.jsx(ft,{size:16,className:"animate-spin"})," Procesando"]}):"Registrar pago"})]})]})})]})}const $m={gastos:{label:"Gastos",bg:"bg-red-50",text:"text-red-700",border:"border-red-200",dot:"bg-red-400"},horarios:{label:"Horarios",bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200",dot:"bg-blue-400"},ventas:{label:"Ventas",bg:"bg-emerald-50",text:"text-emerald-700",border:"border-emerald-200",dot:"bg-emerald-400"}};function aa(e){const t=e.getFullYear(),s=`${e.getMonth()+1}`.padStart(2,"0"),n=`${e.getDate()}`.padStart(2,"0");return`${t}-${s}-${n}`}function NN(e){return`${["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"][e.getMonth()]} ${e.getFullYear()}`}function Rm(e,t){return new Date(e.getFullYear(),e.getMonth()+t,1)}function kN(e){const t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0),n=(t.getDay()+6)%7,a=(s.getDay()+6)%7,o=new Date(t);o.setDate(t.getDate()-n);const i=new Date(s);i.setDate(s.getDate()+(6-a));const l=[],c=new Date(o);for(;c<=i;)l.push(new Date(c)),c.setDate(c.getDate()+1);return l}const SN=["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"],Lm={gastos:0,horarios:1,ventas:2};function _N({onNavigateToComandas:e,onNavigateToGastos:t}){const[s,n]=p.useState(()=>{const f=new Date;return new Date(f.getFullYear(),f.getMonth(),1)}),[a,o]=p.useState([]),[i,l]=p.useState([]),[c,d]=p.useState({}),u=p.useRef(new Set),[h,m]=p.useState(!0),[x,w]=p.useState(null),S=p.useMemo(()=>kN(s),[s]);p.useEffect(()=>{let f=!0;return(async()=>{m(!0);try{const[b,$]=await Promise.all([xe.fetchOrders(),xe.fetchGastos()]);if(!f)return;o(b),l($),w(null)}catch(b){console.error("[Novedades] No se pudieron cargar todas las novedades.",b),f&&w("No se pudieron cargar todas las novedades.")}finally{f&&m(!1)}})(),()=>{f=!1}},[]),p.useEffect(()=>{if(S.length===0)return;Array.from(new Set(S.map(g=>Ru(g)))).forEach(g=>{!g||u.current.has(g)||(u.current.add(g),xe.fetchEmployeeWeeklyHoursForWeek(g).then(b=>{d($=>({...$,[g]:b}))}).catch(b=>{console.error(`[Novedades] Error cargando horas semanales para ${g}.`,b)}))})},[S]);const E=p.useMemo(()=>{const f={},g=b=>(f[b]||(f[b]={ventasTotal:0,ventasCount:0,gastosTotal:0,gastosCount:0,horariosCount:0}),f[b]);return a.forEach(b=>{const $=b.timestamp instanceof Date?b.timestamp:new Date(b.timestamp);if(Number.isNaN($.getTime()))return;const A=aa($),B=g(A),z=Math.max(0,Math.round(Number(b.total)||0));B.ventasTotal+=z,B.ventasCount+=1}),i.forEach(b=>{const $=b.fecha instanceof Date?b.fecha:new Date(b.fecha);if(Number.isNaN($.getTime()))return;const A=aa($),B=g(A),z=Math.max(0,Math.round(Number(b.monto)||0));B.gastosTotal+=z,B.gastosCount+=1}),Object.entries(c).forEach(([b,$])=>{if(!$)return;const A=Ur(b);Number.isNaN(A.getTime())||pt.forEach((B,z)=>{const de=new Date(A);de.setDate(A.getDate()+z);const P=aa(de);Object.values($).forEach(D=>{const Y=Number(D==null?void 0:D[B]);if(!Number.isFinite(Y)||Y<=0)return;const K=g(P);K.horariosCount+=1})})}),f},[i,c,a]),y=aa(new Date);return r.jsx("section",{className:"min-h-[calc(100vh-4rem)] bg-white",children:r.jsxs("div",{className:"mx-auto max-w-7xl px-6 py-10",children:[r.jsxs("header",{className:"flex flex-col gap-6 pb-8 border-b border-gray-200",children:[r.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-3 rounded-xl bg-gray-900 text-white shadow-sm",children:r.jsx(Zp,{size:28})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wider",children:"Novedades"}),r.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Calendario de novedades"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{type:"button",onClick:()=>n(f=>Rm(f,-1)),className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:r.jsx(rv,{size:20})}),r.jsx("span",{className:"text-lg font-semibold text-gray-900 capitalize min-w-[140px] text-center",children:NN(s)}),r.jsx("button",{type:"button",onClick:()=>n(f=>Rm(f,1)),className:"p-2 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:r.jsx(av,{size:20})})]})]}),r.jsx("div",{className:"flex flex-wrap gap-3",children:Object.entries($m).map(([f,g])=>r.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-full border ${g.bg} ${g.border}`,children:[r.jsx("span",{className:`h-2.5 w-2.5 rounded-full ${g.dot}`}),r.jsx("span",{className:`text-sm font-medium ${g.text}`,children:g.label})]},f))})]}),r.jsxs("div",{className:"pt-8",children:[h&&r.jsx("p",{className:"mb-4 text-sm text-gray-500",children:"Cargando novedades..."}),x&&!h&&r.jsx("p",{className:"mb-4 text-sm text-red-500",children:x}),r.jsx("div",{className:"grid grid-cols-7 text-center text-sm font-semibold text-gray-500 uppercase tracking-wide",children:SN.map(f=>r.jsx("div",{className:"py-2",children:f},f))}),r.jsx("div",{className:"grid grid-cols-7 gap-px bg-gray-200 rounded-xl overflow-hidden shadow-sm",children:S.map(f=>{const g=aa(f),b=E[g],$=[];if(b!=null&&b.ventasCount&&$.push({key:"ventas",label:`Ventas · ${W(b.ventasTotal)}`,onClick:e?()=>e(g):void 0}),b!=null&&b.gastosCount&&$.push({key:"gastos",label:`Gastos · ${W(b.gastosTotal)}`,onClick:t?()=>t(g):void 0}),b!=null&&b.horariosCount){const z=b.horariosCount;$.push({key:"horarios",label:`Horarios · ${z} ${z===1?"novedad":"novedades"}`})}$.sort((z,de)=>Lm[z.key]-Lm[de.key]);const A=f.getMonth()===s.getMonth(),B=g===y;return r.jsxs("div",{className:`bg-white p-3 min-h-[140px] flex flex-col gap-2 transition-colors ${A?"text-gray-900":"text-gray-400"} ${B?"ring-2 ring-gray-900 ring-offset-2 ring-offset-white":""}`,children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsx("span",{className:`text-sm font-semibold ${B?"text-gray-900":""}`,children:f.getDate()})}),r.jsx("div",{className:"flex-1 space-y-2 overflow-hidden",children:$.length===0?r.jsx("p",{className:"text-xs text-gray-300 font-medium",children:"Sin novedades"}):r.jsx("ul",{className:"space-y-2",children:$.map(z=>{const de=$m[z.key],P=r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:`h-2 w-2 rounded-full ${de.dot}`}),r.jsx("span",{className:`text-xs font-semibold ${de.text} truncate`,children:z.label})]});return r.jsx("li",{children:z.onClick?r.jsx("button",{type:"button",onClick:z.onClick,className:`w-full text-left rounded-lg border ${de.bg} ${de.border} px-3 py-2 transition-shadow hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900`,children:P}):r.jsx("div",{className:`rounded-lg border ${de.bg} ${de.border} px-3 py-2`,children:P})},z.key)})})})]},g+f.getDate())})})]})]})})}const rr="savia-user-session",CN=13*60*60*1e3;function EN(){const[e,t]=p.useState(null),[s,n]=p.useState("dashboard"),[a,o]=p.useState([]),[i,l]=p.useState([]),[c,d]=p.useState([]),[u,h]=p.useState("checking"),[m,x]=p.useState(null),[w,S]=p.useState(null),[E,y]=p.useState(!1),[f,g]=p.useState(!1);p.useEffect(()=>{Mv();try{const C=localStorage.getItem(rr);if(!C)return;const H=JSON.parse(C);if(!(H&&H.user&&typeof H.timestamp=="number")){localStorage.removeItem(rr);return}if(Date.now()-H.timestamp>CN){localStorage.removeItem(rr);return}t(H.user)}catch(C){console.error("[App] No se pudo restaurar la sesión guardada.",C),localStorage.removeItem(rr)}},[]),p.useEffect(()=>{if(!e)return;let C=!0;return(async()=>{const Q=await xe.fetchMenuItems();C&&o(Q)})(),()=>{C=!1}},[e]),p.useEffect(()=>{let C=!0;const H=async()=>{try{const L=await xe.checkDatabaseConnection();C&&h(L)}catch(L){console.error("[App] Error verificando la conexión con la base de datos.",L),C&&h("local")}};H();const Q=window.setInterval(H,3e4);return()=>{C=!1,window.clearInterval(Q)}},[]),p.useEffect(()=>{if(!e){y(!1),g(!1);return}let C=!0;return(async()=>{try{C&&y(!0);const Q=await xe.fetchOrders();C&&l(Q)}catch(Q){console.error("[App] Error obteniendo comandas.",Q)}finally{C&&y(!1)}})(),()=>{C=!1}},[e]),p.useEffect(()=>{if(!e)return;let C=!0,H,Q=!1;const L=async()=>{if(!(!C||Q)){Q=!0,g(!0);try{const fe=await xe.fetchOrders();C&&l(fe)}catch(fe){console.error("[App] Error actualizando comandas tras cambios remotos.",fe)}finally{C&&g(!1),Q=!1}}};return(async()=>{try{H=await xe.subscribeToOrders({onChange:L,debounceMs:400})}catch(fe){console.error("[App] No se pudo suscribir a los cambios de comandas.",fe)}})(),()=>{C=!1,H&&H()}},[e]),p.useEffect(()=>{if(!e)return;let C=!0;return(async()=>{const Q=await xe.fetchCustomers();C&&d(Q)})(),()=>{C=!1}},[e]);const b=C=>{t(C);try{const H={user:C,timestamp:Date.now()};localStorage.setItem(rr,JSON.stringify(H))}catch(H){console.error("[App] No se pudo guardar la sesión del usuario.",H)}},$=()=>{t(null),n("dashboard"),o([]),l([]),d([]);try{localStorage.removeItem(rr)}catch(C){console.error("[App] No se pudo limpiar la sesión guardada.",C)}},A=C=>{(C==="analitica"||C==="contabilidad")&&(e==null?void 0:e.role)!=="admin"||(C==="comandas"&&x(null),n(C))},B=C=>{const H=C.getFullYear(),Q=String(C.getMonth()+1).padStart(2,"0"),L=String(C.getDate()).padStart(2,"0");return`${H}-${Q}-${L}`},z=(C,H)=>({dateKey:C,orderId:H,requestId:Date.now()}),de=C=>{x(z(C)),n("comandas")},P=C=>{const H=B(C.timestamp);x(z(H,C.id)),n("comandas")},D=C=>{S(z(C)),n("gastos")},Y=async C=>{const H=await xe.createMenuItem(C);o([...a,H])},K=async C=>{const H=await xe.updateMenuItem(C);o(a.map(Q=>Q.id===H.id?H:Q))},pe=async C=>{await xe.deleteMenuItem(C),o(a.filter(H=>H.id!==C))},ye=async C=>{const H=await xe.createOrder(C);l(Q=>[...Q,H])},ue=async(C,H)=>{try{const Q=await xe.recordOrderPayment(C,H);l(L=>L.map(G=>G.id===Q.id?Q:G))}catch(Q){throw console.error("Error registrando el pago del pedido:",Q),Q}},Z=async(C,H)=>{try{const Q=await xe.assignOrderCredit(C,H);l(L=>L.map(G=>G.id===Q.id?Q:G))}catch(Q){throw console.error("Error asignando el pedido a crédito de empleados:",Q),Q}},re=async(C,H)=>{try{const Q=await xe.settleOrderEmployeeCredit(C,H);l(L=>L.map(G=>G.id===Q.id?Q:G))}catch(Q){throw console.error("Error marcando el crédito de empleados como pagado:",Q),Q}},ae=async(C,H)=>{try{const Q=await xe.updateOrderStatus(C,H);l(L=>{const G=L.findIndex(Se=>Se.id===Q.id);if(G===-1)return L;const fe=[...L];return fe[G]=Q,fe})}catch(Q){console.error("Error actualizando el estado del pedido:",Q),alert("No se pudo actualizar el estado del pedido. Inténtalo nuevamente.")}},_=async(C,H)=>{try{await xe.updateOrder(C,H),l(Q=>Q.map(L=>L.id===C?{...L,items:H.items,total:H.total,paymentAllocations:[],paymentStatus:"pendiente",paymentRegisteredAt:void 0}:L))}catch(Q){throw console.error("Error actualizando la orden:",Q),Q}},ie=async C=>{try{await xe.deleteOrder(C),l(H=>H.filter(Q=>Q.id!==C))}catch(H){throw console.error("Error eliminando la comanda:",H),H}},O=async C=>{const H=await xe.createCustomer(C);d([...c,H])},se=async C=>{await xe.updateCustomer(C),d(c.map(H=>H.id===C.id?C:H))},R=async C=>{await xe.deleteCustomer(C),d(c.filter(H=>H.id!==C))};return e?r.jsxs("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:[r.jsx(tN,{activeModule:s,onModuleChange:A,user:e,onLogout:$,connectionStatus:u}),r.jsx("main",{className:"ui-page py-6",children:r.jsxs("div",{className:"ui-page-stack",children:[s==="dashboard"&&r.jsx(Rv,{orders:i,menuItems:a,onModuleChange:A}),s==="balance"&&r.jsx(b1,{}),s==="caja"&&r.jsx(C1,{orders:i,onModuleChange:A,onCreateOrder:ye,onRecordOrderPayment:ue,onAssignOrderCredit:Z}),s==="comandas"&&r.jsx(T1,{orders:i,onUpdateOrderStatus:ae,onSaveOrderChanges:_,onRecordOrderPayment:ue,onDeleteOrder:ie,isAdmin:e.role==="admin",onAssignOrderCredit:Z,focusRequest:m,isLoading:E,isSyncing:f}),s==="inventario"&&r.jsx(M1,{menuItems:a,onUpdateMenuItem:K,onCreateMenuItem:Y,onDeleteMenuItem:pe}),s==="cocina"&&r.jsx(P1,{orders:i,onUpdateOrderStatus:ae}),s==="clientes"&&r.jsx(D1,{customers:c,onAddCustomer:O,onUpdateCustomer:se,onDeleteCustomer:R}),s==="empleados"&&r.jsx(W1,{}),s==="gastos"&&r.jsx(q1,{focusRequest:w}),s==="contabilidad"&&e.role==="admin"&&r.jsx(J1,{}),s==="novedades"&&r.jsx(_N,{onNavigateToComandas:de,onNavigateToGastos:D}),s==="creditoEmpleados"&&r.jsx(wN,{orders:i,onSettleCredit:re,onViewOrder:P}),s==="analitica"&&e.role==="admin"&&r.jsx(yN,{orders:i})]})})]}):r.jsx(eN,{onLogin:b})}Xp(document.getElementById("root")).render(r.jsx(p.StrictMode,{children:r.jsx(EN,{})}));
